INFO:birdwatch.runner:scorer python version: 3.11.14 (main, Oct  9 2025, 16:16:55) [Clang 16.0.0 (clang-1600.0.26.6)]
INFO:birdwatch.runner:scorer pandas version: 2.3.3
INFO:birdwatch.runner:beginning scorer execution
INFO:birdwatch.process_data:Timestamp of latest rating in data: 2026-01-26 02:52:16.873000
INFO:birdwatch.process_data:Timestamp of latest note in data: 2026-01-19 01:00:58.391000
INFO:birdwatch.process_data:Total raters: 623657
INFO:birdwatch.process_data:Identifying high volume raters
INFO:birdwatch.process_data:Total ratings: 4007501
INFO:birdwatch.process_data:High volume threshold for 7 days: 4.740000000000009
INFO:birdwatch.process_data:High volume raters for 7 days: 1
INFO:birdwatch.process_data:High volume threshold for 28 days: 19.0
INFO:birdwatch.process_data:High volume raters for 28 days: 50
INFO:birdwatch.process_data:Total high volume raters: 51
INFO:birdwatch.process_data:Total ratings: 4007501
INFO:birdwatch.process_data:Total ratings from high volume raters: 20858

CONCAT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_status_history.py, in merge_note_info, at line 31: newNoteStatusHistory = oldNoteStatusHistory.merge(
  PandasTypeError: Type expectation mismatch on noteId: found=float64 expected=int64
  PandasTypeError: Type expectation mismatch on noteId: found=float64 expected=int64


MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_status_history.py, in merge_note_info, at line 31: newNoteStatusHistory = oldNoteStatusHistory.merge(
  PandasTypeError: Output mismatch on createdAtMillis: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on createdAtMillis_notes: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_status_history:total notes added to noteStatusHistory: 145122

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_status_history.py, in merge_note_info, at line 57: newNoteStatusHistory[[c.noteIdKey, c.createdAtMillisKey]].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=float64 vs right=int64 (allowed)
  PandasTypeError: Merge key mismatch on createdAtMillis: left=float64 vs right=int64 (allowed)


MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/process_data.py, in _filter_misleading_notes, at line 298: ratings = ratings.merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.process_data:Preprocess Data: Filter misleading notes, starting with 4007501 ratings on 44476 notes
INFO:birdwatch.process_data:  Keeping 3283088 ratings on 34889 misleading notes
INFO:birdwatch.process_data:  Keeping 0 ratings on 0 deleted notes that were previously scored (in note status history)
INFO:birdwatch.process_data:  Removing 6416 ratings on 419 older notes that aren't deleted, but are not-misleading.
INFO:birdwatch.process_data:  Removing 0 ratings on 0 notes that were deleted and not in note status history (e.g. old).
INFO:birdwatch.process_data:Num Ratings: 4001085, Num Unique Notes Rated: 44057, Num Unique Raters: 623416
INFO:birdwatch.process_data:Called filter_input_data_for_testing.
        Notes: 2347611, Ratings: 4001085. Max note createdAt: 2026-01-19 01:00:58.391000; Max rating createAt: 2026-01-26 02:52:16.873000
INFO:birdwatch.process_data:After filtering notes and ratings after particular timestamp (=None). 
        Notes: 2347611, Ratings: 4001085. Max note createdAt: 2026-01-19 01:00:58.391000; Max rating createAt: 2026-01-26 02:52:16.873000
INFO:birdwatch.process_data:After filtering ratings after first status (plus None hours) for notes created in last 14 days. 
        Notes: 2347611, Ratings: 4001085. Max note createdAt: 2026-01-19 01:00:58.391000; Max rating createAt: 2026-01-26 02:52:16.873000
INFO:birdwatch.process_data:After filtering prescoring notes and ratings to simulate a delay of None hours: 
        Notes: 2347611, Ratings: 4001085. Max note createdAt: 2026-01-19 01:00:58.391000; Max rating createAt: 2026-01-26 02:52:16.873000
INFO:birdwatch.constants:Compute pair counts dict elapsed time: 396.47 secs (6.61 mins)
INFO:birdwatch.constants:Compute PMI and minSim elapsed time: 193.23 secs (3.22 mins)
INFO:birdwatch.constants:Delete unneeded pairs from pairCountsDict elapsed time: 96.22 secs (1.60 mins)
INFO:birdwatch.constants:Aggregate into cliques by post selection similarity elapsed time: 3.46 secs (0.06 mins)
INFO:birdwatch.constants:Compute Post Selection Similarity elapsed time: 718.51 secs (11.98 mins)
--- Logging error ---
Traceback (most recent call last):
  File "/usr/local/Cellar/python@3.11/3.11.14_2/Frameworks/Python.framework/Versions/3.11/lib/python3.11/logging/__init__.py", line 1110, in emit
    msg = self.format(record)
          ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.11/3.11.14_2/Frameworks/Python.framework/Versions/3.11/lib/python3.11/logging/__init__.py", line 953, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.11/3.11.14_2/Frameworks/Python.framework/Versions/3.11/lib/python3.11/logging/__init__.py", line 687, in format
    record.message = record.getMessage()
                     ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.11/3.11.14_2/Frameworks/Python.framework/Versions/3.11/lib/python3.11/logging/__init__.py", line 377, in getMessage
    msg = msg % self.args
          ~~~~^~~~~~~~~~~
TypeError: not all arguments converted during string formatting
Call stack:
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/main.py", line 31, in <module>
    main()
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/runner.py", line 278, in main
    return _run_scorer(args=args, dataLoader=dataLoader, extraScoringArgs=extraScoringArgs)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pandas_utils.py", line 722, in _inner
    retVal = main(*args, **kwargs)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/runner.py", line 231, in _run_scorer
    scoredNotes, helpfulnessScores, newStatus, auxNoteInfo = run_scoring(
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py", line 2080, in run_scoring
    postSelectionSimilarityValues = run_rater_clustering(notes=notes, ratings=ratings)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py", line 1188, in run_rater_clustering
    quasiCliques = qcd.get_quasi_cliques(notes, ratings)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/quasi_clique_detection.py", line 256, in get_quasi_cliques
    raterPairCounts, raterPairRatings = self._get_pair_counts(ratings, notes, self._recencyCutoff)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/quasi_clique_detection.py", line 60, in _get_pair_counts
    logger.info("initial rating length:", len(ratings))
Message: 'initial rating length:'
Arguments: (4001085,)
--- Logging error ---
Traceback (most recent call last):
  File "/usr/local/Cellar/python@3.11/3.11.14_2/Frameworks/Python.framework/Versions/3.11/lib/python3.11/logging/__init__.py", line 1110, in emit
    msg = self.format(record)
          ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.11/3.11.14_2/Frameworks/Python.framework/Versions/3.11/lib/python3.11/logging/__init__.py", line 953, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.11/3.11.14_2/Frameworks/Python.framework/Versions/3.11/lib/python3.11/logging/__init__.py", line 687, in format
    record.message = record.getMessage()
                     ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.11/3.11.14_2/Frameworks/Python.framework/Versions/3.11/lib/python3.11/logging/__init__.py", line 377, in getMessage
    msg = msg % self.args
          ~~~~^~~~~~~~~~~
TypeError: not all arguments converted during string formatting
Call stack:
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/main.py", line 31, in <module>
    main()
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/runner.py", line 278, in main
    return _run_scorer(args=args, dataLoader=dataLoader, extraScoringArgs=extraScoringArgs)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pandas_utils.py", line 722, in _inner
    retVal = main(*args, **kwargs)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/runner.py", line 231, in _run_scorer
    scoredNotes, helpfulnessScores, newStatus, auxNoteInfo = run_scoring(
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py", line 2080, in run_scoring
    postSelectionSimilarityValues = run_rater_clustering(notes=notes, ratings=ratings)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py", line 1188, in run_rater_clustering
    quasiCliques = qcd.get_quasi_cliques(notes, ratings)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/quasi_clique_detection.py", line 256, in get_quasi_cliques
    raterPairCounts, raterPairRatings = self._get_pair_counts(ratings, notes, self._recencyCutoff)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/quasi_clique_detection.py", line 67, in _get_pair_counts
    logger.info("ratings after merges:", len(ratings))
Message: 'ratings after merges:'
Arguments: (4001085,)
--- Logging error ---
Traceback (most recent call last):
  File "/usr/local/Cellar/python@3.11/3.11.14_2/Frameworks/Python.framework/Versions/3.11/lib/python3.11/logging/__init__.py", line 1110, in emit
    msg = self.format(record)
          ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.11/3.11.14_2/Frameworks/Python.framework/Versions/3.11/lib/python3.11/logging/__init__.py", line 953, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.11/3.11.14_2/Frameworks/Python.framework/Versions/3.11/lib/python3.11/logging/__init__.py", line 687, in format
    record.message = record.getMessage()
                     ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.11/3.11.14_2/Frameworks/Python.framework/Versions/3.11/lib/python3.11/logging/__init__.py", line 377, in getMessage
    msg = msg % self.args
          ~~~~^~~~~~~~~~~
TypeError: not all arguments converted during string formatting
Call stack:
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/main.py", line 31, in <module>
    main()
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/runner.py", line 278, in main
    return _run_scorer(args=args, dataLoader=dataLoader, extraScoringArgs=extraScoringArgs)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pandas_utils.py", line 722, in _inner
    retVal = main(*args, **kwargs)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/runner.py", line 231, in _run_scorer
    scoredNotes, helpfulnessScores, newStatus, auxNoteInfo = run_scoring(
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py", line 2080, in run_scoring
    postSelectionSimilarityValues = run_rater_clustering(notes=notes, ratings=ratings)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py", line 1188, in run_rater_clustering
    quasiCliques = qcd.get_quasi_cliques(notes, ratings)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/quasi_clique_detection.py", line 256, in get_quasi_cliques
    raterPairCounts, raterPairRatings = self._get_pair_counts(ratings, notes, self._recencyCutoff)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/quasi_clique_detection.py", line 69, in _get_pair_counts
    logger.info("recent ratings:", len(ratings))
Message: 'recent ratings:'
Arguments: (358354,)
--- Logging error ---
Traceback (most recent call last):
  File "/usr/local/Cellar/python@3.11/3.11.14_2/Frameworks/Python.framework/Versions/3.11/lib/python3.11/logging/__init__.py", line 1110, in emit
    msg = self.format(record)
          ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.11/3.11.14_2/Frameworks/Python.framework/Versions/3.11/lib/python3.11/logging/__init__.py", line 953, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.11/3.11.14_2/Frameworks/Python.framework/Versions/3.11/lib/python3.11/logging/__init__.py", line 687, in format
    record.message = record.getMessage()
                     ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.11/3.11.14_2/Frameworks/Python.framework/Versions/3.11/lib/python3.11/logging/__init__.py", line 377, in getMessage
    msg = msg % self.args
          ~~~~^~~~~~~~~~~
TypeError: not all arguments converted during string formatting
Call stack:
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/main.py", line 31, in <module>
    main()
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/runner.py", line 278, in main
    return _run_scorer(args=args, dataLoader=dataLoader, extraScoringArgs=extraScoringArgs)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pandas_utils.py", line 722, in _inner
    retVal = main(*args, **kwargs)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/runner.py", line 231, in _run_scorer
    scoredNotes, helpfulnessScores, newStatus, auxNoteInfo = run_scoring(
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py", line 2080, in run_scoring
    postSelectionSimilarityValues = run_rater_clustering(notes=notes, ratings=ratings)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py", line 1188, in run_rater_clustering
    quasiCliques = qcd.get_quasi_cliques(notes, ratings)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/quasi_clique_detection.py", line 256, in get_quasi_cliques
    raterPairCounts, raterPairRatings = self._get_pair_counts(ratings, notes, self._recencyCutoff)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/quasi_clique_detection.py", line 71, in _get_pair_counts
    logger.info("ratings on non-deleted tweets:", len(ratings))
Message: 'ratings on non-deleted tweets:'
Arguments: (358354,)
--- Logging error ---
Traceback (most recent call last):
  File "/usr/local/Cellar/python@3.11/3.11.14_2/Frameworks/Python.framework/Versions/3.11/lib/python3.11/logging/__init__.py", line 1110, in emit
    msg = self.format(record)
          ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.11/3.11.14_2/Frameworks/Python.framework/Versions/3.11/lib/python3.11/logging/__init__.py", line 953, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.11/3.11.14_2/Frameworks/Python.framework/Versions/3.11/lib/python3.11/logging/__init__.py", line 687, in format
    record.message = record.getMessage()
                     ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.11/3.11.14_2/Frameworks/Python.framework/Versions/3.11/lib/python3.11/logging/__init__.py", line 377, in getMessage
    msg = msg % self.args
          ~~~~^~~~~~~~~~~
TypeError: not all arguments converted during string formatting
Call stack:
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/main.py", line 31, in <module>
    main()
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/runner.py", line 278, in main
    return _run_scorer(args=args, dataLoader=dataLoader, extraScoringArgs=extraScoringArgs)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pandas_utils.py", line 722, in _inner
    retVal = main(*args, **kwargs)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/runner.py", line 231, in _run_scorer
    scoredNotes, helpfulnessScores, newStatus, auxNoteInfo = run_scoring(
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py", line 2080, in run_scoring
    postSelectionSimilarityValues = run_rater_clustering(notes=notes, ratings=ratings)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py", line 1188, in run_rater_clustering
    quasiCliques = qcd.get_quasi_cliques(notes, ratings)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/quasi_clique_detection.py", line 256, in get_quasi_cliques
    raterPairCounts, raterPairRatings = self._get_pair_counts(ratings, notes, self._recencyCutoff)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/quasi_clique_detection.py", line 73, in _get_pair_counts
    logger.info("ratings on misleading posts:", len(ratings))
Message: 'ratings on misleading posts:'
Arguments: (306449,)
INFO:birdwatch.quasi_clique_detection:Preparing pairs for 2752 tweets
INFO:birdwatch.quasi_clique_detection:0
INFO:birdwatch.quasi_clique_detection:1000
INFO:birdwatch.quasi_clique_detection:2000
INFO:birdwatch.quasi_clique_detection:ratings after filter to raters included in pair counts: 80038
INFO:birdwatch.quasi_clique_detection:orig raterPairCounts: 130185
INFO:birdwatch.quasi_clique_detection:pruned raterPairCounts: 193
INFO:birdwatch.quasi_clique_detection:Skipping clique  (raters=3, tweets=32).  Remaining ratePairCounts: 191
INFO:birdwatch.quasi_clique_detection:Adding clique  (raters=38, tweets=64).  Remaining ratePairCounts: 0
INFO:birdwatch.constants:Compute Quasi-Cliques elapsed time: 838.14 secs (13.97 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py, in run_rater_clustering, at line 1192: return postSelectionSimilarityValues.merge(quasiCliques, how="outer")
  PandasTypeError: Output mismatch on postSelectionValue: result=float64 expected=int64 (UNALLOWED)
  PandasTypeError: Output mismatch on quasiCliqueValue: result=float64 expected=int64 (UNALLOWED)

INFO:birdwatch.run_scoring:logging environment variables
INFO:birdwatch.run_scoring:notes total RAM: 190156863 bytes (0.190 GB)
                                    column     dtype       RAM
0                                   noteId     int64  18780888
1                  noteAuthorParticipantId    object  18780888
2                          createdAtMillis     int64  18780888
3                                  tweetId    object  18780888
4                           classification    object  18780888
5                               believable  category   2347735
6                                  harmful  category   2347735
7                     validationDifficulty  category   2347735
8                          misleadingOther      Int8   4695222
9                   misleadingFactualError      Int8   4695222
10              misleadingManipulatedMedia      Int8   4695222
11           misleadingOutdatedInformation      Int8   4695222
12       misleadingMissingImportantContext      Int8   4695222
13         misleadingUnverifiedClaimAsFact      Int8   4695222
14                        misleadingSatire      Int8   4695222
15                      notMisleadingOther      Int8   4695222
16           notMisleadingFactuallyCorrect      Int8   4695222
17  notMisleadingOutdatedButNotWhenWritten      Int8   4695222
18              notMisleadingClearlySatire      Int8   4695222
19            notMisleadingPersonalOpinion      Int8   4695222
20                      trustworthySources      Int8   4695222
21                                 summary    object  18780888
22                             isMediaNote      Int8   4695222
23                     isCollaborativeNote      Int8   4695222
INFO:birdwatch.run_scoring:ratings total RAM: 388105393 bytes (0.388 GB)
                                  column     dtype       RAM
0                                 noteId     int64  32008680
1                     raterParticipantId    object  32008680
2                        createdAtMillis     int64  32008680
3                                version      Int8   8002170
4                                  agree      Int8   8002170
5                               disagree      Int8   8002170
6                                helpful      Int8   8002170
7                             notHelpful      Int8   8002170
8                       helpfulnessLevel  category   4001217
9                           helpfulOther      Int8   8002170
10                    helpfulInformative      Int8   8002170
11                          helpfulClear      Int8   8002170
12                     helpfulEmpathetic      Int8   8002170
13                    helpfulGoodSources      Int8   8002170
14                  helpfulUniqueContext      Int8   8002170
15                 helpfulAddressesClaim      Int8   8002170
16               helpfulImportantContext      Int8   8002170
17               helpfulUnbiasedLanguage      Int8   8002170
18                       notHelpfulOther      Int8   8002170
19                   notHelpfulIncorrect      Int8   8002170
20  notHelpfulSourcesMissingOrUnreliable      Int8   8002170
21    notHelpfulOpinionSpeculationOrBias      Int8   8002170
22            notHelpfulMissingKeyPoints      Int8   8002170
23                    notHelpfulOutdated      Int8   8002170
24            notHelpfulHardToUnderstand      Int8   8002170
25       notHelpfulArgumentativeOrBiased      Int8   8002170
26                    notHelpfulOffTopic      Int8   8002170
27       notHelpfulSpamHarassmentOrAbuse      Int8   8002170
28           notHelpfulIrrelevantSources      Int8   8002170
29          notHelpfulOpinionSpeculation      Int8   8002170
30               notHelpfulNoteNotNeeded      Int8   8002170
31                        ratedOnTweetId     int64  32008680
32                  ratingSourceBucketed  category   4001101
33                            helpfulNum   float64  32008680
34                       highVolumeRater      bool   4001085
INFO:birdwatch.run_scoring:noteStatusHistory total RAM: 344547595 bytes (0.345 GB)
                                            column     dtype       RAM
0                                           noteId     int64  21367128
1                          noteAuthorParticipantId    object  21367128
2                                  createdAtMillis   float64  21367128
3               timestampMillisOfFirstNonNMRStatus   float64  21367128
4                                firstNonNMRStatus  category   2671015
5                   timestampMillisOfCurrentStatus   float64  21367128
6                                    currentStatus  category   2671023
7              timestampMillisOfLatestNonNMRStatus   float64  21367128
8                           mostRecentNonNMRStatus  category   2671015
9                      timestampMillisOfStatusLock   float64  21367128
10                                    lockedStatus  category   2671023
11                      timestampMillisOfRetroLock   float64  21367128
12                               currentCoreStatus  category   2671103
13                          currentExpansionStatus  category   2671103
14                              currentGroupStatus  category   2671095
15                                currentDecidedBy  category   2672203
16                            currentModelingGroup   float64  21367128
17         timestampMillisOfMostRecentStatusChange   float64  21367128
18       timestampMillisOfNmrDueToMinStableCrhTime   float64  21367128
19                         currentMultiGroupStatus  category   2671095
20                       currentModelingMultiGroup   float64  21367128
21             timestampMinuteOfFinalScoringOutput   float64  21367128
22  timestampMillisOfFirstNmrDueToMinStableCrhTime   float64  21367128
23                                  classification    object  21367128
INFO:birdwatch.run_scoring:userEnrollment total RAM: 77749221 bytes (0.078 GB)
                           column     dtype       RAM
0                   participantId    object  10912168
1                 enrollmentState    object  10912168
2  successfulRatingNeededToEarnIn     int64  10912168
3      timestampOfLastStateChange     int64  10912168
4          timestampOfLastEarnOut   float64  10912168
5              modelingPopulation  category   1364045
6                   modelingGroup   float64  10912168
7          numberOfTimesEarnedOut     int64  10912168
INFO:birdwatch.constants:Logging Prescoring Inputs Initial RAM usage elapsed time: 0.16 secs (0.00 mins)
INFO:birdwatch.constants:Get Note Topics: Prepare Post Text elapsed time: 57.44 secs (0.96 mins)
INFO:birdwatch.topic_model:  Notes unassigned due to multiple matches: 2095
INFO:birdwatch.constants:Get Note Topics: Make Seed Labels elapsed time: 963.69 secs (16.06 mins)
INFO:birdwatch.topic_model:  Initial vocabulary length: 3331156
INFO:birdwatch.topic_model:  Total tokens to filter: 34
INFO:birdwatch.topic_model:  Total identified stopwords: 2736
INFO:birdwatch.constants:Get Note Topics: Get Stop Words elapsed time: 467.87 secs (7.80 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/venv/lib/python3.11/site-packages/sklearn/feature_extraction/text.py:411: UserWarning: Your stop_words may be inconsistent with your preprocessing. Tokenizing the stop words generated tokens ['israeltm'] not in stop_words.
  warnings.warn(
INFO:birdwatch.constants:Get Note Topics: Train Model elapsed time: 1389.12 secs (23.15 mins)
INFO:birdwatch.topic_model:Assigning notes to topics:
INFO:birdwatch.constants:Get Note Topics: Prepare Post Text elapsed time: 53.13 secs (0.89 mins)
INFO:birdwatch.topic_model:  Balanced accuracy on raw predictions: 0.6797419556468185
INFO:birdwatch.topic_model:  Post Topic assignment results: [1336458   33907   60918    4018  107895]
INFO:birdwatch.constants:Get Note Topics: Merge and assign predictions elapsed time: 9.42 secs (0.16 mins)
INFO:birdwatch.topic_model:  Note Topic assignment results:
noteTopic
Scams              155626
GazaConflict       123652
UkraineConflict     58112
MessiRonaldo         6362
Name: count, dtype: int64
INFO:birdwatch.constants:Get Note Topics: Predict elapsed time: 391.31 secs (6.52 mins)
INFO:birdwatch.constants:Note Topic Assignment elapsed time: 3335.11 secs (55.59 mins)
INFO:birdwatch.run_scoring:ratings summary before PSS: 72d916edd8480a54840614d8a27768c12eda5a92f28ed63515d656d471f2c6ec
INFO:birdwatch.run_scoring:Post Selection Similarity Prescoring: begin with 4001085 ratings.
INFO:birdwatch.post_selection_similarity:Total ratings prior to applying post selection similarity: 4001085
INFO:birdwatch.post_selection_similarity:Total unique ratings before: 4001085
INFO:birdwatch.post_selection_similarity:Summary of postSelectionSimilarityValues: 
postSelectionValue    86
quasiCliqueValue      38
dtype: int64
INFO:birdwatch.post_selection_similarity:correlatedRater set on 13204 ratings from 38 unique raters
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/post_selection_similarity.py:243: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  ratingsWithPostSelectionSimilarityValue.sort_values(
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/post_selection_similarity.py:246: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  ratingsWithPostSelectionSimilarityValue.drop_duplicates(
INFO:birdwatch.post_selection_similarity:Total ratings after to applying post selection similarity: 3988042
INFO:birdwatch.post_selection_similarity:Total unique ratings after: 3988042
INFO:birdwatch.run_scoring:Post Selection Similarity Prescoring: 3988042 ratings remaining.
INFO:birdwatch.constants:Filter ratings by Post Selection Similarity elapsed time: 21.40 secs (0.36 mins)
INFO:birdwatch.run_scoring:ratings summary after PSS: 9a7cd54d34e5498956eca9b67961c16c00bf98b08b1300f2d5694732fdac0d4a
INFO:birdwatch.run_scoring:Error converting user IDs to ints.  IDs will remain as strings. ValueError("invalid literal for int() with base 10: '65F687F3F0BE41BB456A883BA989742AB6F9566B731F7526D2F0E850C1B7F1DC'")
INFO:birdwatch.run_scoring:notes total RAM: 190156863 bytes (0.190 GB)
                                    column     dtype       RAM
0                                   noteId     int64  18780888
1                  noteAuthorParticipantId    object  18780888
2                          createdAtMillis     int64  18780888
3                                  tweetId    object  18780888
4                           classification    object  18780888
5                               believable  category   2347735
6                                  harmful  category   2347735
7                     validationDifficulty  category   2347735
8                          misleadingOther      Int8   4695222
9                   misleadingFactualError      Int8   4695222
10              misleadingManipulatedMedia      Int8   4695222
11           misleadingOutdatedInformation      Int8   4695222
12       misleadingMissingImportantContext      Int8   4695222
13         misleadingUnverifiedClaimAsFact      Int8   4695222
14                        misleadingSatire      Int8   4695222
15                      notMisleadingOther      Int8   4695222
16           notMisleadingFactuallyCorrect      Int8   4695222
17  notMisleadingOutdatedButNotWhenWritten      Int8   4695222
18              notMisleadingClearlySatire      Int8   4695222
19            notMisleadingPersonalOpinion      Int8   4695222
20                      trustworthySources      Int8   4695222
21                                 summary    object  18780888
22                             isMediaNote      Int8   4695222
23                     isCollaborativeNote      Int8   4695222
INFO:birdwatch.run_scoring:ratings total RAM: 454636936 bytes (0.455 GB)
                                  column     dtype       RAM
0                                 noteId     int64  31904336
1                     raterParticipantId    object  31904336
2                        createdAtMillis     int64  31904336
3                                version      Int8   7976084
4                                  agree      Int8   7976084
5                               disagree      Int8   7976084
6                                helpful      Int8   7976084
7                             notHelpful      Int8   7976084
8                       helpfulnessLevel  category   3988174
9                           helpfulOther      Int8   7976084
10                    helpfulInformative      Int8   7976084
11                          helpfulClear      Int8   7976084
12                     helpfulEmpathetic      Int8   7976084
13                    helpfulGoodSources      Int8   7976084
14                  helpfulUniqueContext      Int8   7976084
15                 helpfulAddressesClaim      Int8   7976084
16               helpfulImportantContext      Int8   7976084
17               helpfulUnbiasedLanguage      Int8   7976084
18                       notHelpfulOther      Int8   7976084
19                   notHelpfulIncorrect      Int8   7976084
20  notHelpfulSourcesMissingOrUnreliable      Int8   7976084
21    notHelpfulOpinionSpeculationOrBias      Int8   7976084
22            notHelpfulMissingKeyPoints      Int8   7976084
23                    notHelpfulOutdated      Int8   7976084
24            notHelpfulHardToUnderstand      Int8   7976084
25       notHelpfulArgumentativeOrBiased      Int8   7976084
26                    notHelpfulOffTopic      Int8   7976084
27       notHelpfulSpamHarassmentOrAbuse      Int8   7976084
28           notHelpfulIrrelevantSources      Int8   7976084
29          notHelpfulOpinionSpeculation      Int8   7976084
30               notHelpfulNoteNotNeeded      Int8   7976084
31                        ratedOnTweetId     int64  31904336
32                  ratingSourceBucketed  category   3988058
33                            helpfulNum   float64  31904336
34                       highVolumeRater      bool   3988042
35                       correlatedRater      bool   3988042
36                    postSelectionValue   float64  31904336
37        postSelectionValue_note_author   float64  31904336
INFO:birdwatch.run_scoring:noteStatusHistory total RAM: 344547595 bytes (0.345 GB)
                                            column     dtype       RAM
0                                           noteId     int64  21367128
1                          noteAuthorParticipantId    object  21367128
2                                  createdAtMillis   float64  21367128
3               timestampMillisOfFirstNonNMRStatus   float64  21367128
4                                firstNonNMRStatus  category   2671015
5                   timestampMillisOfCurrentStatus   float64  21367128
6                                    currentStatus  category   2671023
7              timestampMillisOfLatestNonNMRStatus   float64  21367128
8                           mostRecentNonNMRStatus  category   2671015
9                      timestampMillisOfStatusLock   float64  21367128
10                                    lockedStatus  category   2671023
11                      timestampMillisOfRetroLock   float64  21367128
12                               currentCoreStatus  category   2671103
13                          currentExpansionStatus  category   2671103
14                              currentGroupStatus  category   2671095
15                                currentDecidedBy  category   2672203
16                            currentModelingGroup   float64  21367128
17         timestampMillisOfMostRecentStatusChange   float64  21367128
18       timestampMillisOfNmrDueToMinStableCrhTime   float64  21367128
19                         currentMultiGroupStatus  category   2671095
20                       currentModelingMultiGroup   float64  21367128
21             timestampMinuteOfFinalScoringOutput   float64  21367128
22  timestampMillisOfFirstNmrDueToMinStableCrhTime   float64  21367128
23                                  classification    object  21367128
INFO:birdwatch.run_scoring:userEnrollment total RAM: 77749221 bytes (0.078 GB)
                           column     dtype       RAM
0                   participantId    object  10912168
1                 enrollmentState    object  10912168
2  successfulRatingNeededToEarnIn     int64  10912168
3      timestampOfLastStateChange     int64  10912168
4          timestampOfLastEarnOut   float64  10912168
5              modelingPopulation  category   1364045
6                   modelingGroup   float64  10912168
7          numberOfTimesEarnedOut     int64  10912168
INFO:birdwatch.constants:Logging Prescoring Inputs RAM usage before _run_scorers elapsed time: 0.14 secs (0.00 mins)

INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFCoreWithTopicsScorer set to: 12
INFO:birdwatch.scorer:Filtering ratings for MFCoreWithTopicsScorer.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 3569825
INFO:birdwatch.scorer:MFCoreWithTopicsScorer Filter input elapsed time: 7.63 secs (0.13 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFCoreWithTopicsScorer: 2225481918d5509ff2340d8582050d8073f622c076082760b97f808e90c9664a
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 2387326, Num Unique Notes Rated: 30564, Num Unique Raters: 79773
INFO:birdwatch.scorer:MFCoreWithTopicsScorer Prepare ratings elapsed time: 2.60 secs (0.04 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFCoreWithTopicsScorer: 1d09ed02a9baf049007d80fbfd84dde03498aab5614def883dc6d3100100faf5
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFCoreWithTopicsScorer: 6d968072609a33de48a417adb1c9bbd1f50013f6bb49652814fe261b868abb6f
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFCoreWithTopicsScorer: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.scorer:MFCoreWithTopicsScorer Prepare data for stable initialization elapsed time: 2.72 secs (0.05 mins)
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:asyncio:Using selector: KqueueSelector
DEBUG:git.cmd:Popen(['git', 'version'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src, stdin=None, shell=False, universal_newlines=False)
Python(21757) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
DEBUG:git.cmd:Popen(['git', 'version'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src, stdin=None, shell=False, universal_newlines=False)
Python(21758) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(21759) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(21760) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 34974, Notes: 7236
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 70.7893864013267
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 14.646079945102075
INFO:birdwatch.matrix_factorization:epoch 0 7.490611553192139
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 7.006433010101318
INFO:birdwatch.matrix_factorization:epoch 20 0.24756786227226257
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2079981565475464
INFO:birdwatch.matrix_factorization:epoch 40 0.1286572813987732
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.09618190675973892
INFO:birdwatch.matrix_factorization:epoch 60 0.08701191842556
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0589730441570282
INFO:birdwatch.matrix_factorization:epoch 80 0.0810326561331749
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.055407240986824036
INFO:birdwatch.matrix_factorization:epoch 100 0.08028732985258102
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05476006120443344
INFO:birdwatch.matrix_factorization:epoch 120 0.08018924295902252
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05465652793645859
INFO:birdwatch.matrix_factorization:epoch 140 0.08017677068710327
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05467145889997482
INFO:birdwatch.matrix_factorization:Num epochs: 146
INFO:birdwatch.matrix_factorization:epoch 146 0.08017604053020477
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05465737357735634
INFO:birdwatch.matrix_factorization:Global Intercept: 0.13461551070213318
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFCoreWithTopicsScorer MF on stable-initialization subset elapsed time: 24.59 secs (0.41 mins)
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(21833) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 79773, Notes: 30564
INFO:birdwatch.matrix_factorization:initializing notes

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py, in _initialize_parameters, at line 186: noteInit = self.noteIdMap.merge(
  PandasTypeError: Output mismatch on noteIndex_y: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:initialized global intercept
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 78.10908258081403
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 29.926491419402556
INFO:birdwatch.matrix_factorization:epoch 0 0.2575285732746124
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2202475666999817
INFO:birdwatch.matrix_factorization:epoch 20 0.1050645187497139
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07691601663827896
INFO:birdwatch.matrix_factorization:epoch 40 0.09514376521110535
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06706765294075012
INFO:birdwatch.matrix_factorization:epoch 60 0.0939154103398323
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06619880348443985
INFO:birdwatch.matrix_factorization:epoch 80 0.0937606617808342
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06595534086227417
INFO:birdwatch.matrix_factorization:epoch 100 0.09374046325683594
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0659327507019043
INFO:birdwatch.matrix_factorization:Num epochs: 113
INFO:birdwatch.matrix_factorization:epoch 113 0.09373831748962402
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.065945103764534
INFO:birdwatch.matrix_factorization:Global Intercept: 0.15628957748413086
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFCoreWithTopicsScorer First full MF (initializated with stable-initialization) elapsed time: 61.18 secs (1.02 mins)
INFO:birdwatch.scorer:MFCoreWithTopicsScorer First MF/stable init elapsed time: 88.93 secs (1.48 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFCoreWithTopicsScorer

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 2409631 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 9446 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.26 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.21 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.34 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.37 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.27 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.33 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.28 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.84 secs (0.03 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 72.70 secs (1.21 mins)
INFO:birdwatch.scorer:MFCoreWithTopicsScorer Compute scored notes elapsed time: 119.26 secs (1.99 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 3553009 post-tombstones and 16816 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 2812635, including 2806823 post-tombstones and 5812 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 155639
INFO:birdwatch.scorer:MFCoreWithTopicsScorer Compute valid ratings elapsed time: 7.33 secs (0.12 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFCoreWithTopicsScorer Helpfulness scores pre-harassment  elapsed time: 0.85 secs (0.01 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 79773
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 95586
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 84163
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 37798
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 2387326
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 1422821
INFO:birdwatch.scorer:MFCoreWithTopicsScorer Filtering by helpfulness score elapsed time: 3.82 secs (0.06 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    837938
1     91173
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 491580
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 840454, Num Unique Notes Rated: 21501, Num Unique Raters: 28159
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    755156
1     85298
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.10149038495860571
INFO:birdwatch.matrix_factorization:Using pos weight: 8.853150132476728 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(22081) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 28159, Notes: 21501
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 39.089065624854655
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 29.846727511630384
INFO:birdwatch.matrix_factorization:epoch 0 3.2111668586730957
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 1.3255047798156738
INFO:birdwatch.matrix_factorization:epoch 20 0.6591546535491943
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3463385999202728
INFO:birdwatch.matrix_factorization:epoch 40 0.43735599517822266
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2838262617588043
INFO:birdwatch.matrix_factorization:epoch 60 0.40779826045036316
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.273543119430542
INFO:birdwatch.matrix_factorization:epoch 80 0.4037470519542694
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2719697952270508
INFO:birdwatch.matrix_factorization:epoch 100 0.40320467948913574
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.27183765172958374
INFO:birdwatch.matrix_factorization:Num epochs: 117
INFO:birdwatch.matrix_factorization:epoch 117 0.4031471610069275
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2717931568622589
INFO:birdwatch.matrix_factorization:Global Intercept: -0.21099142730236053
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFCoreWithTopicsScorer Harassment tag consensus elapsed time: 26.40 secs (0.44 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFCoreWithTopicsScorer Helpfulness scores post-harassment elapsed time: 1.25 secs (0.02 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 79773
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 95586
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 83776
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 37411
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 2387326
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 1392273
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(22094) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 37411, Notes: 30500
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 45.64829508196721
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 37.215605035951995
INFO:birdwatch.matrix_factorization:epoch 0 0.40731528401374817
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.34192827343940735
INFO:birdwatch.matrix_factorization:epoch 20 0.09787101298570633
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06764564663171768
INFO:birdwatch.matrix_factorization:epoch 40 0.09266290068626404
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06559275835752487
INFO:birdwatch.matrix_factorization:epoch 60 0.0917334258556366
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06402211636304855
INFO:birdwatch.matrix_factorization:epoch 80 0.0916144996881485
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06359507143497467
INFO:birdwatch.matrix_factorization:epoch 100 0.09160341322422028
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06357992440462112
INFO:birdwatch.matrix_factorization:Num epochs: 101
INFO:birdwatch.matrix_factorization:epoch 101 0.09160341322422028
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06357992440462112
INFO:birdwatch.matrix_factorization:Global Intercept: 0.16072657704353333
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 41.13 secs (0.69 mins)
INFO:birdwatch.mf_base_scorer:In MFCoreWithTopicsScorer prescoring, about to call diligence with 1392273 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                      raterParticipantId  internalRaterFactor1
0      000045A5FA0CF004F68CBF2913506C37D540CF48522D33...             -0.583357
1      0002CA11E7127598E26C281F887129ADA2623C82BBCE8F...              0.431991
2      00055253971F408A7AB80D461A543E010EC67DFAF29C45...              0.612899
3      0007EFAB89EB0BCC18E8994B141F291F33C9CB80B9332E...             -0.111627
4      0008AA2B592A961E760CED75ED025B716C4F51956DDFD9...              0.164391
...                                                  ...                   ...
37406  FFF566C4AC6CDF855B2083DA2C7D9CF983135BCF167735...              0.626751
37407  FFF69D67772D36A4F36656044618362E9F92C97215AE48...             -0.537863
37408  FFFA49720F254411E1F79CA757C403F0A0217240BC4922...             -0.175185
37409  FFFEB058BCC25277E2662DD3E8C0506FB1B23BA4D965EA...              0.630591
37410  FFFF3B1E5FB7927B196BCC7753E5CE5B2E64AFA90099E0...             -0.211262

[37411 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 37411, vs. num we are initializing: 37411
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 37411
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=18.470396 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.684950 | time=7.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=3.222300 | time=16.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=3.153205 | time=24.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=3.133658 | time=32.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=3.125096 | time=40.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=3.120361 | time=48.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=3.117381 | time=56.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=3.115544 | time=64.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=3.114302 | time=72.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=3.113506 | time=80.2s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(0.6806, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=3.113484 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.836100 | time=7.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.826578 | time=15.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.825663 | time=22.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=100 | loss=1.825633 | time=25.0s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.368725 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.257103 | time=4.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.255745 | time=9.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=080 | loss=0.255681 | time=12.2s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(2.2321, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 3.1135, 1.8256, 0.2557
INFO:birdwatch.scorer:MFCoreWithTopicsScorer Low Diligence MF elapsed time: 119.78 secs (2.00 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 2409631 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 9446 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.21 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.21 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.42 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.27 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.14 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.20 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.19 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.49 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 82.22 secs (1.37 mins)
INFO:birdwatch.constants:MFCoreWithTopicsScorer: Compute tag thresholds for percentiles elapsed time: 6.84 secs (0.11 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 280: pd.DataFrame(columns=self.get_auxiliary_note_info_cols())
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFCoreScorer set to: 12
INFO:birdwatch.scorer:Filtering ratings for MFCoreScorer.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3343485
INFO:birdwatch.scorer:  Ratings without assigned group: 439
INFO:birdwatch.scorer:  Ratings after group filter: 3012525
INFO:birdwatch.scorer:MFCoreScorer Filter input elapsed time: 9.49 secs (0.16 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFCoreScorer: d055e841784daa6588ae6180ec86c4f7499ffd17f57364c919782e5103801021
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 1910818, Num Unique Notes Rated: 26008, Num Unique Raters: 66872
INFO:birdwatch.scorer:MFCoreScorer Prepare ratings elapsed time: 2.10 secs (0.04 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFCoreScorer: f281f08974ca5ef6fc5eaec97fffb0e9a0865789a83f8df2ba3d0497fe9694fd
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFCoreScorer: 17f276d3ba771d10df8add91bc10683119e63e11d9a2938fbe3264ac682a46ca
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFCoreScorer: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.scorer:MFCoreScorer Prepare data for stable initialization elapsed time: 2.07 secs (0.03 mins)
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(22188) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 30700, Notes: 6960
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 68.6080459770115
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 15.55413680781759
INFO:birdwatch.matrix_factorization:epoch 0 7.467015266418457
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 6.980542182922363
INFO:birdwatch.matrix_factorization:epoch 20 0.2609645426273346
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.20800474286079407
INFO:birdwatch.matrix_factorization:epoch 40 0.10690924525260925
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07480409741401672
INFO:birdwatch.matrix_factorization:epoch 60 0.08345510810613632
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.056869350373744965
INFO:birdwatch.matrix_factorization:epoch 80 0.08028461784124374
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05448537692427635
INFO:birdwatch.matrix_factorization:epoch 100 0.07988046854734421
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.054184842854738235
INFO:birdwatch.matrix_factorization:epoch 120 0.07982788234949112
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05413449555635452
INFO:birdwatch.matrix_factorization:epoch 140 0.07982100546360016
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05412610247731209
INFO:birdwatch.matrix_factorization:Num epochs: 142
INFO:birdwatch.matrix_factorization:epoch 142 0.079820916056633
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05412673205137253
INFO:birdwatch.matrix_factorization:Global Intercept: 0.1351095736026764
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFCoreScorer MF on stable-initialization subset elapsed time: 16.66 secs (0.28 mins)
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(22195) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 66872, Notes: 26008
INFO:birdwatch.matrix_factorization:initializing notes

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py, in _initialize_parameters, at line 186: noteInit = self.noteIdMap.merge(
  PandasTypeError: Output mismatch on noteIndex_y: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:initialized global intercept
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 73.4703937250077
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 28.57426127527216
INFO:birdwatch.matrix_factorization:epoch 0 0.2537759840488434
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.21587634086608887
INFO:birdwatch.matrix_factorization:epoch 20 0.10182144492864609
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07317742705345154
INFO:birdwatch.matrix_factorization:epoch 40 0.09215868264436722
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.064099982380867
INFO:birdwatch.matrix_factorization:epoch 60 0.0908854603767395
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0630682185292244
INFO:birdwatch.matrix_factorization:epoch 80 0.0907343402504921
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0628894567489624
INFO:birdwatch.matrix_factorization:epoch 100 0.09071411192417145
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06286260485649109
INFO:birdwatch.matrix_factorization:Num epochs: 112
INFO:birdwatch.matrix_factorization:epoch 112 0.0907120630145073
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06286553293466568
INFO:birdwatch.matrix_factorization:Global Intercept: 0.15530212223529816
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFCoreScorer First full MF (initializated with stable-initialization) elapsed time: 44.65 secs (0.74 mins)
INFO:birdwatch.scorer:MFCoreScorer First MF/stable init elapsed time: 63.59 secs (1.06 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFCoreScorer

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 1930972 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 7375 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.06 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.18 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.23 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.04 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.17 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.06 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.06 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.18 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.45 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 61.66 secs (1.03 mins)
INFO:birdwatch.scorer:MFCoreScorer Compute scored notes elapsed time: 95.31 secs (1.59 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 2997193 post-tombstones and 15332 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 2370481, including 2365020 post-tombstones and 5461 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 126541
INFO:birdwatch.scorer:MFCoreScorer Compute valid ratings elapsed time: 6.53 secs (0.11 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFCoreScorer Helpfulness scores pre-harassment  elapsed time: 0.68 secs (0.01 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 66872
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 78909
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 69540
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 30247
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 1910818
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 1100132
INFO:birdwatch.scorer:MFCoreScorer Filtering by helpfulness score elapsed time: 2.97 secs (0.05 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    644525
1     72317
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 381501
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 641116, Num Unique Notes Rated: 17380, Num Unique Raters: 22080
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    573962
1     67154
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.10474547507783302
INFO:birdwatch.matrix_factorization:Using pos weight: 8.546951782470144 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(22235) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 22080, Notes: 17380
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 36.88814729574223
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 29.036050724637683
INFO:birdwatch.matrix_factorization:epoch 0 3.1510398387908936
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 1.2649215459823608
INFO:birdwatch.matrix_factorization:epoch 20 0.6462570428848267
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3329276442527771
INFO:birdwatch.matrix_factorization:epoch 40 0.42529040575027466
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.27265456318855286
INFO:birdwatch.matrix_factorization:epoch 60 0.39541366696357727
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.26130563020706177
INFO:birdwatch.matrix_factorization:epoch 80 0.39135146141052246
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2599824368953705
INFO:birdwatch.matrix_factorization:epoch 100 0.39081382751464844
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2598413825035095
INFO:birdwatch.matrix_factorization:epoch 120 0.39074528217315674
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.259790301322937
INFO:birdwatch.matrix_factorization:Num epochs: 131
INFO:birdwatch.matrix_factorization:epoch 131 0.3907393217086792
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2597895562648773
INFO:birdwatch.matrix_factorization:Global Intercept: -0.20903673768043518
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFCoreScorer Harassment tag consensus elapsed time: 21.56 secs (0.36 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFCoreScorer Helpfulness scores post-harassment elapsed time: 0.87 secs (0.01 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 66872
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 78909
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 69222
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 29929
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 1910818
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 1078126
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(22242) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 29929, Notes: 25890
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 41.64256469679413
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 36.02278726318955
INFO:birdwatch.matrix_factorization:epoch 0 0.408258318901062
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.34350982308387756
INFO:birdwatch.matrix_factorization:epoch 20 0.09496019780635834
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06508685648441315
INFO:birdwatch.matrix_factorization:epoch 40 0.08931756019592285
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06244907155632973
INFO:birdwatch.matrix_factorization:epoch 60 0.08835990726947784
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.060968849807977676
INFO:birdwatch.matrix_factorization:epoch 80 0.08821607381105423
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.060432519763708115
INFO:birdwatch.matrix_factorization:epoch 100 0.08819891512393951
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.060482289642095566
INFO:birdwatch.matrix_factorization:Num epochs: 101
INFO:birdwatch.matrix_factorization:epoch 101 0.08819891512393951
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.060482289642095566
INFO:birdwatch.matrix_factorization:Global Intercept: 0.158314511179924
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 30.97 secs (0.52 mins)
INFO:birdwatch.mf_base_scorer:In MFCoreScorer prescoring, about to call diligence with 1078126 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                      raterParticipantId  internalRaterFactor1
0      000045A5FA0CF004F68CBF2913506C37D540CF48522D33...             -0.563708
1      0002CA11E7127598E26C281F887129ADA2623C82BBCE8F...              0.453943
2      0008AA2B592A961E760CED75ED025B716C4F51956DDFD9...              0.154339
3      000A152E7173AF94A55928A9BC0D120701A1828BB59A29...             -0.302027
4      000C20FD06E1B82796ACF15C8620FA264B70ADDDD300AC...              0.060138
...                                                  ...                   ...
29924  FFF0E85D4BAF243215A303AAF08A06FCF54B3E4DA68D13...              0.699045
29925  FFF4C20F77FE6BBB23129254835E9257FC9F76BB7BF098...             -0.394665
29926  FFF566C4AC6CDF855B2083DA2C7D9CF983135BCF167735...              0.675421
29927  FFF69D67772D36A4F36656044618362E9F92C97215AE48...             -0.509636
29928  FFFF3B1E5FB7927B196BCC7753E5CE5B2E64AFA90099E0...             -0.268703

[29929 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 29929, vs. num we are initializing: 29929
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 29929
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=17.817104 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.615689 | time=5.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=3.174711 | time=12.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=3.106641 | time=18.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=3.086009 | time=23.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=3.076367 | time=29.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=3.070885 | time=35.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=3.067461 | time=41.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=3.065357 | time=47.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=3.063956 | time=54.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=3.062985 | time=60.6s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(0.5534, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=3.062959 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.782898 | time=5.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.773239 | time=11.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.772323 | time=17.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=100 | loss=1.772294 | time=19.2s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.371492 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.261541 | time=3.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.260175 | time=7.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=080 | loss=0.260111 | time=9.5s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(2.0401, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 3.0630, 1.7723, 0.2601
INFO:birdwatch.scorer:MFCoreScorer Low Diligence MF elapsed time: 91.08 secs (1.52 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 1930972 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 7375 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.08 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.18 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.24 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.18 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.08 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.06 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.16 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.30 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 63.31 secs (1.06 mins)
INFO:birdwatch.constants:MFCoreScorer: Compute tag thresholds for percentiles elapsed time: 5.15 secs (0.09 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFExpansionScorer set to: 12
INFO:birdwatch.scorer:Filtering ratings for MFExpansionScorer.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 3979420
INFO:birdwatch.scorer:MFExpansionScorer Filter input elapsed time: 7.33 secs (0.12 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFExpansionScorer: 68c66d6d968a99904637f35488aa65b8cf53da7169e413e4609fab1b9f5c0cb6
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 2568687, Num Unique Notes Rated: 32491, Num Unique Raters: 87649
INFO:birdwatch.scorer:MFExpansionScorer Prepare ratings elapsed time: 3.20 secs (0.05 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFExpansionScorer: d6a9575cf58ce0ec4570d5d6aaf9d6e69f6692472359e994309ae195efcd9006
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFExpansionScorer: 6d968072609a33de48a417adb1c9bbd1f50013f6bb49652814fe261b868abb6f
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFExpansionScorer: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.scorer:MFExpansionScorer Prepare data for stable initialization elapsed time: 2.45 secs (0.04 mins)
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(22306) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 34449, Notes: 6329
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 65.86490756833624
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 12.100757641731255
INFO:birdwatch.matrix_factorization:epoch 0 7.416936874389648
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 6.933922290802002
INFO:birdwatch.matrix_factorization:epoch 20 0.24472278356552124
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18140791356563568
INFO:birdwatch.matrix_factorization:epoch 40 0.10476737469434738
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07307986915111542
INFO:birdwatch.matrix_factorization:epoch 60 0.083412766456604
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05711287260055542
INFO:birdwatch.matrix_factorization:epoch 80 0.08058303594589233
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05496250465512276
INFO:birdwatch.matrix_factorization:epoch 100 0.08020619302988052
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05471114069223404
INFO:birdwatch.matrix_factorization:epoch 120 0.0801558643579483
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.054671481251716614
INFO:birdwatch.matrix_factorization:Num epochs: 140
INFO:birdwatch.matrix_factorization:epoch 140 0.08014953136444092
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.054670605808496475
INFO:birdwatch.matrix_factorization:Global Intercept: 0.13236859440803528
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFExpansionScorer MF on stable-initialization subset elapsed time: 14.57 secs (0.24 mins)
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(22311) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 87649, Notes: 32491
INFO:birdwatch.matrix_factorization:initializing notes

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py, in _initialize_parameters, at line 186: noteInit = self.noteIdMap.merge(
  PandasTypeError: Output mismatch on noteIndex_y: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:initialized global intercept
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 79.05841617678742
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 29.30651804356011
INFO:birdwatch.matrix_factorization:epoch 0 0.2548685669898987
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2188393622636795
INFO:birdwatch.matrix_factorization:epoch 20 0.10591229796409607
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07777754962444305
INFO:birdwatch.matrix_factorization:epoch 40 0.09570470452308655
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06730751693248749
INFO:birdwatch.matrix_factorization:epoch 60 0.09446220844984055
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06659448891878128
INFO:birdwatch.matrix_factorization:epoch 80 0.09430292248725891
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06638520956039429
INFO:birdwatch.matrix_factorization:epoch 100 0.0942816436290741
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0663573369383812
INFO:birdwatch.matrix_factorization:Num epochs: 113
INFO:birdwatch.matrix_factorization:epoch 113 0.094279445707798
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0663645789027214
INFO:birdwatch.matrix_factorization:Global Intercept: 0.15716136991977692
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFExpansionScorer First full MF (initializated with stable-initialization) elapsed time: 59.96 secs (1.00 mins)
INFO:birdwatch.scorer:MFExpansionScorer First MF/stable init elapsed time: 77.21 secs (1.29 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFExpansionScorer

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 2590566 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 10452 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.19 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.21 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.34 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.36 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.27 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.15 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.19 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.49 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 71.80 secs (1.20 mins)
INFO:birdwatch.scorer:MFExpansionScorer Compute scored notes elapsed time: 110.12 secs (1.84 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 3961906 post-tombstones and 17514 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 3138203, including 3132226 post-tombstones and 5977 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 174194
INFO:birdwatch.scorer:MFExpansionScorer Compute valid ratings elapsed time: 7.75 secs (0.13 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFExpansionScorer Helpfulness scores pre-harassment  elapsed time: 0.85 secs (0.01 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 87649
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 109743
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 97287
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 41529
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 2568687
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 1525708
INFO:birdwatch.scorer:MFExpansionScorer Filtering by helpfulness score elapsed time: 4.06 secs (0.07 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    903947
1     98341
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 521204
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 904706, Num Unique Notes Rated: 22932, Num Unique Raters: 30792
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    812853
1     91853
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.10152801020442
INFO:birdwatch.matrix_factorization:Using pos weight: 8.849498655460355 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(22360) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 30792, Notes: 22932
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 39.451683237397525
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 29.381202909846714
INFO:birdwatch.matrix_factorization:epoch 0 3.2228779792785645
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 1.337152123451233
INFO:birdwatch.matrix_factorization:epoch 20 0.6613713502883911
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.34809523820877075
INFO:birdwatch.matrix_factorization:epoch 40 0.44040077924728394
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.28648167848587036
INFO:birdwatch.matrix_factorization:epoch 60 0.4106925129890442
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.27590805292129517
INFO:birdwatch.matrix_factorization:epoch 80 0.4066694676876068
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2743460536003113
INFO:birdwatch.matrix_factorization:epoch 100 0.4061161279678345
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.27418988943099976
INFO:birdwatch.matrix_factorization:epoch 120 0.40604516863822937
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2741430699825287
INFO:birdwatch.matrix_factorization:Num epochs: 137
INFO:birdwatch.matrix_factorization:epoch 137 0.40603747963905334
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2741421163082123
INFO:birdwatch.matrix_factorization:Global Intercept: -0.21107235550880432
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFExpansionScorer Harassment tag consensus elapsed time: 32.14 secs (0.54 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFExpansionScorer Helpfulness scores post-harassment elapsed time: 1.11 secs (0.02 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 87649
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 109743
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 96861
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 41103
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 2568687
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 1492985
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(22370) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 41103, Notes: 32413
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 46.061302563786136
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 36.32301778458993
INFO:birdwatch.matrix_factorization:epoch 0 0.4059443473815918
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3402612507343292
INFO:birdwatch.matrix_factorization:epoch 20 0.09807328879833221
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06764459609985352
INFO:birdwatch.matrix_factorization:epoch 40 0.09314775466918945
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06589445471763611
INFO:birdwatch.matrix_factorization:epoch 60 0.09224818646907806
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0643487349152565
INFO:birdwatch.matrix_factorization:epoch 80 0.09213485568761826
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06393402814865112
INFO:birdwatch.matrix_factorization:epoch 100 0.0921248197555542
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06390786916017532
INFO:birdwatch.matrix_factorization:Num epochs: 101
INFO:birdwatch.matrix_factorization:epoch 101 0.0921248197555542
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06390786916017532
INFO:birdwatch.matrix_factorization:Global Intercept: 0.1621273010969162
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 41.82 secs (0.70 mins)
INFO:birdwatch.mf_base_scorer:In MFExpansionScorer prescoring, about to call diligence with 1492985 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                      raterParticipantId  internalRaterFactor1
0      000045A5FA0CF004F68CBF2913506C37D540CF48522D33...             -0.585023
1      0002CA11E7127598E26C281F887129ADA2623C82BBCE8F...              0.418101
2      00037E5A04D7781E19E5AAF559E14512FF17E7F76C30AF...             -0.400644
3      00055253971F408A7AB80D461A543E010EC67DFAF29C45...              0.610892
4      0007EFAB89EB0BCC18E8994B141F291F33C9CB80B9332E...             -0.132988
...                                                  ...                   ...
41098  FFF7EDDCE3F147B1B3350D639AA98CAA36412F88FA9084...              0.439872
41099  FFFA49720F254411E1F79CA757C403F0A0217240BC4922...             -0.176201
41100  FFFE3234F03ED7E6F39F6799E38C7C146F849346F295D9...             -0.555018
41101  FFFEB058BCC25277E2662DD3E8C0506FB1B23BA4D965EA...              0.624187
41102  FFFF3B1E5FB7927B196BCC7753E5CE5B2E64AFA90099E0...             -0.210505

[41103 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 41103, vs. num we are initializing: 41103
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 41103
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=18.515200 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.676065 | time=8.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=3.219064 | time=16.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=3.150428 | time=23.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=3.131315 | time=32.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=3.123024 | time=40.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=3.118632 | time=48.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=3.115953 | time=55.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=3.114167 | time=63.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=3.112981 | time=71.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=3.112142 | time=79.7s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(0.6882, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=3.112122 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.833863 | time=7.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.824610 | time=16.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.823630 | time=24.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=110 | loss=1.823554 | time=30.0s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.369626 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.256749 | time=4.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.255380 | time=10.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=080 | loss=0.255315 | time=13.9s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(2.2406, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 3.1121, 1.8236, 0.2553
INFO:birdwatch.scorer:MFExpansionScorer Low Diligence MF elapsed time: 125.93 secs (2.10 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 2590566 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 10452 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.25 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.21 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.47 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.38 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.74 secs (0.03 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.42 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.20 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.61 secs (0.03 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 1546.50 secs (25.78 mins)
INFO:birdwatch.constants:MFExpansionScorer: Compute tag thresholds for percentiles elapsed time: 9.64 secs (0.16 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFExpansionPlusScorer set to: 12
INFO:birdwatch.scorer:Filtering ratings for MFExpansionPlusScorer.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 3988042
INFO:birdwatch.scorer:MFExpansionPlusScorer Filter input elapsed time: 6.80 secs (0.11 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFExpansionPlusScorer: 608faef1700c88e9481d1a67c004cd1862b618a8a597c5b8f6a57ce19027a9c0
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 2570017, Num Unique Notes Rated: 32497, Num Unique Raters: 87730
INFO:birdwatch.scorer:MFExpansionPlusScorer Prepare ratings elapsed time: 4.36 secs (0.07 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFExpansionPlusScorer: 6f6712e1dba215318d2e473399c6e2441baf59d384e73c5921d70b8262ae7107
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFExpansionPlusScorer: 6d968072609a33de48a417adb1c9bbd1f50013f6bb49652814fe261b868abb6f
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFExpansionPlusScorer: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.scorer:MFExpansionPlusScorer Prepare data for stable initialization elapsed time: 2.57 secs (0.04 mins)
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(22607) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 34447, Notes: 6326
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 65.84065760354095
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 12.091270647661625
INFO:birdwatch.matrix_factorization:epoch 0 7.438614845275879
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 6.955771446228027
INFO:birdwatch.matrix_factorization:epoch 20 0.2531554400920868
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.20854997634887695
INFO:birdwatch.matrix_factorization:epoch 40 0.10643413662910461
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07146290689706802
INFO:birdwatch.matrix_factorization:epoch 60 0.08342793583869934
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05749252438545227
INFO:birdwatch.matrix_factorization:epoch 80 0.08058688044548035
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05492379143834114
INFO:birdwatch.matrix_factorization:epoch 100 0.08019979298114777
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05471678450703621
INFO:birdwatch.matrix_factorization:epoch 120 0.08014827966690063
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05464649200439453
INFO:birdwatch.matrix_factorization:Num epochs: 139
INFO:birdwatch.matrix_factorization:epoch 139 0.08014153689146042
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.054657816886901855
INFO:birdwatch.matrix_factorization:Global Intercept: 0.13255706429481506
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFExpansionPlusScorer MF on stable-initialization subset elapsed time: 15.20 secs (0.25 mins)
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(22610) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 87730, Notes: 32497
INFO:birdwatch.matrix_factorization:initializing notes

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py, in _initialize_parameters, at line 186: noteInit = self.noteIdMap.merge(
  PandasTypeError: Output mismatch on noteIndex_y: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:initialized global intercept
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 79.0847462842724
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 29.294619856377523
INFO:birdwatch.matrix_factorization:epoch 0 0.2547729015350342
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2187318503856659
INFO:birdwatch.matrix_factorization:epoch 20 0.10590305924415588
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0777648463845253
INFO:birdwatch.matrix_factorization:epoch 40 0.09571010619401932
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06731307506561279
INFO:birdwatch.matrix_factorization:epoch 60 0.09446731209754944
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06659945100545883
INFO:birdwatch.matrix_factorization:epoch 80 0.09430815279483795
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0663897767663002
INFO:birdwatch.matrix_factorization:epoch 100 0.09428686648607254
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06636197119951248
INFO:birdwatch.matrix_factorization:Num epochs: 114
INFO:birdwatch.matrix_factorization:epoch 114 0.09428457915782928
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06637290120124817
INFO:birdwatch.matrix_factorization:Global Intercept: 0.15712182223796844
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFExpansionPlusScorer First full MF (initializated with stable-initialization) elapsed time: 64.67 secs (1.08 mins)
INFO:birdwatch.scorer:MFExpansionPlusScorer First MF/stable init elapsed time: 82.71 secs (1.38 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFExpansionPlusScorer

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 2591889 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 10466 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.20 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.21 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.37 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.35 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.28 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.21 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.19 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.49 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 72.45 secs (1.21 mins)
INFO:birdwatch.scorer:MFExpansionPlusScorer Compute scored notes elapsed time: 113.14 secs (1.89 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 3970525 post-tombstones and 17517 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 3144126, including 3138149 post-tombstones and 5977 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 174171
INFO:birdwatch.scorer:MFExpansionPlusScorer Compute valid ratings elapsed time: 7.87 secs (0.13 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFExpansionPlusScorer Helpfulness scores pre-harassment  elapsed time: 0.90 secs (0.02 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 87730
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 109934
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 97457
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 41547
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 2570017
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 1526006
INFO:birdwatch.scorer:MFExpansionPlusScorer Filtering by helpfulness score elapsed time: 4.17 secs (0.07 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    904125
1     98380
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 521285
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 904779, Num Unique Notes Rated: 22928, Num Unique Raters: 30792
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    812895
1     91884
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.1015540811623612
INFO:birdwatch.matrix_factorization:Using pos weight: 8.846970092725611 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(22664) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 30792, Notes: 22928
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 39.46174982554082
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 29.383573655494935
INFO:birdwatch.matrix_factorization:epoch 0 3.22337007522583
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 1.3376269340515137
INFO:birdwatch.matrix_factorization:epoch 20 0.6614438891410828
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3481847643852234
INFO:birdwatch.matrix_factorization:epoch 40 0.44040435552597046
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2865031361579895
INFO:birdwatch.matrix_factorization:epoch 60 0.41069695353507996
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.27591100335121155
INFO:birdwatch.matrix_factorization:epoch 80 0.40667158365249634
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2743525505065918
INFO:birdwatch.matrix_factorization:epoch 100 0.4061196744441986
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.27419063448905945
INFO:birdwatch.matrix_factorization:epoch 120 0.4060491919517517
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.27414968609809875
INFO:birdwatch.matrix_factorization:Num epochs: 130
INFO:birdwatch.matrix_factorization:epoch 130 0.40604275465011597
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.274151086807251
INFO:birdwatch.matrix_factorization:Global Intercept: -0.21098539233207703
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFExpansionPlusScorer Harassment tag consensus elapsed time: 30.93 secs (0.52 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFExpansionPlusScorer Helpfulness scores post-harassment elapsed time: 1.16 secs (0.02 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 87730
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 109934
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 97032
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 41122
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 2570017
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 1493341
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(22679) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 41122, Notes: 32419
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 46.0637589068139
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 36.314892271776664
INFO:birdwatch.matrix_factorization:epoch 0 0.4058765769004822
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.34020063281059265
INFO:birdwatch.matrix_factorization:epoch 20 0.09808319807052612
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06765598058700562
INFO:birdwatch.matrix_factorization:epoch 40 0.0931524783372879
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0659024715423584
INFO:birdwatch.matrix_factorization:epoch 60 0.09224970638751984
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06435103714466095
INFO:birdwatch.matrix_factorization:epoch 80 0.09213612973690033
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06393606215715408
INFO:birdwatch.matrix_factorization:epoch 100 0.09212590754032135
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06391051411628723
INFO:birdwatch.matrix_factorization:Num epochs: 101
INFO:birdwatch.matrix_factorization:epoch 101 0.09212590754032135
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06391051411628723
INFO:birdwatch.matrix_factorization:Global Intercept: 0.1621285229921341
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 38.34 secs (0.64 mins)
INFO:birdwatch.mf_base_scorer:In MFExpansionPlusScorer prescoring, about to call diligence with 1493341 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                      raterParticipantId  internalRaterFactor1
0      000045A5FA0CF004F68CBF2913506C37D540CF48522D33...             -0.585128
1      0002CA11E7127598E26C281F887129ADA2623C82BBCE8F...              0.417921
2      00037E5A04D7781E19E5AAF559E14512FF17E7F76C30AF...             -0.400704
3      00055253971F408A7AB80D461A543E010EC67DFAF29C45...              0.610654
4      0007EFAB89EB0BCC18E8994B141F291F33C9CB80B9332E...             -0.133924
...                                                  ...                   ...
41117  FFF7EDDCE3F147B1B3350D639AA98CAA36412F88FA9084...              0.439899
41118  FFFA49720F254411E1F79CA757C403F0A0217240BC4922...             -0.176409
41119  FFFE3234F03ED7E6F39F6799E38C7C146F849346F295D9...             -0.555798
41120  FFFEB058BCC25277E2662DD3E8C0506FB1B23BA4D965EA...              0.623785
41121  FFFF3B1E5FB7927B196BCC7753E5CE5B2E64AFA90099E0...             -0.209186

[41122 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 41122, vs. num we are initializing: 41122
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 41122
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=18.488827 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.682078 | time=8.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=3.219321 | time=16.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=3.150610 | time=24.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=3.131804 | time=32.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=3.123544 | time=40.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=3.119000 | time=48.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=3.116161 | time=56.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=3.114376 | time=64.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=3.113199 | time=71.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=3.112408 | time=79.8s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(0.6877, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=3.112384 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.834042 | time=7.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.824902 | time=15.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.823972 | time=23.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=100 | loss=1.823941 | time=26.0s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.369907 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.256925 | time=4.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.255556 | time=9.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=080 | loss=0.255491 | time=12.7s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(2.2471, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 3.1124, 1.8239, 0.2555
INFO:birdwatch.scorer:MFExpansionPlusScorer Low Diligence MF elapsed time: 120.94 secs (2.02 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 2591889 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 10466 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.19 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.21 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.39 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.29 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.25 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.16 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.18 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.47 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 72.52 secs (1.21 mins)
INFO:birdwatch.constants:MFExpansionPlusScorer: Compute tag thresholds for percentiles elapsed time: 7.43 secs (0.12 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for ReputationScorer set to: 12
INFO:birdwatch.scorer:Filtering ratings for ReputationScorer.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 3569825
INFO:birdwatch.scorer:ReputationScorer Filter input elapsed time: 7.39 secs (0.12 mins)
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 2387326, Num Unique Notes Rated: 30564, Num Unique Raters: 79773
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(22760) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 34974, Notes: 7236
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 70.7893864013267
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 14.646079945102075
INFO:birdwatch.matrix_factorization:epoch 0 7.46235990524292
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 6.978163719177246
INFO:birdwatch.matrix_factorization:epoch 20 0.27076825499534607
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.21381109952926636
INFO:birdwatch.matrix_factorization:epoch 40 0.10925576090812683
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07572536915540695
INFO:birdwatch.matrix_factorization:epoch 60 0.08391427248716354
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.057526227086782455
INFO:birdwatch.matrix_factorization:epoch 80 0.08065809309482574
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.055060334503650665
INFO:birdwatch.matrix_factorization:epoch 100 0.08023926615715027
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05469866096973419
INFO:birdwatch.matrix_factorization:epoch 120 0.08018331229686737
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05466292053461075
INFO:birdwatch.matrix_factorization:epoch 140 0.08017604053020477
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.054661523550748825
INFO:birdwatch.matrix_factorization:Num epochs: 143
INFO:birdwatch.matrix_factorization:epoch 143 0.08017584681510925
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05466187745332718
INFO:birdwatch.matrix_factorization:Global Intercept: 0.13462860882282257
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
                   noteId  internalNoteFactor1
0     1377281345605472256            -0.561334
1     1379042834678870019             0.415207
2     1411136229035417602             0.374997
3     1417506709489266699             0.397977
4     1423432584806256647             0.272234
...                   ...                  ...
7231  1798345473138544767            -0.092687
7232  1969698945199755326             0.234993
7233  1859577066997387538            -0.151363
7234  1829342583304425781             0.162214
7235  2000203513532432641             0.059301

[7236 rows x 2 columns],
 raterInitState: 
                                      raterParticipantId  internalRaterFactor1
0      65F687F3F0BE41BB456A883BA989742AB6F9566B731F75...              0.808641
1      D6602F91F0E36E0C5230FB766CF1529E6FB5FC677DCB17...              0.746291
2      5926E5D40EA0EE16FE23941EADF05B78DEFDFD84D1DBEB...              0.555137
3      04243FCEE3704BBA1846E5009F2BA03EE36A98C381FDA4...             -0.549877
4      0BD47C7568154F38C2A90F1A2A9A7573F52415E24DBE18...             -0.569190
...                                                  ...                   ...
34969  D929B80B5FF339ADA3FC081819C60FFEC537198A452CBF...             -0.626409
34970  7D7BAA5B227CBB1058E05356F5A8CA9BD8F35691C4E0D1...             -0.422427
34971  0EFB6486B1D3907CB10E4D8A6B90203203502612790465...             -0.534224
34972  C268312EBE067A1C280DEB03FBC6A727879EFD4F97AEDE...             -0.424277
34973  661124877CA60A5DFE80D04DE9F9A9563C563C84B22D55...             -0.530420

[34974 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 79773, vs. num we are initializing: 34974
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 44799
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 34974
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Initializing internalNoteFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 30564, vs. num we are initializing: 7236
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalNoteFactor1s: 29406
INFO:birdwatch.reputation_matrix_factorization:  initialized internalNoteFactor1s: 1158
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.303952 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.023697 | time=15.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.019750 | time=28.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=0.019557 | time=42.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=0.019544 | time=54.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=0.019542 | time=66.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=0.019541 | time=79.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=190 | loss=0.019541 | time=83.4s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(0.4036, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.116228 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.071816 | time=12.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.069982 | time=24.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=0.069878 | time=36.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=0.069870 | time=47.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=0.069869 | time=59.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=160 | loss=0.069869 | time=63.0s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.006048 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.005630 | time=6.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.005514 | time=13.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=0.005506 | time=20.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=110 | loss=0.005506 | time=25.3s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(0.5948, requires_grad=True)
INFO:birdwatch.helpfulness_model:Helpfulness reputation loss: 0.0195, 0.0699, 0.0055

CONCAT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/reputation_scorer.py, in _prescore_notes_and_users, at line 147: noteStats = noteStats.merge(noteStatusHistory[[c.noteIdKey]].drop_duplicates(), how="outer")
  PandasTypeError: Type expectation mismatch on noteId: found=float64 expected=int64
  PandasTypeError: Type expectation mismatch on noteId: found=float64 expected=int64

INFO:birdwatch.reputation_scorer:Reputation prescoring: returning these columns:
          noteStats: Index(['noteId', 'internalNoteIntercept', 'internalNoteFactor1',
       'lowDiligenceNoteInterceptRound2'],
      dtype='object')
          raterStats: Index(['raterParticipantId', 'internalRaterReputation',
       'internalRaterIntercept', 'internalRaterFactor1',
       'lowDiligenceRaterInterceptRound2'],
      dtype='object')
          

INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_13 set to: 8
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_13.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 1632387
INFO:birdwatch.scorer:MFGroupScorer_13 Filter input elapsed time: 5.16 secs (0.09 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_13: 8590ad518d30011e5c9e2c1864ed165783fc480031268e45a6af994c42c9f150
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 1190040, Num Unique Notes Rated: 18279, Num Unique Raters: 35248
INFO:birdwatch.scorer:MFGroupScorer_13 Prepare ratings elapsed time: 1.11 secs (0.02 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_13: 2d485429ac6bd5ac86a83949ba4cc0e8de812f92482c4ce8e2519dc7cf74151f
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_13: 6d968072609a33de48a417adb1c9bbd1f50013f6bb49652814fe261b868abb6f
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_13: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(22820) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 35248, Notes: 18279
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 65.10421795503036
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 33.76191556967771
INFO:birdwatch.matrix_factorization:epoch 0 7.438117980957031
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 6.959105968475342
INFO:birdwatch.matrix_factorization:epoch 20 0.3299635946750641
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.23484104871749878
INFO:birdwatch.matrix_factorization:epoch 40 0.1176239401102066
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.08391233533620834
INFO:birdwatch.matrix_factorization:epoch 60 0.09305304288864136
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06584871560335159
INFO:birdwatch.matrix_factorization:epoch 80 0.0894194170832634
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06316392868757248
INFO:birdwatch.matrix_factorization:epoch 100 0.08897873759269714
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0629526823759079
INFO:birdwatch.matrix_factorization:epoch 120 0.08892355859279633
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06290611624717712
INFO:birdwatch.matrix_factorization:epoch 140 0.08891573548316956
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06288940459489822
INFO:birdwatch.matrix_factorization:Num epochs: 143
INFO:birdwatch.matrix_factorization:epoch 143 0.08891552686691284
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06288288533687592
INFO:birdwatch.matrix_factorization:Global Intercept: 0.14269277453422546
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_13 First MF/stable init elapsed time: 35.14 secs (0.59 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_13

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 1211005 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 2282 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.23 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.21 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.42 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.26 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.30 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.21 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.19 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.49 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 74.58 secs (1.24 mins)
INFO:birdwatch.scorer:MFGroupScorer_13 Compute scored notes elapsed time: 108.41 secs (1.81 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 1616669 post-tombstones and 15718 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 1312448, including 1306649 post-tombstones and 5799 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 48394
INFO:birdwatch.scorer:MFGroupScorer_13 Compute valid ratings elapsed time: 4.14 secs (0.07 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_13 Helpfulness scores pre-harassment  elapsed time: 0.41 secs (0.01 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 35248
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 34512
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 28637
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 15087
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 1190040
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 681087
INFO:birdwatch.scorer:MFGroupScorer_13 Filtering by helpfulness score elapsed time: 1.75 secs (0.03 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    338326
1     57298
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 283421
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 351620, Num Unique Notes Rated: 11904, Num Unique Raters: 10717
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    298237
1     53383
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.15182014674933167
INFO:birdwatch.matrix_factorization:Using pos weight: 5.58674109735309 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(22859) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 10717, Notes: 11904
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 29.537970430107528
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 32.80955491275544
INFO:birdwatch.matrix_factorization:epoch 0 3.0800108909606934
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 1.202621579170227
INFO:birdwatch.matrix_factorization:epoch 20 0.6242074966430664
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3309752345085144
INFO:birdwatch.matrix_factorization:epoch 40 0.41966792941093445
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2703508138656616
INFO:birdwatch.matrix_factorization:epoch 60 0.39158812165260315
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2607426941394806
INFO:birdwatch.matrix_factorization:epoch 80 0.38784611225128174
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2598347067832947
INFO:birdwatch.matrix_factorization:epoch 100 0.3873507082462311
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.25964003801345825
INFO:birdwatch.matrix_factorization:epoch 120 0.38728761672973633
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.25959140062332153
INFO:birdwatch.matrix_factorization:Num epochs: 121
INFO:birdwatch.matrix_factorization:epoch 121 0.38728761672973633
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.25959140062332153
INFO:birdwatch.matrix_factorization:Global Intercept: -0.2074967920780182
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_13 Harassment tag consensus elapsed time: 11.51 secs (0.19 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_13 Helpfulness scores post-harassment elapsed time: 0.51 secs (0.01 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 35248
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 34512
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 28634
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 15084
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 1190040
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 680810
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(22864) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 15084, Notes: 18265
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 37.27402135231317
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 45.134579687085655
INFO:birdwatch.matrix_factorization:epoch 0 0.40846413373947144
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3473847210407257
INFO:birdwatch.matrix_factorization:epoch 20 0.09581981599330902
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06752534210681915
INFO:birdwatch.matrix_factorization:epoch 40 0.08836156874895096
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06315179914236069
INFO:birdwatch.matrix_factorization:epoch 60 0.08713977038860321
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.061320964246988297
INFO:birdwatch.matrix_factorization:epoch 80 0.08699552714824677
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06071654334664345
INFO:birdwatch.matrix_factorization:Num epochs: 82
INFO:birdwatch.matrix_factorization:epoch 82 0.08699555695056915
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.060836080461740494
INFO:birdwatch.matrix_factorization:Global Intercept: 0.1443648487329483
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 14.87 secs (0.25 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_13 prescoring, about to call diligence with 680810 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                      raterParticipantId  internalRaterFactor1
0      000045A5FA0CF004F68CBF2913506C37D540CF48522D33...             -0.521251
1      0002CA11E7127598E26C281F887129ADA2623C82BBCE8F...              0.503343
2      000A152E7173AF94A55928A9BC0D120701A1828BB59A29...             -0.281590
3      001226CEFA7FAA022C825459EF0731988DB66BA000D0C3...              0.573272
4      001A1BA9FBE62859A450D0A6BAE39DFB47CE649A9E154F...              0.563992
...                                                  ...                   ...
15079  FFE869D51FD64C9E02044A8625A73BFAA6BF5C28643BDC...             -0.386075
15080  FFEE86876559D283E86FFD2DCE8ED8D612D9E8D7E92E83...             -0.418023
15081  FFF0E85D4BAF243215A303AAF08A06FCF54B3E4DA68D13...              0.717956
15082  FFF566C4AC6CDF855B2083DA2C7D9CF983135BCF167735...              0.654716
15083  FFF69D67772D36A4F36656044618362E9F92C97215AE48...             -0.471413

[15084 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 15084, vs. num we are initializing: 15084
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 15084
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=21.951597 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.935652 | time=3.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=3.402908 | time=6.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=3.329037 | time=10.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=3.309456 | time=13.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=3.301126 | time=17.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=3.296475 | time=20.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=3.293770 | time=23.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=3.292068 | time=27.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=3.290959 | time=30.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=3.290195 | time=34.0s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(0.9620, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=3.290174 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=2.009426 | time=3.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.999995 | time=6.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.999128 | time=10.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=100 | loss=1.999101 | time=11.2s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.355920 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.252756 | time=2.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.251492 | time=3.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=080 | loss=0.251435 | time=5.3s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(2.3604, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 3.2902, 1.9991, 0.2514
INFO:birdwatch.scorer:MFGroupScorer_13 Low Diligence MF elapsed time: 51.50 secs (0.86 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 1211005 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 2282 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.21 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.21 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.41 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.21 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.27 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.20 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.19 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.48 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 71.43 secs (1.19 mins)
INFO:birdwatch.constants:MFGroupScorer_13: Compute tag thresholds for percentiles elapsed time: 2.83 secs (0.05 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_12 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_12.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 16394
INFO:birdwatch.scorer:MFGroupScorer_12 Filter input elapsed time: 5.50 secs (0.09 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_12: 50375f737684e02ad29f6804d5cfdce1bfa1749a2a1f1110052d5cb7e298ffca
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 704, Num Unique Notes Rated: 71, Num Unique Raters: 109
INFO:birdwatch.scorer:MFGroupScorer_12 Prepare ratings elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_12: b3d3a8a30c6d55b6ea7f2462fd524b92583017393068d9e7c2ba903fbc54271c
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_12: 6d968072609a33de48a417adb1c9bbd1f50013f6bb49652814fe261b868abb6f
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_12: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(22915) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 109, Notes: 71
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 9.915492957746478
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 6.458715596330276
INFO:birdwatch.matrix_factorization:epoch 0 7.16274881362915
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 6.652442455291748
INFO:birdwatch.matrix_factorization:epoch 20 0.21859818696975708
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.15666547417640686
INFO:birdwatch.matrix_factorization:epoch 40 0.08870551735162735
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04302002489566803
INFO:birdwatch.matrix_factorization:epoch 60 0.06230995059013367
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.02681523747742176
INFO:birdwatch.matrix_factorization:epoch 80 0.05737055093050003
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.021536080166697502
INFO:birdwatch.matrix_factorization:epoch 100 0.05667641758918762
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.021162565797567368
INFO:birdwatch.matrix_factorization:Num epochs: 106
INFO:birdwatch.matrix_factorization:epoch 106 0.05662627890706062
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.02087465673685074
INFO:birdwatch.matrix_factorization:Global Intercept: 0.15494872629642487
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_12 First MF/stable init elapsed time: 0.50 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_12

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 3334 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 26 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.23 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.20 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.34 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.16 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.14 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.15 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.19 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.36 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 72.43 secs (1.21 mins)
INFO:birdwatch.scorer:MFGroupScorer_12 Compute scored notes elapsed time: 96.88 secs (1.61 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 16391 post-tombstones and 3 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 13328, including 13328 post-tombstones and 0 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 14
INFO:birdwatch.scorer:MFGroupScorer_12 Compute valid ratings elapsed time: 1.47 secs (0.02 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_12 Helpfulness scores pre-harassment  elapsed time: 0.13 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 109
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 54
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 14
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 4
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 704
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 36
INFO:birdwatch.scorer:MFGroupScorer_12 Filtering by helpfulness score elapsed time: 0.02 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    26
1     2
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 8
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 0, Num Unique Notes Rated: 0, Num Unique Raters: 0
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown Series([], dtype: int64)
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:No valid data for notHelpfulSpamHarassmentOrAbuse, returning None and aborting notHelpfulSpamHarassmentOrAbuse model training.
INFO:birdwatch.scorer:MFGroupScorer_12 Harassment tag consensus elapsed time: 0.04 secs (0.00 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_12 Helpfulness scores post-harassment elapsed time: 0.12 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 109
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 54
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 14
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 4
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 704
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 36
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(22947) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 4, Notes: 30
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 1.2
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 9.0
INFO:birdwatch.matrix_factorization:epoch 0 0.412722647190094
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3250347375869751
INFO:birdwatch.matrix_factorization:epoch 20 0.04998694360256195
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.014885323122143745
INFO:birdwatch.matrix_factorization:epoch 40 0.0371750183403492
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0023857930209487677
INFO:birdwatch.matrix_factorization:epoch 60 0.03584340214729309
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.001985749462619424
INFO:birdwatch.matrix_factorization:epoch 80 0.03561641648411751
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0013072756119072437
INFO:birdwatch.matrix_factorization:Num epochs: 100
INFO:birdwatch.matrix_factorization:epoch 100 0.03559325262904167
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0013094726018607616
INFO:birdwatch.matrix_factorization:Global Intercept: 0.15046723186969757
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 0.37 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_12 prescoring, about to call diligence with 36 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                  raterParticipantId  internalRaterFactor1
0  1E88DDB7C7065B2F4FCA4D453A3B3E28E1792E6DA91504...             -0.602239
1  66C8F9EC567DD6C34BDAA1805E63A5E7AAAC4FB8D18B2B...             -0.165129
2  800A625468F03893CA64F6967F8E9751D9D7E2567E913C...             -0.536315
3  DAAEC8652040E16FA54FA111733F8AB5B2AC88E983AF6E...              0.785011
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 4, vs. num we are initializing: 4
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 4
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=20.127304 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=2.220640 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.902470 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.836104 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=1.815622 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=1.803803 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=1.794756 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=1.786818 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=1.779743 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=1.773388 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=1.767656 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(0.4369, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=1.767475 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.280153 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.279452 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=0.278070 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=100 | loss=0.278022 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.247910 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.211615 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.211074 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.211074 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(-3.7797, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 1.7677, 0.2780, 0.2111
INFO:birdwatch.scorer:MFGroupScorer_12 Low Diligence MF elapsed time: 0.78 secs (0.01 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 3334 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 26 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.64 secs (0.03 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.28 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.60 secs (0.03 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.27 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.70 secs (0.03 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.63 secs (0.03 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.22 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.59 secs (0.03 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 74.87 secs (1.25 mins)
INFO:birdwatch.constants:MFGroupScorer_12: Compute tag thresholds for percentiles elapsed time: 0.18 secs (0.00 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_11 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_11.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 46957
INFO:birdwatch.scorer:MFGroupScorer_11 Filter input elapsed time: 5.77 secs (0.10 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_11: 206e35389df7cbca14c387fe614ca0d97d617a18b65d6a1537daaeca6a6981ac
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 13185, Num Unique Notes Rated: 1377, Num Unique Raters: 724
INFO:birdwatch.scorer:MFGroupScorer_11 Prepare ratings elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_11: 2d0eefdc38b0649622ea950efcd43099e12457993d8b01240dad0a29263258c0
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_11: 6d968072609a33de48a417adb1c9bbd1f50013f6bb49652814fe261b868abb6f
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_11: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(23040) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 724, Notes: 1377
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 9.57516339869281
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 18.21132596685083
INFO:birdwatch.matrix_factorization:epoch 0 7.4459943771362305
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 6.939742088317871
INFO:birdwatch.matrix_factorization:epoch 20 0.2537682056427002
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.19850647449493408
INFO:birdwatch.matrix_factorization:epoch 40 0.11036507785320282
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07148932665586472
INFO:birdwatch.matrix_factorization:epoch 60 0.0867641419172287
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05252259224653244
INFO:birdwatch.matrix_factorization:epoch 80 0.0834076851606369
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04890984669327736
INFO:birdwatch.matrix_factorization:epoch 100 0.08296091854572296
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.048756346106529236
INFO:birdwatch.matrix_factorization:epoch 120 0.08290691673755646
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04867742210626602
INFO:birdwatch.matrix_factorization:Num epochs: 134
INFO:birdwatch.matrix_factorization:epoch 134 0.0829005166888237
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.048719316720962524
INFO:birdwatch.matrix_factorization:Global Intercept: 0.15584303438663483
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_11 First MF/stable init elapsed time: 1.12 secs (0.02 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_11

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 25533 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 44 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.23 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.20 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.35 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.21 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.21 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.16 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.18 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.45 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 82.46 secs (1.37 mins)
INFO:birdwatch.scorer:MFGroupScorer_11 Compute scored notes elapsed time: 108.81 secs (1.81 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 46915 post-tombstones and 42 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 37824, including 37824 post-tombstones and 0 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 1439
INFO:birdwatch.scorer:MFGroupScorer_11 Compute valid ratings elapsed time: 1.79 secs (0.03 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_11 Helpfulness scores pre-harassment  elapsed time: 0.13 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 724
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 1657
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 907
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 376
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 13185
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 8505
INFO:birdwatch.scorer:MFGroupScorer_11 Filtering by helpfulness score elapsed time: 0.04 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    4665
1     507
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 3333
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 925, Num Unique Notes Rated: 135, Num Unique Raters: 93
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    869
1     56
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.06054054054054054
INFO:birdwatch.matrix_factorization:Using pos weight: 15.517857142857142 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(23077) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 93, Notes: 135
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 6.851851851851852
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 9.946236559139784
INFO:birdwatch.matrix_factorization:epoch 0 3.062631607055664
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 1.1956138610839844
INFO:birdwatch.matrix_factorization:epoch 20 0.6924525499343872
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2939622700214386
INFO:birdwatch.matrix_factorization:epoch 40 0.4591890871524811
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2529900372028351
INFO:birdwatch.matrix_factorization:epoch 60 0.4207375645637512
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.22835369408130646
INFO:birdwatch.matrix_factorization:epoch 80 0.401559054851532
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.21589455008506775
INFO:birdwatch.matrix_factorization:epoch 100 0.3840571343898773
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.20481467247009277
INFO:birdwatch.matrix_factorization:Num epochs: 104
INFO:birdwatch.matrix_factorization:epoch 104 0.38318300247192383
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.20342621207237244
INFO:birdwatch.matrix_factorization:Global Intercept: -0.33028778433799744
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_11 Harassment tag consensus elapsed time: 0.68 secs (0.01 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_11 Helpfulness scores post-harassment elapsed time: 0.23 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 724
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 1657
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 907
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 376
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 13185
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 8505
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(23079) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 376, Notes: 1373
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 6.194464675892207
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 22.61968085106383
INFO:birdwatch.matrix_factorization:epoch 0 0.39770442247390747
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.32545006275177
INFO:birdwatch.matrix_factorization:epoch 20 0.08132176846265793
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.044391896575689316
INFO:birdwatch.matrix_factorization:epoch 40 0.0785677507519722
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04513030871748924
INFO:birdwatch.matrix_factorization:epoch 60 0.07718239724636078
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04247485101222992
INFO:birdwatch.matrix_factorization:epoch 80 0.07713226228952408
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04253974184393883
INFO:birdwatch.matrix_factorization:epoch 100 0.07710662484169006
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04235031083226204
INFO:birdwatch.matrix_factorization:Num epochs: 103
INFO:birdwatch.matrix_factorization:epoch 103 0.07710838317871094
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04246622696518898
INFO:birdwatch.matrix_factorization:Global Intercept: 0.1580977737903595
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 0.72 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_11 prescoring, about to call diligence with 8505 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                    raterParticipantId  internalRaterFactor1
0    00055253971F408A7AB80D461A543E010EC67DFAF29C45...              0.627881
1    0096E887BAB766D447D935A6FAA4B583C57CDDD7437330...              0.262955
2    02392701E4091AE843AD4485F95727D5E936281FC0F00C...             -0.266192
3    02552C5986DDF49CF618D738BD5FDDE46F07D965B780C5...             -0.510257
4    029E49778E6642A935E0CAE3E5896E4BD8B1112E89127B...             -0.436562
..                                                 ...                   ...
371  FE59A526EF3F5201453FE484E163928828B605DA4CD3BA...              0.804958
372  FE85094603CE54C94C5BFB73B4C36B92C775BE56DB7A10...              0.181820
373  FEB153643EB9E05DDEA406950F906E2CF9B0228BD82FF9...              0.523299
374  FED35B57756A294F0573827EAB412B5595E3D301D9F0A0...              0.860629
375  FFFA49720F254411E1F79CA757C403F0A0217240BC4922...             -0.197187

[376 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 376, vs. num we are initializing: 376
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 376
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=18.594408 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.280349 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.754679 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.605662 | time=0.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.538257 | time=1.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.499725 | time=1.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.474676 | time=1.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.457410 | time=1.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.444807 | time=1.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.434804 | time=1.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.426950 | time=1.9s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(-0.6917, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.426644 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.188416 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.181353 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.180409 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.180409 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.504249 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.438700 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.437854 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=075 | loss=0.437819 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(-0.6270, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.4270, 1.1804, 0.4378
INFO:birdwatch.scorer:MFGroupScorer_11 Low Diligence MF elapsed time: 2.74 secs (0.05 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 25533 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 44 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.22 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.20 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.37 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.24 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.19 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.20 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.19 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.40 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 75.94 secs (1.27 mins)
INFO:birdwatch.constants:MFGroupScorer_11: Compute tag thresholds for percentiles elapsed time: 0.19 secs (0.00 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_10 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_10.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 26153
INFO:birdwatch.scorer:MFGroupScorer_10 Filter input elapsed time: 5.95 secs (0.10 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_10: 435ef71f01a7873a405e0dded5015b5b3d475220b0c6062663565fed8640d39b
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 3561, Num Unique Notes Rated: 406, Num Unique Raters: 291
INFO:birdwatch.scorer:MFGroupScorer_10 Prepare ratings elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_10: b8ba09c608a3d438abcc451c72c9c37966ad88d5ec07bba2355a19c069710be0
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_10: 6d968072609a33de48a417adb1c9bbd1f50013f6bb49652814fe261b868abb6f
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_10: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(23126) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 291, Notes: 406
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 8.770935960591133
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 12.237113402061855
INFO:birdwatch.matrix_factorization:epoch 0 7.433362007141113
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 6.924577713012695
INFO:birdwatch.matrix_factorization:epoch 20 0.29048657417297363
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2279641032218933
INFO:birdwatch.matrix_factorization:epoch 40 0.12066060304641724
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0810791403055191
INFO:birdwatch.matrix_factorization:epoch 60 0.07890140265226364
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.043594054877758026
INFO:birdwatch.matrix_factorization:epoch 80 0.07415630668401718
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03941578045487404
INFO:birdwatch.matrix_factorization:epoch 100 0.07345519959926605
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0389360636472702
INFO:birdwatch.matrix_factorization:epoch 120 0.0733727514743805
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03886517882347107
INFO:birdwatch.matrix_factorization:epoch 140 0.07336153835058212
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.038857944309711456
INFO:birdwatch.matrix_factorization:Num epochs: 143
INFO:birdwatch.matrix_factorization:epoch 143 0.07336127012968063
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03884393721818924
INFO:birdwatch.matrix_factorization:Global Intercept: 0.15346956253051758
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_10 First MF/stable init elapsed time: 0.72 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_10

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 10902 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 21 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.22 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.20 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.36 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.19 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.15 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.16 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.19 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.42 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 71.99 secs (1.20 mins)
INFO:birdwatch.scorer:MFGroupScorer_10 Compute scored notes elapsed time: 97.60 secs (1.63 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 26146 post-tombstones and 7 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 21512, including 21512 post-tombstones and 0 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 562
INFO:birdwatch.scorer:MFGroupScorer_10 Compute valid ratings elapsed time: 1.44 secs (0.02 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_10 Helpfulness scores pre-harassment  elapsed time: 0.12 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 291
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 667
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 392
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 151
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 3561
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 2255
INFO:birdwatch.scorer:MFGroupScorer_10 Filtering by helpfulness score elapsed time: 0.02 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    1230
1     176
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 849
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 153, Num Unique Notes Rated: 20, Num Unique Raters: 22
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    153
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse tag positive rate is 0.0: returning None and aborting notHelpfulSpamHarassmentOrAbuse model training.
INFO:birdwatch.scorer:MFGroupScorer_10 Harassment tag consensus elapsed time: 0.04 secs (0.00 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_10 Helpfulness scores post-harassment elapsed time: 0.11 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 291
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 667
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 392
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 151
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 3561
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 2255
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(23149) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 151, Notes: 406
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 5.554187192118227
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 14.933774834437086
INFO:birdwatch.matrix_factorization:epoch 0 0.3955038785934448
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3252996802330017
INFO:birdwatch.matrix_factorization:epoch 20 0.07230775058269501
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03628130629658699
INFO:birdwatch.matrix_factorization:epoch 40 0.06868304312229156
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03506634756922722
INFO:birdwatch.matrix_factorization:epoch 60 0.06721463799476624
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.032377637922763824
INFO:birdwatch.matrix_factorization:epoch 80 0.06713195145130157
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03242770954966545
INFO:birdwatch.matrix_factorization:epoch 100 0.0671081617474556
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03220595419406891
INFO:birdwatch.matrix_factorization:Num epochs: 103
INFO:birdwatch.matrix_factorization:epoch 103 0.06710919737815857
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03231135010719299
INFO:birdwatch.matrix_factorization:Global Intercept: 0.1520671397447586
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 0.45 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_10 prescoring, about to call diligence with 2255 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                    raterParticipantId  internalRaterFactor1
0    01552D5C26FC92544FC04FC6295300EB0F18231076FCA5...             -0.673863
1    01E57AF02AE507E09A96747887664ED43F14374567C26F...             -0.358317
2    053B64CC0B096D79A09BC665C84EF0B9F14996FC81BEA9...             -0.721452
3    094A2218E592741C7A9B2F8DBA17B9A03279194479EB02...              0.864684
4    0A65EA1338C709F851D6459ABFBA1141EE2B4DB496D3D7...             -0.642634
..                                                 ...                   ...
146  FA0CDC5CD8DD6F5056FCCD4E0848810C5888D71D5B4B37...              0.674466
147  FB72F3D4CBE1FE6DB8AFA4FC948EEE28E98019FF31A9FE...             -0.044802
148  FB77683424FDABC100967536C499B6FB56BAEB24A4DAE4...             -0.325915
149  FC9E0A8DBF9173C60DC171330FFA45B2562254A3AFAED4...             -0.538657
150  FF3967F3562EA361C231F53000A40BC23DA93C318A3101...             -0.377389

[151 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 151, vs. num we are initializing: 151
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 151
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=24.154860 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.414059 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.873492 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.706530 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.638597 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.596601 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.569927 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.550345 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.536131 | time=0.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.523937 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.513746 | time=0.8s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(0.2284, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.513447 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.291861 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.278763 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.277877 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=105 | loss=1.277846 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.602120 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.496841 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.495644 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=080 | loss=0.495581 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(-0.1642, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.5137, 1.2778, 0.4956
INFO:birdwatch.scorer:MFGroupScorer_10 Low Diligence MF elapsed time: 1.24 secs (0.02 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 10902 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 21 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.19 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.20 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.33 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.20 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.16 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.14 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.19 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.56 secs (0.03 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 74.31 secs (1.24 mins)
INFO:birdwatch.constants:MFGroupScorer_10: Compute tag thresholds for percentiles elapsed time: 0.18 secs (0.00 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_9 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_9.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 134738
INFO:birdwatch.scorer:MFGroupScorer_9 Filter input elapsed time: 5.76 secs (0.10 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_9: 7603afe18415075459d559d1c0af85aef68e3b0405b4d418bbf7203fafc2a2e8
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 49348, Num Unique Notes Rated: 2327, Num Unique Raters: 2718
INFO:birdwatch.scorer:MFGroupScorer_9 Prepare ratings elapsed time: 0.10 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_9: 727300b3844d0154c00003fe036798d61374ce483af40a3975bb09a848e6bcfd
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_9: 6d968072609a33de48a417adb1c9bbd1f50013f6bb49652814fe261b868abb6f
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_9: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(23183) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 2718, Notes: 2327
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 21.206703910614525
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 18.15599705665931
INFO:birdwatch.matrix_factorization:epoch 0 7.227132797241211
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 6.723984718322754
INFO:birdwatch.matrix_factorization:epoch 20 0.26298537850379944
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2121865153312683
INFO:birdwatch.matrix_factorization:epoch 40 0.10830499231815338
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06959907710552216
INFO:birdwatch.matrix_factorization:epoch 60 0.08160893619060516
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.048199161887168884
INFO:birdwatch.matrix_factorization:epoch 80 0.07815445959568024
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.045012034475803375
INFO:birdwatch.matrix_factorization:epoch 100 0.07770473510026932
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04459706321358681
INFO:birdwatch.matrix_factorization:epoch 120 0.07764662802219391
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0445684976875782
INFO:birdwatch.matrix_factorization:Num epochs: 138
INFO:birdwatch.matrix_factorization:epoch 138 0.07763940095901489
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04456597566604614
INFO:birdwatch.matrix_factorization:Global Intercept: 0.16304278373718262
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_9 First MF/stable init elapsed time: 1.97 secs (0.03 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_9

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 61213 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 260 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.17 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.20 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.33 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.23 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.21 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.17 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.19 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.46 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 72.44 secs (1.21 mins)
INFO:birdwatch.scorer:MFGroupScorer_9 Compute scored notes elapsed time: 99.59 secs (1.66 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 134712 post-tombstones and 26 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 108607, including 108607 post-tombstones and 0 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 5378
INFO:birdwatch.scorer:MFGroupScorer_9 Compute valid ratings elapsed time: 1.51 secs (0.03 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_9 Helpfulness scores pre-harassment  elapsed time: 0.14 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 2718
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 5105
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 3902
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 1321
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 49348
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 28093
INFO:birdwatch.scorer:MFGroupScorer_9 Filtering by helpfulness score elapsed time: 0.08 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    17780
1     1883
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 8430
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 12099, Num Unique Notes Rated: 802, Num Unique Raters: 707
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    11016
1     1083
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.08951152987850236
INFO:birdwatch.matrix_factorization:Using pos weight: 10.171745152354571 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(23211) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 707, Notes: 802
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 15.086034912718205
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 17.11315417256011
INFO:birdwatch.matrix_factorization:epoch 0 3.2997806072235107
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 1.438652753829956
INFO:birdwatch.matrix_factorization:epoch 20 0.6562227606773376
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.22416703402996063
INFO:birdwatch.matrix_factorization:epoch 40 0.3811412751674652
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.19446243345737457
INFO:birdwatch.matrix_factorization:epoch 60 0.3485370874404907
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18137586116790771
INFO:birdwatch.matrix_factorization:epoch 80 0.344166100025177
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18115884065628052
INFO:birdwatch.matrix_factorization:epoch 100 0.34355631470680237
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18091996014118195
INFO:birdwatch.matrix_factorization:epoch 120 0.3434782028198242
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18085341155529022
INFO:birdwatch.matrix_factorization:epoch 140 0.3434685468673706
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18089789152145386
INFO:birdwatch.matrix_factorization:Num epochs: 143
INFO:birdwatch.matrix_factorization:epoch 143 0.3434683382511139
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18089070916175842
INFO:birdwatch.matrix_factorization:Global Intercept: -0.231605663895607
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_9 Harassment tag consensus elapsed time: 1.41 secs (0.02 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_9 Helpfulness scores post-harassment elapsed time: 0.24 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 2718
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 5105
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 3902
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 1321
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 49348
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 28093
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(23213) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 1321, Notes: 2323
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 12.093413689195007
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 21.2664647993944
INFO:birdwatch.matrix_factorization:epoch 0 0.4058699905872345
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3330115079879761
INFO:birdwatch.matrix_factorization:epoch 20 0.07782082259654999
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.041290443390607834
INFO:birdwatch.matrix_factorization:epoch 40 0.07490861415863037
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04224443808197975
INFO:birdwatch.matrix_factorization:epoch 60 0.07412488758563995
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.040735602378845215
INFO:birdwatch.matrix_factorization:epoch 80 0.07398568093776703
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0400872603058815
INFO:birdwatch.matrix_factorization:epoch 100 0.07398152351379395
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0400463305413723
INFO:birdwatch.matrix_factorization:Num epochs: 101
INFO:birdwatch.matrix_factorization:epoch 101 0.07398152351379395
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0400463305413723
INFO:birdwatch.matrix_factorization:Global Intercept: 0.16503368318080902
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 1.23 secs (0.02 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_9 prescoring, about to call diligence with 28093 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                     raterParticipantId  internalRaterFactor1
0     0010071192160B757808FAA013F537FC46BDAB3245A1D1...             -0.163677
1     003342625F00A9CCC1E87CC2EBDB61AE4042297B2E2EAE...              0.145339
2     007724A5673C2AC83FEB05670C44E28CEDF043BFB3FB29...             -0.359174
3     008A699E5E1D0F4C106E5A2D39AA9E7D7048FA367C4222...             -0.263525
4     00B1CD9CEEE1AA0E9434B3FC1E07C7CA329FE3EBE9AB45...             -0.521661
...                                                 ...                   ...
1316  FF1FBCB5BE47B326E922C801FE922884F6F57A031CC291...              0.521359
1317  FF3E0F86DEE8F26B4206335671C8D1B19BB5DE4C094662...             -0.506571
1318  FF862F35A3E9BE11D12C20D4B75BF6290C5566CBAC90B2...             -0.005247
1319  FF970D7E05D06EACFC74A3D512FE5E5EA4C7461B3AE0E3...              0.343654
1320  FFA32B052EE21AD7FCCDA98BD213D106DAB4DA6A168DB7...             -0.616749

[1321 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 1321, vs. num we are initializing: 1321
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 1321
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=20.320591 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.399559 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.802176 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.690253 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.653731 | time=0.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.636991 | time=1.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.627135 | time=1.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.620686 | time=1.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.616287 | time=1.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.613206 | time=2.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.610900 | time=2.3s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(0.1844, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.610819 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.383644 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.375525 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.374693 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=100 | loss=1.374670 | time=0.8s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.478771 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.393242 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.392144 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=075 | loss=0.392101 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(0.9303, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.6109, 1.3747, 0.3921
INFO:birdwatch.scorer:MFGroupScorer_9 Low Diligence MF elapsed time: 3.63 secs (0.06 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 61213 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 260 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.17 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.20 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.35 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.19 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.16 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.15 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.19 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.40 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 71.22 secs (1.19 mins)
INFO:birdwatch.constants:MFGroupScorer_9: Compute tag thresholds for percentiles elapsed time: 0.27 secs (0.00 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_8 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_8.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 21657
INFO:birdwatch.scorer:MFGroupScorer_8 Filter input elapsed time: 5.65 secs (0.09 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_8: e01e335b9122917c0e18fef7a0626e8b9ec86d67a15f36dd4a9bd4c89435573c
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 2275, Num Unique Notes Rated: 306, Num Unique Raters: 218
INFO:birdwatch.scorer:MFGroupScorer_8 Prepare ratings elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_8: 8a0eb1e5569f5ffef21102dd11ef38c32081b083187fa97e3097dd907e6038ad
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_8: 6d968072609a33de48a417adb1c9bbd1f50013f6bb49652814fe261b868abb6f
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_8: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(23246) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 218, Notes: 306
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 7.434640522875817
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 10.435779816513762
INFO:birdwatch.matrix_factorization:epoch 0 7.540817737579346
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 7.032833576202393
INFO:birdwatch.matrix_factorization:epoch 20 0.24545493721961975
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.1821167916059494
INFO:birdwatch.matrix_factorization:epoch 40 0.11517629027366638
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07405024766921997
INFO:birdwatch.matrix_factorization:epoch 60 0.09312328696250916
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.053471606224775314
INFO:birdwatch.matrix_factorization:epoch 80 0.08922053873538971
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04941513389348984
INFO:birdwatch.matrix_factorization:epoch 100 0.08870380371809006
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04883928224444389
INFO:birdwatch.matrix_factorization:epoch 120 0.08862406015396118
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04868321120738983
INFO:birdwatch.matrix_factorization:Num epochs: 140
INFO:birdwatch.matrix_factorization:epoch 140 0.08860404044389725
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04858730360865593
INFO:birdwatch.matrix_factorization:Global Intercept: 0.15697221457958221
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_8 First MF/stable init elapsed time: 0.60 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_8

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 9600 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 18 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.21 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.20 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.37 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.20 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.17 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.18 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.19 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.45 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 73.56 secs (1.23 mins)
INFO:birdwatch.scorer:MFGroupScorer_8 Compute scored notes elapsed time: 100.20 secs (1.67 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 21640 post-tombstones and 17 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 17549, including 17549 post-tombstones and 0 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 597
INFO:birdwatch.scorer:MFGroupScorer_8 Compute valid ratings elapsed time: 1.36 secs (0.02 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_8 Helpfulness scores pre-harassment  elapsed time: 0.12 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 218
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 589
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 324
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 134
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 2275
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 1601
INFO:birdwatch.scorer:MFGroupScorer_8 Filtering by helpfulness score elapsed time: 0.02 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    726
1    130
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 745
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 0, Num Unique Notes Rated: 0, Num Unique Raters: 0
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown Series([], dtype: int64)
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:No valid data for notHelpfulSpamHarassmentOrAbuse, returning None and aborting notHelpfulSpamHarassmentOrAbuse model training.
INFO:birdwatch.scorer:MFGroupScorer_8 Harassment tag consensus elapsed time: 0.03 secs (0.00 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_8 Helpfulness scores post-harassment elapsed time: 0.11 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 218
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 589
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 324
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 134
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 2275
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 1601
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(23284) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 134, Notes: 306
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 5.23202614379085
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 11.947761194029852
INFO:birdwatch.matrix_factorization:epoch 0 0.33456629514694214
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.26684901118278503
INFO:birdwatch.matrix_factorization:epoch 20 0.0724370926618576
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.037025369703769684
INFO:birdwatch.matrix_factorization:epoch 40 0.06940474361181259
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.034920305013656616
INFO:birdwatch.matrix_factorization:epoch 60 0.06752453744411469
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03139478340744972
INFO:birdwatch.matrix_factorization:epoch 80 0.06732739508152008
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03168020397424698
INFO:birdwatch.matrix_factorization:epoch 100 0.06730639934539795
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.031627804040908813
INFO:birdwatch.matrix_factorization:Num epochs: 101
INFO:birdwatch.matrix_factorization:epoch 101 0.06730639934539795
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.031627804040908813
INFO:birdwatch.matrix_factorization:Global Intercept: 0.13241185247898102
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 0.42 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_8 prescoring, about to call diligence with 1601 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                    raterParticipantId  internalRaterFactor1
0    02DB36F53766B5A72170C2E64EA5ADF5049A1BDB38A2C9...              0.131125
1    034D043921F0321563A40F6C033A627423DB4AEBAB8B8E...             -0.231309
2    03DCE96CD069F4925DBE3CD69F26AF7ED7E5A434B03394...             -0.699296
3    10FB4DB26055F348FD00DDC89812D4F257D7CC0BF0FF81...              0.122721
4    18DC8EF68B3AEF99345E969C56EE590C2DA4C14E893E6D...              0.353185
..                                                 ...                   ...
129  F1767C4474E20E688323F099CCA1D01F02ED417D83D089...             -0.212768
130  F3DE9F4343D8DD44E618EBAF1478BBAE161EB9D3B20C74...              0.612403
131  F60C3414D5669983B70B9EBF234A2BE08390E954A58615...             -0.078745
132  F7C724A477F5CDDC480F4D76FBDB060676BA4096576300...             -0.038805
133  FE48D2947F539E4B125452622985E955B43B4F23D9404E...             -0.409086

[134 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 134, vs. num we are initializing: 134
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 134
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=17.143005 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.090199 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.648359 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.545042 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.493626 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.458060 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.440477 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.429146 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.420520 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.413689 | time=0.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.408331 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(-0.4064, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.408171 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.214854 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.205754 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.204863 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=105 | loss=1.204834 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.654285 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.563889 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.562903 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=080 | loss=0.562851 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(-0.4294, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.4083, 1.2048, 0.5629
INFO:birdwatch.scorer:MFGroupScorer_8 Low Diligence MF elapsed time: 1.07 secs (0.02 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 9600 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 18 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.18 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.21 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.32 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.22 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.21 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.20 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.19 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.51 secs (0.03 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 78.86 secs (1.31 mins)
INFO:birdwatch.constants:MFGroupScorer_8: Compute tag thresholds for percentiles elapsed time: 0.23 secs (0.00 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_7 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_7.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 49986
INFO:birdwatch.scorer:MFGroupScorer_7 Filter input elapsed time: 6.73 secs (0.11 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_7: f510407878034c700fb38d4c5f16bf0ceaecf4a78de981a4dc5c8b7a53ed1975
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 9268, Num Unique Notes Rated: 853, Num Unique Raters: 660
INFO:birdwatch.scorer:MFGroupScorer_7 Prepare ratings elapsed time: 0.04 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_7: dad49217b26c532795cafdb08ada29dec8350f4e82b6da3d292f7327920f8481
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_7: 6d968072609a33de48a417adb1c9bbd1f50013f6bb49652814fe261b868abb6f
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_7: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(23314) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 660, Notes: 853
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 10.865181711606096
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 14.042424242424243
INFO:birdwatch.matrix_factorization:epoch 0 7.513163089752197
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 7.005551338195801
INFO:birdwatch.matrix_factorization:epoch 20 0.24263548851013184
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18606533110141754
INFO:birdwatch.matrix_factorization:epoch 40 0.116185262799263
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07837558537721634
INFO:birdwatch.matrix_factorization:epoch 60 0.09049871563911438
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05514201894402504
INFO:birdwatch.matrix_factorization:epoch 80 0.08725166320800781
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.051822081208229065
INFO:birdwatch.matrix_factorization:epoch 100 0.08683090656995773
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05152080953121185
INFO:birdwatch.matrix_factorization:epoch 120 0.08677458763122559
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05156571790575981
INFO:birdwatch.matrix_factorization:Num epochs: 138
INFO:birdwatch.matrix_factorization:epoch 138 0.08676795661449432
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05152944475412369
INFO:birdwatch.matrix_factorization:Global Intercept: 0.16482135653495789
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_7 First MF/stable init elapsed time: 0.99 secs (0.02 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_7

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 17636 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 89 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.05 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.40 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.22 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.40 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.33 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.25 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.28 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.19 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.51 secs (0.03 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 77.23 secs (1.29 mins)
INFO:birdwatch.scorer:MFGroupScorer_7 Compute scored notes elapsed time: 121.09 secs (2.02 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 49974 post-tombstones and 12 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 39302, including 39302 post-tombstones and 0 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 1614
INFO:birdwatch.scorer:MFGroupScorer_7 Compute valid ratings elapsed time: 1.72 secs (0.03 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_7 Helpfulness scores pre-harassment  elapsed time: 0.13 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 660
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 1754
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 1154
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 308
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 9268
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 5035
INFO:birdwatch.scorer:MFGroupScorer_7 Filtering by helpfulness score elapsed time: 0.03 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    2937
1     396
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 1702
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 381, Num Unique Notes Rated: 54, Num Unique Raters: 60
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    360
1     21
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.05511811023622047
INFO:birdwatch.matrix_factorization:Using pos weight: 17.142857142857142 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(23377) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 60, Notes: 54
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 7.055555555555555
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 6.35
INFO:birdwatch.matrix_factorization:epoch 0 3.387343406677246
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 1.5057159662246704
INFO:birdwatch.matrix_factorization:epoch 20 0.6076347231864929
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.16678114235401154
INFO:birdwatch.matrix_factorization:epoch 40 0.33540835976600647
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.12348635494709015
INFO:birdwatch.matrix_factorization:epoch 60 0.29279625415802
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.12872740626335144
INFO:birdwatch.matrix_factorization:epoch 80 0.2883542776107788
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.12433292716741562
INFO:birdwatch.matrix_factorization:epoch 100 0.2877344489097595
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.12320584058761597
INFO:birdwatch.matrix_factorization:Num epochs: 112
INFO:birdwatch.matrix_factorization:epoch 112 0.2876809537410736
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.12285500764846802
INFO:birdwatch.matrix_factorization:Global Intercept: -0.2961941063404083
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_7 Harassment tag consensus elapsed time: 0.47 secs (0.01 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_7 Helpfulness scores post-harassment elapsed time: 0.24 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 660
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 1754
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 1154
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 308
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 9268
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 5035
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(23379) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 308, Notes: 848
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 5.9375
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 16.3474025974026
INFO:birdwatch.matrix_factorization:epoch 0 0.37912678718566895
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3061395287513733
INFO:birdwatch.matrix_factorization:epoch 20 0.0804319754242897
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04235425963997841
INFO:birdwatch.matrix_factorization:epoch 40 0.0782332718372345
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.043268799781799316
INFO:birdwatch.matrix_factorization:epoch 60 0.07650826126337051
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03990555927157402
INFO:birdwatch.matrix_factorization:epoch 80 0.07641035318374634
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04022388532757759
INFO:birdwatch.matrix_factorization:epoch 100 0.07637393474578857
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03996235504746437
INFO:birdwatch.matrix_factorization:Num epochs: 102
INFO:birdwatch.matrix_factorization:epoch 102 0.07637476176023483
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04003499448299408
INFO:birdwatch.matrix_factorization:Global Intercept: 0.16469848155975342
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 0.52 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_7 prescoring, about to call diligence with 5035 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                    raterParticipantId  internalRaterFactor1
0    0007FA945EF35219D0388D94715189F6231A77263D83B1...              0.429642
1    000F1687C56AB92D846F2B9BFA71AE16D8A88426754E3B...              0.462853
2    008D2B105D9284320C4CC52C5247EC6C4167699D26BD53...              0.466683
3    00D9B842B8F532C5E4159DCB7443408832331D526F5B0A...              0.694498
4    00E801A1AE7306E83F42DE6B2C1D7D5E4AF667A29E3AFC...             -0.446203
..                                                 ...                   ...
303  FA42C855566088D2CF0A3FD5A1F156A681DD0E8E058A69...             -0.404248
304  FA77FDC6DBA0EDBE1244CD3E9BB0E11E10DD92FC9361CF...              0.115896
305  FB7453028620D33F1C4E68A8437CE132ED11A967C2733D...             -0.599029
306  FE4973B3DA280A019D30F8EBAFFC19D8B7C1E5B89AF997...              0.122582
307  FF77FD3571A6B1C5746E07AC7CD9D569F05CABA3183635...             -0.545250

[308 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 308, vs. num we are initializing: 308
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 308
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=21.338985 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.326382 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.770847 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.629612 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.571326 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.538498 | time=0.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.516753 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.502444 | time=0.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.491661 | time=1.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.483171 | time=1.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.476798 | time=1.2s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(-0.2266, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.476621 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.283625 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.275286 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.274316 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=100 | loss=1.274293 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.567134 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.487103 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.486110 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=075 | loss=0.486070 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(-0.2724, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.4768, 1.2743, 0.4861
INFO:birdwatch.scorer:MFGroupScorer_7 Low Diligence MF elapsed time: 1.87 secs (0.03 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 17636 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 89 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.27 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.20 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.37 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.27 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.20 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.25 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.19 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.53 secs (0.03 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 74.44 secs (1.24 mins)
INFO:birdwatch.constants:MFGroupScorer_7: Compute tag thresholds for percentiles elapsed time: 0.20 secs (0.00 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_6 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_6.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 139548
INFO:birdwatch.scorer:MFGroupScorer_6 Filter input elapsed time: 6.86 secs (0.11 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_6: 6c0ddb8b1625f20183a4b1bd869c69b9dfede08cb0c17bb75f6959cc9e2ca986
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 61687, Num Unique Notes Rated: 3844, Num Unique Raters: 2890
INFO:birdwatch.scorer:MFGroupScorer_6 Prepare ratings elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_6: 788238e12ef578e83a2c879dd2238e2d4d4c149cc9fac6146c453f86a2fa8129
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_6: 6d968072609a33de48a417adb1c9bbd1f50013f6bb49652814fe261b868abb6f
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_6: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(23410) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 2890, Notes: 3844
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 16.04760665972945
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 21.34498269896194
INFO:birdwatch.matrix_factorization:epoch 0 7.3676605224609375
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 6.8657708168029785
INFO:birdwatch.matrix_factorization:epoch 20 0.25533080101013184
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.20541591942310333
INFO:birdwatch.matrix_factorization:epoch 40 0.11374028772115707
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07717647403478622
INFO:birdwatch.matrix_factorization:epoch 60 0.09344808757305145
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.059632059186697006
INFO:birdwatch.matrix_factorization:epoch 80 0.09067234396934509
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05648688226938248
INFO:birdwatch.matrix_factorization:epoch 100 0.09030643105506897
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05637016519904137
INFO:birdwatch.matrix_factorization:epoch 120 0.0902618020772934
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05635818466544151
INFO:birdwatch.matrix_factorization:Num epochs: 132
INFO:birdwatch.matrix_factorization:epoch 132 0.09025711566209793
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.056368548423051834
INFO:birdwatch.matrix_factorization:Global Intercept: 0.1662329137325287
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_6 First MF/stable init elapsed time: 2.27 secs (0.04 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_6

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 77962 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 268 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.26 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.23 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.48 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.33 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.30 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.26 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.19 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.55 secs (0.03 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 76.12 secs (1.27 mins)
INFO:birdwatch.scorer:MFGroupScorer_6 Compute scored notes elapsed time: 105.48 secs (1.76 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 139464 post-tombstones and 84 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 114255, including 114250 post-tombstones and 5 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 8056
INFO:birdwatch.scorer:MFGroupScorer_6 Compute valid ratings elapsed time: 1.55 secs (0.03 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_6 Helpfulness scores pre-harassment  elapsed time: 0.17 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 2890
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 6434
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 4594
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 1757
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 61687
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 42254
INFO:birdwatch.scorer:MFGroupScorer_6 Filtering by helpfulness score elapsed time: 0.09 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    26005
1     2005
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 14244
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 16709, Num Unique Notes Rated: 1407, Num Unique Raters: 941
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    15681
1     1028
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.061523729726494704
INFO:birdwatch.matrix_factorization:Using pos weight: 15.253891050583658 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(23439) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 941, Notes: 1407
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 11.875621890547263
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 17.75664187035069
INFO:birdwatch.matrix_factorization:epoch 0 3.329723596572876
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 1.4536405801773071
INFO:birdwatch.matrix_factorization:epoch 20 0.6634089350700378
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2649775445461273
INFO:birdwatch.matrix_factorization:epoch 40 0.4109291434288025
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.21228426694869995
INFO:birdwatch.matrix_factorization:epoch 60 0.3765120208263397
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.20392639935016632
INFO:birdwatch.matrix_factorization:epoch 80 0.3720197081565857
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.20227769017219543
INFO:birdwatch.matrix_factorization:epoch 100 0.37140411138534546
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.20195704698562622
INFO:birdwatch.matrix_factorization:epoch 120 0.37132522463798523
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.20189888775348663
INFO:birdwatch.matrix_factorization:epoch 140 0.3713153004646301
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.20191358029842377
INFO:birdwatch.matrix_factorization:Num epochs: 146
INFO:birdwatch.matrix_factorization:epoch 146 0.37131467461586
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.20191991329193115
INFO:birdwatch.matrix_factorization:Global Intercept: -0.29330766201019287
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_6 Harassment tag consensus elapsed time: 1.54 secs (0.03 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_6 Helpfulness scores post-harassment elapsed time: 0.30 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 2890
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 6434
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 4567
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 1730
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 61687
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 40362
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(23440) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 1730, Notes: 3837
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 10.519155590304926
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 23.33063583815029
INFO:birdwatch.matrix_factorization:epoch 0 0.3965469300746918
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3231081962585449
INFO:birdwatch.matrix_factorization:epoch 20 0.08882641047239304
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05193734169006348
INFO:birdwatch.matrix_factorization:epoch 40 0.08644437789916992
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05317248776555061
INFO:birdwatch.matrix_factorization:epoch 60 0.08543387055397034
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.051225531846284866
INFO:birdwatch.matrix_factorization:epoch 80 0.08534465730190277
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05085071548819542
INFO:birdwatch.matrix_factorization:epoch 100 0.08534131199121475
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05074799805879593
INFO:birdwatch.matrix_factorization:Num epochs: 101
INFO:birdwatch.matrix_factorization:epoch 101 0.08534131199121475
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05074799805879593
INFO:birdwatch.matrix_factorization:Global Intercept: 0.16950590908527374
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 1.39 secs (0.02 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_6 prescoring, about to call diligence with 40362 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                     raterParticipantId  internalRaterFactor1
0     00537B460182CCA4864ED4D53F50B3C90AAC12C10D2393...              0.608338
1     007A172A5561E8B7763F51D195A87DF3FE042D50A20328...              0.458105
2     00819BDCAA385D10049D512029D3F839808A094BFB9F6F...              0.709683
3     009C38FB2D3F4140022CC566C236B8E161E362406F7D10...              0.097642
4     009F30BCF8C336CA8D2770C5264293797F55F2C83A5FA3...             -0.493409
...                                                 ...                   ...
1725  FF8482988E355445D426EB9CA10449FFA8BF5D7B898DFB...              0.674057
1726  FF8B8E0DB0E0B736C013D10B7E0BE5503AA4EC11AC0C50...              0.621721
1727  FFAA882D56280425C2A13877395F17D5BF7A25C6FD1BC7...              0.674180
1728  FFB5F72892AFEECA1370E0D784FAB97CB07AC2D3DAAC31...              0.696796
1729  FFFC8248F057883916F06F78A0DB7878BFB2C6162434E2...              0.581550

[1730 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 1730, vs. num we are initializing: 1730
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 1730
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=16.448523 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.284245 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.809746 | time=0.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.709477 | time=0.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.670868 | time=1.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.650638 | time=1.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.638062 | time=1.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.629107 | time=2.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.621935 | time=2.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.617351 | time=2.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.614286 | time=3.1s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(-0.3933, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.614194 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.428403 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.419900 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.419091 | time=1.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=100 | loss=1.419067 | time=1.1s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.534943 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.447074 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.445933 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=075 | loss=0.445888 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(0.3704, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.6143, 1.4191, 0.4459
INFO:birdwatch.scorer:MFGroupScorer_6 Low Diligence MF elapsed time: 4.75 secs (0.08 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 77962 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 268 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.25 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.21 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.43 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.32 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.28 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.25 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.19 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.56 secs (0.03 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 74.51 secs (1.24 mins)
INFO:birdwatch.constants:MFGroupScorer_6: Compute tag thresholds for percentiles elapsed time: 0.32 secs (0.01 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_5 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_5.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 14172
INFO:birdwatch.scorer:MFGroupScorer_5 Filter input elapsed time: 5.61 secs (0.09 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_5: 74f5d3a0e6f003a2616624c2ef5687de81069bafc3ce003fd4d4ab655f979ed3
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 726, Num Unique Notes Rated: 83, Num Unique Raters: 92
INFO:birdwatch.scorer:MFGroupScorer_5 Prepare ratings elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_5: 070078da5b37a726746ee8b9c61377095b539512528102c284a231563271b400
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_5: 6d968072609a33de48a417adb1c9bbd1f50013f6bb49652814fe261b868abb6f
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_5: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(23474) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 92, Notes: 83
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 8.74698795180723
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 7.891304347826087
INFO:birdwatch.matrix_factorization:epoch 0 7.5840253829956055
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 7.073186874389648
INFO:birdwatch.matrix_factorization:epoch 20 0.31245213747024536
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.24720124900341034
INFO:birdwatch.matrix_factorization:epoch 40 0.09196560084819794
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.045576389878988266
INFO:birdwatch.matrix_factorization:epoch 60 0.06110866367816925
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.022220509126782417
INFO:birdwatch.matrix_factorization:epoch 80 0.05681204795837402
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0179317407310009
INFO:birdwatch.matrix_factorization:epoch 100 0.0562252476811409
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.017745407298207283
INFO:birdwatch.matrix_factorization:Num epochs: 108
INFO:birdwatch.matrix_factorization:epoch 108 0.056185901165008545
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.017810719087719917
INFO:birdwatch.matrix_factorization:Global Intercept: 0.165120929479599
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_5 First MF/stable init elapsed time: 0.50 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_5

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 3432 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 15 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.27 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.20 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.37 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.22 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.20 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.26 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.19 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.39 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 73.66 secs (1.23 mins)
INFO:birdwatch.scorer:MFGroupScorer_5 Compute scored notes elapsed time: 98.98 secs (1.65 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 14169 post-tombstones and 3 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 11419, including 11419 post-tombstones and 0 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 141
INFO:birdwatch.scorer:MFGroupScorer_5 Compute valid ratings elapsed time: 1.37 secs (0.02 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_5 Helpfulness scores pre-harassment  elapsed time: 0.11 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 92
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 175
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 124
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 23
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 726
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 208
INFO:birdwatch.scorer:MFGroupScorer_5 Filtering by helpfulness score elapsed time: 0.01 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    140
1     13
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 55
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 0, Num Unique Notes Rated: 0, Num Unique Raters: 0
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown Series([], dtype: int64)
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:No valid data for notHelpfulSpamHarassmentOrAbuse, returning None and aborting notHelpfulSpamHarassmentOrAbuse model training.
INFO:birdwatch.scorer:MFGroupScorer_5 Harassment tag consensus elapsed time: 0.02 secs (0.00 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_5 Helpfulness scores post-harassment elapsed time: 0.12 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 92
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 175
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 124
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 23
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 726
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 208
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(23499) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 23, Notes: 72
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 2.888888888888889
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 9.043478260869565
INFO:birdwatch.matrix_factorization:epoch 0 0.39579829573631287
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3130822479724884
INFO:birdwatch.matrix_factorization:epoch 20 0.05076555162668228
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.01141438540071249
INFO:birdwatch.matrix_factorization:epoch 40 0.046807318925857544
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.01147166732698679
INFO:birdwatch.matrix_factorization:epoch 60 0.045017097145318985
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.007676136679947376
INFO:birdwatch.matrix_factorization:epoch 80 0.04491373524069786
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.008057702332735062
INFO:birdwatch.matrix_factorization:epoch 100 0.04487244784832001
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.007870794273912907
INFO:birdwatch.matrix_factorization:Num epochs: 102
INFO:birdwatch.matrix_factorization:epoch 102 0.04487460106611252
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.007931126281619072
INFO:birdwatch.matrix_factorization:Global Intercept: 0.16382735967636108
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 0.38 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_5 prescoring, about to call diligence with 208 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                   raterParticipantId  internalRaterFactor1
0   06714FBDCE5A7A6E45B5F0815901C281FEB961390712A2...             -0.543721
1   0EF7481E7E847819CBDE13CC2C3933C118215DC5819A97...             -0.509633
2   1729D50F11A2405B98258D5389E18F5FBD9B2979176588...             -0.643986
3   19C25936718B5013BB2228AD4F1EBDB1726A731C986162...              0.532676
4   2769B56422E5E4AE5C6F0E8014FF9D544F92B4C2FBD037...             -0.627675
5   2FED843BA72F095F4DA1FAEDE071B3CF6271F47EC29027...             -0.455404
6   45A5BAC69E307E940554DBD6BABD16899132DDC2583FFB...              0.673811
7   47FCCEA02838D26E00DB65A821CE70778CEE9CB161A216...              0.357029
8   49787BB4031B62F92FCF98FF57091428B7E7D299BAD934...              0.685785
9   4AEEFB2D8959A36D46A96F9DF98532388344AA2CF91C9F...             -0.693824
10  4ED158FE69FADBE2A473E1512B3FFBCA8728AF23D4CA06...             -0.550320
11  5020509DFCFB744DB84715469B4ABF87DA9E2ED072B813...              0.531045
12  5F6311257FE14462CCB51A18801817AC5D38CC69DEDCEC...             -0.583115
13  6444EE19DE9290141D7B08D6EA3F2AAEF3FF64215D8CB6...             -0.699088
14  7B01CC0F9341F73DA9AEFED9639A869A050AA6967D41AA...             -0.616965
15  9585BE0BD81A263EA7243D1F9C8248391DBE34013D8E3A...             -0.293528
16  96ABC65F2ABC51F218CC4450FBC4F49D1C19E4C251F8AB...              0.278296
17  9B97B1FBACB2209C6D0BCA75B1CA282A3B3DA7C07CBD85...             -0.699183
18  9DC67B26EA92E056FA5411048F563168FEC64EC67EB9DA...              0.588939
19  A836C6F56F7D37BEA213868DFD41FCFCE7C2E2184593EE...              0.529950
20  B92CC2CC56D23D3FA02C0A4642F5ECC5C586C602407679...             -0.641587
21  B92D1E0BD707B660351C99D48A4F187349C939CCFDF481...             -0.599713
22  D02578E31DDC80C9FEA63EDEC5842FEC6A5FCBAEEAF58F...              0.423557
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 23, vs. num we are initializing: 23
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 23
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=15.793743 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=2.760593 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.268252 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.098150 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=1.998925 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=1.955430 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=1.931335 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=1.915769 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=1.904830 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=1.896816 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=1.890851 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(-1.3233, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=1.890681 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.446658 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.440980 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=0.439577 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=100 | loss=0.439538 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.321541 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.286377 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.285637 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=070 | loss=0.285613 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(-3.2163, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 1.8909, 0.4395, 0.2856
INFO:birdwatch.scorer:MFGroupScorer_5 Low Diligence MF elapsed time: 0.82 secs (0.01 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 3432 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 15 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.23 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.20 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.37 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.22 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.18 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.16 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.19 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.41 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 73.24 secs (1.22 mins)
INFO:birdwatch.constants:MFGroupScorer_5: Compute tag thresholds for percentiles elapsed time: 0.10 secs (0.00 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_4 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_4.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 33598
INFO:birdwatch.scorer:MFGroupScorer_4 Filter input elapsed time: 5.67 secs (0.09 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_4: 000de088e6e757994a81ab0d8f8a8eefd4759f2b9ae311fdd34a12c69e01680f
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 4120, Num Unique Notes Rated: 371, Num Unique Raters: 361
INFO:birdwatch.scorer:MFGroupScorer_4 Prepare ratings elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_4: f6025cecbf88cbf0aa9531507e8f786616f9c50596430ef3202d43bd209d2b2d
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_4: 6d968072609a33de48a417adb1c9bbd1f50013f6bb49652814fe261b868abb6f
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_4: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(23528) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 361, Notes: 371
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 11.10512129380054
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 11.412742382271468
INFO:birdwatch.matrix_factorization:epoch 0 7.660407066345215
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 7.152763366699219
INFO:birdwatch.matrix_factorization:epoch 20 0.23640786111354828
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.1817425936460495
INFO:birdwatch.matrix_factorization:epoch 40 0.09573064744472504
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05871056392788887
INFO:birdwatch.matrix_factorization:epoch 60 0.07647190988063812
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04162903502583504
INFO:birdwatch.matrix_factorization:epoch 80 0.0739324614405632
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0401729978621006
INFO:birdwatch.matrix_factorization:epoch 100 0.07359059154987335
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03980044275522232
INFO:birdwatch.matrix_factorization:epoch 120 0.07354548573493958
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03970940783619881
INFO:birdwatch.matrix_factorization:Num epochs: 131
INFO:birdwatch.matrix_factorization:epoch 131 0.07354159653186798
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03972097113728523
INFO:birdwatch.matrix_factorization:Global Intercept: 0.14531683921813965
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_4 First MF/stable init elapsed time: 0.68 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_4

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 8904 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 57 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.27 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.20 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.40 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.27 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.24 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.25 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.19 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.67 secs (0.03 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 81.20 secs (1.35 mins)
INFO:birdwatch.scorer:MFGroupScorer_4 Compute scored notes elapsed time: 107.64 secs (1.79 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 33595 post-tombstones and 3 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 27619, including 27619 post-tombstones and 0 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 849
INFO:birdwatch.scorer:MFGroupScorer_4 Compute valid ratings elapsed time: 1.79 secs (0.03 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_4 Helpfulness scores pre-harassment  elapsed time: 0.12 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 361
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 958
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 692
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 155
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 4120
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 1949
INFO:birdwatch.scorer:MFGroupScorer_4 Filtering by helpfulness score elapsed time: 0.02 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    1034
1     179
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 736
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 5, Num Unique Notes Rated: 1, Num Unique Raters: 5
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    5
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse tag positive rate is 0.0: returning None and aborting notHelpfulSpamHarassmentOrAbuse model training.
INFO:birdwatch.scorer:MFGroupScorer_4 Harassment tag consensus elapsed time: 0.03 secs (0.00 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_4 Helpfulness scores post-harassment elapsed time: 0.12 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 361
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 958
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 692
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 155
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 4120
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 1949
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(23560) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 155, Notes: 366
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 5.325136612021858
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 12.574193548387097
INFO:birdwatch.matrix_factorization:epoch 0 0.39849963784217834
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3274095058441162
INFO:birdwatch.matrix_factorization:epoch 20 0.06968393921852112
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.032473836094141006
INFO:birdwatch.matrix_factorization:epoch 40 0.06705210357904434
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.032446153461933136
INFO:birdwatch.matrix_factorization:epoch 60 0.06544975191354752
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.029392460361123085
INFO:birdwatch.matrix_factorization:epoch 80 0.06539390236139297
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.029480597004294395
INFO:birdwatch.matrix_factorization:epoch 100 0.06537414342164993
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.02932300604879856
INFO:birdwatch.matrix_factorization:Num epochs: 103
INFO:birdwatch.matrix_factorization:epoch 103 0.06537313759326935
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.029426848515868187
INFO:birdwatch.matrix_factorization:Global Intercept: 0.15031348168849945
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 0.46 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_4 prescoring, about to call diligence with 1949 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                    raterParticipantId  internalRaterFactor1
0    00DF531883F82B474928CB0E73C08D543F3B4944D094B5...             -0.438634
1    016A6BD710984AFF6E78F97183758AE2CAF2CDCAE10961...             -0.607129
2    0281A3E88C3C226058BEE76E1CF5061FC8A6D553ACEA0B...             -0.561879
3    03208CE07F85EC3A764559309F250D019774E8C4B357E8...              0.655733
4    05C32141E3A2301389D4F6FB0F6F0925D28B28FA739D0A...             -0.200714
..                                                 ...                   ...
150  FC2DDDCA0E5BDF6DA28E84A101DD02FF8910B7CE1E45BC...             -0.530600
151  FC6121D9B2F94211FDD9F7A2D79A670423B53A466732A7...             -0.405834
152  FCA342919301000CE0E0B21AA9890C54C752B2B36FC28B...              0.572627
153  FCF71787C19F6C45ED673372CD3469351C26003C8F44E5...              0.719081
154  FDF97D6605DA5352D673B7CB06306039BD4549FE4E7026...              0.513121

[155 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 155, vs. num we are initializing: 155
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 155
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=24.865671 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.528188 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.834803 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.650635 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.573514 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.527042 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.496777 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.477679 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.462129 | time=0.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.447881 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.436144 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(0.0430, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.435779 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.223751 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.208395 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.207460 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=105 | loss=1.207421 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.563132 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.465487 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.464028 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=075 | loss=0.463976 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(-0.2872, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.4361, 1.2074, 0.4640
INFO:birdwatch.scorer:MFGroupScorer_4 Low Diligence MF elapsed time: 1.23 secs (0.02 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 8904 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 57 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.25 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.20 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.37 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.27 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.23 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.24 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.19 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.42 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 75.02 secs (1.25 mins)
INFO:birdwatch.constants:MFGroupScorer_4: Compute tag thresholds for percentiles elapsed time: 0.15 secs (0.00 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_3 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_3.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 113991
INFO:birdwatch.scorer:MFGroupScorer_3 Filter input elapsed time: 5.78 secs (0.10 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_3: 228686326e3dfe2c14fc570551a1344f9547e51ea0a0ce8db29ebde8dac3fe52
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 34023, Num Unique Notes Rated: 2048, Num Unique Raters: 1909
INFO:birdwatch.scorer:MFGroupScorer_3 Prepare ratings elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_3: 475a49d056bb88d5d68eb92b0ee1f86e14b1bcdb4a441907496c4650d39fce36
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_3: 6d968072609a33de48a417adb1c9bbd1f50013f6bb49652814fe261b868abb6f
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_3: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(23590) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 1909, Notes: 2048
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 16.61279296875
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 17.822420115243585
INFO:birdwatch.matrix_factorization:epoch 0 7.181307792663574
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 6.676263332366943
INFO:birdwatch.matrix_factorization:epoch 20 0.2526402473449707
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.19849886000156403
INFO:birdwatch.matrix_factorization:epoch 40 0.11775411665439606
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.08203845471143723
INFO:birdwatch.matrix_factorization:epoch 60 0.09396033734083176
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05934472754597664
INFO:birdwatch.matrix_factorization:epoch 80 0.09110554307699203
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.056771282106637955
INFO:birdwatch.matrix_factorization:epoch 100 0.09070396423339844
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05658149719238281
INFO:birdwatch.matrix_factorization:epoch 120 0.09065067023038864
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.056589990854263306
INFO:birdwatch.matrix_factorization:Num epochs: 134
INFO:birdwatch.matrix_factorization:epoch 134 0.0906449407339096
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05663001164793968
INFO:birdwatch.matrix_factorization:Global Intercept: 0.17309200763702393
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_3 First MF/stable init elapsed time: 1.74 secs (0.03 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_3

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 45761 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 180 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.35 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.23 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.62 secs (0.03 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.42 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.33 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.25 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.19 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.55 secs (0.03 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 77.65 secs (1.29 mins)
INFO:birdwatch.scorer:MFGroupScorer_3 Compute scored notes elapsed time: 104.70 secs (1.75 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 113957 post-tombstones and 34 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 85301, including 85298 post-tombstones and 3 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 8308
INFO:birdwatch.scorer:MFGroupScorer_3 Compute valid ratings elapsed time: 1.57 secs (0.03 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_3 Helpfulness scores pre-harassment  elapsed time: 0.13 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 1909
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 6353
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 4949
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 1286
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 34023
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 25023
INFO:birdwatch.scorer:MFGroupScorer_3 Filtering by helpfulness score elapsed time: 0.05 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    17119
1      933
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 6971
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 10916, Num Unique Notes Rated: 733, Num Unique Raters: 668
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    10567
1      349
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.03197141810186881
INFO:birdwatch.matrix_factorization:Using pos weight: 30.277936962750722 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(23636) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 668, Notes: 733
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 14.892223738062755
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 16.34131736526946
INFO:birdwatch.matrix_factorization:epoch 0 3.132998466491699
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 1.2320982217788696
INFO:birdwatch.matrix_factorization:epoch 20 0.6794173717498779
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2666299641132355
INFO:birdwatch.matrix_factorization:epoch 40 0.39117366075515747
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.20095902681350708
INFO:birdwatch.matrix_factorization:epoch 60 0.3451654314994812
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.17929133772850037
INFO:birdwatch.matrix_factorization:epoch 80 0.3397332727909088
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.17948152124881744
INFO:birdwatch.matrix_factorization:epoch 100 0.3389616012573242
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.17898239195346832
INFO:birdwatch.matrix_factorization:epoch 120 0.33886441588401794
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.17896585166454315
INFO:birdwatch.matrix_factorization:epoch 140 0.33885154128074646
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.17900784313678741
INFO:birdwatch.matrix_factorization:Num epochs: 145
INFO:birdwatch.matrix_factorization:epoch 145 0.33885088562965393
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.17898401618003845
INFO:birdwatch.matrix_factorization:Global Intercept: -0.2664569914340973
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_3 Harassment tag consensus elapsed time: 1.17 secs (0.02 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_3 Helpfulness scores post-harassment elapsed time: 0.25 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 1909
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 6353
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 4949
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 1286
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 34023
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 25023
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(23637) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 1286, Notes: 2046
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 12.230205278592376
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 19.45800933125972
INFO:birdwatch.matrix_factorization:epoch 0 0.38765570521354675
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.313388854265213
INFO:birdwatch.matrix_factorization:epoch 20 0.0893501341342926
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05351204797625542
INFO:birdwatch.matrix_factorization:epoch 40 0.08631665259599686
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05347352847456932
INFO:birdwatch.matrix_factorization:epoch 60 0.0851745456457138
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05116894841194153
INFO:birdwatch.matrix_factorization:epoch 80 0.0850859060883522
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05082995072007179
INFO:birdwatch.matrix_factorization:epoch 100 0.08507867157459259
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05065804719924927
INFO:birdwatch.matrix_factorization:Num epochs: 101
INFO:birdwatch.matrix_factorization:epoch 101 0.08507867157459259
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05065804719924927
INFO:birdwatch.matrix_factorization:Global Intercept: 0.17757073044776917
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 1.05 secs (0.02 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_3 prescoring, about to call diligence with 25023 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                     raterParticipantId  internalRaterFactor1
0     0082235CA4459F0F8C5D33A76A9E9C985165454365EA2A...             -0.598116
1     008B07A5C6396F8E4812840D0379BE7E7351683F5E6320...              0.083232
2     009040F358AE8F2BA076F70305BBFFF02248F2E9086C1F...             -0.221053
3     009EF8E67A7620A96FEEA18E8CA43EDACB1FD6E8EE3850...             -0.446241
4     010E852380E40FB1BD5DB43C2D83FFE9AAE05B330FCA51...             -0.641032
...                                                 ...                   ...
1281  FF9FE70C24E5AC0646100D783F8E4033FE39E0532B86FB...              0.026649
1282  FFA1228B74DC1BC97BBB4CC7FCF812BBA979C1D0E6FB66...              0.238070
1283  FFAF7A01888D9005A21A1C22CC3BC3B487CA7B4A7829A1...             -0.385209
1284  FFBE6497F66B97BD0FFAC62B0E5ED0A3CA89E07885039C...             -0.307915
1285  FFC0FE156D4D58A807AE58E3C67B1CAFAA4D1B09794163...             -0.539390

[1286 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 1286, vs. num we are initializing: 1286
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 1286
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=15.470836 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.156477 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.698708 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.589388 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.543826 | time=0.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.517537 | time=1.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.502021 | time=1.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.492898 | time=1.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.487072 | time=1.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.483174 | time=2.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.480545 | time=2.4s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(-0.5867, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.480474 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.267718 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.254558 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.253685 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=100 | loss=1.253657 | time=0.8s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.514462 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.414276 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.413038 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=080 | loss=0.412981 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(0.2908, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.4805, 1.2537, 0.4130
INFO:birdwatch.scorer:MFGroupScorer_3 Low Diligence MF elapsed time: 3.69 secs (0.06 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 45761 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 180 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.22 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.22 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.41 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.36 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.43 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.48 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.20 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.61 secs (0.03 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 76.23 secs (1.27 mins)
INFO:birdwatch.constants:MFGroupScorer_3: Compute tag thresholds for percentiles elapsed time: 0.28 secs (0.00 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_2 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_2.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 42885
INFO:birdwatch.scorer:MFGroupScorer_2 Filter input elapsed time: 6.31 secs (0.11 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_2: 6331503e965a834318c9020257dcd52d771dd42b79006909fe2d0bc59788e68a
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 9721, Num Unique Notes Rated: 973, Num Unique Raters: 588
INFO:birdwatch.scorer:MFGroupScorer_2 Prepare ratings elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_2: 9f82ef3c30f5f748b7ba7c332c68b0eabbb0df77f252720af0f86103ae9769e8
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_2: 6d968072609a33de48a417adb1c9bbd1f50013f6bb49652814fe261b868abb6f
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_2: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(23666) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 588, Notes: 973
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 9.990750256937307
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 16.532312925170068
INFO:birdwatch.matrix_factorization:epoch 0 7.245419025421143
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 6.738010406494141
INFO:birdwatch.matrix_factorization:epoch 20 0.24606604874134064
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18887554109096527
INFO:birdwatch.matrix_factorization:epoch 40 0.12234368920326233
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.08352018147706985
INFO:birdwatch.matrix_factorization:epoch 60 0.09436789155006409
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05918283015489578
INFO:birdwatch.matrix_factorization:epoch 80 0.09094056487083435
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05590910091996193
INFO:birdwatch.matrix_factorization:epoch 100 0.09045364707708359
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05567900463938713
INFO:birdwatch.matrix_factorization:epoch 120 0.09039367735385895
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05563976243138313
INFO:birdwatch.matrix_factorization:epoch 140 0.09038563072681427
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.055663201957941055
INFO:birdwatch.matrix_factorization:Num epochs: 143
INFO:birdwatch.matrix_factorization:epoch 143 0.09038543701171875
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05564875528216362
INFO:birdwatch.matrix_factorization:Global Intercept: 0.16229258477687836
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_2 First MF/stable init elapsed time: 1.15 secs (0.02 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_2

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 19967 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 53 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.39 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.40 secs (0.01 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.65 secs (0.03 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.38 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.29 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.32 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.20 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.53 secs (0.03 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 81.25 secs (1.35 mins)
INFO:birdwatch.scorer:MFGroupScorer_2 Compute scored notes elapsed time: 113.29 secs (1.89 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 42863 post-tombstones and 22 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 33357, including 33357 post-tombstones and 0 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 2161
INFO:birdwatch.scorer:MFGroupScorer_2 Compute valid ratings elapsed time: 1.80 secs (0.03 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_2 Helpfulness scores pre-harassment  elapsed time: 0.13 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 588
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 2022
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 1359
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 374
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 9721
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 6731
INFO:birdwatch.scorer:MFGroupScorer_2 Filtering by helpfulness score elapsed time: 0.02 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    4173
1     262
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 2296
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 954, Num Unique Notes Rated: 120, Num Unique Raters: 95
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    926
1     28
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.029350104821802937
INFO:birdwatch.matrix_factorization:Using pos weight: 33.07142857142857 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(23700) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 95, Notes: 120
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 7.95
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 10.042105263157895
INFO:birdwatch.matrix_factorization:epoch 0 2.74914813041687
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.8547552227973938
INFO:birdwatch.matrix_factorization:epoch 20 0.6003860235214233
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2234557867050171
INFO:birdwatch.matrix_factorization:epoch 40 0.3320767283439636
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.1193312257528305
INFO:birdwatch.matrix_factorization:epoch 60 0.28904300928115845
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.11419743299484253
INFO:birdwatch.matrix_factorization:epoch 80 0.281795859336853
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.11322196573019028
INFO:birdwatch.matrix_factorization:epoch 100 0.27589577436447144
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.10707134008407593
INFO:birdwatch.matrix_factorization:epoch 120 0.24535617232322693
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.08662610501050949
INFO:birdwatch.matrix_factorization:Num epochs: 126
INFO:birdwatch.matrix_factorization:epoch 126 0.239647775888443
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07993010431528091
INFO:birdwatch.matrix_factorization:Global Intercept: -0.21776387095451355
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_2 Harassment tag consensus elapsed time: 0.51 secs (0.01 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_2 Helpfulness scores post-harassment elapsed time: 0.22 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 588
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 2022
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 1359
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 374
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 9721
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 6731
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(23703) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 374, Notes: 970
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 6.939175257731959
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 17.997326203208555
INFO:birdwatch.matrix_factorization:epoch 0 0.4011635184288025
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3266505300998688
INFO:birdwatch.matrix_factorization:epoch 20 0.09124209731817245
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05362922325730324
INFO:birdwatch.matrix_factorization:epoch 40 0.08572862297296524
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05116519331932068
INFO:birdwatch.matrix_factorization:epoch 60 0.08424173295497894
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0480632483959198
INFO:birdwatch.matrix_factorization:epoch 80 0.0841459184885025
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04803773760795593
INFO:birdwatch.matrix_factorization:epoch 100 0.08411525934934616
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.047880299389362335
INFO:birdwatch.matrix_factorization:Num epochs: 102
INFO:birdwatch.matrix_factorization:epoch 102 0.08411577343940735
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04794403910636902
INFO:birdwatch.matrix_factorization:Global Intercept: 0.16880956292152405
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 0.66 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_2 prescoring, about to call diligence with 6731 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                    raterParticipantId  internalRaterFactor1
0    004155EE77F1D621C93AC236A4E0DC3F3ADE8362817535...             -0.555580
1    006D40D8573E03CCCE668D8C289DEA96FB519A75356786...             -0.127617
2    00A4EDC01FFF8C52C55BA50811078061D15C23E5ECA99A...             -0.370070
3    019065DD62143A0CFEBF5C9DCFC4F67549A76C7EE02E29...             -0.346519
4    01DF80CE748D764930B05F40EA2E3CA86C220AC05F87F9...              0.169167
..                                                 ...                   ...
369  FCF5C6479C7EC58AB271F1AF8D46438C754E5E730766CE...             -0.130995
370  FD6357C7D5694C614853A40BDCAE231AD9327294BABCFC...             -0.517652
371  FD8CDB4FFEDA9C0B025FCD1E318B8CCFCA0E349E683265...             -0.435070
372  FE9616D890308B83BA931D17A92EE72CFB5F669017216D...             -0.544415
373  FEC16AB59DFD7992B5D16534CB7A1B1CC4C8C84E088ADE...              0.070740

[374 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 374, vs. num we are initializing: 374
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 374
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=17.453577 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.200864 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.713386 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.581417 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.530020 | time=0.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.501862 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.483169 | time=0.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.471217 | time=1.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.462519 | time=1.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.454516 | time=1.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.448720 | time=1.4s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(-0.3705, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.448576 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.285599 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.273129 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.272252 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=100 | loss=1.272223 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.574492 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.491118 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.489896 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=075 | loss=0.489854 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(-0.0963, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.4487, 1.2722, 0.4899
INFO:birdwatch.scorer:MFGroupScorer_2 Low Diligence MF elapsed time: 2.20 secs (0.04 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 19967 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 53 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.24 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.21 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.41 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.24 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.25 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.26 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.19 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.49 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 77.41 secs (1.29 mins)
INFO:birdwatch.constants:MFGroupScorer_2: Compute tag thresholds for percentiles elapsed time: 0.18 secs (0.00 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_1 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_1.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 171481
INFO:birdwatch.scorer:MFGroupScorer_1 Filter input elapsed time: 6.90 secs (0.11 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_1: 514cbbb55733ae23ec6fda54816d75fa9b21d10ee0a3dfbda917c30318f23614
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 56729, Num Unique Notes Rated: 2248, Num Unique Raters: 3052
INFO:birdwatch.scorer:MFGroupScorer_1 Prepare ratings elapsed time: 0.17 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_1: c3986be02fc74c0ba8c6b9ec52f34215f2b47f8a3264070d51e0924f8f3543d0
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_1: 6d968072609a33de48a417adb1c9bbd1f50013f6bb49652814fe261b868abb6f
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_1: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(23749) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 3052, Notes: 2248
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 25.235320284697508
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 18.58748361730013
INFO:birdwatch.matrix_factorization:epoch 0 7.772954940795898
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 7.273065090179443
INFO:birdwatch.matrix_factorization:epoch 20 0.2374163568019867
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.1976100653409958
INFO:birdwatch.matrix_factorization:epoch 40 0.0990014299750328
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06346718221902847
INFO:birdwatch.matrix_factorization:epoch 60 0.07932990789413452
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.049307361245155334
INFO:birdwatch.matrix_factorization:epoch 80 0.0766628086566925
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04688897356390953
INFO:birdwatch.matrix_factorization:epoch 100 0.07631382346153259
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04671129956841469
INFO:birdwatch.matrix_factorization:epoch 120 0.07626792788505554
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0467303991317749
INFO:birdwatch.matrix_factorization:Num epochs: 139
INFO:birdwatch.matrix_factorization:epoch 139 0.07626232504844666
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.046721041202545166
INFO:birdwatch.matrix_factorization:Global Intercept: 0.1417277753353119
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_1 First MF/stable init elapsed time: 2.62 secs (0.04 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_1

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 67149 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 597 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.28 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.21 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.39 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.25 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.22 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.25 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.19 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.48 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 75.95 secs (1.27 mins)
INFO:birdwatch.scorer:MFGroupScorer_1 Compute scored notes elapsed time: 104.87 secs (1.75 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 171446 post-tombstones and 35 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 138431, including 138431 post-tombstones and 0 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 6946
INFO:birdwatch.scorer:MFGroupScorer_1 Compute valid ratings elapsed time: 1.88 secs (0.03 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_1 Helpfulness scores pre-harassment  elapsed time: 0.16 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 3052
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 6632
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 5403
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 1344
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 56729
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 29019
INFO:birdwatch.scorer:MFGroupScorer_1 Filtering by helpfulness score elapsed time: 0.08 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    16385
1     2217
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 10417
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 10922, Num Unique Notes Rated: 704, Num Unique Raters: 664
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    9655
1    1267
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.11600439479948728
INFO:birdwatch.matrix_factorization:Using pos weight: 7.620363062352012 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(23778) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 664, Notes: 704
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 15.514204545454545
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 16.448795180722893
INFO:birdwatch.matrix_factorization:epoch 0 3.0745277404785156
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 1.213863730430603
INFO:birdwatch.matrix_factorization:epoch 20 0.6201873421669006
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2305537313222885
INFO:birdwatch.matrix_factorization:epoch 40 0.385250449180603
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.19754637777805328
INFO:birdwatch.matrix_factorization:epoch 60 0.3541911244392395
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.1892412155866623
INFO:birdwatch.matrix_factorization:epoch 80 0.35019049048423767
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18944968283176422
INFO:birdwatch.matrix_factorization:epoch 100 0.3496509790420532
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.1892329752445221
INFO:birdwatch.matrix_factorization:epoch 120 0.3495807647705078
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18913066387176514
INFO:birdwatch.matrix_factorization:Num epochs: 137
INFO:birdwatch.matrix_factorization:epoch 137 0.34957271814346313
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.1891392022371292
INFO:birdwatch.matrix_factorization:Global Intercept: -0.18931356072425842
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_1 Harassment tag consensus elapsed time: 1.17 secs (0.02 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_1 Helpfulness scores post-harassment elapsed time: 0.25 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 3052
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 6632
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 5403
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 1344
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 56729
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 29019
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(23780) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 1344, Notes: 2228
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 13.024685816876122
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 21.591517857142858
INFO:birdwatch.matrix_factorization:epoch 0 0.4323660135269165
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.36665332317352295
INFO:birdwatch.matrix_factorization:epoch 20 0.07938801497220993
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04682479426264763
INFO:birdwatch.matrix_factorization:epoch 40 0.0748906061053276
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0461922213435173
INFO:birdwatch.matrix_factorization:epoch 60 0.07385715842247009
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04451683163642883
INFO:birdwatch.matrix_factorization:epoch 80 0.0736825242638588
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.043783608824014664
INFO:birdwatch.matrix_factorization:Num epochs: 93
INFO:birdwatch.matrix_factorization:epoch 93 0.0736733227968216
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04381604492664337
INFO:birdwatch.matrix_factorization:Global Intercept: 0.14079630374908447
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 1.14 secs (0.02 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_1 prescoring, about to call diligence with 29019 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                     raterParticipantId  internalRaterFactor1
0     00112506AE39C99AC786AD84B9C4CF2EC5040813AB92FF...             -0.148430
1     0023E170A507256EDF23FF2BDD8C448C483228143F0005...             -0.390325
2     0042E705C9CC807BECE823F245D34D18F0B2BD80D575A7...              0.637115
3     004ADBC69D4312D219477CF778E9D8BC19BF9280135D57...             -0.343976
4     00533D1DF2498B0ADD194F7895B09F8B36B885DF9C79BD...             -0.572076
...                                                 ...                   ...
1339  FEDD8FF0ED6BAC4996AC061841CC9B62DB246AF5C0A3BE...              0.760655
1340  FEF5C89461E9EDC9443990BF3225DBF0F5233CC2143350...             -0.493213
1341  FF501081452FE92A0E41AB20BB62156E32E07826BE7E63...             -0.361576
1342  FF606A8A07943D2836B1392C2BD9CC6331508BA0A01231...             -0.467971
1343  FF7A4377FD8A6393B76A69F95EDBD9EF7A24CCD97B8D84...             -0.438974

[1344 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 1344, vs. num we are initializing: 1344
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 1344
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=21.530897 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.526169 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.960553 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.847476 | time=0.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.808039 | time=1.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.787584 | time=1.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.775180 | time=1.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.767201 | time=1.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.761392 | time=2.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.756974 | time=2.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.753496 | time=2.6s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(0.3977, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.753346 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.505096 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.494055 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.493239 | time=0.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=105 | loss=1.493207 | time=0.9s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.473813 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.368826 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.367370 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=075 | loss=0.367311 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(1.2590, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.7535, 1.4932, 0.3673
INFO:birdwatch.scorer:MFGroupScorer_1 Low Diligence MF elapsed time: 4.00 secs (0.07 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 67149 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 597 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.24 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.21 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.38 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.25 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.26 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.23 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.19 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.49 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 75.60 secs (1.26 mins)
INFO:birdwatch.constants:MFGroupScorer_1: Compute tag thresholds for percentiles elapsed time: 0.34 secs (0.01 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_14 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_14.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 314456
INFO:birdwatch.scorer:MFGroupScorer_14 Filter input elapsed time: 5.81 secs (0.10 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_14: 3c51175ec22dbcdcc830bf1a5f5de3159bec4b480330a98c16e9be42e553975d
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 184135, Num Unique Notes Rated: 8293, Num Unique Raters: 7166
INFO:birdwatch.scorer:MFGroupScorer_14 Prepare ratings elapsed time: 0.22 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_14: 22163bc70855e634fde7a9624dec7bc542a8563bef074e1c58394ad29d7bae17
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_14: 6d968072609a33de48a417adb1c9bbd1f50013f6bb49652814fe261b868abb6f
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_14: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(23809) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 7166, Notes: 8293
INFO:birdwatch.matrix_factorization:learning rate set to :0.02
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 22.20366574219221
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 25.695646106614568
INFO:birdwatch.matrix_factorization:epoch 0 0.4977129399776459
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.4969589114189148
INFO:birdwatch.matrix_factorization:epoch 20 0.1894599348306656
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.1369694620370865
INFO:birdwatch.matrix_factorization:epoch 40 0.13479645550251007
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.09415312856435776
INFO:birdwatch.matrix_factorization:epoch 60 0.1066509336233139
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07037459313869476
INFO:birdwatch.matrix_factorization:epoch 80 0.09888811409473419
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0666813999414444
INFO:birdwatch.matrix_factorization:epoch 100 0.0966399759054184
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06628432869911194
INFO:birdwatch.matrix_factorization:epoch 120 0.09585537761449814
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06640005856752396
INFO:birdwatch.matrix_factorization:epoch 140 0.09551069140434265
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06653083115816116
INFO:birdwatch.matrix_factorization:Num epochs: 143
INFO:birdwatch.matrix_factorization:epoch 143 0.09549903869628906
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06654153019189835
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 7166, Notes: 8293
INFO:birdwatch.matrix_factorization:learning rate set to :0.02
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:epoch 0 0.21145713329315186
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.4969739019870758
INFO:birdwatch.matrix_factorization:epoch 20 0.09539266675710678
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.149156853556633
INFO:birdwatch.matrix_factorization:epoch 40 0.07201825082302094
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.10499046742916107
INFO:birdwatch.matrix_factorization:epoch 60 0.05988060683012009
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07786089926958084
INFO:birdwatch.matrix_factorization:epoch 80 0.05618579685688019
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07596760243177414
INFO:birdwatch.matrix_factorization:epoch 100 0.05506078898906708
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0763406977057457
INFO:birdwatch.matrix_factorization:epoch 120 0.05465269833803177
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07657993584871292
INFO:birdwatch.matrix_factorization:Num epochs: 125
INFO:birdwatch.matrix_factorization:epoch 125 0.05460302531719208
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.076638363301754
INFO:birdwatch.matrix_factorization:Global Intercept: 0.19954591989517212
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_14 First MF/stable init elapsed time: 10.12 secs (0.17 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_14

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 204215 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 413 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.23 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.21 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.40 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.36 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.18 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.28 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.19 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.53 secs (0.03 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 76.14 secs (1.27 mins)
INFO:birdwatch.scorer:MFGroupScorer_14 Compute scored notes elapsed time: 104.11 secs (1.74 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 314180 post-tombstones and 276 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 255465, including 255439 post-tombstones and 26 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 11901
INFO:birdwatch.scorer:MFGroupScorer_14 Compute valid ratings elapsed time: 2.12 secs (0.04 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_14 Helpfulness scores pre-harassment  elapsed time: 0.20 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 7166
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 10310
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 6697
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 3242
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 184135
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 102004
INFO:birdwatch.scorer:MFGroupScorer_14 Filtering by helpfulness score elapsed time: 0.25 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    58958
1     4278
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 38768
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 43194, Num Unique Notes Rated: 3179, Num Unique Raters: 1904
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    40409
1     2785
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.06447654766865768
INFO:birdwatch.matrix_factorization:Using pos weight: 14.50951526032316 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(23841) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 1904, Notes: 3179
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 13.587291601132431
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 22.685924369747898
INFO:birdwatch.matrix_factorization:epoch 0 3.1171321868896484
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 1.2614492177963257
INFO:birdwatch.matrix_factorization:epoch 20 0.6673160791397095
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2419697344303131
INFO:birdwatch.matrix_factorization:epoch 40 0.3963209390640259
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.20563682913780212
INFO:birdwatch.matrix_factorization:epoch 60 0.3618898391723633
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.19962069392204285
INFO:birdwatch.matrix_factorization:epoch 80 0.3570181131362915
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.19808036088943481
INFO:birdwatch.matrix_factorization:epoch 100 0.3563212752342224
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.19811612367630005
INFO:birdwatch.matrix_factorization:epoch 120 0.3562116026878357
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.19813108444213867
INFO:birdwatch.matrix_factorization:epoch 140 0.3561905026435852
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.1980966031551361
INFO:birdwatch.matrix_factorization:Num epochs: 158
INFO:birdwatch.matrix_factorization:epoch 158 0.35618624091148376
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.19808907806873322
INFO:birdwatch.matrix_factorization:Global Intercept: -0.27391138672828674
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_14 Harassment tag consensus elapsed time: 2.29 secs (0.04 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)


MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 183: helpfulnessScores = helpfulnessScores.merge(
  PandasTypeError: Output mismatch on totalHelpfulHarassmentPenalty: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_14 Helpfulness scores post-harassment elapsed time: 0.30 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 7166
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 10310
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 6646
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 3191
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 184135
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 99665
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(23842) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 3191, Notes: 8247
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.02
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 12.085000606281072
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 31.233155750548416
INFO:birdwatch.matrix_factorization:epoch 0 0.13681069016456604
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.1127888560295105
INFO:birdwatch.matrix_factorization:epoch 20 0.09696478396654129
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06651037186384201
INFO:birdwatch.matrix_factorization:epoch 40 0.09321865439414978
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06365913897752762
INFO:birdwatch.matrix_factorization:epoch 60 0.09267530590295792
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06329997628927231
INFO:birdwatch.matrix_factorization:epoch 80 0.09259063005447388
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06315603852272034
INFO:birdwatch.matrix_factorization:Num epochs: 91
INFO:birdwatch.matrix_factorization:epoch 91 0.09256358444690704
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06315714120864868
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 3191, Notes: 8247
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.02
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:epoch 0 0.1318529099225998
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.288642019033432
INFO:birdwatch.matrix_factorization:epoch 20 0.062459900975227356
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0812995657324791
INFO:birdwatch.matrix_factorization:epoch 40 0.05476249381899834
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07356409728527069
INFO:birdwatch.matrix_factorization:epoch 60 0.05292095988988876
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07438596338033676
INFO:birdwatch.matrix_factorization:epoch 80 0.052375420928001404
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07480726391077042
INFO:birdwatch.matrix_factorization:epoch 100 0.05215447396039963
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07511407881975174
INFO:birdwatch.matrix_factorization:Num epochs: 105
INFO:birdwatch.matrix_factorization:epoch 105 0.052125364542007446
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07518190890550613
INFO:birdwatch.matrix_factorization:Global Intercept: 0.1924729198217392
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 4.75 secs (0.08 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_14 prescoring, about to call diligence with 99665 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                     raterParticipantId  internalRaterFactor1
0     000B5C69FAB0466A4CDD351B8F2A116C6FB2033EBE430A...              0.567063
1     00108E4CC8AF3573F479BD3EC1ED4DE673BB74F78BA96F...             -0.875842
2     0026842E7BA6E0D7B865A12D877689B96DE9A7DB19E19F...              0.794619
3     003D2B3D72FF436059DC4E01162C7253A0635B275A35D9...              0.529038
4     003F780D3B6933BBF7368DCA9D59AECBC659C0556B6AD7...             -0.470550
...                                                 ...                   ...
3186  FF54873952D71F23E3167EB13300DF5C43B0ABA1821BE5...             -0.573066
3187  FF78F603EF4B1B58D481C10F587E3C6BBDD4AE0D00BECB...              0.450983
3188  FFB5647328B8D14158E857811DAF369FDCCD24772E2EBC...              0.736212
3189  FFEC6A5CC145DFB2F63DFB1453E10ECEE8E6C032F76FC3...             -0.902201
3190  FFF22CB48A5F4C1C0F944C552973CE17979A4B2F5C225C...             -0.854778

[3191 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 3191, vs. num we are initializing: 3191
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 3191
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=18.285957 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.450471 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.963878 | time=0.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.868417 | time=1.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.834025 | time=1.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.816112 | time=2.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.804844 | time=2.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.797497 | time=3.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.792516 | time=3.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.789150 | time=4.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.786703 | time=4.6s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(-0.0279, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.786635 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.594667 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.585745 | time=0.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.584892 | time=1.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=110 | loss=1.584816 | time=1.6s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.497632 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.403510 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.402303 | time=0.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=075 | loss=0.402255 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(0.9633, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.7867, 1.5848, 0.4023
INFO:birdwatch.scorer:MFGroupScorer_14 Low Diligence MF elapsed time: 7.09 secs (0.12 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 204215 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 413 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.23 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.21 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.42 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.37 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.16 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.32 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.20 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.52 secs (0.03 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 76.07 secs (1.27 mins)
INFO:birdwatch.constants:MFGroupScorer_14: Compute tag thresholds for percentiles elapsed time: 0.54 secs (0.01 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_33 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_33.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 14795
INFO:birdwatch.scorer:MFGroupScorer_33 Filter input elapsed time: 6.33 secs (0.11 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_33: eb790d8d02e3e4fc7c7d9ac07482b2b150a4ea405a5f63d762709432f45d3687
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 4039, Num Unique Notes Rated: 207, Num Unique Raters: 264
INFO:birdwatch.scorer:MFGroupScorer_33 Prepare ratings elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_33: a7896b21d0313197bbde21ccc7c83268221805b27ce14c6be33724bdf979100b
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_33: 6d968072609a33de48a417adb1c9bbd1f50013f6bb49652814fe261b868abb6f
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_33: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(23874) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 264, Notes: 207
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 19.51207729468599
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 15.299242424242424
INFO:birdwatch.matrix_factorization:epoch 0 6.078814506530762
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 5.5727009773254395
INFO:birdwatch.matrix_factorization:epoch 20 0.18431363999843597
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.12544502317905426
INFO:birdwatch.matrix_factorization:epoch 40 0.08267827332019806
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03059389255940914
INFO:birdwatch.matrix_factorization:epoch 60 0.06379645317792892
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0215096864849329
INFO:birdwatch.matrix_factorization:epoch 80 0.057076044380664825
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.018041759729385376
INFO:birdwatch.matrix_factorization:epoch 100 0.05084092915058136
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.01673639751970768
INFO:birdwatch.matrix_factorization:epoch 120 0.05022483319044113
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.016499245539307594
INFO:birdwatch.matrix_factorization:epoch 140 0.050146155059337616
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.01639503426849842
INFO:birdwatch.matrix_factorization:Num epochs: 146
INFO:birdwatch.matrix_factorization:epoch 146 0.0501425638794899
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.016372835263609886
INFO:birdwatch.matrix_factorization:Global Intercept: 0.14766283333301544
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_33 First MF/stable init elapsed time: 0.76 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_33

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 4226 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 63 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.28 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.20 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.42 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.15 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.18 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.17 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.19 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.39 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 74.86 secs (1.25 mins)
INFO:birdwatch.scorer:MFGroupScorer_33 Compute scored notes elapsed time: 99.93 secs (1.67 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 14795 post-tombstones and 0 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 10786, including 10786 post-tombstones and 0 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 315
INFO:birdwatch.scorer:MFGroupScorer_33 Compute valid ratings elapsed time: 1.40 secs (0.02 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_33 Helpfulness scores pre-harassment  elapsed time: 0.12 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 264
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 328
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 253
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 53
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 4039
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 876
INFO:birdwatch.scorer:MFGroupScorer_33 Filtering by helpfulness score elapsed time: 0.01 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    689
1     17
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 170
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 224, Num Unique Notes Rated: 33, Num Unique Raters: 21
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    224
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse tag positive rate is 0.0: returning None and aborting notHelpfulSpamHarassmentOrAbuse model training.
INFO:birdwatch.scorer:MFGroupScorer_33 Harassment tag consensus elapsed time: 0.03 secs (0.00 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_33 Helpfulness scores post-harassment elapsed time: 0.11 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 264
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 328
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 253
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 53
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 4039
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 876
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(23903) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 53, Notes: 195
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 4.492307692307692
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 16.528301886792452
INFO:birdwatch.matrix_factorization:epoch 0 0.5119147300720215
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.4328497648239136
INFO:birdwatch.matrix_factorization:epoch 20 0.057116687297821045
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.01618657261133194
INFO:birdwatch.matrix_factorization:epoch 40 0.051096100360155106
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.015025661326944828
INFO:birdwatch.matrix_factorization:epoch 60 0.049438539892435074
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.015161114744842052
INFO:birdwatch.matrix_factorization:epoch 80 0.04885600507259369
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.01355049666017294
INFO:birdwatch.matrix_factorization:epoch 100 0.04883591830730438
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.013597378507256508
INFO:birdwatch.matrix_factorization:Num epochs: 101
INFO:birdwatch.matrix_factorization:epoch 101 0.04883591830730438
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.013597378507256508
INFO:birdwatch.matrix_factorization:Global Intercept: 0.15397924184799194
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 0.40 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_33 prescoring, about to call diligence with 876 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                   raterParticipantId  internalRaterFactor1
0   0070440BCF2300370D08C94C1D5ECB966A3EC26F9415B4...              0.196002
1   07F9F0F26C9F82E8848562815D0359CA414AAFF175D552...             -0.683347
2   09607871CE251DA1617067D306D55E743B71C1108F5D7A...              0.171961
3   0C7E40EF08E14F494B478879BADCE4E8F2DA2C65ACF130...              0.139291
4   1564869C42BBB09FCF3C35B7B0F21ACA80442341351D25...             -0.656244
5   281A26459CA7831354ACC128311BE88C7210E6E5CB2C3E...             -0.641974
6   3253192B6C494A85E0558BD2134D79CB166B5FF012E0E4...             -0.669741
7   357DE6431AAB5F8DBB182DE8EF73ECCC4A8007B3185BA2...             -0.624497
8   3614818F18CBC94DD720AAC2F65AC2431E0128A837989D...              0.273586
9   43672B39F700A847158B2B2F6448ED9EEF3409D1C61BD3...              0.212158
10  43DA6E75C707DFFE55D782C7CDE344D39BB5F3771F3013...             -0.699090
11  50842D703CE58C5529C82175D47DF7ACF11664A43423FB...             -0.644961
12  54181B66F1C421355416829FA4EDD24D93B396E492339A...             -0.645567
13  5694E6530996AC1A6281083E691CCA3FC9C292C201AE96...             -0.667067
14  579406E812B1AB336C0C8AD8E4F357E3678C49E4B394ED...             -0.593559
15  5D3C0202EA986D10FACC285BC341652BCA8C049E2848E7...              0.290397
16  60C79F791A410F772AE616A950D2520EB111ADAAF139E9...             -0.670384
17  61CC5971E93360D871952AC90324A8F8539F97E49E7AEB...              0.257680
18  67995D6FA66C918AD7E816F695E307D96A97F6EDB68B2D...             -0.751224
19  70752682E10040EBF50C6D1934A1ED93BEC848BCE3D105...             -0.411876
20  7248565463894E4A69132CC09943A8482C8AFD4E7EF611...             -0.503617
21  752BFBE2BD61F9096E18083EE2E8A193E9143945D4332C...             -0.102156
22  781B2D137805731E39AF2FE707197725F6DEE820EA7477...             -0.708107
23  78FB6CF821108F1AD5B05CE035758C6ECF03450A1090F4...             -0.449859
24  79322F8FC9D78A663EAB65454794D08E17CF3988DF64B8...             -0.630349
25  7AEE95CB66D25841C2BAF5BFC4496CB5CB67EA6CC21212...              0.432748
26  80BE8059CF6D3B90B2A752959F6B6ACED18BB08C33D502...              0.354695
27  8172896AE09B906B0D11531B80ED2A28AD9C6FB6A0E100...             -0.589341
28  86BD3AA3819BDC0AC55C9377CFE847EEDA5F429FA27CA3...              0.329044
29  871031957E92A057D995286B6D7C4E8E007A25E8C018F4...             -0.668746
30  8E9C8478E20992B9F395480AFC7326B334BC47C6B4FCE2...              0.277427
31  9294BB7CB3D5BA1D3F7C6F3545C56CECA7615CFC2A9D4D...             -0.626303
32  941C9AD843ABDF04CBD7740B18A467390ED14B79CA1511...              0.170036
33  95AFF705DEF22889105778EA39A6F9B4E9313D5BD7D710...             -0.830692
34  9705A73677B41C2A1C55DA7BDECE501C0A3A93D8E1DE25...             -0.625845
35  9ECB1EE68B86AC4974DD3AD19CC433E89E8EE88FF62D74...              0.261822
36  A2205139F8E8A2C635D495128DD7ECAC70D0DBB4766AB6...             -0.792732
37  A3F0B84AA806E3DB8D54B026EB474D3652E4A1515FC420...             -0.654330
38  AB09CFCE51432283F95DE979E26880FD26FAA001B102DB...             -0.644172
39  AB9B10D1D6D46A330169E58921D190C57CD5C389BB3E23...              0.287963
40  B35B364064C1555A7F51E4BDE9FA8258BD7AD35397E561...             -0.685133
41  B3AAA87CF0434FC699F383C59BA77E5E8602BF5E85A868...             -0.319268
42  B4919D3DC8FB1FCF6B9F0C113F59F844A289F3F14233C5...              0.482595
43  CA61CECE655294BFA083FEFE1AD8173ECD65F902EC5370...             -0.655324
44  D07A5792EBB9295F69EFB61129D4271FB4E43DF28959F1...             -0.642214
45  D8C6F6C4EF39E440B4D2A972CB81210841624CC4D04550...             -0.675705
46  DBF79DADD9FE2CB8FD3D5A3E7621E10D0646449CD3BC46...             -0.646893
47  DF1C55F430F0E859D5520FE413388B38CF64CBA62087FB...             -0.726104
48  E4D796BCD74B8095D02AFD6A58669D7FB1B272F9B934C3...             -0.684362
49  EA313B78C8A5EE37A8DACB3A12A8C3282F226E0D6AB1F0...              0.531487
50  ECD0A2ABEF013BECBFAE24F481F37E7A2ECCB71AC7714A...             -0.683233
51  F7B2DC436D20887BAF3C969EF64AD33A79D09A4ED26124...             -0.656359
52  FD7C32A30F2DC53BD9498C93A0A2E9E50A74FDB43D186C...             -0.517195
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 53, vs. num we are initializing: 53
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 53
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=12.035231 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=2.448032 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.153643 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.060260 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.012352 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=1.979420 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=1.952783 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=1.931746 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=1.915838 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=1.904296 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=1.896273 | time=0.6s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(-1.6749, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=1.896056 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.512649 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.509383 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=0.508030 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=100 | loss=0.507993 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.282483 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.250362 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.249857 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=065 | loss=0.249849 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(-2.8703, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 1.8963, 0.5080, 0.2498
INFO:birdwatch.scorer:MFGroupScorer_33 Low Diligence MF elapsed time: 0.94 secs (0.02 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 4226 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 63 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.23 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.21 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.41 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.19 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.18 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.21 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.19 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.36 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 73.18 secs (1.22 mins)
INFO:birdwatch.constants:MFGroupScorer_33: Compute tag thresholds for percentiles elapsed time: 0.11 secs (0.00 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFTopicScorer_Unassigned set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFTopicScorer_Unassigned.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 0
INFO:birdwatch.scorer:  Ratings after group filter: 0
INFO:birdwatch.scorer:MFTopicScorer_Unassigned Filter input elapsed time: 3.45 secs (0.06 mins)

INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFTopicScorer_UkraineConflict set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFTopicScorer_UkraineConflict.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 163254
INFO:birdwatch.scorer:  Ratings after group filter: 163254
INFO:birdwatch.scorer:MFTopicScorer_UkraineConflict Filter input elapsed time: 2.32 secs (0.04 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFTopicScorer_UkraineConflict: fbedded9fbf4e19701a2360056d7a68b78870713993de57775aa867b455332ba
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 24425, Num Unique Notes Rated: 809, Num Unique Raters: 1513
INFO:birdwatch.scorer:MFTopicScorer_UkraineConflict Prepare ratings elapsed time: 0.17 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFTopicScorer_UkraineConflict: 6fe889cf860e4826cc091a9085e808efb9b388a1230adf907494a780713a28b6
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFTopicScorer_UkraineConflict: 4d22f7b0219a60b1f2fcfcab9ca440078f7124219af7459e823786bc9765125c
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFTopicScorer_UkraineConflict: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(23931) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 1513, Notes: 809
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 30.19159456118665
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 16.14342366159947
INFO:birdwatch.matrix_factorization:epoch 0 7.598763465881348
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 7.092226028442383
INFO:birdwatch.matrix_factorization:epoch 20 0.25021329522132874
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.19811324775218964
INFO:birdwatch.matrix_factorization:epoch 40 0.13017846643924713
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.09353303909301758
INFO:birdwatch.matrix_factorization:epoch 60 0.07901597023010254
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04622872918844223
INFO:birdwatch.matrix_factorization:epoch 80 0.07271313667297363
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04106907546520233
INFO:birdwatch.matrix_factorization:epoch 100 0.0719100683927536
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.040461331605911255
INFO:birdwatch.matrix_factorization:epoch 120 0.07180483639240265
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0404043048620224
INFO:birdwatch.matrix_factorization:epoch 140 0.07179102301597595
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.040392275899648666
INFO:birdwatch.matrix_factorization:Num epochs: 143
INFO:birdwatch.matrix_factorization:epoch 143 0.07179081439971924
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04039487615227699
INFO:birdwatch.matrix_factorization:Global Intercept: 0.14498087763786316
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFTopicScorer_UkraineConflict First MF/stable init elapsed time: 1.77 secs (0.03 mins)
INFO:birdwatch.mf_base_scorer:Skipping rep-filtering in prescoring for MFTopicScorer_UkraineConflict
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py:622: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  helpfulnessScores[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py:642: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  harassmentAbuseNoteParams[[c.harassmentNoteInterceptKey, c.harassmentNoteFactor1Key]] = np.nan
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py:642: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  harassmentAbuseNoteParams[[c.harassmentNoteInterceptKey, c.harassmentNoteFactor1Key]] = np.nan
INFO:birdwatch.mf_base_scorer:In MFTopicScorer_UkraineConflict prescoring, about to call diligence with 24425 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                     raterParticipantId  internalRaterFactor1
0     65F687F3F0BE41BB456A883BA989742AB6F9566B731F75...             -0.864193
1     995CDD1ACA6A44FE6F335A7496C96AA1C822D2A0057912...              0.520881
2     85B9E8186274A9ADCC3B045AF0F8E32370856F5FFCD762...              0.576124
3     D752977825D7D32B37B11AECF6CCE2986777E95A506AB0...             -0.695643
4     317E7B293F89EFAB079850CA634A7DCA04CC9007906784...             -0.414821
...                                                 ...                   ...
1508  313BAE3F782B8F3DECC446BF629588B95FD148C5699B9A...              0.529262
1509  7561B82DAB6D3FBE2ECD8CF94056476CE9252C8890DB36...              0.483607
1510  D929B80B5FF339ADA3FC081819C60FFEC537198A452CBF...              0.654590
1511  7D7BAA5B227CBB1058E05356F5A8CA9BD8F35691C4E0D1...              0.384905
1512  661124877CA60A5DFE80D04DE9F9A9563C563C84B22D55...              0.489805

[1513 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 1513, vs. num we are initializing: 1513
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 1513
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=22.417435 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.687493 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=3.055144 | time=0.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.935610 | time=1.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.899529 | time=1.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.883714 | time=2.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.874568 | time=2.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.867772 | time=2.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.863549 | time=3.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.860737 | time=3.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.858795 | time=3.8s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(0.7437, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.858739 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.523794 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.514471 | time=0.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.513441 | time=1.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=100 | loss=1.513412 | time=1.2s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.404817 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.290842 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.289540 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=080 | loss=0.289472 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(2.3269, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.8588, 1.5134, 0.2895
INFO:birdwatch.scorer:MFTopicScorer_UkraineConflict Low Diligence MF elapsed time: 5.58 secs (0.09 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 25359 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 21 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 1.38 secs (0.02 mins)
INFO:birdwatch.constants:MFTopicScorer_UkraineConflict: Compute tag thresholds for percentiles elapsed time: 0.31 secs (0.01 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFTopicScorer_GazaConflict set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFTopicScorer_GazaConflict.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 282380
INFO:birdwatch.scorer:  Ratings after group filter: 282380
INFO:birdwatch.scorer:MFTopicScorer_GazaConflict Filter input elapsed time: 2.44 secs (0.04 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFTopicScorer_GazaConflict: 6c2b9dd842227f41bc98f47d56eb1a17e23a32bab73a7e4f4638a1f084b2702d
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 79794, Num Unique Notes Rated: 1624, Num Unique Raters: 4118
INFO:birdwatch.scorer:MFTopicScorer_GazaConflict Prepare ratings elapsed time: 0.25 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFTopicScorer_GazaConflict: 9842e9f6d1005e5e4eca3343f1885a8ef7a3c2a8d6fa3ad0a6c3787d8cac5d37
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFTopicScorer_GazaConflict: 3b5b9d88094e6c80d62908567f7fa20ad692c72e97df88977480f72d83dc3a0b
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFTopicScorer_GazaConflict: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(23935) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 4118, Notes: 1624
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 49.13423645320197
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 19.37688198154444
INFO:birdwatch.matrix_factorization:epoch 0 7.668451309204102
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 7.164143085479736
INFO:birdwatch.matrix_factorization:epoch 20 0.2849617004394531
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.21730802953243256
INFO:birdwatch.matrix_factorization:epoch 40 0.16318431496620178
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.13180021941661835
INFO:birdwatch.matrix_factorization:epoch 60 0.08145648241043091
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.047051213681697845
INFO:birdwatch.matrix_factorization:epoch 80 0.06791234761476517
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03683675825595856
INFO:birdwatch.matrix_factorization:epoch 100 0.06638715416193008
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0357193760573864
INFO:birdwatch.matrix_factorization:epoch 120 0.06618257611989975
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03551647439599037
INFO:birdwatch.matrix_factorization:epoch 140 0.06615637242794037
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.035468071699142456
INFO:birdwatch.matrix_factorization:Num epochs: 153
INFO:birdwatch.matrix_factorization:epoch 153 0.06615369766950607
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03544999286532402
INFO:birdwatch.matrix_factorization:Global Intercept: 0.1394062489271164
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFTopicScorer_GazaConflict First MF/stable init elapsed time: 3.21 secs (0.05 mins)
INFO:birdwatch.mf_base_scorer:Skipping rep-filtering in prescoring for MFTopicScorer_GazaConflict
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py:622: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  helpfulnessScores[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py:642: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  harassmentAbuseNoteParams[[c.harassmentNoteInterceptKey, c.harassmentNoteFactor1Key]] = np.nan
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py:642: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  harassmentAbuseNoteParams[[c.harassmentNoteInterceptKey, c.harassmentNoteFactor1Key]] = np.nan
INFO:birdwatch.mf_base_scorer:In MFTopicScorer_GazaConflict prescoring, about to call diligence with 79794 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                     raterParticipantId  internalRaterFactor1
0     D6602F91F0E36E0C5230FB766CF1529E6FB5FC677DCB17...             -0.346206
1     4D21AECB6F4E15FEE944190B2F6FD34E4C9AAAA99A6FA0...              0.277412
2     BF52D38A2D1B3FD7AEEA3F4C1C9C0625A3DD72135C962D...              0.013988
3     995CDD1ACA6A44FE6F335A7496C96AA1C822D2A0057912...             -0.226230
4     D4B7D69646A9F37921139DEAD0E1C09171E66ADC136BD0...              0.594165
...                                                 ...                   ...
4113  7561B82DAB6D3FBE2ECD8CF94056476CE9252C8890DB36...              0.145886
4114  E26C94838DB911EDA747183982B9309567D738BF7064C2...              0.482442
4115  D929B80B5FF339ADA3FC081819C60FFEC537198A452CBF...              0.655133
4116  7D7BAA5B227CBB1058E05356F5A8CA9BD8F35691C4E0D1...              0.111926
4117  661124877CA60A5DFE80D04DE9F9A9563C563C84B22D55...              0.680211

[4118 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 4118, vs. num we are initializing: 4118
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 4118
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=29.243103 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=4.091884 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=3.185649 | time=1.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=3.028988 | time=1.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.993235 | time=2.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.981415 | time=2.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.976402 | time=3.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.973915 | time=3.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.972514 | time=4.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.971492 | time=4.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.970994 | time=5.0s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(1.1555, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.970981 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.598282 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.591106 | time=1.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=080 | loss=1.590106 | time=1.4s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.352766 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.245862 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.244827 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=080 | loss=0.244771 | time=0.9s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(3.2051, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.9710, 1.5901, 0.2448
INFO:birdwatch.scorer:MFTopicScorer_GazaConflict Low Diligence MF elapsed time: 7.51 secs (0.13 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 80852 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 18 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 0.05 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 0.05 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 0.05 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 0.04 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 0.04 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 0.05 secs (0.00 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 3.08 secs (0.05 mins)
INFO:birdwatch.constants:MFTopicScorer_GazaConflict: Compute tag thresholds for percentiles elapsed time: 0.51 secs (0.01 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFTopicScorer_MessiRonaldo set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFTopicScorer_MessiRonaldo.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 569
INFO:birdwatch.scorer:  Ratings after group filter: 569
INFO:birdwatch.scorer:MFTopicScorer_MessiRonaldo Filter input elapsed time: 2.14 secs (0.04 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFTopicScorer_MessiRonaldo: cf1266e4853fdd431a22072f4953f90de6e46f016b7454012dba977cdc333445
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 0, Num Unique Notes Rated: 0, Num Unique Raters: 0
INFO:birdwatch.scorer:MFTopicScorer_MessiRonaldo Prepare ratings elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.scorer:EmptyRatingException raised from MFTopicScorer_MessiRonaldo.

INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFTopicScorer_Scams set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFTopicScorer_Scams.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 198354
INFO:birdwatch.scorer:  Ratings after group filter: 198354
INFO:birdwatch.scorer:MFTopicScorer_Scams Filter input elapsed time: 2.44 secs (0.04 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFTopicScorer_Scams: 7fa87443be4d6d0df7059c9f92ab624d988ce34cc1b9c839654acb54f7acbb60
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 16350, Num Unique Notes Rated: 470, Num Unique Raters: 1147
INFO:birdwatch.scorer:MFTopicScorer_Scams Prepare ratings elapsed time: 0.22 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFTopicScorer_Scams: ab8178dd5bebbbebe3a30b05edd255e21be95ed13f1f25d2b54cba3f1dd96c4d
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFTopicScorer_Scams: 543280c63dc8456aa58845016f419a3426767e70fcbf5ef6e1b6acd137046aeb
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFTopicScorer_Scams: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(23943) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 1147, Notes: 470
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 34.787234042553195
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 14.254577157802965
INFO:birdwatch.matrix_factorization:epoch 0 8.008864402770996
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 7.5030035972595215
INFO:birdwatch.matrix_factorization:epoch 20 0.2746593952178955
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.22534574568271637
INFO:birdwatch.matrix_factorization:epoch 40 0.10785549134016037
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07157056033611298
INFO:birdwatch.matrix_factorization:epoch 60 0.0814233347773552
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05336087942123413
INFO:birdwatch.matrix_factorization:epoch 80 0.0779038667678833
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05125099793076515
INFO:birdwatch.matrix_factorization:epoch 100 0.0774572342634201
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05063503235578537
INFO:birdwatch.matrix_factorization:epoch 120 0.07739955931901932
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05065838620066643
INFO:birdwatch.matrix_factorization:Num epochs: 128
INFO:birdwatch.matrix_factorization:epoch 128 0.07739540934562683
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05065008997917175
INFO:birdwatch.matrix_factorization:Global Intercept: 0.12961068749427795
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFTopicScorer_Scams First MF/stable init elapsed time: 1.33 secs (0.02 mins)
INFO:birdwatch.mf_base_scorer:Skipping rep-filtering in prescoring for MFTopicScorer_Scams
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py:622: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  helpfulnessScores[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py:642: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  harassmentAbuseNoteParams[[c.harassmentNoteInterceptKey, c.harassmentNoteFactor1Key]] = np.nan
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py:642: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  harassmentAbuseNoteParams[[c.harassmentNoteInterceptKey, c.harassmentNoteFactor1Key]] = np.nan
INFO:birdwatch.mf_base_scorer:In MFTopicScorer_Scams prescoring, about to call diligence with 16350 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                     raterParticipantId  internalRaterFactor1
0     995CDD1ACA6A44FE6F335A7496C96AA1C822D2A0057912...             -0.504148
1     5080FAA8170DAE5A436212C906E5558A4DCCF652B2320C...              0.032258
2     A17C2F5C19E68984FAC0CD2DB536533374E083E180EE89...             -0.475710
3     4F1F86DC11937B51BBD2A537F5D94EA5680652E51E3938...              0.719733
4     11941BD441167A7A8A85DC9A0893ECFD1F4D4B0F2758CC...             -0.307491
...                                                 ...                   ...
1142  7561B82DAB6D3FBE2ECD8CF94056476CE9252C8890DB36...             -0.220735
1143  2C1735818C8583363E68D14DD2957AF58421E2FF63412D...             -0.447966
1144  D929B80B5FF339ADA3FC081819C60FFEC537198A452CBF...             -0.547434
1145  7D7BAA5B227CBB1058E05356F5A8CA9BD8F35691C4E0D1...             -0.571408
1146  661124877CA60A5DFE80D04DE9F9A9563C563C84B22D55...             -0.522727

[1147 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 1147, vs. num we are initializing: 1147
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 1147
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=22.793646 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.945803 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=3.367301 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=3.267248 | time=0.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=3.236140 | time=0.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=3.222791 | time=1.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=3.216228 | time=1.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=3.212254 | time=1.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=3.209512 | time=1.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=3.207390 | time=2.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=3.205526 | time=2.3s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(0.6724, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=3.205475 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.875103 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.864265 | time=0.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.862987 | time=0.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=105 | loss=1.862944 | time=1.0s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.423156 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.270415 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.268770 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=080 | loss=0.268673 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(2.4430, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 3.2055, 1.8629, 0.2687
INFO:birdwatch.scorer:MFTopicScorer_Scams Low Diligence MF elapsed time: 3.86 secs (0.06 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 17819 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 76 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 0.06 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 0.07 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 0.06 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 0.05 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 0.05 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 0.06 secs (0.00 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 4.05 secs (0.07 mins)
INFO:birdwatch.constants:MFTopicScorer_Scams: Compute tag thresholds for percentiles elapsed time: 0.32 secs (0.01 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFMultiGroupScorer_1 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFMultiGroupScorer_1.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 142811
INFO:birdwatch.scorer:MFMultiGroupScorer_1 Filter input elapsed time: 4.51 secs (0.08 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFMultiGroupScorer_1: 26b7cd9e1eac4f6710f46646d6c493523eedb723c18566fdd92a7c902d7b61c4
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 38360, Num Unique Notes Rated: 2978, Num Unique Raters: 2221
INFO:birdwatch.scorer:MFMultiGroupScorer_1 Prepare ratings elapsed time: 0.10 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFMultiGroupScorer_1: 83d597d1bc136a002bdfd8fb59cfdb7a35785b65b85aa8a75bca076ffdfa7e30
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFMultiGroupScorer_1: 6d968072609a33de48a417adb1c9bbd1f50013f6bb49652814fe261b868abb6f
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFMultiGroupScorer_1: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(23946) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 2221, Notes: 2978
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 12.881128274009402
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 17.271499324628547
INFO:birdwatch.matrix_factorization:epoch 0 7.389924049377441
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 6.886965751647949
INFO:birdwatch.matrix_factorization:epoch 20 0.27001428604125977
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.20721423625946045
INFO:birdwatch.matrix_factorization:epoch 40 0.11419570446014404
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07711569964885712
INFO:birdwatch.matrix_factorization:epoch 60 0.09299144148826599
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05891930311918259
INFO:birdwatch.matrix_factorization:epoch 80 0.09011930972337723
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05594700574874878
INFO:birdwatch.matrix_factorization:epoch 100 0.08973102271556854
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.055725809186697006
INFO:birdwatch.matrix_factorization:epoch 120 0.0896831750869751
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05568995326757431
INFO:birdwatch.matrix_factorization:Num epochs: 136
INFO:birdwatch.matrix_factorization:epoch 136 0.08967743068933487
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.055692244321107864
INFO:birdwatch.matrix_factorization:Global Intercept: 0.16330058872699738
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFMultiGroupScorer_1 First MF/stable init elapsed time: 1.65 secs (0.03 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFMultiGroupScorer_1

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 53269 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 312 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.35 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.22 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.48 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.30 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.33 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.34 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.32 secs (0.01 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.65 secs (0.03 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 76.92 secs (1.28 mins)
INFO:birdwatch.scorer:MFMultiGroupScorer_1 Compute scored notes elapsed time: 106.04 secs (1.77 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 142782 post-tombstones and 29 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 114745, including 114745 post-tombstones and 0 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 6678
INFO:birdwatch.scorer:MFMultiGroupScorer_1 Compute valid ratings elapsed time: 1.81 secs (0.03 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFMultiGroupScorer_1 Helpfulness scores pre-harassment  elapsed time: 0.16 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 2221
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 6483
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 4805
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 1174
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 38360
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 23397
INFO:birdwatch.scorer:MFMultiGroupScorer_1 Filtering by helpfulness score elapsed time: 0.06 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    13492
1     2275
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 7630
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 5450, Num Unique Notes Rated: 660, Num Unique Raters: 400
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    4780
1     670
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.12293577981651377
INFO:birdwatch.matrix_factorization:Using pos weight: 7.134328358208954 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(23987) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 400, Notes: 660
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 8.257575757575758
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 13.625
INFO:birdwatch.matrix_factorization:epoch 0 3.2289276123046875
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 1.354780673980713
INFO:birdwatch.matrix_factorization:epoch 20 0.7787998914718628
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.4176923930644989
INFO:birdwatch.matrix_factorization:epoch 40 0.5061308145523071
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.29628896713256836
INFO:birdwatch.matrix_factorization:epoch 60 0.3981419503688812
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.21032452583312988
INFO:birdwatch.matrix_factorization:epoch 80 0.3640204668045044
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.19246219098567963
INFO:birdwatch.matrix_factorization:epoch 100 0.358803927898407
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18969957530498505
INFO:birdwatch.matrix_factorization:Num epochs: 103
INFO:birdwatch.matrix_factorization:epoch 103 0.35866135358810425
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18982864916324615
INFO:birdwatch.matrix_factorization:Global Intercept: -0.24985387921333313
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFMultiGroupScorer_1 Harassment tag consensus elapsed time: 0.84 secs (0.01 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFMultiGroupScorer_1 Helpfulness scores post-harassment elapsed time: 0.26 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 2221
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 6483
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 4805
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 1174
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 38360
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 23397
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
Python(23989) MallocStackLogging: can't turn off malloc stack logging because it was not enabled.
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 1174, Notes: 2969
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 7.880431121589761
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 19.92930153321976
INFO:birdwatch.matrix_factorization:epoch 0 0.38927513360977173
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.31728076934814453
INFO:birdwatch.matrix_factorization:epoch 20 0.08427343517541885
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.047502290457487106
INFO:birdwatch.matrix_factorization:epoch 40 0.08288010209798813
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.049153078347444534
INFO:birdwatch.matrix_factorization:epoch 60 0.08137726783752441
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04628946632146835
INFO:birdwatch.matrix_factorization:epoch 80 0.08133260905742645
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.046372510492801666
INFO:birdwatch.matrix_factorization:Num epochs: 99
INFO:birdwatch.matrix_factorization:epoch 99 0.08131588995456696
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0461803637444973
INFO:birdwatch.matrix_factorization:Global Intercept: 0.16449634730815887
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 1.01 secs (0.02 mins)
INFO:birdwatch.mf_base_scorer:In MFMultiGroupScorer_1 prescoring, about to call diligence with 23397 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                     raterParticipantId  internalRaterFactor1
0     0007FA945EF35219D0388D94715189F6231A77263D83B1...              0.080767
1     000F1687C56AB92D846F2B9BFA71AE16D8A88426754E3B...              0.531690
2     00403F6A378AB662BD6A14B1F09C2D0817A843B01E0E04...              0.349078
3     00720BF51C446ED4E89C14B3C9C054F9557789AD0CB013...              0.511093
4     008D2B105D9284320C4CC52C5247EC6C4167699D26BD53...              0.256248
...                                                 ...                   ...
1169  FE283EE92CACEDDCA0FAFBCCA57D96A3053BEFBA837849...             -0.538296
1170  FE8FCC5CB441BBAC17079F1C9D89743B56A8CB444B44D8...              0.754759
1171  FEE6C03F45C7E92C66ADCF8F16F6722483E760D293C023...              0.265952
1172  FF10E6EE6DECE1153515D6D38E8C076D20AB9393292946...             -0.283356
1173  FFA7AFC202040B072B0AE92D4DF0239977FC8E55497E95...             -0.610591

[1174 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 1174, vs. num we are initializing: 1174
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 1174
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=22.174120 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.555840 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.939102 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.771148 | time=0.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.699486 | time=0.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.659534 | time=1.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.635784 | time=1.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.619997 | time=1.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.610174 | time=1.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.603245 | time=1.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.598367 | time=2.2s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(-0.0718, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.598228 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.431242 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.421674 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.420850 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=100 | loss=1.420824 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.576040 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.476464 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.475202 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=075 | loss=0.475150 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(0.5138, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.5984, 1.4208, 0.4752
INFO:birdwatch.scorer:MFMultiGroupScorer_1 Low Diligence MF elapsed time: 3.33 secs (0.06 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 53269 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 312 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.26 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.23 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.60 secs (0.03 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.41 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.21 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.33 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.20 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.60 secs (0.03 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 76.15 secs (1.27 mins)
INFO:birdwatch.constants:MFMultiGroupScorer_1: Compute tag thresholds for percentiles elapsed time: 0.31 secs (0.01 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)

INFO:birdwatch.run_scoring:----
    Completed individual scorers. Ran in parallel: False.  Succeeded in 6183.88 seconds. 
    Individual scorers: (name, runtime): [('MFCoreWithTopicsScorer', '9.52 mins'), ('MFCoreScorer', '7.38 mins'), ('MFExpansionScorer', '10.03 mins'), ('MFExpansionPlusScorer', '9.27 mins'), ('ReputationScorer', '3.48 mins'), ('MFGroupScorer_13', '5.88 mins'), ('MFGroupScorer_12', '3.61 mins'), ('MFGroupScorer_11', '3.84 mins'), ('MFGroupScorer_10', '3.53 mins'), ('MFGroupScorer_9', '3.64 mins'), ('MFGroupScorer_8', '3.64 mins'), ('MFGroupScorer_7', '4.03 mins'), ('MFGroupScorer_6', '3.86 mins'), ('MFGroupScorer_5', '3.50 mins'), ('MFGroupScorer_4', '3.72 mins'), ('MFGroupScorer_3', '3.81 mins'), ('MFGroupScorer_2', '3.96 mins'), ('MFGroupScorer_1', '3.90 mins'), ('MFGroupScorer_14', '4.13 mins'), ('MFGroupScorer_33', '3.55 mins'), ('MFTopicScorer_Unassigned', '0.06 mins'), ('MFTopicScorer_UkraineConflict', '0.25 mins'), ('MFTopicScorer_GazaConflict', '0.35 mins'), ('MFTopicScorer_MessiRonaldo', '0.04 mins'), ('MFTopicScorer_Scams', '0.27 mins'), ('MFMultiGroupScorer_1', '3.82 mins')]
    ----
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pandas_utils.py:405: FutureWarning: The behavior of DataFrame concatenation with empty or all-NA entries is deprecated. In a future version, this will no longer exclude empty or all-NA columns when determining the result dtypes. To retain the old behavior, exclude the relevant entries before the concat operation.
  result = self._origConcat(*args, **kwargs)

CONCAT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py, in combine_prescorer_scorer_results, at line 549: prescoringNoteModelOutput = pd.concat(
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64
  PandasTypeError: DataFrame concat on noteId: output=object inputs=[dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('O'), dtype('int64'), dtype('int64'), dtype('O'), dtype('int64'), dtype('int64')] (allowed)
  PandasTypeError: DataFrame concat on internalNoteIntercept: output=float32 inputs=[dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32')] (allowed)
  PandasTypeError: DataFrame concat on internalNoteFactor1: output=float32 inputs=[dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32')] (allowed)
  PandasTypeError: DataFrame concat on lowDiligenceNoteIntercept: output=float32 inputs=[dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32')] (allowed)
  PandasTypeError: DataFrame concat on lowDiligenceNoteFactor1: output=float32 inputs=[dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32')] (allowed)
  PandasTypeError: DataFrame concat on harassmentNoteIntercept: output=float32 inputs=[dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float32'), dtype('float64'), dtype('float64'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float32')] (UNALLOWED)
  PandasTypeError: DataFrame concat on harassmentNoteFactor1: output=float32 inputs=[dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float32'), dtype('float64'), dtype('float64'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float32')] (UNALLOWED)
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pandas_utils.py:405: FutureWarning: The behavior of DataFrame concatenation with empty or all-NA entries is deprecated. In a future version, this will no longer exclude empty or all-NA columns when determining the result dtypes. To retain the old behavior, exclude the relevant entries before the concat operation.
  result = self._origConcat(*args, **kwargs)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pandas_utils.py:405: FutureWarning: The behavior of DataFrame concatenation with empty or all-NA entries is deprecated. In a future version, this will no longer exclude empty or all-NA columns when determining the result dtypes. To retain the old behavior, exclude the relevant entries before the concat operation.
  result = self._origConcat(*args, **kwargs)

CONCAT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py, in combine_prescorer_scorer_results, at line 570: raterParamsUnfilteredMultiScorers = pd.concat(
  PandasTypeError: DataFrame concat on internalRaterIntercept: output=float32 inputs=[dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32')] (allowed)
  PandasTypeError: DataFrame concat on internalRaterFactor1: output=float32 inputs=[dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32')] (allowed)
  PandasTypeError: DataFrame concat on internalFirstRoundRaterIntercept: output=float32 inputs=[dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32')] (UNALLOWED)
  PandasTypeError: DataFrame concat on internalFirstRoundRaterFactor1: output=float32 inputs=[dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32')] (UNALLOWED)
  PandasTypeError: DataFrame concat on crhCrnhRatioDifference: output=float64 inputs=[dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('O'), dtype('float64'), dtype('float64'), dtype('O'), dtype('float64'), dtype('float64')] (allowed)
  PandasTypeError: DataFrame concat on meanNoteScore: output=float64 inputs=[dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('O'), dtype('float64'), dtype('float64'), dtype('O'), dtype('float64'), dtype('float64')] (allowed)
  PandasTypeError: DataFrame concat on raterAgreeRatio: output=float64 inputs=[dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('O'), dtype('float64'), dtype('float64'), dtype('O'), dtype('float64'), dtype('float64')] (allowed)
  PandasTypeError: DataFrame concat on aboveHelpfulnessThreshold: output=object inputs=[dtype('bool'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('float64'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('O'), dtype('float64'), dtype('float64'), dtype('O'), dtype('float64'), dtype('bool')] (allowed)
  PandasTypeError: DataFrame concat on internalRaterReputation: output=float32 inputs=[dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float32'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64')] (allowed)
  PandasTypeError: DataFrame concat on lowDiligenceRaterIntercept: output=float32 inputs=[dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32')] (allowed)
  PandasTypeError: DataFrame concat on lowDiligenceRaterFactor1: output=float32 inputs=[dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32')] (allowed)
  PandasTypeError: DataFrame concat on lowDiligenceRaterReputation: output=float32 inputs=[dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32')] (allowed)
  PandasTypeError: DataFrame concat on incorrectTagRatingsMadeByRater: output=Int64 inputs=[Int64Dtype(), Int64Dtype(), Int64Dtype(), Int64Dtype(), dtype('float64'), Int64Dtype(), Int8Dtype(), Int64Dtype(), Int8Dtype(), Int8Dtype(), Int8Dtype(), Int8Dtype(), Int64Dtype(), Int64Dtype(), Int8Dtype(), Int64Dtype(), Int8Dtype(), Int8Dtype(), Int64Dtype(), Int8Dtype(), Int8Dtype(), Int8Dtype(), Int8Dtype(), Int64Dtype()] (allowed)

INFO:birdwatch.run_scoring:notes total RAM: 190156863 bytes (0.190 GB)
                                    column     dtype       RAM
0                                   noteId     int64  18780888
1                  noteAuthorParticipantId    object  18780888
2                          createdAtMillis     int64  18780888
3                                  tweetId    object  18780888
4                           classification    object  18780888
5                               believable  category   2347735
6                                  harmful  category   2347735
7                     validationDifficulty  category   2347735
8                          misleadingOther      Int8   4695222
9                   misleadingFactualError      Int8   4695222
10              misleadingManipulatedMedia      Int8   4695222
11           misleadingOutdatedInformation      Int8   4695222
12       misleadingMissingImportantContext      Int8   4695222
13         misleadingUnverifiedClaimAsFact      Int8   4695222
14                        misleadingSatire      Int8   4695222
15                      notMisleadingOther      Int8   4695222
16           notMisleadingFactuallyCorrect      Int8   4695222
17  notMisleadingOutdatedButNotWhenWritten      Int8   4695222
18              notMisleadingClearlySatire      Int8   4695222
19            notMisleadingPersonalOpinion      Int8   4695222
20                      trustworthySources      Int8   4695222
21                                 summary    object  18780888
22                             isMediaNote      Int8   4695222
23                     isCollaborativeNote      Int8   4695222
INFO:birdwatch.run_scoring:ratings total RAM: 454637044 bytes (0.455 GB)
                                  column     dtype       RAM
0                                 noteId     int64  31904336
1                     raterParticipantId    object  31904336
2                        createdAtMillis     int64  31904336
3                                version      Int8   7976084
4                                  agree      Int8   7976084
5                               disagree      Int8   7976084
6                                helpful      Int8   7976084
7                             notHelpful      Int8   7976084
8                       helpfulnessLevel  category   3988174
9                           helpfulOther      Int8   7976084
10                    helpfulInformative      Int8   7976084
11                          helpfulClear      Int8   7976084
12                     helpfulEmpathetic      Int8   7976084
13                    helpfulGoodSources      Int8   7976084
14                  helpfulUniqueContext      Int8   7976084
15                 helpfulAddressesClaim      Int8   7976084
16               helpfulImportantContext      Int8   7976084
17               helpfulUnbiasedLanguage      Int8   7976084
18                       notHelpfulOther      Int8   7976084
19                   notHelpfulIncorrect      Int8   7976084
20  notHelpfulSourcesMissingOrUnreliable      Int8   7976084
21    notHelpfulOpinionSpeculationOrBias      Int8   7976084
22            notHelpfulMissingKeyPoints      Int8   7976084
23                    notHelpfulOutdated      Int8   7976084
24            notHelpfulHardToUnderstand      Int8   7976084
25       notHelpfulArgumentativeOrBiased      Int8   7976084
26                    notHelpfulOffTopic      Int8   7976084
27       notHelpfulSpamHarassmentOrAbuse      Int8   7976084
28           notHelpfulIrrelevantSources      Int8   7976084
29          notHelpfulOpinionSpeculation      Int8   7976084
30               notHelpfulNoteNotNeeded      Int8   7976084
31                        ratedOnTweetId     int64  31904336
32                  ratingSourceBucketed  category   3988166
33                            helpfulNum   float64  31904336
34                       highVolumeRater      bool   3988042
35                       correlatedRater      bool   3988042
36                    postSelectionValue   float64  31904336
37        postSelectionValue_note_author   float64  31904336
INFO:birdwatch.run_scoring:noteStatusHistory total RAM: 344547595 bytes (0.345 GB)
                                            column     dtype       RAM
0                                           noteId     int64  21367128
1                          noteAuthorParticipantId    object  21367128
2                                  createdAtMillis   float64  21367128
3               timestampMillisOfFirstNonNMRStatus   float64  21367128
4                                firstNonNMRStatus  category   2671015
5                   timestampMillisOfCurrentStatus   float64  21367128
6                                    currentStatus  category   2671023
7              timestampMillisOfLatestNonNMRStatus   float64  21367128
8                           mostRecentNonNMRStatus  category   2671015
9                      timestampMillisOfStatusLock   float64  21367128
10                                    lockedStatus  category   2671023
11                      timestampMillisOfRetroLock   float64  21367128
12                               currentCoreStatus  category   2671103
13                          currentExpansionStatus  category   2671103
14                              currentGroupStatus  category   2671095
15                                currentDecidedBy  category   2672203
16                            currentModelingGroup   float64  21367128
17         timestampMillisOfMostRecentStatusChange   float64  21367128
18       timestampMillisOfNmrDueToMinStableCrhTime   float64  21367128
19                         currentMultiGroupStatus  category   2671095
20                       currentModelingMultiGroup   float64  21367128
21             timestampMinuteOfFinalScoringOutput   float64  21367128
22  timestampMillisOfFirstNmrDueToMinStableCrhTime   float64  21367128
23                                  classification    object  21367128
INFO:birdwatch.run_scoring:userEnrollment total RAM: 77749221 bytes (0.078 GB)
                           column     dtype       RAM
0                   participantId    object  10912168
1                 enrollmentState    object  10912168
2  successfulRatingNeededToEarnIn     int64  10912168
3      timestampOfLastStateChange     int64  10912168
4          timestampOfLastEarnOut   float64  10912168
5              modelingPopulation  category   1364045
6                   modelingGroup   float64  10912168
7          numberOfTimesEarnedOut     int64  10912168
INFO:birdwatch.run_scoring:prescoringNoteModelOutput total RAM: 124937868 bytes (0.125 GB)
                            column    dtype       RAM
0                           noteId   object  22715976
1            internalNoteIntercept  float32  11357988
2              internalNoteFactor1  float32  11357988
3                       scorerName   object  22715976
4        lowDiligenceNoteIntercept  float32  11357988
5          lowDiligenceNoteFactor1  float32  11357988
6  lowDiligenceNoteInterceptRound2  float32  11357988
7          harassmentNoteIntercept  float32  11357988
8            harassmentNoteFactor1  float32  11357988
INFO:birdwatch.run_scoring:prescoringRaterModelOutput total RAM: 93184740 bytes (0.093 GB)
                                          column    dtype      RAM
0                             raterParticipantId   object  4518048
1                         internalRaterIntercept  float32  2259024
2                           internalRaterFactor1  float32  2259024
3               internalFirstRoundRaterIntercept  float32  2259024
4                 internalFirstRoundRaterFactor1  float32  2259024
5                         crhCrnhRatioDifference  float64  4518048
6                                  meanNoteScore  float64  4518048
7                                raterAgreeRatio  float64  4518048
8                      aboveHelpfulnessThreshold   object  4518048
9                                     scorerName   object  4518048
10                       internalRaterReputation  float32  2259024
11                    lowDiligenceRaterIntercept  float32  2259024
12                      lowDiligenceRaterFactor1  float32  2259024
13                   lowDiligenceRaterReputation  float32  2259024
14              lowDiligenceRaterInterceptRound2  float32  2259024
15                incorrectTagRatingsMadeByRater    Int64  5082804
16                       totalRatingsMadeByRater  float64  4518048
17                            postSelectionValue  float64  4518048
18                  successfulRatingHelpfulCount  float64  4518048
19               successfulRatingNotHelpfulCount  float64  4518048
20                unsuccessfulRatingHelpfulCount  float64  4518048
21             unsuccessfulRatingNotHelpfulCount  float64  4518048
22                 totalHelpfulHarassmentPenalty  float64  4518048
23  raterAgreeRatioKeyWithHarassmentAbusePenalty  float64  4518048
24                              quasiCliqueValue  float64  4518048
INFO:birdwatch.constants:Logging Prescoring Results RAM usage (before conversion) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.run_scoring:notes total RAM: 190156863 bytes (0.190 GB)
                                    column     dtype       RAM
0                                   noteId     int64  18780888
1                  noteAuthorParticipantId    object  18780888
2                          createdAtMillis     int64  18780888
3                                  tweetId    object  18780888
4                           classification    object  18780888
5                               believable  category   2347735
6                                  harmful  category   2347735
7                     validationDifficulty  category   2347735
8                          misleadingOther      Int8   4695222
9                   misleadingFactualError      Int8   4695222
10              misleadingManipulatedMedia      Int8   4695222
11           misleadingOutdatedInformation      Int8   4695222
12       misleadingMissingImportantContext      Int8   4695222
13         misleadingUnverifiedClaimAsFact      Int8   4695222
14                        misleadingSatire      Int8   4695222
15                      notMisleadingOther      Int8   4695222
16           notMisleadingFactuallyCorrect      Int8   4695222
17  notMisleadingOutdatedButNotWhenWritten      Int8   4695222
18              notMisleadingClearlySatire      Int8   4695222
19            notMisleadingPersonalOpinion      Int8   4695222
20                      trustworthySources      Int8   4695222
21                                 summary    object  18780888
22                             isMediaNote      Int8   4695222
23                     isCollaborativeNote      Int8   4695222
INFO:birdwatch.run_scoring:ratings total RAM: 454637044 bytes (0.455 GB)
                                  column     dtype       RAM
0                                 noteId     int64  31904336
1                     raterParticipantId    object  31904336
2                        createdAtMillis     int64  31904336
3                                version      Int8   7976084
4                                  agree      Int8   7976084
5                               disagree      Int8   7976084
6                                helpful      Int8   7976084
7                             notHelpful      Int8   7976084
8                       helpfulnessLevel  category   3988174
9                           helpfulOther      Int8   7976084
10                    helpfulInformative      Int8   7976084
11                          helpfulClear      Int8   7976084
12                     helpfulEmpathetic      Int8   7976084
13                    helpfulGoodSources      Int8   7976084
14                  helpfulUniqueContext      Int8   7976084
15                 helpfulAddressesClaim      Int8   7976084
16               helpfulImportantContext      Int8   7976084
17               helpfulUnbiasedLanguage      Int8   7976084
18                       notHelpfulOther      Int8   7976084
19                   notHelpfulIncorrect      Int8   7976084
20  notHelpfulSourcesMissingOrUnreliable      Int8   7976084
21    notHelpfulOpinionSpeculationOrBias      Int8   7976084
22            notHelpfulMissingKeyPoints      Int8   7976084
23                    notHelpfulOutdated      Int8   7976084
24            notHelpfulHardToUnderstand      Int8   7976084
25       notHelpfulArgumentativeOrBiased      Int8   7976084
26                    notHelpfulOffTopic      Int8   7976084
27       notHelpfulSpamHarassmentOrAbuse      Int8   7976084
28           notHelpfulIrrelevantSources      Int8   7976084
29          notHelpfulOpinionSpeculation      Int8   7976084
30               notHelpfulNoteNotNeeded      Int8   7976084
31                        ratedOnTweetId     int64  31904336
32                  ratingSourceBucketed  category   3988166
33                            helpfulNum   float64  31904336
34                       highVolumeRater      bool   3988042
35                       correlatedRater      bool   3988042
36                    postSelectionValue   float64  31904336
37        postSelectionValue_note_author   float64  31904336
INFO:birdwatch.run_scoring:noteStatusHistory total RAM: 344547595 bytes (0.345 GB)
                                            column     dtype       RAM
0                                           noteId     int64  21367128
1                          noteAuthorParticipantId    object  21367128
2                                  createdAtMillis   float64  21367128
3               timestampMillisOfFirstNonNMRStatus   float64  21367128
4                                firstNonNMRStatus  category   2671015
5                   timestampMillisOfCurrentStatus   float64  21367128
6                                    currentStatus  category   2671023
7              timestampMillisOfLatestNonNMRStatus   float64  21367128
8                           mostRecentNonNMRStatus  category   2671015
9                      timestampMillisOfStatusLock   float64  21367128
10                                    lockedStatus  category   2671023
11                      timestampMillisOfRetroLock   float64  21367128
12                               currentCoreStatus  category   2671103
13                          currentExpansionStatus  category   2671103
14                              currentGroupStatus  category   2671095
15                                currentDecidedBy  category   2672203
16                            currentModelingGroup   float64  21367128
17         timestampMillisOfMostRecentStatusChange   float64  21367128
18       timestampMillisOfNmrDueToMinStableCrhTime   float64  21367128
19                         currentMultiGroupStatus  category   2671095
20                       currentModelingMultiGroup   float64  21367128
21             timestampMinuteOfFinalScoringOutput   float64  21367128
22  timestampMillisOfFirstNmrDueToMinStableCrhTime   float64  21367128
23                                  classification    object  21367128
INFO:birdwatch.run_scoring:userEnrollment total RAM: 77749221 bytes (0.078 GB)
                           column     dtype       RAM
0                   participantId    object  10912168
1                 enrollmentState    object  10912168
2  successfulRatingNeededToEarnIn     int64  10912168
3      timestampOfLastStateChange     int64  10912168
4          timestampOfLastEarnOut   float64  10912168
5              modelingPopulation  category   1364045
6                   modelingGroup   float64  10912168
7          numberOfTimesEarnedOut     int64  10912168
INFO:birdwatch.run_scoring:prescoringNoteModelOutput total RAM: 124937868 bytes (0.125 GB)
                            column    dtype       RAM
0                           noteId   object  22715976
1            internalNoteIntercept  float32  11357988
2              internalNoteFactor1  float32  11357988
3                       scorerName   object  22715976
4        lowDiligenceNoteIntercept  float32  11357988
5          lowDiligenceNoteFactor1  float32  11357988
6  lowDiligenceNoteInterceptRound2  float32  11357988
7          harassmentNoteIntercept  float32  11357988
8            harassmentNoteFactor1  float32  11357988
INFO:birdwatch.run_scoring:prescoringRaterModelOutput total RAM: 93184740 bytes (0.093 GB)
                                          column    dtype      RAM
0                             raterParticipantId   object  4518048
1                         internalRaterIntercept  float32  2259024
2                           internalRaterFactor1  float32  2259024
3               internalFirstRoundRaterIntercept  float32  2259024
4                 internalFirstRoundRaterFactor1  float32  2259024
5                         crhCrnhRatioDifference  float64  4518048
6                                  meanNoteScore  float64  4518048
7                                raterAgreeRatio  float64  4518048
8                      aboveHelpfulnessThreshold   object  4518048
9                                     scorerName   object  4518048
10                       internalRaterReputation  float32  2259024
11                    lowDiligenceRaterIntercept  float32  2259024
12                      lowDiligenceRaterFactor1  float32  2259024
13                   lowDiligenceRaterReputation  float32  2259024
14              lowDiligenceRaterInterceptRound2  float32  2259024
15                incorrectTagRatingsMadeByRater    Int64  5082804
16                       totalRatingsMadeByRater  float64  4518048
17                            postSelectionValue  float64  4518048
18                  successfulRatingHelpfulCount  float64  4518048
19               successfulRatingNotHelpfulCount  float64  4518048
20                unsuccessfulRatingHelpfulCount  float64  4518048
21             unsuccessfulRatingNotHelpfulCount  float64  4518048
22                 totalHelpfulHarassmentPenalty  float64  4518048
23  raterAgreeRatioKeyWithHarassmentAbusePenalty  float64  4518048
24                              quasiCliqueValue  float64  4518048
INFO:birdwatch.constants:Logging Prescoring Results RAM usage (after conversion) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.run_scoring:prescoringRaterModelOutput total RAM: 93199260 bytes (0.093 GB)
                                          column    dtype      RAM
0                             raterParticipantId   object  4518752
1                         internalRaterIntercept  float32  2259376
2                           internalRaterFactor1  float32  2259376
3               internalFirstRoundRaterIntercept  float32  2259376
4                 internalFirstRoundRaterFactor1  float32  2259376
5                         crhCrnhRatioDifference  float64  4518752
6                                  meanNoteScore  float64  4518752
7                                raterAgreeRatio  float64  4518752
8                      aboveHelpfulnessThreshold   object  4518752
9                                     scorerName   object  4518752
10                       internalRaterReputation  float32  2259376
11                    lowDiligenceRaterIntercept  float32  2259376
12                      lowDiligenceRaterFactor1  float32  2259376
13                   lowDiligenceRaterReputation  float32  2259376
14              lowDiligenceRaterInterceptRound2  float32  2259376
15                incorrectTagRatingsMadeByRater    Int64  5083596
16                       totalRatingsMadeByRater  float64  4518752
17                            postSelectionValue  float64  4518752
18                  successfulRatingHelpfulCount  float64  4518752
19               successfulRatingNotHelpfulCount  float64  4518752
20                unsuccessfulRatingHelpfulCount  float64  4518752
21             unsuccessfulRatingNotHelpfulCount  float64  4518752
22                 totalHelpfulHarassmentPenalty  float64  4518752
23  raterAgreeRatioKeyWithHarassmentAbusePenalty  float64  4518752
24                              quasiCliqueValue  float64  4518752
INFO:birdwatch.constants:Logging Prescoring Results RAM usage (after concatenation) elapsed time: 0.01 secs (0.00 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pflip_plus_model.py, in _get_notes, at line 242: noteStatusHistory[[c.noteIdKey, c.createdAtMillisKey]].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=Int64 vs right=int64 (UNALLOWED)
  PandasTypeError: Merge key mismatch on createdAtMillis: left=Int64 vs right=int64 (UNALLOWED)
  PandasTypeError: Output mismatch on createdAtMillis: result=Int64 expected=None (UNALLOWED)

INFO:birdwatch.pflip_plus_model:labels before ScoringDriftGuard:
LABEL
CRH     95483
FLIP    38318
Name: count, dtype: int64
INFO:birdwatch.pflip_plus_model:labels after ScoringDriftGuard:
LABEL
CRH     93144
FLIP    38318
Name: count, dtype: int64

INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pflip_plus_model.py, in _compute_scoring_cutoff, at line 335: .astype(pd.Int64Dtype())
  PandasTypeError: Type expectation mismatch on noteId: found=Int64 expected=int64


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pflip_plus_model.py, in _compute_scoring_cutoff, at line 342: .astype(pd.Int64Dtype()),
  PandasTypeError: Type expectation mismatch on noteId: found=Int64 expected=int64


CONCAT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pflip_plus_model.py, in _compute_scoring_cutoff, at line 337: cutoffByRatings = cutoffByRatings.merge(
  PandasTypeError: Type expectation mismatch on noteId: found=Int64 expected=int64
  PandasTypeError: Type expectation mismatch on noteId: found=Int64 expected=int64


MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pflip_plus_model.py, in _compute_scoring_cutoff, at line 337: cutoffByRatings = cutoffByRatings.merge(
  PandasTypeError: Type expectation mismatch on noteId: found=Int64 expected=int64
  PandasTypeError: Type expectation mismatch on noteId: found=Int64 expected=int64
  PandasTypeError: Type expectation mismatch on noteId: found=Int64 expected=int64


MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pflip_plus_model.py, in _compute_scoring_cutoff, at line 348: scoringCutoff = scoringCutoff.merge(cutoffByRatings[[c.noteIdKey, "ratingMin"]])
  PandasTypeError: Type expectation mismatch on noteId: found=Int64 expected=int64
  PandasTypeError: Input mismatch on noteId: left=int64 vs right=Int64 (UNALLOWED)
  PandasTypeError: Merge key mismatch on noteId: left=int64 vs right=Int64 (UNALLOWED)
  PandasTypeError: Output mismatch on noteId: result=int64 expected=None (UNALLOWED)

INFO:birdwatch.constants:Fitting pflip model elapsed time: 29.08 secs (0.48 mins)
Patching pandas
Pairs dict used 2.6843546480000002GB RAM at max
Pairs dict used 2.6843546480000002GB RAM after deleted unneeded pairs
TERM_PROGRAM: Apple_Terminal
SHELL: /bin/zsh
TERM: xterm-256color
TMPDIR: /var/folders/06/vqf6dx7s0mdbgx_rpjv0hc5m0000gn/T/
TERM_PROGRAM_VERSION: 453
TERM_SESSION_ID: F736EB59-D622-4D96-8E2F-8FE9FDD8CEF1
USER: canbo
SSH_AUTH_SOCK: /private/tmp/com.apple.launchd.p38rtIG1br/Listeners
PATH: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/venv/bin:/Users/canbo/.local/bin:/Library/Frameworks/Python.framework/Versions/3.14/bin:/opt/local/bin:/opt/local/sbin:/Library/Frameworks/Python.framework/Versions/3.13/bin:/usr/local/bin:/System/Cryptexes/App/usr/bin:/usr/bin:/bin:/usr/sbin:/sbin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/local/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/appleinternal/bin
LaunchInstanceID: FEDCD432-4AA4-450A-B3C3-C3F601934137
__CFBundleIdentifier: com.apple.Terminal
PWD: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src
XPC_FLAGS: 0x0
XPC_SERVICE_NAME: 0
SHLVL: 1
HOME: /Users/canbo
LOGNAME: canbo
SECURITYSESSIONID: 186a2
OLDPWD: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring
PS1: (venv) %n@%m %1~ %# 
VIRTUAL_ENV: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/venv
VIRTUAL_ENV_PROMPT: (venv) 
LANG: en_US.UTF-8
_: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/venv/bin/python3
__CF_USER_TEXT_ENCODING: 0x1F5:0x0:0x0
KMP_INIT_AT_FORK: FALSE
KMP_DUPLICATE_LIB_OK: True
[Pipeline] .... (step 1 of 3) Processing UnigramEncoder, total= 8.1min
[Pipeline] ............. (step 2 of 3) Processing tfidf, total=   4.5s
[Pipeline] ........ (step 3 of 3) Processing Classifier, total= 5.9min
(343752, 3)
Excluding ratings outside of group
Traceback (most recent call last):
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/main.py", line 31, in <module>
    main()
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/runner.py", line 278, in main
    return _run_scorer(args=args, dataLoader=dataLoader, extraScoringArgs=extraScoringArgs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pandas_utils.py", line 722, in _inner
    retVal = main(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/runner.py", line 231, in _run_scorer
    scoredNotes, helpfulnessScores, newStatus, auxNoteInfo = run_scoring(
                                                             ^^^^^^^^^^^^
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py", line 2089, in run_scoring
    ) = run_prescoring(
        ^^^^^^^^^^^^^^^
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py", line 1348, in run_prescoring
    pflipPlusModel.fit(notes, ratings, noteStatusHistory, prescoringRaterModelOutput)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pflip_plus_model.py", line 1566, in fit
    self._prepare_note_info(
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pflip_plus_model.py", line 1054, in _prepare_note_info
    scoringCutoff = self._compute_scoring_cutoff(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pflip_plus_model.py", line 349, in _compute_scoring_cutoff
    assert len(scoringCutoff) == beforeMerge
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AssertionError
