INFO:birdwatch.runner:scorer python version: 3.12.12 (main, Oct  9 2025, 11:07:00) [Clang 16.0.0 (clang-1600.0.26.6)]
INFO:birdwatch.runner:scorer pandas version: 2.3.3
INFO:birdwatch.runner:beginning scorer execution
INFO:birdwatch.process_data:Timestamp of latest rating in data: 2026-01-26 02:52:16.873000
INFO:birdwatch.process_data:Timestamp of latest note in data: 2026-01-19 01:00:50.225000
INFO:birdwatch.process_data:Total raters: 623657
INFO:birdwatch.process_data:Identifying high volume raters
INFO:birdwatch.process_data:Total ratings: 4007501
INFO:birdwatch.process_data:High volume threshold for 7 days: 4.740000000000009
INFO:birdwatch.process_data:High volume raters for 7 days: 1
INFO:birdwatch.process_data:High volume threshold for 28 days: 19.0
INFO:birdwatch.process_data:High volume raters for 28 days: 50
INFO:birdwatch.process_data:Total high volume raters: 51
INFO:birdwatch.process_data:Total ratings: 4007501
INFO:birdwatch.process_data:Total ratings from high volume raters: 20858

CONCAT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_status_history.py, in merge_note_info, at line 31: newNoteStatusHistory = oldNoteStatusHistory.merge(
  PandasTypeError: Type expectation mismatch on noteId: found=float64 expected=int64
  PandasTypeError: Type expectation mismatch on noteId: found=float64 expected=int64


MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_status_history.py, in merge_note_info, at line 31: newNoteStatusHistory = oldNoteStatusHistory.merge(
  PandasTypeError: Output mismatch on createdAtMillis: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on createdAtMillis_notes: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_status_history:total notes added to noteStatusHistory: 2297

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_status_history.py, in merge_note_info, at line 57: newNoteStatusHistory[[c.noteIdKey, c.createdAtMillisKey]].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=float64 vs right=int64 (allowed)
  PandasTypeError: Merge key mismatch on createdAtMillis: left=float64 vs right=int64 (allowed)


MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/process_data.py, in _filter_misleading_notes, at line 298: ratings = ratings.merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.process_data:Preprocess Data: Filter misleading notes, starting with 4007501 ratings on 44476 notes
INFO:birdwatch.process_data:  Keeping 3283088 ratings on 34889 misleading notes
INFO:birdwatch.process_data:  Keeping 0 ratings on 0 deleted notes that were previously scored (in note status history)
INFO:birdwatch.process_data:  Removing 6416 ratings on 419 older notes that aren't deleted, but are not-misleading.
INFO:birdwatch.process_data:  Removing 0 ratings on 0 notes that were deleted and not in note status history (e.g. old).
INFO:birdwatch.process_data:Num Ratings: 4001085, Num Unique Notes Rated: 44057, Num Unique Raters: 623416
INFO:birdwatch.process_data:Called filter_input_data_for_testing.
        Notes: 50000, Ratings: 4001085. Max note createdAt: 2026-01-19 01:00:50.225000; Max rating createAt: 2026-01-26 02:52:16.873000
INFO:birdwatch.process_data:After filtering notes and ratings after particular timestamp (=None). 
        Notes: 50000, Ratings: 4001085. Max note createdAt: 2026-01-19 01:00:50.225000; Max rating createAt: 2026-01-26 02:52:16.873000
INFO:birdwatch.process_data:After filtering ratings after first status (plus None hours) for notes created in last 14 days. 
        Notes: 50000, Ratings: 4001085. Max note createdAt: 2026-01-19 01:00:50.225000; Max rating createAt: 2026-01-26 02:52:16.873000
INFO:birdwatch.process_data:After filtering prescoring notes and ratings to simulate a delay of None hours: 
        Notes: 50000, Ratings: 4001085. Max note createdAt: 2026-01-19 01:00:50.225000; Max rating createAt: 2026-01-26 02:52:16.873000
INFO:birdwatch.constants:Compute pair counts dict elapsed time: 198.31 secs (3.31 mins)
INFO:birdwatch.constants:Compute PMI and minSim elapsed time: 114.73 secs (1.91 mins)
INFO:birdwatch.constants:Delete unneeded pairs from pairCountsDict elapsed time: 52.24 secs (0.87 mins)
INFO:birdwatch.constants:Aggregate into cliques by post selection similarity elapsed time: 1.83 secs (0.03 mins)
INFO:birdwatch.constants:Compute Post Selection Similarity elapsed time: 389.82 secs (6.50 mins)
--- Logging error ---
Traceback (most recent call last):
  File "/usr/local/Cellar/python@3.12/3.12.12_1/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 1160, in emit
    msg = self.format(record)
          ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.12/3.12.12_1/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.12/3.12.12_1/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 703, in format
    record.message = record.getMessage()
                     ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.12/3.12.12_1/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 392, in getMessage
    msg = msg % self.args
          ~~~~^~~~~~~~~~~
TypeError: not all arguments converted during string formatting
Call stack:
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/main.py", line 31, in <module>
    main()
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/runner.py", line 278, in main
    return _run_scorer(args=args, dataLoader=dataLoader, extraScoringArgs=extraScoringArgs)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pandas_utils.py", line 722, in _inner
    retVal = main(*args, **kwargs)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/runner.py", line 231, in _run_scorer
    scoredNotes, helpfulnessScores, newStatus, auxNoteInfo = run_scoring(
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py", line 2080, in run_scoring
    postSelectionSimilarityValues = run_rater_clustering(notes=notes, ratings=ratings)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py", line 1188, in run_rater_clustering
    quasiCliques = qcd.get_quasi_cliques(notes, ratings)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/quasi_clique_detection.py", line 256, in get_quasi_cliques
    raterPairCounts, raterPairRatings = self._get_pair_counts(ratings, notes, self._recencyCutoff)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/quasi_clique_detection.py", line 60, in _get_pair_counts
    logger.info("initial rating length:", len(ratings))
Message: 'initial rating length:'
Arguments: (4001085,)
--- Logging error ---
Traceback (most recent call last):
  File "/usr/local/Cellar/python@3.12/3.12.12_1/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 1160, in emit
    msg = self.format(record)
          ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.12/3.12.12_1/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.12/3.12.12_1/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 703, in format
    record.message = record.getMessage()
                     ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.12/3.12.12_1/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 392, in getMessage
    msg = msg % self.args
          ~~~~^~~~~~~~~~~
TypeError: not all arguments converted during string formatting
Call stack:
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/main.py", line 31, in <module>
    main()
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/runner.py", line 278, in main
    return _run_scorer(args=args, dataLoader=dataLoader, extraScoringArgs=extraScoringArgs)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pandas_utils.py", line 722, in _inner
    retVal = main(*args, **kwargs)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/runner.py", line 231, in _run_scorer
    scoredNotes, helpfulnessScores, newStatus, auxNoteInfo = run_scoring(
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py", line 2080, in run_scoring
    postSelectionSimilarityValues = run_rater_clustering(notes=notes, ratings=ratings)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py", line 1188, in run_rater_clustering
    quasiCliques = qcd.get_quasi_cliques(notes, ratings)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/quasi_clique_detection.py", line 256, in get_quasi_cliques
    raterPairCounts, raterPairRatings = self._get_pair_counts(ratings, notes, self._recencyCutoff)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/quasi_clique_detection.py", line 67, in _get_pair_counts
    logger.info("ratings after merges:", len(ratings))
Message: 'ratings after merges:'
Arguments: (4001085,)
--- Logging error ---
Traceback (most recent call last):
  File "/usr/local/Cellar/python@3.12/3.12.12_1/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 1160, in emit
    msg = self.format(record)
          ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.12/3.12.12_1/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.12/3.12.12_1/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 703, in format
    record.message = record.getMessage()
                     ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.12/3.12.12_1/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 392, in getMessage
    msg = msg % self.args
          ~~~~^~~~~~~~~~~
TypeError: not all arguments converted during string formatting
Call stack:
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/main.py", line 31, in <module>
    main()
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/runner.py", line 278, in main
    return _run_scorer(args=args, dataLoader=dataLoader, extraScoringArgs=extraScoringArgs)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pandas_utils.py", line 722, in _inner
    retVal = main(*args, **kwargs)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/runner.py", line 231, in _run_scorer
    scoredNotes, helpfulnessScores, newStatus, auxNoteInfo = run_scoring(
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py", line 2080, in run_scoring
    postSelectionSimilarityValues = run_rater_clustering(notes=notes, ratings=ratings)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py", line 1188, in run_rater_clustering
    quasiCliques = qcd.get_quasi_cliques(notes, ratings)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/quasi_clique_detection.py", line 256, in get_quasi_cliques
    raterPairCounts, raterPairRatings = self._get_pair_counts(ratings, notes, self._recencyCutoff)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/quasi_clique_detection.py", line 69, in _get_pair_counts
    logger.info("recent ratings:", len(ratings))
Message: 'recent ratings:'
Arguments: (358354,)
--- Logging error ---
Traceback (most recent call last):
  File "/usr/local/Cellar/python@3.12/3.12.12_1/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 1160, in emit
    msg = self.format(record)
          ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.12/3.12.12_1/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.12/3.12.12_1/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 703, in format
    record.message = record.getMessage()
                     ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.12/3.12.12_1/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 392, in getMessage
    msg = msg % self.args
          ~~~~^~~~~~~~~~~
TypeError: not all arguments converted during string formatting
Call stack:
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/main.py", line 31, in <module>
    main()
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/runner.py", line 278, in main
    return _run_scorer(args=args, dataLoader=dataLoader, extraScoringArgs=extraScoringArgs)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pandas_utils.py", line 722, in _inner
    retVal = main(*args, **kwargs)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/runner.py", line 231, in _run_scorer
    scoredNotes, helpfulnessScores, newStatus, auxNoteInfo = run_scoring(
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py", line 2080, in run_scoring
    postSelectionSimilarityValues = run_rater_clustering(notes=notes, ratings=ratings)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py", line 1188, in run_rater_clustering
    quasiCliques = qcd.get_quasi_cliques(notes, ratings)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/quasi_clique_detection.py", line 256, in get_quasi_cliques
    raterPairCounts, raterPairRatings = self._get_pair_counts(ratings, notes, self._recencyCutoff)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/quasi_clique_detection.py", line 71, in _get_pair_counts
    logger.info("ratings on non-deleted tweets:", len(ratings))
Message: 'ratings on non-deleted tweets:'
Arguments: (358354,)
--- Logging error ---
Traceback (most recent call last):
  File "/usr/local/Cellar/python@3.12/3.12.12_1/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 1160, in emit
    msg = self.format(record)
          ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.12/3.12.12_1/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.12/3.12.12_1/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 703, in format
    record.message = record.getMessage()
                     ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.12/3.12.12_1/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 392, in getMessage
    msg = msg % self.args
          ~~~~^~~~~~~~~~~
TypeError: not all arguments converted during string formatting
Call stack:
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/main.py", line 31, in <module>
    main()
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/runner.py", line 278, in main
    return _run_scorer(args=args, dataLoader=dataLoader, extraScoringArgs=extraScoringArgs)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pandas_utils.py", line 722, in _inner
    retVal = main(*args, **kwargs)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/runner.py", line 231, in _run_scorer
    scoredNotes, helpfulnessScores, newStatus, auxNoteInfo = run_scoring(
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py", line 2080, in run_scoring
    postSelectionSimilarityValues = run_rater_clustering(notes=notes, ratings=ratings)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py", line 1188, in run_rater_clustering
    quasiCliques = qcd.get_quasi_cliques(notes, ratings)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/quasi_clique_detection.py", line 256, in get_quasi_cliques
    raterPairCounts, raterPairRatings = self._get_pair_counts(ratings, notes, self._recencyCutoff)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/quasi_clique_detection.py", line 73, in _get_pair_counts
    logger.info("ratings on misleading posts:", len(ratings))
Message: 'ratings on misleading posts:'
Arguments: (306449,)
INFO:birdwatch.quasi_clique_detection:Preparing pairs for 2752 tweets
INFO:birdwatch.quasi_clique_detection:0
INFO:birdwatch.quasi_clique_detection:1000
INFO:birdwatch.quasi_clique_detection:2000
INFO:birdwatch.quasi_clique_detection:ratings after filter to raters included in pair counts: 80038
INFO:birdwatch.quasi_clique_detection:orig raterPairCounts: 130185
INFO:birdwatch.quasi_clique_detection:pruned raterPairCounts: 193
INFO:birdwatch.quasi_clique_detection:Skipping clique  (raters=3, tweets=32).  Remaining ratePairCounts: 191
INFO:birdwatch.quasi_clique_detection:Adding clique  (raters=38, tweets=64).  Remaining ratePairCounts: 0
INFO:birdwatch.constants:Compute Quasi-Cliques elapsed time: 248.52 secs (4.14 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py, in run_rater_clustering, at line 1192: return postSelectionSimilarityValues.merge(quasiCliques, how="outer")
  PandasTypeError: Output mismatch on postSelectionValue: result=float64 expected=int64 (UNALLOWED)
  PandasTypeError: Output mismatch on quasiCliqueValue: result=float64 expected=int64 (UNALLOWED)

INFO:birdwatch.run_scoring:logging environment variables
INFO:birdwatch.run_scoring:notes total RAM: 4050264 bytes (0.004 GB)
                                    column     dtype     RAM
0                                   noteId     int64  400000
1                  noteAuthorParticipantId    object  400000
2                          createdAtMillis     int64  400000
3                                  tweetId    object  400000
4                           classification    object  400000
5                               believable  category   50124
6                                  harmful  category   50016
7                     validationDifficulty  category   50124
8                          misleadingOther      Int8  100000
9                   misleadingFactualError      Int8  100000
10              misleadingManipulatedMedia      Int8  100000
11           misleadingOutdatedInformation      Int8  100000
12       misleadingMissingImportantContext      Int8  100000
13         misleadingUnverifiedClaimAsFact      Int8  100000
14                        misleadingSatire      Int8  100000
15                      notMisleadingOther      Int8  100000
16           notMisleadingFactuallyCorrect      Int8  100000
17  notMisleadingOutdatedButNotWhenWritten      Int8  100000
18              notMisleadingClearlySatire      Int8  100000
19            notMisleadingPersonalOpinion      Int8  100000
20                      trustworthySources      Int8  100000
21                                 summary    object  400000
22                             isMediaNote      Int8  100000
23                     isCollaborativeNote      Int8  100000
INFO:birdwatch.run_scoring:ratings total RAM: 388105393 bytes (0.388 GB)
                                  column     dtype       RAM
0                                 noteId     int64  32008680
1                     raterParticipantId    object  32008680
2                        createdAtMillis     int64  32008680
3                                version      Int8   8002170
4                                  agree      Int8   8002170
5                               disagree      Int8   8002170
6                                helpful      Int8   8002170
7                             notHelpful      Int8   8002170
8                       helpfulnessLevel  category   4001217
9                           helpfulOther      Int8   8002170
10                    helpfulInformative      Int8   8002170
11                          helpfulClear      Int8   8002170
12                     helpfulEmpathetic      Int8   8002170
13                    helpfulGoodSources      Int8   8002170
14                  helpfulUniqueContext      Int8   8002170
15                 helpfulAddressesClaim      Int8   8002170
16               helpfulImportantContext      Int8   8002170
17               helpfulUnbiasedLanguage      Int8   8002170
18                       notHelpfulOther      Int8   8002170
19                   notHelpfulIncorrect      Int8   8002170
20  notHelpfulSourcesMissingOrUnreliable      Int8   8002170
21    notHelpfulOpinionSpeculationOrBias      Int8   8002170
22            notHelpfulMissingKeyPoints      Int8   8002170
23                    notHelpfulOutdated      Int8   8002170
24            notHelpfulHardToUnderstand      Int8   8002170
25       notHelpfulArgumentativeOrBiased      Int8   8002170
26                    notHelpfulOffTopic      Int8   8002170
27       notHelpfulSpamHarassmentOrAbuse      Int8   8002170
28           notHelpfulIrrelevantSources      Int8   8002170
29          notHelpfulOpinionSpeculation      Int8   8002170
30               notHelpfulNoteNotNeeded      Int8   8002170
31                        ratedOnTweetId     int64  32008680
32                  ratingSourceBucketed  category   4001101
33                            helpfulNum   float64  32008680
34                       highVolumeRater      bool   4001085
INFO:birdwatch.run_scoring:noteStatusHistory total RAM: 326123170 bytes (0.326 GB)
                                            column     dtype       RAM
0                                           noteId     int64  20224528
1                          noteAuthorParticipantId    object  20224528
2                                  createdAtMillis   float64  20224528
3               timestampMillisOfFirstNonNMRStatus   float64  20224528
4                                firstNonNMRStatus  category   2528190
5                   timestampMillisOfCurrentStatus   float64  20224528
6                                    currentStatus  category   2528198
7              timestampMillisOfLatestNonNMRStatus   float64  20224528
8                           mostRecentNonNMRStatus  category   2528190
9                      timestampMillisOfStatusLock   float64  20224528
10                                    lockedStatus  category   2528198
11                      timestampMillisOfRetroLock   float64  20224528
12                               currentCoreStatus  category   2528278
13                          currentExpansionStatus  category   2528278
14                              currentGroupStatus  category   2528270
15                                currentDecidedBy  category   2529378
16                            currentModelingGroup   float64  20224528
17         timestampMillisOfMostRecentStatusChange   float64  20224528
18       timestampMillisOfNmrDueToMinStableCrhTime   float64  20224528
19                         currentMultiGroupStatus  category   2528270
20                       currentModelingMultiGroup   float64  20224528
21             timestampMinuteOfFinalScoringOutput   float64  20224528
22  timestampMillisOfFirstNmrDueToMinStableCrhTime   float64  20224528
23                                  classification    object  20224528
INFO:birdwatch.run_scoring:userEnrollment total RAM: 77749221 bytes (0.078 GB)
                           column     dtype       RAM
0                   participantId    object  10912168
1                 enrollmentState    object  10912168
2  successfulRatingNeededToEarnIn     int64  10912168
3      timestampOfLastStateChange     int64  10912168
4          timestampOfLastEarnOut   float64  10912168
5              modelingPopulation  category   1364045
6                   modelingGroup   float64  10912168
7          numberOfTimesEarnedOut     int64  10912168
INFO:birdwatch.constants:Logging Prescoring Inputs Initial RAM usage elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Get Note Topics: Prepare Post Text elapsed time: 1.48 secs (0.02 mins)
INFO:birdwatch.topic_model:  Notes unassigned due to multiple matches: 41
INFO:birdwatch.constants:Get Note Topics: Make Seed Labels elapsed time: 18.19 secs (0.30 mins)
INFO:birdwatch.topic_model:  Initial vocabulary length: 177649
INFO:birdwatch.topic_model:  Total tokens to filter: 34
INFO:birdwatch.topic_model:  Total identified stopwords: 283
INFO:birdwatch.constants:Get Note Topics: Get Stop Words elapsed time: 7.62 secs (0.13 mins)
INFO:birdwatch.constants:Get Note Topics: Train Model elapsed time: 9.09 secs (0.15 mins)
INFO:birdwatch.topic_model:Assigning notes to topics:
INFO:birdwatch.constants:Get Note Topics: Prepare Post Text elapsed time: 1.32 secs (0.02 mins)
INFO:birdwatch.topic_model:  Balanced accuracy on raw predictions: 0.4520598050268324
INFO:birdwatch.topic_model:  Post Topic assignment results: [44922  1138  1473    13  1439]
INFO:birdwatch.constants:Get Note Topics: Merge and assign predictions elapsed time: 0.10 secs (0.00 mins)
INFO:birdwatch.topic_model:  Note Topic assignment results:
noteTopic
GazaConflict       1527
Scams              1455
UkraineConflict    1186
MessiRonaldo         13
Name: count, dtype: int64
INFO:birdwatch.constants:Get Note Topics: Predict elapsed time: 6.85 secs (0.11 mins)
INFO:birdwatch.constants:Note Topic Assignment elapsed time: 44.56 secs (0.74 mins)
INFO:birdwatch.run_scoring:ratings summary before PSS: 72d916edd8480a54840614d8a27768c12eda5a92f28ed63515d656d471f2c6ec
INFO:birdwatch.run_scoring:Post Selection Similarity Prescoring: begin with 4001085 ratings.
INFO:birdwatch.post_selection_similarity:Total ratings prior to applying post selection similarity: 4001085
INFO:birdwatch.post_selection_similarity:Total unique ratings before: 4001085
INFO:birdwatch.post_selection_similarity:Summary of postSelectionSimilarityValues: 
postSelectionValue    86
quasiCliqueValue      38
dtype: int64
INFO:birdwatch.post_selection_similarity:correlatedRater set on 13204 ratings from 38 unique raters
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/post_selection_similarity.py:243: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  ratingsWithPostSelectionSimilarityValue.sort_values(
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/post_selection_similarity.py:246: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  ratingsWithPostSelectionSimilarityValue.drop_duplicates(
INFO:birdwatch.post_selection_similarity:Total ratings after to applying post selection similarity: 3988042
INFO:birdwatch.post_selection_similarity:Total unique ratings after: 3988042
INFO:birdwatch.run_scoring:Post Selection Similarity Prescoring: 3988042 ratings remaining.
INFO:birdwatch.constants:Filter ratings by Post Selection Similarity elapsed time: 18.07 secs (0.30 mins)
INFO:birdwatch.run_scoring:ratings summary after PSS: 9a7cd54d34e5498956eca9b67961c16c00bf98b08b1300f2d5694732fdac0d4a
INFO:birdwatch.run_scoring:Error converting user IDs to ints.  IDs will remain as strings. ValueError("invalid literal for int() with base 10: '65F687F3F0BE41BB456A883BA989742AB6F9566B731F7526D2F0E850C1B7F1DC'")
INFO:birdwatch.run_scoring:notes total RAM: 4050264 bytes (0.004 GB)
                                    column     dtype     RAM
0                                   noteId     int64  400000
1                  noteAuthorParticipantId    object  400000
2                          createdAtMillis     int64  400000
3                                  tweetId    object  400000
4                           classification    object  400000
5                               believable  category   50124
6                                  harmful  category   50016
7                     validationDifficulty  category   50124
8                          misleadingOther      Int8  100000
9                   misleadingFactualError      Int8  100000
10              misleadingManipulatedMedia      Int8  100000
11           misleadingOutdatedInformation      Int8  100000
12       misleadingMissingImportantContext      Int8  100000
13         misleadingUnverifiedClaimAsFact      Int8  100000
14                        misleadingSatire      Int8  100000
15                      notMisleadingOther      Int8  100000
16           notMisleadingFactuallyCorrect      Int8  100000
17  notMisleadingOutdatedButNotWhenWritten      Int8  100000
18              notMisleadingClearlySatire      Int8  100000
19            notMisleadingPersonalOpinion      Int8  100000
20                      trustworthySources      Int8  100000
21                                 summary    object  400000
22                             isMediaNote      Int8  100000
23                     isCollaborativeNote      Int8  100000
INFO:birdwatch.run_scoring:ratings total RAM: 454636936 bytes (0.455 GB)
                                  column     dtype       RAM
0                                 noteId     int64  31904336
1                     raterParticipantId    object  31904336
2                        createdAtMillis     int64  31904336
3                                version      Int8   7976084
4                                  agree      Int8   7976084
5                               disagree      Int8   7976084
6                                helpful      Int8   7976084
7                             notHelpful      Int8   7976084
8                       helpfulnessLevel  category   3988174
9                           helpfulOther      Int8   7976084
10                    helpfulInformative      Int8   7976084
11                          helpfulClear      Int8   7976084
12                     helpfulEmpathetic      Int8   7976084
13                    helpfulGoodSources      Int8   7976084
14                  helpfulUniqueContext      Int8   7976084
15                 helpfulAddressesClaim      Int8   7976084
16               helpfulImportantContext      Int8   7976084
17               helpfulUnbiasedLanguage      Int8   7976084
18                       notHelpfulOther      Int8   7976084
19                   notHelpfulIncorrect      Int8   7976084
20  notHelpfulSourcesMissingOrUnreliable      Int8   7976084
21    notHelpfulOpinionSpeculationOrBias      Int8   7976084
22            notHelpfulMissingKeyPoints      Int8   7976084
23                    notHelpfulOutdated      Int8   7976084
24            notHelpfulHardToUnderstand      Int8   7976084
25       notHelpfulArgumentativeOrBiased      Int8   7976084
26                    notHelpfulOffTopic      Int8   7976084
27       notHelpfulSpamHarassmentOrAbuse      Int8   7976084
28           notHelpfulIrrelevantSources      Int8   7976084
29          notHelpfulOpinionSpeculation      Int8   7976084
30               notHelpfulNoteNotNeeded      Int8   7976084
31                        ratedOnTweetId     int64  31904336
32                  ratingSourceBucketed  category   3988058
33                            helpfulNum   float64  31904336
34                       highVolumeRater      bool   3988042
35                       correlatedRater      bool   3988042
36                    postSelectionValue   float64  31904336
37        postSelectionValue_note_author   float64  31904336
INFO:birdwatch.run_scoring:noteStatusHistory total RAM: 326123170 bytes (0.326 GB)
                                            column     dtype       RAM
0                                           noteId     int64  20224528
1                          noteAuthorParticipantId    object  20224528
2                                  createdAtMillis   float64  20224528
3               timestampMillisOfFirstNonNMRStatus   float64  20224528
4                                firstNonNMRStatus  category   2528190
5                   timestampMillisOfCurrentStatus   float64  20224528
6                                    currentStatus  category   2528198
7              timestampMillisOfLatestNonNMRStatus   float64  20224528
8                           mostRecentNonNMRStatus  category   2528190
9                      timestampMillisOfStatusLock   float64  20224528
10                                    lockedStatus  category   2528198
11                      timestampMillisOfRetroLock   float64  20224528
12                               currentCoreStatus  category   2528278
13                          currentExpansionStatus  category   2528278
14                              currentGroupStatus  category   2528270
15                                currentDecidedBy  category   2529378
16                            currentModelingGroup   float64  20224528
17         timestampMillisOfMostRecentStatusChange   float64  20224528
18       timestampMillisOfNmrDueToMinStableCrhTime   float64  20224528
19                         currentMultiGroupStatus  category   2528270
20                       currentModelingMultiGroup   float64  20224528
21             timestampMinuteOfFinalScoringOutput   float64  20224528
22  timestampMillisOfFirstNmrDueToMinStableCrhTime   float64  20224528
23                                  classification    object  20224528
INFO:birdwatch.run_scoring:userEnrollment total RAM: 77749221 bytes (0.078 GB)
                           column     dtype       RAM
0                   participantId    object  10912168
1                 enrollmentState    object  10912168
2  successfulRatingNeededToEarnIn     int64  10912168
3      timestampOfLastStateChange     int64  10912168
4          timestampOfLastEarnOut   float64  10912168
5              modelingPopulation  category   1364045
6                   modelingGroup   float64  10912168
7          numberOfTimesEarnedOut     int64  10912168
INFO:birdwatch.constants:Logging Prescoring Inputs RAM usage before _run_scorers elapsed time: 0.06 secs (0.00 mins)

INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFCoreWithTopicsScorer set to: 12
INFO:birdwatch.scorer:Filtering ratings for MFCoreWithTopicsScorer.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 3569825
INFO:birdwatch.scorer:MFCoreWithTopicsScorer Filter input elapsed time: 6.74 secs (0.11 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFCoreWithTopicsScorer: 2225481918d5509ff2340d8582050d8073f622c076082760b97f808e90c9664a
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 2387326, Num Unique Notes Rated: 30564, Num Unique Raters: 79773
INFO:birdwatch.scorer:MFCoreWithTopicsScorer Prepare ratings elapsed time: 2.58 secs (0.04 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFCoreWithTopicsScorer: 1d09ed02a9baf049007d80fbfd84dde03498aab5614def883dc6d3100100faf5
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFCoreWithTopicsScorer: a98b9575925fbdbc138fad20a54069ccbb0a2d5fa3b11835db1f34e65d093d9a
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFCoreWithTopicsScorer: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.scorer:MFCoreWithTopicsScorer Prepare data for stable initialization elapsed time: 2.38 secs (0.04 mins)
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:asyncio:Using selector: KqueueSelector
DEBUG:git.cmd:Popen(['git', 'version'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src, stdin=None, shell=False, universal_newlines=False)
DEBUG:git.cmd:Popen(['git', 'version'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src, stdin=None, shell=False, universal_newlines=False)
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 34974, Notes: 7236
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 70.7893864013267
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 14.646079945102075
INFO:birdwatch.matrix_factorization:epoch 0 7.387148857116699
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 6.902719020843506
INFO:birdwatch.matrix_factorization:epoch 20 0.25360020995140076
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.1918763518333435
INFO:birdwatch.matrix_factorization:epoch 40 0.10798897594213486
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0764286145567894
INFO:birdwatch.matrix_factorization:epoch 60 0.0838751420378685
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05744753032922745
INFO:birdwatch.matrix_factorization:epoch 80 0.08062388747930527
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.055016569793224335
INFO:birdwatch.matrix_factorization:epoch 100 0.08023521304130554
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05474657565355301
INFO:birdwatch.matrix_factorization:epoch 120 0.08018269389867783
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05468983203172684
INFO:birdwatch.matrix_factorization:Num epochs: 138
INFO:birdwatch.matrix_factorization:epoch 138 0.08017627894878387
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05465789884328842
INFO:birdwatch.matrix_factorization:Global Intercept: 0.13441401720046997
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFCoreWithTopicsScorer MF on stable-initialization subset elapsed time: 19.66 secs (0.33 mins)
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 79773, Notes: 30564
INFO:birdwatch.matrix_factorization:initializing notes

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py, in _initialize_parameters, at line 186: noteInit = self.noteIdMap.merge(
  PandasTypeError: Output mismatch on noteIndex_y: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:initialized global intercept
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 78.10908258081403
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 29.926491419402556
INFO:birdwatch.matrix_factorization:epoch 0 0.25705844163894653
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.21979321539402008
INFO:birdwatch.matrix_factorization:epoch 20 0.10502511262893677
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07685794681310654
INFO:birdwatch.matrix_factorization:epoch 40 0.09514170140028
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0670686885714531
INFO:birdwatch.matrix_factorization:epoch 60 0.09391570091247559
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06619906425476074
INFO:birdwatch.matrix_factorization:epoch 80 0.0937606543302536
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06595684587955475
INFO:birdwatch.matrix_factorization:epoch 100 0.09374047070741653
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06593357026576996
INFO:birdwatch.matrix_factorization:Num epochs: 113
INFO:birdwatch.matrix_factorization:epoch 113 0.09373831748962402
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06594521552324295
INFO:birdwatch.matrix_factorization:Global Intercept: 0.15628603100776672
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFCoreWithTopicsScorer First full MF (initializated with stable-initialization) elapsed time: 59.60 secs (0.99 mins)
INFO:birdwatch.scorer:MFCoreWithTopicsScorer First MF/stable init elapsed time: 81.91 secs (1.37 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFCoreWithTopicsScorer

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 2409631 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 9446 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.10 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.10 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.27 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.04 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.25 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.17 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.15 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.25 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 82.82 secs (1.38 mins)
INFO:birdwatch.scorer:MFCoreWithTopicsScorer Compute scored notes elapsed time: 120.50 secs (2.01 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 3553009 post-tombstones and 16816 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 2812635, including 2806823 post-tombstones and 5812 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 155667
INFO:birdwatch.scorer:MFCoreWithTopicsScorer Compute valid ratings elapsed time: 6.94 secs (0.12 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFCoreWithTopicsScorer Helpfulness scores pre-harassment  elapsed time: 0.73 secs (0.01 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 79773
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 95606
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 84172
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 37801
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 2387326
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 1422939
INFO:birdwatch.scorer:MFCoreWithTopicsScorer Filtering by helpfulness score elapsed time: 4.26 secs (0.07 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    838009
1     91183
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 491617
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 840539, Num Unique Notes Rated: 21503, Num Unique Raters: 28163
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    755228
1     85311
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.10149558795011296
INFO:birdwatch.matrix_factorization:Using pos weight: 8.852645028190972 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 28163, Notes: 21503
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 39.08938287680789
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 29.84550651564109
INFO:birdwatch.matrix_factorization:epoch 0 3.2111854553222656
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 1.325525164604187
INFO:birdwatch.matrix_factorization:epoch 20 0.6591897010803223
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3463476896286011
INFO:birdwatch.matrix_factorization:epoch 40 0.43735450506210327
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2838076949119568
INFO:birdwatch.matrix_factorization:epoch 60 0.40779098868370056
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.27353060245513916
INFO:birdwatch.matrix_factorization:epoch 80 0.40374475717544556
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2719639241695404
INFO:birdwatch.matrix_factorization:epoch 100 0.40320175886154175
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.27183085680007935
INFO:birdwatch.matrix_factorization:Num epochs: 114
INFO:birdwatch.matrix_factorization:epoch 114 0.4031478464603424
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.271793931722641
INFO:birdwatch.matrix_factorization:Global Intercept: -0.21107257902622223
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFCoreWithTopicsScorer Harassment tag consensus elapsed time: 24.71 secs (0.41 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFCoreWithTopicsScorer Helpfulness scores post-harassment elapsed time: 1.02 secs (0.02 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 79773
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 95606
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 83785
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 37414
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 2387326
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 1392391
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 37414, Notes: 30500
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 45.65216393442623
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 37.21577484364142
INFO:birdwatch.matrix_factorization:epoch 0 0.40734031796455383
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3419506549835205
INFO:birdwatch.matrix_factorization:epoch 20 0.09785997867584229
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06763100624084473
INFO:birdwatch.matrix_factorization:epoch 40 0.09265775233507156
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06558564305305481
INFO:birdwatch.matrix_factorization:epoch 60 0.09173251688480377
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06402065604925156
INFO:birdwatch.matrix_factorization:epoch 80 0.09161344170570374
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06359398365020752
INFO:birdwatch.matrix_factorization:epoch 100 0.09160248935222626
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06357777118682861
INFO:birdwatch.matrix_factorization:Num epochs: 101
INFO:birdwatch.matrix_factorization:epoch 101 0.09160248935222626
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06357777118682861
INFO:birdwatch.matrix_factorization:Global Intercept: 0.16073007881641388
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 38.83 secs (0.65 mins)
INFO:birdwatch.mf_base_scorer:In MFCoreWithTopicsScorer prescoring, about to call diligence with 1392391 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                      raterParticipantId  internalRaterFactor1
0      000045A5FA0CF004F68CBF2913506C37D540CF48522D33...             -0.583387
1      0002CA11E7127598E26C281F887129ADA2623C82BBCE8F...              0.432043
2      00055253971F408A7AB80D461A543E010EC67DFAF29C45...              0.612886
3      0007EFAB89EB0BCC18E8994B141F291F33C9CB80B9332E...             -0.111652
4      0008AA2B592A961E760CED75ED025B716C4F51956DDFD9...              0.164366
...                                                  ...                   ...
37409  FFF566C4AC6CDF855B2083DA2C7D9CF983135BCF167735...              0.626831
37410  FFF69D67772D36A4F36656044618362E9F92C97215AE48...             -0.537866
37411  FFFA49720F254411E1F79CA757C403F0A0217240BC4922...             -0.175231
37412  FFFEB058BCC25277E2662DD3E8C0506FB1B23BA4D965EA...              0.630560
37413  FFFF3B1E5FB7927B196BCC7753E5CE5B2E64AFA90099E0...             -0.211323

[37414 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 37414, vs. num we are initializing: 37414
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 37414
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=18.463394 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.672952 | time=7.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=3.217559 | time=15.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=3.150609 | time=22.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=3.131872 | time=29.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=3.123727 | time=37.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=3.119334 | time=44.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=3.116582 | time=53.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=3.114717 | time=61.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=3.113563 | time=70.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=3.112741 | time=78.8s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(0.6711, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=3.112720 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.835698 | time=8.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.826379 | time=16.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.825498 | time=24.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=100 | loss=1.825470 | time=28.2s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.368656 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.257023 | time=5.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.255660 | time=10.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=080 | loss=0.255596 | time=13.9s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(2.2322, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 3.1127, 1.8255, 0.2556
INFO:birdwatch.scorer:MFCoreWithTopicsScorer Low Diligence MF elapsed time: 123.74 secs (2.06 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 2409631 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 9446 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.10 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.10 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.22 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.25 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.17 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.16 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.26 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 93.61 secs (1.56 mins)
INFO:birdwatch.constants:MFCoreWithTopicsScorer: Compute tag thresholds for percentiles elapsed time: 7.28 secs (0.12 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 280: pd.DataFrame(columns=self.get_auxiliary_note_info_cols())
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFCoreScorer set to: 12
INFO:birdwatch.scorer:Filtering ratings for MFCoreScorer.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3662174
INFO:birdwatch.scorer:  Ratings without assigned group: 491
INFO:birdwatch.scorer:  Ratings after group filter: 3291769
INFO:birdwatch.scorer:MFCoreScorer Filter input elapsed time: 9.88 secs (0.16 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFCoreScorer: a2fbcfc41138f2e6b730b0b26cf7b1f09afac2a49c0e18c6c97c61709bca991f
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 2153132, Num Unique Notes Rated: 27775, Num Unique Raters: 73281
INFO:birdwatch.scorer:MFCoreScorer Prepare ratings elapsed time: 2.46 secs (0.04 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFCoreScorer: 890c420dafb12dc01f2db4c1994ec45acc5d31de1511d7b37060d234ad072e7d
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFCoreScorer: ad384f60b737285de5e8091e1c2f985eac3d7b58d7b77a2f1aff20f2adf11053
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFCoreScorer: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.scorer:MFCoreScorer Prepare data for stable initialization elapsed time: 2.56 secs (0.04 mins)
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 33031, Notes: 7078
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 70.6612037298672
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 15.141533710756562
INFO:birdwatch.matrix_factorization:epoch 0 7.4544901847839355
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 6.9690022468566895
INFO:birdwatch.matrix_factorization:epoch 20 0.2647331953048706
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2042839676141739
INFO:birdwatch.matrix_factorization:epoch 40 0.10406056046485901
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0714501217007637
INFO:birdwatch.matrix_factorization:epoch 60 0.0832405537366867
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05710765719413757
INFO:birdwatch.matrix_factorization:epoch 80 0.08066881448030472
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05490158870816231
INFO:birdwatch.matrix_factorization:epoch 100 0.08029674738645554
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05469343438744545
INFO:birdwatch.matrix_factorization:epoch 120 0.08024845272302628
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.054658710956573486
INFO:birdwatch.matrix_factorization:epoch 140 0.08024247735738754
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05465968698263168
INFO:birdwatch.matrix_factorization:Num epochs: 141
INFO:birdwatch.matrix_factorization:epoch 141 0.08024247735738754
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05465968698263168
INFO:birdwatch.matrix_factorization:Global Intercept: 0.1348271518945694
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFCoreScorer MF on stable-initialization subset elapsed time: 18.22 secs (0.30 mins)
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 73281, Notes: 27775
INFO:birdwatch.matrix_factorization:initializing notes

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py, in _initialize_parameters, at line 186: noteInit = self.noteIdMap.merge(
  PandasTypeError: Output mismatch on noteIndex_y: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:initialized global intercept
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 77.52050405040504
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 29.381858872013208
INFO:birdwatch.matrix_factorization:epoch 0 0.2568565309047699
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.21922807395458221
INFO:birdwatch.matrix_factorization:epoch 20 0.10343678295612335
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0751492977142334
INFO:birdwatch.matrix_factorization:epoch 40 0.0936812311410904
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06575413048267365
INFO:birdwatch.matrix_factorization:epoch 60 0.0924239307641983
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.064804308116436
INFO:birdwatch.matrix_factorization:epoch 80 0.09227094054222107
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06458265334367752
INFO:birdwatch.matrix_factorization:epoch 100 0.09225097298622131
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06456134468317032
INFO:birdwatch.matrix_factorization:Num epochs: 112
INFO:birdwatch.matrix_factorization:epoch 112 0.09224892407655716
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0645667165517807
INFO:birdwatch.matrix_factorization:Global Intercept: 0.15501604974269867
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFCoreScorer First full MF (initializated with stable-initialization) elapsed time: 53.92 secs (0.90 mins)
INFO:birdwatch.scorer:MFCoreScorer First MF/stable init elapsed time: 75.10 secs (1.25 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFCoreScorer

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 2173646 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 8764 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.12 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.10 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.24 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.04 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.26 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.15 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.10 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.34 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 81.86 secs (1.36 mins)
INFO:birdwatch.scorer:MFCoreScorer Compute scored notes elapsed time: 116.93 secs (1.95 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 3276066 post-tombstones and 15703 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 2600499, including 2594981 post-tombstones and 5518 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 138722
INFO:birdwatch.scorer:MFCoreScorer Compute valid ratings elapsed time: 6.86 secs (0.11 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFCoreScorer Helpfulness scores pre-harassment  elapsed time: 0.76 secs (0.01 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 73281
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 85619
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 75302
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 33471
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 2153132
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 1247951
INFO:birdwatch.scorer:MFCoreScorer Filtering by helpfulness score elapsed time: 3.70 secs (0.06 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    731039
1     81469
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 433446
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 732201, Num Unique Notes Rated: 19116, Num Unique Raters: 24726
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    656118
1     76083
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.10390999192844588
INFO:birdwatch.matrix_factorization:Using pos weight: 8.623713575963093 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 24726, Notes: 19116
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 38.30304456999372
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 29.612594030575103
INFO:birdwatch.matrix_factorization:epoch 0 3.178865432739258
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 1.2934479713439941
INFO:birdwatch.matrix_factorization:epoch 20 0.6528919339179993
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3392118513584137
INFO:birdwatch.matrix_factorization:epoch 40 0.43092888593673706
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.278083473443985
INFO:birdwatch.matrix_factorization:epoch 60 0.40112659335136414
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.26729094982147217
INFO:birdwatch.matrix_factorization:epoch 80 0.39709335565567017
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2658085525035858
INFO:birdwatch.matrix_factorization:epoch 100 0.3965464234352112
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2656598389148712
INFO:birdwatch.matrix_factorization:epoch 120 0.39647769927978516
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.26564961671829224
INFO:birdwatch.matrix_factorization:epoch 140 0.3964688181877136
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2656536102294922
INFO:birdwatch.matrix_factorization:Num epochs: 142
INFO:birdwatch.matrix_factorization:epoch 142 0.39646872878074646
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.26565396785736084
INFO:birdwatch.matrix_factorization:Global Intercept: -0.2082548290491104
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFCoreScorer Harassment tag consensus elapsed time: 26.92 secs (0.45 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFCoreScorer Helpfulness scores post-harassment elapsed time: 0.97 secs (0.02 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 73281
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 85619
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 74937
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 33106
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 2153132
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 1223209
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 33106, Notes: 27676
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 44.197463506287036
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 36.94825711351417
INFO:birdwatch.matrix_factorization:epoch 0 0.40878695249557495
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3438122272491455
INFO:birdwatch.matrix_factorization:epoch 20 0.09645822644233704
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0664953887462616
INFO:birdwatch.matrix_factorization:epoch 40 0.09100904315710068
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06411420553922653
INFO:birdwatch.matrix_factorization:epoch 60 0.09006410092115402
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06259419769048691
INFO:birdwatch.matrix_factorization:epoch 80 0.08993475139141083
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.062138061970472336
INFO:birdwatch.matrix_factorization:epoch 100 0.08992182463407516
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06214883551001549
INFO:birdwatch.matrix_factorization:Num epochs: 101
INFO:birdwatch.matrix_factorization:epoch 101 0.08992182463407516
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06214883551001549
INFO:birdwatch.matrix_factorization:Global Intercept: 0.1588379442691803
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 34.55 secs (0.58 mins)
INFO:birdwatch.mf_base_scorer:In MFCoreScorer prescoring, about to call diligence with 1223209 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                      raterParticipantId  internalRaterFactor1
0      000045A5FA0CF004F68CBF2913506C37D540CF48522D33...             -0.567787
1      0002CA11E7127598E26C281F887129ADA2623C82BBCE8F...              0.417801
2      00055253971F408A7AB80D461A543E010EC67DFAF29C45...              0.606578
3      0007EFAB89EB0BCC18E8994B141F291F33C9CB80B9332E...             -0.111338
4      0008AA2B592A961E760CED75ED025B716C4F51956DDFD9...              0.157617
...                                                  ...                   ...
33101  FFF22CB48A5F4C1C0F944C552973CE17979A4B2F5C225C...              0.515419
33102  FFF4C20F77FE6BBB23129254835E9257FC9F76BB7BF098...             -0.387807
33103  FFF566C4AC6CDF855B2083DA2C7D9CF983135BCF167735...              0.678566
33104  FFF69D67772D36A4F36656044618362E9F92C97215AE48...             -0.517200
33105  FFFF3B1E5FB7927B196BCC7753E5CE5B2E64AFA90099E0...             -0.260834

[33106 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 33106, vs. num we are initializing: 33106
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 33106
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=17.828825 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.632282 | time=7.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=3.198220 | time=13.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=3.132897 | time=20.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=3.114481 | time=26.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=3.106203 | time=33.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=3.101585 | time=40.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=3.098636 | time=47.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=3.096742 | time=54.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=3.095573 | time=60.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=3.094774 | time=67.6s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(0.6115, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=3.094744 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.814356 | time=6.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.804872 | time=12.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.803975 | time=19.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=100 | loss=1.803945 | time=21.4s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.368158 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.257488 | time=3.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.256125 | time=7.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=080 | loss=0.256060 | time=10.4s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(2.1750, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 3.0948, 1.8039, 0.2561
INFO:birdwatch.scorer:MFCoreScorer Low Diligence MF elapsed time: 102.56 secs (1.71 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 2173646 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 8764 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.09 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.21 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.23 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.10 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.16 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.33 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 80.51 secs (1.34 mins)
INFO:birdwatch.constants:MFCoreScorer: Compute tag thresholds for percentiles elapsed time: 6.03 secs (0.10 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFExpansionScorer set to: 12
INFO:birdwatch.scorer:Filtering ratings for MFExpansionScorer.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 3979420
INFO:birdwatch.scorer:MFExpansionScorer Filter input elapsed time: 6.61 secs (0.11 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFExpansionScorer: 68c66d6d968a99904637f35488aa65b8cf53da7169e413e4609fab1b9f5c0cb6
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 2568687, Num Unique Notes Rated: 32491, Num Unique Raters: 87649
INFO:birdwatch.scorer:MFExpansionScorer Prepare ratings elapsed time: 2.93 secs (0.05 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFExpansionScorer: d6a9575cf58ce0ec4570d5d6aaf9d6e69f6692472359e994309ae195efcd9006
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFExpansionScorer: a98b9575925fbdbc138fad20a54069ccbb0a2d5fa3b11835db1f34e65d093d9a
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFExpansionScorer: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.scorer:MFExpansionScorer Prepare data for stable initialization elapsed time: 2.31 secs (0.04 mins)
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 34449, Notes: 6329
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 65.86490756833624
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 12.100757641731255
INFO:birdwatch.matrix_factorization:epoch 0 7.371501922607422
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 6.888624668121338
INFO:birdwatch.matrix_factorization:epoch 20 0.24004855751991272
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.1828046590089798
INFO:birdwatch.matrix_factorization:epoch 40 0.10464775562286377
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07227075845003128
INFO:birdwatch.matrix_factorization:epoch 60 0.08342639356851578
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.057168714702129364
INFO:birdwatch.matrix_factorization:epoch 80 0.08058580756187439
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05503767356276512
INFO:birdwatch.matrix_factorization:epoch 100 0.08020643889904022
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.054720621556043625
INFO:birdwatch.matrix_factorization:epoch 120 0.08015578985214233
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05467984452843666
INFO:birdwatch.matrix_factorization:epoch 140 0.08014942705631256
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.054671771824359894
INFO:birdwatch.matrix_factorization:Num epochs: 142
INFO:birdwatch.matrix_factorization:epoch 142 0.080149345099926
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05467059835791588
INFO:birdwatch.matrix_factorization:Global Intercept: 0.13244161009788513
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFExpansionScorer MF on stable-initialization subset elapsed time: 14.35 secs (0.24 mins)
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 87649, Notes: 32491
INFO:birdwatch.matrix_factorization:initializing notes

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py, in _initialize_parameters, at line 186: noteInit = self.noteIdMap.merge(
  PandasTypeError: Output mismatch on noteIndex_y: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:initialized global intercept
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 79.05841617678742
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 29.30651804356011
INFO:birdwatch.matrix_factorization:epoch 0 0.2548655867576599
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2188296765089035
INFO:birdwatch.matrix_factorization:epoch 20 0.10590962320566177
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07777257263660431
INFO:birdwatch.matrix_factorization:epoch 40 0.09570536762475967
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06730838119983673
INFO:birdwatch.matrix_factorization:epoch 60 0.09446220099925995
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06659439206123352
INFO:birdwatch.matrix_factorization:epoch 80 0.0943029522895813
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0663851797580719
INFO:birdwatch.matrix_factorization:epoch 100 0.0942816436290741
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06635744124650955
INFO:birdwatch.matrix_factorization:Num epochs: 114
INFO:birdwatch.matrix_factorization:epoch 114 0.09427934885025024
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06636843085289001
INFO:birdwatch.matrix_factorization:Global Intercept: 0.1571125090122223
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFExpansionScorer First full MF (initializated with stable-initialization) elapsed time: 70.64 secs (1.18 mins)
INFO:birdwatch.scorer:MFExpansionScorer First MF/stable init elapsed time: 87.63 secs (1.46 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFExpansionScorer

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 2590566 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 10452 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.12 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.25 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.27 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.10 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.13 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.23 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 81.89 secs (1.36 mins)
INFO:birdwatch.scorer:MFExpansionScorer Compute scored notes elapsed time: 122.56 secs (2.04 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 3961906 post-tombstones and 17514 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 3138203, including 3132226 post-tombstones and 5977 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 174012
INFO:birdwatch.scorer:MFExpansionScorer Compute valid ratings elapsed time: 7.39 secs (0.12 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFExpansionScorer Helpfulness scores pre-harassment  elapsed time: 0.83 secs (0.01 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 87649
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 109671
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 97234
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 41527
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 2568687
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 1525726
INFO:birdwatch.scorer:MFExpansionScorer Filtering by helpfulness score elapsed time: 4.53 secs (0.08 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    903969
1     98366
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 521175
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 904737, Num Unique Notes Rated: 22929, Num Unique Raters: 30789
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    812862
1     91875
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.10154884789723423
INFO:birdwatch.matrix_factorization:Using pos weight: 8.847477551020408 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 30789, Notes: 22929
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 39.45819704304593
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 29.38507259086037
INFO:birdwatch.matrix_factorization:epoch 0 3.2234559059143066
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 1.3377399444580078
INFO:birdwatch.matrix_factorization:epoch 20 0.6614565849304199
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3481755554676056
INFO:birdwatch.matrix_factorization:epoch 40 0.4404066801071167
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2864830195903778
INFO:birdwatch.matrix_factorization:epoch 60 0.41070207953453064
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.275927871465683
INFO:birdwatch.matrix_factorization:epoch 80 0.4066794216632843
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.274363249540329
INFO:birdwatch.matrix_factorization:epoch 100 0.406131774187088
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.27421000599861145
INFO:birdwatch.matrix_factorization:Num epochs: 106
INFO:birdwatch.matrix_factorization:epoch 106 0.4061073660850525
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.27420124411582947
INFO:birdwatch.matrix_factorization:Global Intercept: -0.21113081276416779
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFExpansionScorer Harassment tag consensus elapsed time: 24.41 secs (0.41 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFExpansionScorer Helpfulness scores post-harassment elapsed time: 1.13 secs (0.02 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 87649
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 109671
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 96809
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 41102
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 2568687
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 1493062
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 41102, Notes: 32413
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 46.06367815382717
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 36.32577490146465
INFO:birdwatch.matrix_factorization:epoch 0 0.4058673679828644
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.34019026160240173
INFO:birdwatch.matrix_factorization:epoch 20 0.09808224439620972
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0676530972123146
INFO:birdwatch.matrix_factorization:epoch 40 0.0931473970413208
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06589715927839279
INFO:birdwatch.matrix_factorization:epoch 60 0.09224513918161392
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06434513628482819
INFO:birdwatch.matrix_factorization:epoch 80 0.09213179349899292
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0639314204454422
INFO:birdwatch.matrix_factorization:epoch 100 0.09212160110473633
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06390561163425446
INFO:birdwatch.matrix_factorization:Num epochs: 101
INFO:birdwatch.matrix_factorization:epoch 101 0.09212160110473633
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06390561163425446
INFO:birdwatch.matrix_factorization:Global Intercept: 0.1621260643005371
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 42.60 secs (0.71 mins)
INFO:birdwatch.mf_base_scorer:In MFExpansionScorer prescoring, about to call diligence with 1493062 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                      raterParticipantId  internalRaterFactor1
0      000045A5FA0CF004F68CBF2913506C37D540CF48522D33...             -0.585114
1      0002CA11E7127598E26C281F887129ADA2623C82BBCE8F...              0.418098
2      00037E5A04D7781E19E5AAF559E14512FF17E7F76C30AF...             -0.400686
3      00055253971F408A7AB80D461A543E010EC67DFAF29C45...              0.610896
4      0007EFAB89EB0BCC18E8994B141F291F33C9CB80B9332E...             -0.133240
...                                                  ...                   ...
41097  FFF7EDDCE3F147B1B3350D639AA98CAA36412F88FA9084...              0.440019
41098  FFFA49720F254411E1F79CA757C403F0A0217240BC4922...             -0.176237
41099  FFFE3234F03ED7E6F39F6799E38C7C146F849346F295D9...             -0.555749
41100  FFFEB058BCC25277E2662DD3E8C0506FB1B23BA4D965EA...              0.624200
41101  FFFF3B1E5FB7927B196BCC7753E5CE5B2E64AFA90099E0...             -0.210322

[41102 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 41102, vs. num we are initializing: 41102
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 41102
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=18.331303 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.661290 | time=8.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=3.213014 | time=16.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=3.148002 | time=23.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=3.130180 | time=31.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=3.122459 | time=39.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=3.118249 | time=47.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=3.115476 | time=55.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=3.113795 | time=63.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=3.112740 | time=72.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=3.112052 | time=80.0s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(0.6680, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=3.112034 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.833526 | time=8.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.824404 | time=15.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.823493 | time=24.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=100 | loss=1.823465 | time=26.7s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.369978 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.257171 | time=4.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.255805 | time=9.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=080 | loss=0.255740 | time=12.8s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(2.2440, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 3.1121, 1.8235, 0.2557
INFO:birdwatch.scorer:MFExpansionScorer Low Diligence MF elapsed time: 122.09 secs (2.03 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 2590566 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 10452 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.11 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.10 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.30 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.04 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.28 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.21 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.18 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.28 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 80.50 secs (1.34 mins)
INFO:birdwatch.constants:MFExpansionScorer: Compute tag thresholds for percentiles elapsed time: 7.31 secs (0.12 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFExpansionPlusScorer set to: 12
INFO:birdwatch.scorer:Filtering ratings for MFExpansionPlusScorer.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 3988042
INFO:birdwatch.scorer:MFExpansionPlusScorer Filter input elapsed time: 6.25 secs (0.10 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFExpansionPlusScorer: 608faef1700c88e9481d1a67c004cd1862b618a8a597c5b8f6a57ce19027a9c0
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 2570017, Num Unique Notes Rated: 32497, Num Unique Raters: 87730
INFO:birdwatch.scorer:MFExpansionPlusScorer Prepare ratings elapsed time: 2.96 secs (0.05 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFExpansionPlusScorer: 6f6712e1dba215318d2e473399c6e2441baf59d384e73c5921d70b8262ae7107
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFExpansionPlusScorer: a98b9575925fbdbc138fad20a54069ccbb0a2d5fa3b11835db1f34e65d093d9a
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFExpansionPlusScorer: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.scorer:MFExpansionPlusScorer Prepare data for stable initialization elapsed time: 2.30 secs (0.04 mins)
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 34447, Notes: 6326
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 65.84065760354095
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 12.091270647661625
INFO:birdwatch.matrix_factorization:epoch 0 7.3561482429504395
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 6.873262405395508
INFO:birdwatch.matrix_factorization:epoch 20 0.2568846344947815
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18965131044387817
INFO:birdwatch.matrix_factorization:epoch 40 0.10442166030406952
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07194681465625763
INFO:birdwatch.matrix_factorization:epoch 60 0.08337802439928055
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05710297077894211
INFO:birdwatch.matrix_factorization:epoch 80 0.08058501780033112
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.054972656071186066
INFO:birdwatch.matrix_factorization:epoch 100 0.08019702881574631
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05470253899693489
INFO:birdwatch.matrix_factorization:epoch 120 0.08014734834432602
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0546671524643898
INFO:birdwatch.matrix_factorization:epoch 140 0.08014120161533356
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.054666295647621155
INFO:birdwatch.matrix_factorization:Num epochs: 142
INFO:birdwatch.matrix_factorization:epoch 142 0.0801411122083664
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05466439574956894
INFO:birdwatch.matrix_factorization:Global Intercept: 0.13237826526165009
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFExpansionPlusScorer MF on stable-initialization subset elapsed time: 14.33 secs (0.24 mins)
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 87730, Notes: 32497
INFO:birdwatch.matrix_factorization:initializing notes

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py, in _initialize_parameters, at line 186: noteInit = self.noteIdMap.merge(
  PandasTypeError: Output mismatch on noteIndex_y: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:initialized global intercept
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 79.0847462842724
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 29.294619856377523
INFO:birdwatch.matrix_factorization:epoch 0 0.25497907400131226
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.21895258128643036
INFO:birdwatch.matrix_factorization:epoch 20 0.10591988265514374
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07778559625148773
INFO:birdwatch.matrix_factorization:epoch 40 0.09570974856615067
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06731139868497849
INFO:birdwatch.matrix_factorization:epoch 60 0.09446760267019272
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06659810990095139
INFO:birdwatch.matrix_factorization:epoch 80 0.09430816769599915
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06638984382152557
INFO:birdwatch.matrix_factorization:epoch 100 0.09428687393665314
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06636197865009308
INFO:birdwatch.matrix_factorization:Num epochs: 114
INFO:birdwatch.matrix_factorization:epoch 114 0.09428457170724869
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06637290120124817
INFO:birdwatch.matrix_factorization:Global Intercept: 0.15712369978427887
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFExpansionPlusScorer First full MF (initializated with stable-initialization) elapsed time: 63.63 secs (1.06 mins)
INFO:birdwatch.scorer:MFExpansionPlusScorer First MF/stable init elapsed time: 80.52 secs (1.34 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFExpansionPlusScorer

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 2591889 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 10466 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.13 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.10 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.21 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.04 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.28 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.13 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.17 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.27 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 86.80 secs (1.45 mins)
INFO:birdwatch.scorer:MFExpansionPlusScorer Compute scored notes elapsed time: 122.97 secs (2.05 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 3970525 post-tombstones and 17517 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 3144126, including 3138149 post-tombstones and 5977 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 174220
INFO:birdwatch.scorer:MFExpansionPlusScorer Compute valid ratings elapsed time: 7.67 secs (0.13 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFExpansionPlusScorer Helpfulness scores pre-harassment  elapsed time: 0.89 secs (0.01 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 87730
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 109943
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 97464
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 41552
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 2570017
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 1526070
INFO:birdwatch.scorer:MFExpansionPlusScorer Filtering by helpfulness score elapsed time: 4.53 secs (0.08 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    904168
1     98383
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 521303
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 904825, Num Unique Notes Rated: 22930, Num Unique Raters: 30796
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    812938
1     91887
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.10155223385737573
INFO:birdwatch.matrix_factorization:Using pos weight: 8.847149215884729 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 30796, Notes: 22930
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 39.46031399912778
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 29.38125081179374
INFO:birdwatch.matrix_factorization:epoch 0 3.223371744155884
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 1.3376353979110718
INFO:birdwatch.matrix_factorization:epoch 20 0.6614506244659424
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3481869697570801
INFO:birdwatch.matrix_factorization:epoch 40 0.4403996467590332
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2864972949028015
INFO:birdwatch.matrix_factorization:epoch 60 0.41069459915161133
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.27590832114219666
INFO:birdwatch.matrix_factorization:epoch 80 0.4066691994667053
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2743512988090515
INFO:birdwatch.matrix_factorization:epoch 100 0.40611711144447327
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.27419012784957886
INFO:birdwatch.matrix_factorization:epoch 120 0.40604618191719055
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.27414819598197937
INFO:birdwatch.matrix_factorization:Num epochs: 133
INFO:birdwatch.matrix_factorization:epoch 133 0.40603941679000854
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2741505801677704
INFO:birdwatch.matrix_factorization:Global Intercept: -0.2110288292169571
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFExpansionPlusScorer Harassment tag consensus elapsed time: 31.09 secs (0.52 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFExpansionPlusScorer Helpfulness scores post-harassment elapsed time: 1.11 secs (0.02 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 87730
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 109943
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 97039
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 41127
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 2570017
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 1493405
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 41127, Notes: 32419
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 46.065733057774764
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 36.31203345733946
INFO:birdwatch.matrix_factorization:epoch 0 0.40587204694747925
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.34019726514816284
INFO:birdwatch.matrix_factorization:epoch 20 0.09808476269245148
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06765652447938919
INFO:birdwatch.matrix_factorization:epoch 40 0.0931519940495491
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06590182334184647
INFO:birdwatch.matrix_factorization:epoch 60 0.09224933385848999
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06434964388608932
INFO:birdwatch.matrix_factorization:epoch 80 0.09213580191135406
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06393589824438095
INFO:birdwatch.matrix_factorization:epoch 100 0.09212559461593628
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06391005218029022
INFO:birdwatch.matrix_factorization:Num epochs: 101
INFO:birdwatch.matrix_factorization:epoch 101 0.09212559461593628
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06391005218029022
INFO:birdwatch.matrix_factorization:Global Intercept: 0.16212782263755798
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 41.68 secs (0.69 mins)
INFO:birdwatch.mf_base_scorer:In MFExpansionPlusScorer prescoring, about to call diligence with 1493405 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                      raterParticipantId  internalRaterFactor1
0      000045A5FA0CF004F68CBF2913506C37D540CF48522D33...             -0.585163
1      0002CA11E7127598E26C281F887129ADA2623C82BBCE8F...              0.417905
2      00037E5A04D7781E19E5AAF559E14512FF17E7F76C30AF...             -0.400755
3      00055253971F408A7AB80D461A543E010EC67DFAF29C45...              0.610718
4      0007EFAB89EB0BCC18E8994B141F291F33C9CB80B9332E...             -0.134814
...                                                  ...                   ...
41122  FFF7EDDCE3F147B1B3350D639AA98CAA36412F88FA9084...              0.439938
41123  FFFA49720F254411E1F79CA757C403F0A0217240BC4922...             -0.176408
41124  FFFE3234F03ED7E6F39F6799E38C7C146F849346F295D9...             -0.555723
41125  FFFEB058BCC25277E2662DD3E8C0506FB1B23BA4D965EA...              0.623871
41126  FFFF3B1E5FB7927B196BCC7753E5CE5B2E64AFA90099E0...             -0.209485

[41127 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 41127, vs. num we are initializing: 41127
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 41127
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=18.774017 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.688152 | time=8.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=3.221143 | time=16.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=3.152192 | time=24.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=3.133027 | time=32.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=3.124379 | time=40.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=3.119571 | time=48.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=3.116706 | time=56.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=3.114908 | time=65.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=3.113673 | time=73.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=3.112849 | time=81.1s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(0.6922, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=3.112825 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.834627 | time=8.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.825371 | time=15.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.824450 | time=25.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=100 | loss=1.824421 | time=28.3s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.370145 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.257093 | time=5.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.255723 | time=10.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=080 | loss=0.255658 | time=13.9s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(2.2483, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 3.1128, 1.8244, 0.2557
INFO:birdwatch.scorer:MFExpansionPlusScorer Low Diligence MF elapsed time: 125.93 secs (2.10 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 2591889 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 10466 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.60 secs (0.03 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.10 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.37 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.04 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.28 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.15 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.18 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.33 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 82.04 secs (1.37 mins)
INFO:birdwatch.constants:MFExpansionPlusScorer: Compute tag thresholds for percentiles elapsed time: 7.29 secs (0.12 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for ReputationScorer set to: 12
INFO:birdwatch.scorer:Filtering ratings for ReputationScorer.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 3569825
INFO:birdwatch.scorer:ReputationScorer Filter input elapsed time: 7.40 secs (0.12 mins)
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 2387326, Num Unique Notes Rated: 30564, Num Unique Raters: 79773
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 34974, Notes: 7236
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 70.7893864013267
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 14.646079945102075
INFO:birdwatch.matrix_factorization:epoch 0 7.465810775756836
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 6.981651782989502
INFO:birdwatch.matrix_factorization:epoch 20 0.25741124153137207
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.20326276123523712
INFO:birdwatch.matrix_factorization:epoch 40 0.10595552623271942
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07590935379266739
INFO:birdwatch.matrix_factorization:epoch 60 0.08378776907920837
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05760422348976135
INFO:birdwatch.matrix_factorization:epoch 80 0.08064998686313629
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.055072810500860214
INFO:birdwatch.matrix_factorization:epoch 100 0.08023624122142792
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05469633638858795
INFO:birdwatch.matrix_factorization:epoch 120 0.08018282055854797
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05465840920805931
INFO:birdwatch.matrix_factorization:epoch 140 0.0801759660243988
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05466019734740257
INFO:birdwatch.matrix_factorization:Num epochs: 142
INFO:birdwatch.matrix_factorization:epoch 142 0.08017589151859283
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05466526374220848
INFO:birdwatch.matrix_factorization:Global Intercept: 0.13451671600341797
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
                   noteId  internalNoteFactor1
0     1377281345605472256            -0.563577
1     1379042834678870019             0.412760
2     1411136229035417602             0.374512
3     1417506709489266699             0.399998
4     1423432584806256647             0.272299
...                   ...                  ...
7231  1798345473138544767            -0.094190
7232  1969698945199755326             0.232591
7233  1859577066997387538            -0.151696
7234  1829342583304425781             0.163878
7235  2000203513532432641             0.061648

[7236 rows x 2 columns],
 raterInitState: 
                                      raterParticipantId  internalRaterFactor1
0      65F687F3F0BE41BB456A883BA989742AB6F9566B731F75...              0.808434
1      D6602F91F0E36E0C5230FB766CF1529E6FB5FC677DCB17...              0.744768
2      5926E5D40EA0EE16FE23941EADF05B78DEFDFD84D1DBEB...              0.553099
3      04243FCEE3704BBA1846E5009F2BA03EE36A98C381FDA4...             -0.548702
4      0BD47C7568154F38C2A90F1A2A9A7573F52415E24DBE18...             -0.572287
...                                                  ...                   ...
34969  D929B80B5FF339ADA3FC081819C60FFEC537198A452CBF...             -0.627116
34970  7D7BAA5B227CBB1058E05356F5A8CA9BD8F35691C4E0D1...             -0.422732
34971  0EFB6486B1D3907CB10E4D8A6B90203203502612790465...             -0.535010
34972  C268312EBE067A1C280DEB03FBC6A727879EFD4F97AEDE...             -0.423371
34973  661124877CA60A5DFE80D04DE9F9A9563C563C84B22D55...             -0.530735

[34974 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 79773, vs. num we are initializing: 34974
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 44799
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 34974
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Initializing internalNoteFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 30564, vs. num we are initializing: 7236
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalNoteFactor1s: 29406
INFO:birdwatch.reputation_matrix_factorization:  initialized internalNoteFactor1s: 1158
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.296850 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.023741 | time=12.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.019735 | time=24.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=0.019550 | time=36.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=0.019541 | time=48.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=0.019541 | time=60.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=0.019541 | time=60.7s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(0.4035, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.116235 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.071817 | time=11.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.069983 | time=23.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=0.069879 | time=35.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=0.069871 | time=47.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=0.069870 | time=58.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=160 | loss=0.069870 | time=62.9s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.006048 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.005630 | time=7.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.005514 | time=14.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=0.005507 | time=21.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=110 | loss=0.005506 | time=25.9s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(0.5948, requires_grad=True)
INFO:birdwatch.helpfulness_model:Helpfulness reputation loss: 0.0195, 0.0699, 0.0055

CONCAT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/reputation_scorer.py, in _prescore_notes_and_users, at line 147: noteStats = noteStats.merge(noteStatusHistory[[c.noteIdKey]].drop_duplicates(), how="outer")
  PandasTypeError: Type expectation mismatch on noteId: found=float64 expected=int64
  PandasTypeError: Type expectation mismatch on noteId: found=float64 expected=int64

INFO:birdwatch.reputation_scorer:Reputation prescoring: returning these columns:
          noteStats: Index(['noteId', 'internalNoteIntercept', 'internalNoteFactor1',
       'lowDiligenceNoteInterceptRound2'],
      dtype='object')
          raterStats: Index(['raterParticipantId', 'internalRaterReputation',
       'internalRaterIntercept', 'internalRaterFactor1',
       'lowDiligenceRaterInterceptRound2'],
      dtype='object')
          

INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_13 set to: 8
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_13.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 1632387
INFO:birdwatch.scorer:MFGroupScorer_13 Filter input elapsed time: 4.64 secs (0.08 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_13: 8590ad518d30011e5c9e2c1864ed165783fc480031268e45a6af994c42c9f150
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 1190040, Num Unique Notes Rated: 18279, Num Unique Raters: 35248
INFO:birdwatch.scorer:MFGroupScorer_13 Prepare ratings elapsed time: 1.11 secs (0.02 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_13: 2d485429ac6bd5ac86a83949ba4cc0e8de812f92482c4ce8e2519dc7cf74151f
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_13: a98b9575925fbdbc138fad20a54069ccbb0a2d5fa3b11835db1f34e65d093d9a
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_13: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 35248, Notes: 18279
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 65.10421795503036
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 33.76191556967771
INFO:birdwatch.matrix_factorization:epoch 0 7.428566932678223
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 6.949489116668701
INFO:birdwatch.matrix_factorization:epoch 20 0.28496789932250977
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2310085892677307
INFO:birdwatch.matrix_factorization:epoch 40 0.1142917051911354
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.08295097947120667
INFO:birdwatch.matrix_factorization:epoch 60 0.09226186573505402
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06560692191123962
INFO:birdwatch.matrix_factorization:epoch 80 0.08933478593826294
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0630941390991211
INFO:birdwatch.matrix_factorization:epoch 100 0.0889703780412674
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06297586113214493
INFO:birdwatch.matrix_factorization:epoch 120 0.08892181515693665
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06289804726839066
INFO:birdwatch.matrix_factorization:Num epochs: 139
INFO:birdwatch.matrix_factorization:epoch 139 0.08891576528549194
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06288058310747147
INFO:birdwatch.matrix_factorization:Global Intercept: 0.142846941947937
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_13 First MF/stable init elapsed time: 33.57 secs (0.56 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_13

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 1211005 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 2282 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.10 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.10 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.22 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.29 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.18 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.11 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.26 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 80.08 secs (1.33 mins)
INFO:birdwatch.scorer:MFGroupScorer_13 Compute scored notes elapsed time: 111.00 secs (1.85 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 1616669 post-tombstones and 15718 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 1312448, including 1306649 post-tombstones and 5799 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 48944
INFO:birdwatch.scorer:MFGroupScorer_13 Compute valid ratings elapsed time: 3.69 secs (0.06 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_13 Helpfulness scores pre-harassment  elapsed time: 0.34 secs (0.01 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 35248
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 34721
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 28748
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 15141
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 1190040
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 682383
INFO:birdwatch.scorer:MFGroupScorer_13 Filtering by helpfulness score elapsed time: 1.90 secs (0.03 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    339065
1     57119
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 284153
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 352110, Num Unique Notes Rated: 11916, Num Unique Raters: 10753
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    298909
1     53201
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.15109198829911108
INFO:birdwatch.matrix_factorization:Using pos weight: 5.618484614950846 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 10753, Notes: 11916
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 29.54934541792548
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 32.74528038686878
INFO:birdwatch.matrix_factorization:epoch 0 3.0774569511413574
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 1.200136661529541
INFO:birdwatch.matrix_factorization:epoch 20 0.6247965097427368
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3314635753631592
INFO:birdwatch.matrix_factorization:epoch 40 0.4198344051837921
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2705921530723572
INFO:birdwatch.matrix_factorization:epoch 60 0.39184796810150146
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2609643340110779
INFO:birdwatch.matrix_factorization:epoch 80 0.38811343908309937
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.26005053520202637
INFO:birdwatch.matrix_factorization:epoch 100 0.3876214325428009
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.25982341170310974
INFO:birdwatch.matrix_factorization:epoch 120 0.3875575065612793
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2597878873348236
INFO:birdwatch.matrix_factorization:Num epochs: 132
INFO:birdwatch.matrix_factorization:epoch 132 0.3875519633293152
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.25978773832321167
INFO:birdwatch.matrix_factorization:Global Intercept: -0.20771141350269318
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_13 Harassment tag consensus elapsed time: 11.22 secs (0.19 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_13 Helpfulness scores post-harassment elapsed time: 0.49 secs (0.01 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 35248
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 34721
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 28744
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 15137
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 1190040
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 681953
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 15137, Notes: 18265
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 37.33660005474952
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 45.05205787144084
INFO:birdwatch.matrix_factorization:epoch 0 0.40835434198379517
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.34729069471359253
INFO:birdwatch.matrix_factorization:epoch 20 0.09596562385559082
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06769030541181564
INFO:birdwatch.matrix_factorization:epoch 40 0.08839978277683258
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06319670379161835
INFO:birdwatch.matrix_factorization:epoch 60 0.08716136962175369
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06135861948132515
INFO:birdwatch.matrix_factorization:epoch 80 0.08701231330633163
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.060732025653123856
INFO:birdwatch.matrix_factorization:epoch 100 0.08698677271604538
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.060847099870443344
INFO:birdwatch.matrix_factorization:Num epochs: 103
INFO:birdwatch.matrix_factorization:epoch 103 0.08698499202728271
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.060832202434539795
INFO:birdwatch.matrix_factorization:Global Intercept: 0.14282670617103577
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 19.40 secs (0.32 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_13 prescoring, about to call diligence with 681953 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                      raterParticipantId  internalRaterFactor1
0      000045A5FA0CF004F68CBF2913506C37D540CF48522D33...             -0.524159
1      0002CA11E7127598E26C281F887129ADA2623C82BBCE8F...              0.498517
2      000A152E7173AF94A55928A9BC0D120701A1828BB59A29...             -0.275679
3      001226CEFA7FAA022C825459EF0731988DB66BA000D0C3...              0.565592
4      001A1BA9FBE62859A450D0A6BAE39DFB47CE649A9E154F...              0.549207
...                                                  ...                   ...
15132  FFE869D51FD64C9E02044A8625A73BFAA6BF5C28643BDC...             -0.393215
15133  FFEE86876559D283E86FFD2DCE8ED8D612D9E8D7E92E83...             -0.420000
15134  FFF0E85D4BAF243215A303AAF08A06FCF54B3E4DA68D13...              0.712049
15135  FFF566C4AC6CDF855B2083DA2C7D9CF983135BCF167735...              0.647284
15136  FFF69D67772D36A4F36656044618362E9F92C97215AE48...             -0.472995

[15137 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 15137, vs. num we are initializing: 15137
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 15137
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=21.869461 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.957748 | time=3.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=3.411473 | time=6.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=3.333158 | time=10.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=3.311699 | time=13.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=3.302392 | time=17.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=3.297453 | time=20.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=3.294520 | time=24.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=3.292687 | time=28.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=3.291421 | time=33.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=3.290601 | time=37.4s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(0.9650, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=3.290579 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=2.010324 | time=3.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.000912 | time=7.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.000046 | time=11.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=100 | loss=2.000018 | time=13.0s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.356760 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.252938 | time=2.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.251672 | time=4.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=080 | loss=0.251614 | time=6.6s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(2.3650, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 3.2906, 2.0000, 0.2516
INFO:birdwatch.scorer:MFGroupScorer_13 Low Diligence MF elapsed time: 58.24 secs (0.97 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 1211005 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 2282 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.09 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.20 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.23 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.09 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.16 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.31 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 80.12 secs (1.34 mins)
INFO:birdwatch.constants:MFGroupScorer_13: Compute tag thresholds for percentiles elapsed time: 2.83 secs (0.05 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_12 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_12.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 16394
INFO:birdwatch.scorer:MFGroupScorer_12 Filter input elapsed time: 5.42 secs (0.09 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_12: 50375f737684e02ad29f6804d5cfdce1bfa1749a2a1f1110052d5cb7e298ffca
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 704, Num Unique Notes Rated: 71, Num Unique Raters: 109
INFO:birdwatch.scorer:MFGroupScorer_12 Prepare ratings elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_12: b3d3a8a30c6d55b6ea7f2462fd524b92583017393068d9e7c2ba903fbc54271c
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_12: a98b9575925fbdbc138fad20a54069ccbb0a2d5fa3b11835db1f34e65d093d9a
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_12: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 109, Notes: 71
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 9.915492957746478
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 6.458715596330276
INFO:birdwatch.matrix_factorization:epoch 0 6.500573635101318
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 5.9963836669921875
INFO:birdwatch.matrix_factorization:epoch 20 0.2792890965938568
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.1957656741142273
INFO:birdwatch.matrix_factorization:epoch 40 0.10283002257347107
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05494309589266777
INFO:birdwatch.matrix_factorization:epoch 60 0.07180007547140121
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03168465197086334
INFO:birdwatch.matrix_factorization:epoch 80 0.05792555212974548
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.022397678345441818
INFO:birdwatch.matrix_factorization:epoch 100 0.0569845549762249
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.021333880722522736
INFO:birdwatch.matrix_factorization:Num epochs: 107
INFO:birdwatch.matrix_factorization:epoch 107 0.056788183748722076
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.02125968039035797
INFO:birdwatch.matrix_factorization:Global Intercept: 0.15403220057487488
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_12 First MF/stable init elapsed time: 0.46 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_12

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 3334 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 26 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.14 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.18 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.12 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.10 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.09 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.16 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 79.52 secs (1.33 mins)
INFO:birdwatch.scorer:MFGroupScorer_12 Compute scored notes elapsed time: 102.02 secs (1.70 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 16391 post-tombstones and 3 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 13328, including 13328 post-tombstones and 0 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 6
INFO:birdwatch.scorer:MFGroupScorer_12 Compute valid ratings elapsed time: 1.35 secs (0.02 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_12 Helpfulness scores pre-harassment  elapsed time: 0.12 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 109
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 46
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 6
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 2
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 704
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 17
INFO:birdwatch.scorer:MFGroupScorer_12 Filtering by helpfulness score elapsed time: 0.01 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    9
1    2
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 6
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 0, Num Unique Notes Rated: 0, Num Unique Raters: 0
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown Series([], dtype: int64)
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:No valid data for notHelpfulSpamHarassmentOrAbuse, returning None and aborting notHelpfulSpamHarassmentOrAbuse model training.
INFO:birdwatch.scorer:MFGroupScorer_12 Harassment tag consensus elapsed time: 0.02 secs (0.00 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_12 Helpfulness scores post-harassment elapsed time: 0.12 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 109
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 46
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 6
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 2
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 704
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 17
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 2, Notes: 17
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 1.0
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 8.5
INFO:birdwatch.matrix_factorization:epoch 0 0.3173622488975525
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2392100691795349
INFO:birdwatch.matrix_factorization:epoch 20 0.04972050338983536
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.019128555431962013
INFO:birdwatch.matrix_factorization:epoch 40 0.03324723243713379
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.002617892576381564
INFO:birdwatch.matrix_factorization:epoch 60 0.03214861452579498
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0016058944165706635
INFO:birdwatch.matrix_factorization:epoch 80 0.03186158463358879
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0007899397751316428
INFO:birdwatch.matrix_factorization:epoch 100 0.03183925524353981
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0009470785735175014
INFO:birdwatch.matrix_factorization:Num epochs: 103
INFO:birdwatch.matrix_factorization:epoch 103 0.031840283423662186
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.00087227817857638
INFO:birdwatch.matrix_factorization:Global Intercept: 0.10801364481449127
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 0.36 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_12 prescoring, about to call diligence with 17 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                  raterParticipantId  internalRaterFactor1
0  1E88DDB7C7065B2F4FCA4D453A3B3E28E1792E6DA91504...             -0.607437
1  800A625468F03893CA64F6967F8E9751D9D7E2567E913C...             -0.590868
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 2, vs. num we are initializing: 2
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 2
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=35.253670 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=2.439836 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.020218 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.877816 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=1.845431 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=1.837564 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=1.834872 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=1.833260 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=1.832134 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=1.831334 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=1.830744 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(1.7382, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=1.830727 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.392096 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.392260 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=0.390689 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=110 | loss=0.390617 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.348784 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.311698 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.311055 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=070 | loss=0.311034 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(0.3141, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 1.8307, 0.3906, 0.3110
INFO:birdwatch.scorer:MFGroupScorer_12 Low Diligence MF elapsed time: 0.75 secs (0.01 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 3334 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 26 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.14 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.17 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.18 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.05 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.10 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.14 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 79.49 secs (1.32 mins)
INFO:birdwatch.constants:MFGroupScorer_12: Compute tag thresholds for percentiles elapsed time: 0.12 secs (0.00 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_11 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_11.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 46957
INFO:birdwatch.scorer:MFGroupScorer_11 Filter input elapsed time: 4.63 secs (0.08 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_11: 206e35389df7cbca14c387fe614ca0d97d617a18b65d6a1537daaeca6a6981ac
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 13185, Num Unique Notes Rated: 1377, Num Unique Raters: 724
INFO:birdwatch.scorer:MFGroupScorer_11 Prepare ratings elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_11: 2d0eefdc38b0649622ea950efcd43099e12457993d8b01240dad0a29263258c0
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_11: a98b9575925fbdbc138fad20a54069ccbb0a2d5fa3b11835db1f34e65d093d9a
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_11: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 724, Notes: 1377
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 9.57516339869281
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 18.21132596685083
INFO:birdwatch.matrix_factorization:epoch 0 7.721789836883545
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 7.2154011726379395
INFO:birdwatch.matrix_factorization:epoch 20 0.23193830251693726
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18136826157569885
INFO:birdwatch.matrix_factorization:epoch 40 0.1046774610877037
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06485172361135483
INFO:birdwatch.matrix_factorization:epoch 60 0.0857657641172409
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05080437287688255
INFO:birdwatch.matrix_factorization:epoch 80 0.08326934278011322
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04910998418927193
INFO:birdwatch.matrix_factorization:epoch 100 0.08294603228569031
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04879079386591911
INFO:birdwatch.matrix_factorization:epoch 120 0.08290435373783112
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04869115725159645
INFO:birdwatch.matrix_factorization:Num epochs: 134
INFO:birdwatch.matrix_factorization:epoch 134 0.08289997279644012
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04870820790529251
INFO:birdwatch.matrix_factorization:Global Intercept: 0.15584923326969147
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_11 First MF/stable init elapsed time: 1.10 secs (0.02 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_11

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 25533 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 44 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.12 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.18 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.19 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.12 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.10 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.21 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 90.44 secs (1.51 mins)
INFO:birdwatch.scorer:MFGroupScorer_11 Compute scored notes elapsed time: 114.80 secs (1.91 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 46915 post-tombstones and 42 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 37824, including 37824 post-tombstones and 0 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 1433
INFO:birdwatch.scorer:MFGroupScorer_11 Compute valid ratings elapsed time: 2.28 secs (0.04 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_11 Helpfulness scores pre-harassment  elapsed time: 0.12 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 724
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 1658
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 909
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 378
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 13185
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 8529
INFO:birdwatch.scorer:MFGroupScorer_11 Filtering by helpfulness score elapsed time: 0.03 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    4683
1     507
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 3339
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 941, Num Unique Notes Rated: 138, Num Unique Raters: 94
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    885
1     56
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.05951115834218916
INFO:birdwatch.matrix_factorization:Using pos weight: 15.803571428571429 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 94, Notes: 138
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 6.818840579710145
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 10.01063829787234
INFO:birdwatch.matrix_factorization:epoch 0 3.058199644088745
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 1.1918798685073853
INFO:birdwatch.matrix_factorization:epoch 20 0.6925482153892517
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.297362744808197
INFO:birdwatch.matrix_factorization:epoch 40 0.4584226608276367
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.25137367844581604
INFO:birdwatch.matrix_factorization:epoch 60 0.40861034393310547
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.21771450340747833
INFO:birdwatch.matrix_factorization:epoch 80 0.3938019275665283
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2114320546388626
INFO:birdwatch.matrix_factorization:epoch 100 0.3816172480583191
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.20261986553668976
INFO:birdwatch.matrix_factorization:Num epochs: 103
INFO:birdwatch.matrix_factorization:epoch 103 0.3814157247543335
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2037549763917923
INFO:birdwatch.matrix_factorization:Global Intercept: -0.33516544103622437
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_11 Harassment tag consensus elapsed time: 0.46 secs (0.01 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_11 Helpfulness scores post-harassment elapsed time: 0.21 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 724
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 1658
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 909
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 378
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 13185
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 8529
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 378, Notes: 1373
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 6.211944646758922
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 22.563492063492063
INFO:birdwatch.matrix_factorization:epoch 0 0.39826565980911255
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3259504735469818
INFO:birdwatch.matrix_factorization:epoch 20 0.08151611685752869
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04458065330982208
INFO:birdwatch.matrix_factorization:epoch 40 0.07874616235494614
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04531167447566986
INFO:birdwatch.matrix_factorization:epoch 60 0.07737372815608978
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04267760366201401
INFO:birdwatch.matrix_factorization:epoch 80 0.07732339203357697
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.042714737355709076
INFO:birdwatch.matrix_factorization:epoch 100 0.07729864120483398
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04252975434064865
INFO:birdwatch.matrix_factorization:Num epochs: 103
INFO:birdwatch.matrix_factorization:epoch 103 0.0773002952337265
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04264619201421738
INFO:birdwatch.matrix_factorization:Global Intercept: 0.1583309769630432
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 0.67 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_11 prescoring, about to call diligence with 8529 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                    raterParticipantId  internalRaterFactor1
0    00055253971F408A7AB80D461A543E010EC67DFAF29C45...              0.630100
1    0096E887BAB766D447D935A6FAA4B583C57CDDD7437330...              0.264168
2    02392701E4091AE843AD4485F95727D5E936281FC0F00C...             -0.266214
3    02552C5986DDF49CF618D738BD5FDDE46F07D965B780C5...             -0.510367
4    029E49778E6642A935E0CAE3E5896E4BD8B1112E89127B...             -0.434100
..                                                 ...                   ...
373  FE59A526EF3F5201453FE484E163928828B605DA4CD3BA...              0.816167
374  FE85094603CE54C94C5BFB73B4C36B92C775BE56DB7A10...              0.183952
375  FEB153643EB9E05DDEA406950F906E2CF9B0228BD82FF9...              0.526773
376  FED35B57756A294F0573827EAB412B5595E3D301D9F0A0...              0.862959
377  FFFA49720F254411E1F79CA757C403F0A0217240BC4922...             -0.197722

[378 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 378, vs. num we are initializing: 378
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 378
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=21.892422 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.339563 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.836961 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.677164 | time=0.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.592414 | time=0.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.540696 | time=1.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.507712 | time=1.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.488057 | time=1.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.475043 | time=1.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.465547 | time=1.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.454589 | time=1.8s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(-0.4258, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.454111 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.201507 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.192620 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.191575 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=1.189568 | time=0.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=140 | loss=1.189493 | time=0.8s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.505496 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.431028 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.430089 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=075 | loss=0.430053 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(-0.6453, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.4546, 1.1895, 0.4301
INFO:birdwatch.scorer:MFGroupScorer_11 Low Diligence MF elapsed time: 3.05 secs (0.05 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 25533 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 44 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.27 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.25 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.31 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.29 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.29 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.48 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 94.60 secs (1.58 mins)
INFO:birdwatch.constants:MFGroupScorer_11: Compute tag thresholds for percentiles elapsed time: 0.29 secs (0.00 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_10 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_10.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 26153
INFO:birdwatch.scorer:MFGroupScorer_10 Filter input elapsed time: 5.86 secs (0.10 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_10: 435ef71f01a7873a405e0dded5015b5b3d475220b0c6062663565fed8640d39b
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 3561, Num Unique Notes Rated: 406, Num Unique Raters: 291
INFO:birdwatch.scorer:MFGroupScorer_10 Prepare ratings elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_10: b8ba09c608a3d438abcc451c72c9c37966ad88d5ec07bba2355a19c069710be0
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_10: a98b9575925fbdbc138fad20a54069ccbb0a2d5fa3b11835db1f34e65d093d9a
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_10: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 291, Notes: 406
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 8.770935960591133
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 12.237113402061855
INFO:birdwatch.matrix_factorization:epoch 0 7.557739734649658
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 7.049651622772217
INFO:birdwatch.matrix_factorization:epoch 20 0.2652737498283386
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2016337662935257
INFO:birdwatch.matrix_factorization:epoch 40 0.10161056369543076
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.060199011117219925
INFO:birdwatch.matrix_factorization:epoch 60 0.07712997496128082
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04218584671616554
INFO:birdwatch.matrix_factorization:epoch 80 0.07389706373214722
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03910384327173233
INFO:birdwatch.matrix_factorization:epoch 100 0.07342509180307388
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03893930837512016
INFO:birdwatch.matrix_factorization:epoch 120 0.07336895167827606
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.038873422890901566
INFO:birdwatch.matrix_factorization:Num epochs: 134
INFO:birdwatch.matrix_factorization:epoch 134 0.0733623206615448
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03883752226829529
INFO:birdwatch.matrix_factorization:Global Intercept: 0.15358011424541473
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_10 First MF/stable init elapsed time: 0.75 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_10

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 10902 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 21 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.23 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.10 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.46 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.26 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.22 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.33 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.31 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 85.37 secs (1.42 mins)
INFO:birdwatch.scorer:MFGroupScorer_10 Compute scored notes elapsed time: 112.39 secs (1.87 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 26146 post-tombstones and 7 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 21512, including 21512 post-tombstones and 0 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 562
INFO:birdwatch.scorer:MFGroupScorer_10 Compute valid ratings elapsed time: 1.45 secs (0.02 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_10 Helpfulness scores pre-harassment  elapsed time: 0.12 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 291
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 667
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 392
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 151
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 3561
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 2255
INFO:birdwatch.scorer:MFGroupScorer_10 Filtering by helpfulness score elapsed time: 0.02 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    1230
1     176
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 849
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 153, Num Unique Notes Rated: 20, Num Unique Raters: 22
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    153
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse tag positive rate is 0.0: returning None and aborting notHelpfulSpamHarassmentOrAbuse model training.
INFO:birdwatch.scorer:MFGroupScorer_10 Harassment tag consensus elapsed time: 0.03 secs (0.00 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_10 Helpfulness scores post-harassment elapsed time: 0.11 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 291
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 667
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 392
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 151
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 3561
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 2255
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 151, Notes: 406
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 5.554187192118227
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 14.933774834437086
INFO:birdwatch.matrix_factorization:epoch 0 0.39542171359062195
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3252476155757904
INFO:birdwatch.matrix_factorization:epoch 20 0.07229658961296082
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03623134270310402
INFO:birdwatch.matrix_factorization:epoch 40 0.06869902461767197
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03507925942540169
INFO:birdwatch.matrix_factorization:epoch 60 0.06721499562263489
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03237700089812279
INFO:birdwatch.matrix_factorization:epoch 80 0.06713224947452545
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03242850676178932
INFO:birdwatch.matrix_factorization:epoch 100 0.06710810959339142
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03220777213573456
INFO:birdwatch.matrix_factorization:Num epochs: 103
INFO:birdwatch.matrix_factorization:epoch 103 0.06710924208164215
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03231242671608925
INFO:birdwatch.matrix_factorization:Global Intercept: 0.15206599235534668
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 0.45 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_10 prescoring, about to call diligence with 2255 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                    raterParticipantId  internalRaterFactor1
0    01552D5C26FC92544FC04FC6295300EB0F18231076FCA5...             -0.673872
1    01E57AF02AE507E09A96747887664ED43F14374567C26F...             -0.358175
2    053B64CC0B096D79A09BC665C84EF0B9F14996FC81BEA9...             -0.721349
3    094A2218E592741C7A9B2F8DBA17B9A03279194479EB02...              0.864569
4    0A65EA1338C709F851D6459ABFBA1141EE2B4DB496D3D7...             -0.642732
..                                                 ...                   ...
146  FA0CDC5CD8DD6F5056FCCD4E0848810C5888D71D5B4B37...              0.674534
147  FB72F3D4CBE1FE6DB8AFA4FC948EEE28E98019FF31A9FE...             -0.044788
148  FB77683424FDABC100967536C499B6FB56BAEB24A4DAE4...             -0.325984
149  FC9E0A8DBF9173C60DC171330FFA45B2562254A3AFAED4...             -0.538587
150  FF3967F3562EA361C231F53000A40BC23DA93C318A3101...             -0.377365

[151 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 151, vs. num we are initializing: 151
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 151
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=25.778397 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.488168 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.889606 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.717094 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.640985 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.593956 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.563951 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.537395 | time=0.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.513000 | time=0.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.492454 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.471990 | time=0.8s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(0.1573, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.471454 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.303425 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.293249 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.292613 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=100 | loss=1.292592 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.621194 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.532227 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.531012 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=075 | loss=0.530968 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(-0.1352, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.4720, 1.2926, 0.5310
INFO:birdwatch.scorer:MFGroupScorer_10 Low Diligence MF elapsed time: 1.19 secs (0.02 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 10902 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 21 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.15 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.17 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.21 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.11 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.14 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.24 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 79.92 secs (1.33 mins)
INFO:birdwatch.constants:MFGroupScorer_10: Compute tag thresholds for percentiles elapsed time: 0.14 secs (0.00 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_9 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_9.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 134738
INFO:birdwatch.scorer:MFGroupScorer_9 Filter input elapsed time: 5.83 secs (0.10 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_9: 7603afe18415075459d559d1c0af85aef68e3b0405b4d418bbf7203fafc2a2e8
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 49348, Num Unique Notes Rated: 2327, Num Unique Raters: 2718
INFO:birdwatch.scorer:MFGroupScorer_9 Prepare ratings elapsed time: 0.10 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_9: 727300b3844d0154c00003fe036798d61374ce483af40a3975bb09a848e6bcfd
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_9: a98b9575925fbdbc138fad20a54069ccbb0a2d5fa3b11835db1f34e65d093d9a
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_9: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 2718, Notes: 2327
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 21.206703910614525
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 18.15599705665931
INFO:birdwatch.matrix_factorization:epoch 0 7.335009574890137
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 6.83160924911499
INFO:birdwatch.matrix_factorization:epoch 20 0.22197233140468597
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.1638060361146927
INFO:birdwatch.matrix_factorization:epoch 40 0.09731090068817139
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06017804145812988
INFO:birdwatch.matrix_factorization:epoch 60 0.08031627535820007
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04613933339715004
INFO:birdwatch.matrix_factorization:epoch 80 0.07798542827367783
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04502866789698601
INFO:birdwatch.matrix_factorization:epoch 100 0.07768195122480392
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04462672770023346
INFO:birdwatch.matrix_factorization:epoch 120 0.07764361053705215
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04458217695355415
INFO:birdwatch.matrix_factorization:Num epochs: 137
INFO:birdwatch.matrix_factorization:epoch 137 0.07763893157243729
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.044542524963617325
INFO:birdwatch.matrix_factorization:Global Intercept: 0.16315479576587677
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_9 First MF/stable init elapsed time: 2.06 secs (0.03 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_9

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 61213 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 260 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.10 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.36 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.04 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.39 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.25 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.14 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.45 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 88.67 secs (1.48 mins)
INFO:birdwatch.scorer:MFGroupScorer_9 Compute scored notes elapsed time: 114.59 secs (1.91 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 134712 post-tombstones and 26 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 108607, including 108607 post-tombstones and 0 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 5377
INFO:birdwatch.scorer:MFGroupScorer_9 Compute valid ratings elapsed time: 1.66 secs (0.03 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_9 Helpfulness scores pre-harassment  elapsed time: 0.14 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 2718
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 5104
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 3901
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 1319
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 49348
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 28051
INFO:birdwatch.scorer:MFGroupScorer_9 Filtering by helpfulness score elapsed time: 0.08 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    17774
1     1866
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 8411
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 12068, Num Unique Notes Rated: 800, Num Unique Raters: 705
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    10990
1     1078
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.08932714617169374
INFO:birdwatch.matrix_factorization:Using pos weight: 10.194805194805193 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 705, Notes: 800
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 15.085
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 17.117730496453902
INFO:birdwatch.matrix_factorization:epoch 0 3.297102928161621
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 1.4361199140548706
INFO:birdwatch.matrix_factorization:epoch 20 0.6562255024909973
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.22413697838783264
INFO:birdwatch.matrix_factorization:epoch 40 0.38120946288108826
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.19498078525066376
INFO:birdwatch.matrix_factorization:epoch 60 0.34862184524536133
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18150536715984344
INFO:birdwatch.matrix_factorization:epoch 80 0.3442484736442566
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18131455779075623
INFO:birdwatch.matrix_factorization:epoch 100 0.3436448574066162
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18106643855571747
INFO:birdwatch.matrix_factorization:epoch 120 0.3435673713684082
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.1809902936220169
INFO:birdwatch.matrix_factorization:epoch 140 0.3435576856136322
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.1810378134250641
INFO:birdwatch.matrix_factorization:Num epochs: 143
INFO:birdwatch.matrix_factorization:epoch 143 0.3435574769973755
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18103377521038055
INFO:birdwatch.matrix_factorization:Global Intercept: -0.23161254823207855
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_9 Harassment tag consensus elapsed time: 1.15 secs (0.02 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_9 Helpfulness scores post-harassment elapsed time: 0.21 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 2718
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 5104
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 3901
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 1319
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 49348
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 28051
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 1319, Notes: 2324
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 12.07013769363167
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 21.266868840030327
INFO:birdwatch.matrix_factorization:epoch 0 0.40702518820762634
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3340616524219513
INFO:birdwatch.matrix_factorization:epoch 20 0.0778769999742508
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04129526764154434
INFO:birdwatch.matrix_factorization:epoch 40 0.07491593062877655
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04222936928272247
INFO:birdwatch.matrix_factorization:epoch 60 0.0741407722234726
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04073681682348251
INFO:birdwatch.matrix_factorization:epoch 80 0.07399828732013702
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04007330536842346
INFO:birdwatch.matrix_factorization:epoch 100 0.07399366796016693
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04003440588712692
INFO:birdwatch.matrix_factorization:Num epochs: 101
INFO:birdwatch.matrix_factorization:epoch 101 0.07399366796016693
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04003440588712692
INFO:birdwatch.matrix_factorization:Global Intercept: 0.16511479020118713
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 1.09 secs (0.02 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_9 prescoring, about to call diligence with 28051 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                     raterParticipantId  internalRaterFactor1
0     0010071192160B757808FAA013F537FC46BDAB3245A1D1...             -0.164553
1     003342625F00A9CCC1E87CC2EBDB61AE4042297B2E2EAE...              0.145229
2     007724A5673C2AC83FEB05670C44E28CEDF043BFB3FB29...             -0.359079
3     008A699E5E1D0F4C106E5A2D39AA9E7D7048FA367C4222...             -0.263344
4     00B1CD9CEEE1AA0E9434B3FC1E07C7CA329FE3EBE9AB45...             -0.522500
...                                                 ...                   ...
1314  FF1FBCB5BE47B326E922C801FE922884F6F57A031CC291...              0.520921
1315  FF3E0F86DEE8F26B4206335671C8D1B19BB5DE4C094662...             -0.506873
1316  FF862F35A3E9BE11D12C20D4B75BF6290C5566CBAC90B2...             -0.007785
1317  FF970D7E05D06EACFC74A3D512FE5E5EA4C7461B3AE0E3...              0.343535
1318  FFA32B052EE21AD7FCCDA98BD213D106DAB4DA6A168DB7...             -0.617064

[1319 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 1319, vs. num we are initializing: 1319
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 1319
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=20.189869 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.392756 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.805922 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.687834 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.649117 | time=1.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.631562 | time=1.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.621586 | time=1.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.615057 | time=1.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.610633 | time=1.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.607142 | time=2.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.604659 | time=2.3s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(0.1406, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.604590 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.377673 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.369235 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.368417 | time=0.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=1.368207 | time=1.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=140 | loss=1.368183 | time=1.1s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.478292 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.393970 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.392901 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=075 | loss=0.392856 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(0.8957, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.6047, 1.3682, 0.3929
INFO:birdwatch.scorer:MFGroupScorer_9 Low Diligence MF elapsed time: 3.94 secs (0.07 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 61213 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 260 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.12 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.10 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.17 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.25 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.15 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.19 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.32 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 83.56 secs (1.39 mins)
INFO:birdwatch.constants:MFGroupScorer_9: Compute tag thresholds for percentiles elapsed time: 0.30 secs (0.01 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_8 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_8.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 21657
INFO:birdwatch.scorer:MFGroupScorer_8 Filter input elapsed time: 5.69 secs (0.09 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_8: e01e335b9122917c0e18fef7a0626e8b9ec86d67a15f36dd4a9bd4c89435573c
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 2275, Num Unique Notes Rated: 306, Num Unique Raters: 218
INFO:birdwatch.scorer:MFGroupScorer_8 Prepare ratings elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_8: 8a0eb1e5569f5ffef21102dd11ef38c32081b083187fa97e3097dd907e6038ad
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_8: a98b9575925fbdbc138fad20a54069ccbb0a2d5fa3b11835db1f34e65d093d9a
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_8: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 218, Notes: 306
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 7.434640522875817
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 10.435779816513762
INFO:birdwatch.matrix_factorization:epoch 0 7.403165817260742
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 6.894455909729004
INFO:birdwatch.matrix_factorization:epoch 20 0.24754327535629272
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18172486126422882
INFO:birdwatch.matrix_factorization:epoch 40 0.11233599483966827
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.072006456553936
INFO:birdwatch.matrix_factorization:epoch 60 0.08389052748680115
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04697752371430397
INFO:birdwatch.matrix_factorization:epoch 80 0.07650335878133774
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.040673721581697464
INFO:birdwatch.matrix_factorization:epoch 100 0.07340184599161148
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03830304741859436
INFO:birdwatch.matrix_factorization:epoch 120 0.07173091173171997
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03687185421586037
INFO:birdwatch.matrix_factorization:epoch 140 0.07150180637836456
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.036658987402915955
INFO:birdwatch.matrix_factorization:epoch 160 0.07145087420940399
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0367097407579422
INFO:birdwatch.matrix_factorization:Num epochs: 169
INFO:birdwatch.matrix_factorization:epoch 169 0.07144767791032791
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03670092299580574
INFO:birdwatch.matrix_factorization:Global Intercept: 0.14711327850818634
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_8 First MF/stable init elapsed time: 0.68 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_8

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 9600 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 18 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.15 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.10 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.28 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.36 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.22 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.11 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.27 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 116.07 secs (1.93 mins)
INFO:birdwatch.scorer:MFGroupScorer_8 Compute scored notes elapsed time: 140.83 secs (2.35 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 21640 post-tombstones and 17 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 17549, including 17549 post-tombstones and 0 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 393
INFO:birdwatch.scorer:MFGroupScorer_8 Compute valid ratings elapsed time: 1.83 secs (0.03 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_8 Helpfulness scores pre-harassment  elapsed time: 0.13 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 218
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 507
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 274
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 112
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 2275
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 1337
INFO:birdwatch.scorer:MFGroupScorer_8 Filtering by helpfulness score elapsed time: 0.03 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    640
1    108
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 589
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 0, Num Unique Notes Rated: 0, Num Unique Raters: 0
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown Series([], dtype: int64)
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:No valid data for notHelpfulSpamHarassmentOrAbuse, returning None and aborting notHelpfulSpamHarassmentOrAbuse model training.
INFO:birdwatch.scorer:MFGroupScorer_8 Harassment tag consensus elapsed time: 0.04 secs (0.00 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_8 Helpfulness scores post-harassment elapsed time: 0.12 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 218
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 507
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 274
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 112
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 2275
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 1337
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 112, Notes: 302
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 4.427152317880795
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 11.9375
INFO:birdwatch.matrix_factorization:epoch 0 0.3689117729663849
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.30053970217704773
INFO:birdwatch.matrix_factorization:epoch 20 0.06361119449138641
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.028908096253871918
INFO:birdwatch.matrix_factorization:epoch 40 0.06021517515182495
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.027866797521710396
INFO:birdwatch.matrix_factorization:epoch 60 0.058356381952762604
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.024544453248381615
INFO:birdwatch.matrix_factorization:epoch 80 0.05816895514726639
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.024641146883368492
INFO:birdwatch.matrix_factorization:epoch 100 0.05813004821538925
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.024516405537724495
INFO:birdwatch.matrix_factorization:Num epochs: 101
INFO:birdwatch.matrix_factorization:epoch 101 0.05813004821538925
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.024516405537724495
INFO:birdwatch.matrix_factorization:Global Intercept: 0.13758578896522522
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 0.60 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_8 prescoring, about to call diligence with 1337 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                    raterParticipantId  internalRaterFactor1
0    022ECDC03030E4FD492F7698ED84CC94BA45F8514944D6...             -0.003925
1    02DB36F53766B5A72170C2E64EA5ADF5049A1BDB38A2C9...             -0.279551
2    034D043921F0321563A40F6C033A627423DB4AEBAB8B8E...              0.439876
3    03DCE96CD069F4925DBE3CD69F26AF7ED7E5A434B03394...              0.583966
4    08C9795E0EBD2D221AE25B8792340175E4847CB67E9B15...             -0.575979
..                                                 ...                   ...
107  F3DE9F4343D8DD44E618EBAF1478BBAE161EB9D3B20C74...             -0.304710
108  F7C724A477F5CDDC480F4D76FBDB060676BA4096576300...             -0.354723
109  F7D3C87A4E3919A63566FB781FA8AE20872E4665C2CB95...              0.620537
110  FE48D2947F539E4B125452622985E955B43B4F23D9404E...             -0.522442
111  FFA64E61F9B012016BB7ACCFE2FF2E42D57BB570E94452...              0.025890

[112 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 112, vs. num we are initializing: 112
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 112
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=16.586031 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=2.962359 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.552299 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.410018 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.321934 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.266788 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.238441 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.221201 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.206362 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.194977 | time=0.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.188153 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(-0.7648, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.187938 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.932358 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.925951 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=0.925101 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=105 | loss=0.925073 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.530154 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.464496 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.463673 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=070 | loss=0.463650 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(-1.2366, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.1882, 0.9251, 0.4637
INFO:birdwatch.scorer:MFGroupScorer_8 Low Diligence MF elapsed time: 1.24 secs (0.02 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 9600 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 18 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.42 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.10 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.59 secs (0.03 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.05 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.56 secs (0.03 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.21 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.17 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.28 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 84.87 secs (1.41 mins)
INFO:birdwatch.constants:MFGroupScorer_8: Compute tag thresholds for percentiles elapsed time: 0.17 secs (0.00 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_7 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_7.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 49986
INFO:birdwatch.scorer:MFGroupScorer_7 Filter input elapsed time: 6.06 secs (0.10 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_7: f510407878034c700fb38d4c5f16bf0ceaecf4a78de981a4dc5c8b7a53ed1975
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 9268, Num Unique Notes Rated: 853, Num Unique Raters: 660
INFO:birdwatch.scorer:MFGroupScorer_7 Prepare ratings elapsed time: 0.04 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_7: dad49217b26c532795cafdb08ada29dec8350f4e82b6da3d292f7327920f8481
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_7: a98b9575925fbdbc138fad20a54069ccbb0a2d5fa3b11835db1f34e65d093d9a
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_7: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 660, Notes: 853
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 10.865181711606096
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 14.042424242424243
INFO:birdwatch.matrix_factorization:epoch 0 7.2400803565979
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 6.731949806213379
INFO:birdwatch.matrix_factorization:epoch 20 0.25657764077186584
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.19485601782798767
INFO:birdwatch.matrix_factorization:epoch 40 0.11099167913198471
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07086697965860367
INFO:birdwatch.matrix_factorization:epoch 60 0.09017569571733475
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05420945957303047
INFO:birdwatch.matrix_factorization:epoch 80 0.08724381774663925
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0517699271440506
INFO:birdwatch.matrix_factorization:epoch 100 0.08682763576507568
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05164887383580208
INFO:birdwatch.matrix_factorization:epoch 120 0.08677397668361664
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05156443640589714
INFO:birdwatch.matrix_factorization:epoch 140 0.08676737546920776
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05153270065784454
INFO:birdwatch.matrix_factorization:Num epochs: 142
INFO:birdwatch.matrix_factorization:epoch 142 0.0867672860622406
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.051537465304136276
INFO:birdwatch.matrix_factorization:Global Intercept: 0.1647704541683197
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_7 First MF/stable init elapsed time: 0.99 secs (0.02 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_7

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 17636 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 89 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.11 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.20 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.21 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.13 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.11 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.22 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 97.40 secs (1.62 mins)
INFO:birdwatch.scorer:MFGroupScorer_7 Compute scored notes elapsed time: 123.68 secs (2.06 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 49974 post-tombstones and 12 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 39302, including 39302 post-tombstones and 0 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 1620
INFO:birdwatch.scorer:MFGroupScorer_7 Compute valid ratings elapsed time: 2.24 secs (0.04 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_7 Helpfulness scores pre-harassment  elapsed time: 0.17 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 660
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 1756
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 1156
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 309
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 9268
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 5067
INFO:birdwatch.scorer:MFGroupScorer_7 Filtering by helpfulness score elapsed time: 0.03 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    2959
1     403
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 1705
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 402, Num Unique Notes Rated: 57, Num Unique Raters: 61
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    377
1     25
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.06218905472636816
INFO:birdwatch.matrix_factorization:Using pos weight: 15.08 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 61, Notes: 57
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 7.052631578947368
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 6.590163934426229
INFO:birdwatch.matrix_factorization:epoch 0 3.4938244819641113
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 1.6124838590621948
INFO:birdwatch.matrix_factorization:epoch 20 0.6357589960098267
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2170335352420807
INFO:birdwatch.matrix_factorization:epoch 40 0.37627843022346497
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.1708511859178543
INFO:birdwatch.matrix_factorization:epoch 60 0.3383462727069855
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.1718897670507431
INFO:birdwatch.matrix_factorization:epoch 80 0.3333510160446167
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.1603277623653412
INFO:birdwatch.matrix_factorization:epoch 100 0.3327244818210602
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.16108669340610504
INFO:birdwatch.matrix_factorization:Num epochs: 103
INFO:birdwatch.matrix_factorization:epoch 103 0.33272063732147217
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.16165383160114288
INFO:birdwatch.matrix_factorization:Global Intercept: -0.3329756259918213
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_7 Harassment tag consensus elapsed time: 0.56 secs (0.01 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_7 Helpfulness scores post-harassment elapsed time: 0.20 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 660
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 1756
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 1156
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 309
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 9268
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 5067
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 309, Notes: 848
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 5.975235849056604
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 16.398058252427184
INFO:birdwatch.matrix_factorization:epoch 0 0.3796917796134949
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3067611753940582
INFO:birdwatch.matrix_factorization:epoch 20 0.08094169199466705
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04287603124976158
INFO:birdwatch.matrix_factorization:epoch 40 0.07878970354795456
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04386604577302933
INFO:birdwatch.matrix_factorization:epoch 60 0.0770348310470581
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04043542221188545
INFO:birdwatch.matrix_factorization:epoch 80 0.07696044445037842
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04076625034213066
INFO:birdwatch.matrix_factorization:epoch 100 0.0769239217042923
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04048921912908554
INFO:birdwatch.matrix_factorization:Num epochs: 102
INFO:birdwatch.matrix_factorization:epoch 102 0.07692476361989975
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.040564630180597305
INFO:birdwatch.matrix_factorization:Global Intercept: 0.16500523686408997
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 0.55 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_7 prescoring, about to call diligence with 5067 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                    raterParticipantId  internalRaterFactor1
0    0007FA945EF35219D0388D94715189F6231A77263D83B1...              0.428812
1    000F1687C56AB92D846F2B9BFA71AE16D8A88426754E3B...              0.470300
2    008D2B105D9284320C4CC52C5247EC6C4167699D26BD53...              0.462287
3    00D9B842B8F532C5E4159DCB7443408832331D526F5B0A...              0.688446
4    00E801A1AE7306E83F42DE6B2C1D7D5E4AF667A29E3AFC...             -0.452902
..                                                 ...                   ...
304  FA42C855566088D2CF0A3FD5A1F156A681DD0E8E058A69...             -0.404869
305  FA77FDC6DBA0EDBE1244CD3E9BB0E11E10DD92FC9361CF...              0.117673
306  FB7453028620D33F1C4E68A8437CE132ED11A967C2733D...             -0.607270
307  FE4973B3DA280A019D30F8EBAFFC19D8B7C1E5B89AF997...              0.120698
308  FF77FD3571A6B1C5746E07AC7CD9D569F05CABA3183635...             -0.517789

[309 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 309, vs. num we are initializing: 309
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 309
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=20.404278 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.385621 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.833905 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.683849 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.617384 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.575244 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.545063 | time=0.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.526935 | time=0.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.513709 | time=1.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.502387 | time=1.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.494335 | time=1.3s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(-0.1019, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.494122 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.316897 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.307251 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.306499 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=105 | loss=1.306469 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.595814 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.505308 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.504022 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=075 | loss=0.503974 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(-0.0345, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.4943, 1.3065, 0.5040
INFO:birdwatch.scorer:MFGroupScorer_7 Low Diligence MF elapsed time: 2.15 secs (0.04 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 17636 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 89 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.19 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.21 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.23 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.14 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.20 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.28 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 94.18 secs (1.57 mins)
INFO:birdwatch.constants:MFGroupScorer_7: Compute tag thresholds for percentiles elapsed time: 0.31 secs (0.01 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_6 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_6.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 139548
INFO:birdwatch.scorer:MFGroupScorer_6 Filter input elapsed time: 5.83 secs (0.10 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_6: 6c0ddb8b1625f20183a4b1bd869c69b9dfede08cb0c17bb75f6959cc9e2ca986
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 61687, Num Unique Notes Rated: 3844, Num Unique Raters: 2890
INFO:birdwatch.scorer:MFGroupScorer_6 Prepare ratings elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_6: 788238e12ef578e83a2c879dd2238e2d4d4c149cc9fac6146c453f86a2fa8129
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_6: a98b9575925fbdbc138fad20a54069ccbb0a2d5fa3b11835db1f34e65d093d9a
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_6: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 2890, Notes: 3844
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 16.04760665972945
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 21.34498269896194
INFO:birdwatch.matrix_factorization:epoch 0 7.264091491699219
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 6.762390613555908
INFO:birdwatch.matrix_factorization:epoch 20 0.26922205090522766
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.21238070726394653
INFO:birdwatch.matrix_factorization:epoch 40 0.11327677965164185
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07695571333169937
INFO:birdwatch.matrix_factorization:epoch 60 0.0933590680360794
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.059615153819322586
INFO:birdwatch.matrix_factorization:epoch 80 0.09065832197666168
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.056518878787755966
INFO:birdwatch.matrix_factorization:epoch 100 0.09030662477016449
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05646654963493347
INFO:birdwatch.matrix_factorization:epoch 120 0.09026136249303818
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05638095363974571
INFO:birdwatch.matrix_factorization:Num epochs: 131
INFO:birdwatch.matrix_factorization:epoch 131 0.09025732427835464
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.056404996663331985
INFO:birdwatch.matrix_factorization:Global Intercept: 0.16600805521011353
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_6 First MF/stable init elapsed time: 2.57 secs (0.04 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_6

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 77962 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 268 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.12 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.10 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.22 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.04 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.28 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.19 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.15 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.65 secs (0.03 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 98.04 secs (1.63 mins)
INFO:birdwatch.scorer:MFGroupScorer_6 Compute scored notes elapsed time: 126.01 secs (2.10 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 139464 post-tombstones and 84 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 114255, including 114250 post-tombstones and 5 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 8125
INFO:birdwatch.scorer:MFGroupScorer_6 Compute valid ratings elapsed time: 1.82 secs (0.03 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_6 Helpfulness scores pre-harassment  elapsed time: 0.16 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 2890
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 6452
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 4610
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 1762
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 61687
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 42392
INFO:birdwatch.scorer:MFGroupScorer_6 Filtering by helpfulness score elapsed time: 0.10 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    26057
1     2017
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 14318
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 16758, Num Unique Notes Rated: 1412, Num Unique Raters: 943
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    15727
1     1031
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.06152285475593746
INFO:birdwatch.matrix_factorization:Using pos weight: 15.2541222114452 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 943, Notes: 1412
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 11.86827195467422
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 17.770943796394487
INFO:birdwatch.matrix_factorization:epoch 0 3.332686424255371
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 1.456755518913269
INFO:birdwatch.matrix_factorization:epoch 20 0.6628890037536621
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.26392611861228943
INFO:birdwatch.matrix_factorization:epoch 40 0.41082167625427246
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.21252501010894775
INFO:birdwatch.matrix_factorization:epoch 60 0.37638556957244873
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.20374619960784912
INFO:birdwatch.matrix_factorization:epoch 80 0.37186282873153687
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.20217131078243256
INFO:birdwatch.matrix_factorization:epoch 100 0.3712506890296936
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.20182648301124573
INFO:birdwatch.matrix_factorization:epoch 120 0.37117207050323486
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.20177732408046722
INFO:birdwatch.matrix_factorization:epoch 140 0.3711622357368469
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.20177455246448517
INFO:birdwatch.matrix_factorization:Num epochs: 145
INFO:birdwatch.matrix_factorization:epoch 145 0.37116169929504395
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.20178106427192688
INFO:birdwatch.matrix_factorization:Global Intercept: -0.2930724322795868
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_6 Harassment tag consensus elapsed time: 1.35 secs (0.02 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_6 Helpfulness scores post-harassment elapsed time: 0.24 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 2890
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 6452
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 4583
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 1735
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 61687
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 40500
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 1735, Notes: 3837
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 10.55512118842846
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 23.34293948126801
INFO:birdwatch.matrix_factorization:epoch 0 0.3959979712963104
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.32263264060020447
INFO:birdwatch.matrix_factorization:epoch 20 0.08867646753787994
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05180678516626358
INFO:birdwatch.matrix_factorization:epoch 40 0.08634281158447266
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.053095895797014236
INFO:birdwatch.matrix_factorization:epoch 60 0.08532305061817169
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.051125332713127136
INFO:birdwatch.matrix_factorization:epoch 80 0.0852360725402832
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.050759077072143555
INFO:birdwatch.matrix_factorization:epoch 100 0.08523266017436981
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0506504625082016
INFO:birdwatch.matrix_factorization:Num epochs: 101
INFO:birdwatch.matrix_factorization:epoch 101 0.08523266017436981
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0506504625082016
INFO:birdwatch.matrix_factorization:Global Intercept: 0.16939198970794678
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 1.32 secs (0.02 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_6 prescoring, about to call diligence with 40500 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                     raterParticipantId  internalRaterFactor1
0     00537B460182CCA4864ED4D53F50B3C90AAC12C10D2393...              0.608291
1     007A172A5561E8B7763F51D195A87DF3FE042D50A20328...              0.457542
2     00819BDCAA385D10049D512029D3F839808A094BFB9F6F...              0.710093
3     009C38FB2D3F4140022CC566C236B8E161E362406F7D10...              0.097552
4     009F30BCF8C336CA8D2770C5264293797F55F2C83A5FA3...             -0.493325
...                                                 ...                   ...
1730  FF8482988E355445D426EB9CA10449FFA8BF5D7B898DFB...              0.674749
1731  FF8B8E0DB0E0B736C013D10B7E0BE5503AA4EC11AC0C50...              0.622105
1732  FFAA882D56280425C2A13877395F17D5BF7A25C6FD1BC7...              0.674852
1733  FFB5F72892AFEECA1370E0D784FAB97CB07AC2D3DAAC31...              0.696183
1734  FFFC8248F057883916F06F78A0DB7878BFB2C6162434E2...              0.581893

[1735 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 1735, vs. num we are initializing: 1735
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 1735
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=16.661119 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.318446 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.823466 | time=0.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.714506 | time=0.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.673760 | time=1.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.651954 | time=1.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.638017 | time=1.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.628563 | time=1.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.622404 | time=2.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.618426 | time=2.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.615518 | time=2.8s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(-0.3668, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.615446 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.432927 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.424175 | time=0.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.423306 | time=0.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=105 | loss=1.423277 | time=1.1s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.535244 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.446778 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.445621 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=075 | loss=0.445576 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(0.3739, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.6155, 1.4233, 0.4456
INFO:birdwatch.scorer:MFGroupScorer_6 Low Diligence MF elapsed time: 4.38 secs (0.07 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 77962 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 268 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.15 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.10 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.22 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.18 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.18 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.21 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.32 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 82.82 secs (1.38 mins)
INFO:birdwatch.constants:MFGroupScorer_6: Compute tag thresholds for percentiles elapsed time: 0.47 secs (0.01 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_5 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_5.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 14172
INFO:birdwatch.scorer:MFGroupScorer_5 Filter input elapsed time: 6.08 secs (0.10 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_5: 74f5d3a0e6f003a2616624c2ef5687de81069bafc3ce003fd4d4ab655f979ed3
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 726, Num Unique Notes Rated: 83, Num Unique Raters: 92
INFO:birdwatch.scorer:MFGroupScorer_5 Prepare ratings elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_5: 070078da5b37a726746ee8b9c61377095b539512528102c284a231563271b400
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_5: a98b9575925fbdbc138fad20a54069ccbb0a2d5fa3b11835db1f34e65d093d9a
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_5: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 92, Notes: 83
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 8.74698795180723
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 7.891304347826087
INFO:birdwatch.matrix_factorization:epoch 0 6.883915901184082
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 6.378740310668945
INFO:birdwatch.matrix_factorization:epoch 20 0.2919563353061676
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.23182295262813568
INFO:birdwatch.matrix_factorization:epoch 40 0.10230574011802673
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05885190889239311
INFO:birdwatch.matrix_factorization:epoch 60 0.06234370917081833
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.022831076756119728
INFO:birdwatch.matrix_factorization:epoch 80 0.05689698085188866
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.018250692635774612
INFO:birdwatch.matrix_factorization:epoch 100 0.05625053495168686
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.017814816907048225
INFO:birdwatch.matrix_factorization:epoch 120 0.05615513026714325
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.017710184678435326
INFO:birdwatch.matrix_factorization:Num epochs: 127
INFO:birdwatch.matrix_factorization:epoch 127 0.0561489537358284
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.017749957740306854
INFO:birdwatch.matrix_factorization:Global Intercept: 0.16468746960163116
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_5 First MF/stable init elapsed time: 0.50 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_5

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 3432 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 15 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.15 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.24 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.20 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.16 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.28 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.28 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 96.49 secs (1.61 mins)
INFO:birdwatch.scorer:MFGroupScorer_5 Compute scored notes elapsed time: 122.94 secs (2.05 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 14169 post-tombstones and 3 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 11419, including 11419 post-tombstones and 0 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 141
INFO:birdwatch.scorer:MFGroupScorer_5 Compute valid ratings elapsed time: 1.87 secs (0.03 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_5 Helpfulness scores pre-harassment  elapsed time: 0.21 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 92
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 175
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 124
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 23
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 726
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 208
INFO:birdwatch.scorer:MFGroupScorer_5 Filtering by helpfulness score elapsed time: 0.08 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    140
1     13
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 55
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 0, Num Unique Notes Rated: 0, Num Unique Raters: 0
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown Series([], dtype: int64)
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:No valid data for notHelpfulSpamHarassmentOrAbuse, returning None and aborting notHelpfulSpamHarassmentOrAbuse model training.
INFO:birdwatch.scorer:MFGroupScorer_5 Harassment tag consensus elapsed time: 0.05 secs (0.00 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_5 Helpfulness scores post-harassment elapsed time: 0.14 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 92
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 175
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 124
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 23
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 726
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 208
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 23, Notes: 72
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 2.888888888888889
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 9.043478260869565
INFO:birdwatch.matrix_factorization:epoch 0 0.39855512976646423
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3156474828720093
INFO:birdwatch.matrix_factorization:epoch 20 0.050524622201919556
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.011267020367085934
INFO:birdwatch.matrix_factorization:epoch 40 0.04682309925556183
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.011410510167479515
INFO:birdwatch.matrix_factorization:epoch 60 0.045013170689344406
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.007689063437283039
INFO:birdwatch.matrix_factorization:epoch 80 0.04491410776972771
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.008057225495576859
INFO:birdwatch.matrix_factorization:Num epochs: 89
INFO:birdwatch.matrix_factorization:epoch 89 0.04488992318511009
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.007994960062205791
INFO:birdwatch.matrix_factorization:Global Intercept: 0.16223807632923126
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 0.35 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_5 prescoring, about to call diligence with 208 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                   raterParticipantId  internalRaterFactor1
0   06714FBDCE5A7A6E45B5F0815901C281FEB961390712A2...             -0.543276
1   0EF7481E7E847819CBDE13CC2C3933C118215DC5819A97...             -0.511805
2   1729D50F11A2405B98258D5389E18F5FBD9B2979176588...             -0.645646
3   19C25936718B5013BB2228AD4F1EBDB1726A731C986162...              0.536872
4   2769B56422E5E4AE5C6F0E8014FF9D544F92B4C2FBD037...             -0.628704
5   2FED843BA72F095F4DA1FAEDE071B3CF6271F47EC29027...             -0.459336
6   45A5BAC69E307E940554DBD6BABD16899132DDC2583FFB...              0.679162
7   47FCCEA02838D26E00DB65A821CE70778CEE9CB161A216...              0.354080
8   49787BB4031B62F92FCF98FF57091428B7E7D299BAD934...              0.686083
9   4AEEFB2D8959A36D46A96F9DF98532388344AA2CF91C9F...             -0.691847
10  4ED158FE69FADBE2A473E1512B3FFBCA8728AF23D4CA06...             -0.551534
11  5020509DFCFB744DB84715469B4ABF87DA9E2ED072B813...              0.528502
12  5F6311257FE14462CCB51A18801817AC5D38CC69DEDCEC...             -0.579888
13  6444EE19DE9290141D7B08D6EA3F2AAEF3FF64215D8CB6...             -0.699956
14  7B01CC0F9341F73DA9AEFED9639A869A050AA6967D41AA...             -0.617904
15  9585BE0BD81A263EA7243D1F9C8248391DBE34013D8E3A...             -0.302695
16  96ABC65F2ABC51F218CC4450FBC4F49D1C19E4C251F8AB...              0.279243
17  9B97B1FBACB2209C6D0BCA75B1CA282A3B3DA7C07CBD85...             -0.700020
18  9DC67B26EA92E056FA5411048F563168FEC64EC67EB9DA...              0.589343
19  A836C6F56F7D37BEA213868DFD41FCFCE7C2E2184593EE...              0.527990
20  B92CC2CC56D23D3FA02C0A4642F5ECC5C586C602407679...             -0.641789
21  B92D1E0BD707B660351C99D48A4F187349C939CCFDF481...             -0.598944
22  D02578E31DDC80C9FEA63EDEC5842FEC6A5FCBAEEAF58F...              0.426692
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 23, vs. num we are initializing: 23
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 23
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=22.073879 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=2.653792 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.223648 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.105490 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.054314 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.020651 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=1.994120 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=1.971317 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=1.950848 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=1.932675 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=1.917978 | time=0.6s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(-0.6410, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=1.917557 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.450524 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.443719 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=070 | loss=0.442856 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.322628 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.285924 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.285397 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=070 | loss=0.285372 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(-3.2199, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 1.9180, 0.4429, 0.2854
INFO:birdwatch.scorer:MFGroupScorer_5 Low Diligence MF elapsed time: 0.87 secs (0.01 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 3432 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 15 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.13 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.17 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.18 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.34 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.16 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.44 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.31 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 95.83 secs (1.60 mins)
INFO:birdwatch.constants:MFGroupScorer_5: Compute tag thresholds for percentiles elapsed time: 0.23 secs (0.00 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_4 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_4.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 33598
INFO:birdwatch.scorer:MFGroupScorer_4 Filter input elapsed time: 6.03 secs (0.10 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_4: 000de088e6e757994a81ab0d8f8a8eefd4759f2b9ae311fdd34a12c69e01680f
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 4120, Num Unique Notes Rated: 371, Num Unique Raters: 361
INFO:birdwatch.scorer:MFGroupScorer_4 Prepare ratings elapsed time: 0.04 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_4: f6025cecbf88cbf0aa9531507e8f786616f9c50596430ef3202d43bd209d2b2d
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_4: a98b9575925fbdbc138fad20a54069ccbb0a2d5fa3b11835db1f34e65d093d9a
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_4: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 361, Notes: 371
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 11.10512129380054
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 11.412742382271468
INFO:birdwatch.matrix_factorization:epoch 0 7.570182800292969
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 7.062375068664551
INFO:birdwatch.matrix_factorization:epoch 20 0.25454846024513245
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.19901303946971893
INFO:birdwatch.matrix_factorization:epoch 40 0.09682780504226685
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05996204912662506
INFO:birdwatch.matrix_factorization:epoch 60 0.07666327804327011
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04212401434779167
INFO:birdwatch.matrix_factorization:epoch 80 0.07395392656326294
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04015963524580002
INFO:birdwatch.matrix_factorization:epoch 100 0.07359100878238678
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03973156958818436
INFO:birdwatch.matrix_factorization:epoch 120 0.07354630529880524
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.039739806205034256
INFO:birdwatch.matrix_factorization:Num epochs: 127
INFO:birdwatch.matrix_factorization:epoch 127 0.07354296743869781
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03969234600663185
INFO:birdwatch.matrix_factorization:Global Intercept: 0.1456783562898636
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_4 First MF/stable init elapsed time: 0.63 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_4

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 8904 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 57 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.10 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.18 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.19 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.13 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.10 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.19 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 95.39 secs (1.59 mins)
INFO:birdwatch.scorer:MFGroupScorer_4 Compute scored notes elapsed time: 120.86 secs (2.01 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 33595 post-tombstones and 3 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 27619, including 27619 post-tombstones and 0 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 858
INFO:birdwatch.scorer:MFGroupScorer_4 Compute valid ratings elapsed time: 2.01 secs (0.03 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_4 Helpfulness scores pre-harassment  elapsed time: 0.15 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 361
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 967
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 701
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 157
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 4120
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 1960
INFO:birdwatch.scorer:MFGroupScorer_4 Filtering by helpfulness score elapsed time: 0.03 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    1045
1     179
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 736
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 5, Num Unique Notes Rated: 1, Num Unique Raters: 5
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    5
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse tag positive rate is 0.0: returning None and aborting notHelpfulSpamHarassmentOrAbuse model training.
INFO:birdwatch.scorer:MFGroupScorer_4 Harassment tag consensus elapsed time: 0.04 secs (0.00 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_4 Helpfulness scores post-harassment elapsed time: 0.12 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 361
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 967
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 701
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 157
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 4120
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 1960
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 157, Notes: 366
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 5.355191256830601
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 12.48407643312102
INFO:birdwatch.matrix_factorization:epoch 0 0.40019965171813965
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3286418616771698
INFO:birdwatch.matrix_factorization:epoch 20 0.06977769732475281
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03230315074324608
INFO:birdwatch.matrix_factorization:epoch 40 0.06712111830711365
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.032423704862594604
INFO:birdwatch.matrix_factorization:epoch 60 0.06551159918308258
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.029433300718665123
INFO:birdwatch.matrix_factorization:epoch 80 0.06545300036668777
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.029507216066122055
INFO:birdwatch.matrix_factorization:epoch 100 0.06543421000242233
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.029324470087885857
INFO:birdwatch.matrix_factorization:Num epochs: 103
INFO:birdwatch.matrix_factorization:epoch 103 0.06543329358100891
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.029446067288517952
INFO:birdwatch.matrix_factorization:Global Intercept: 0.15138746798038483
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 0.41 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_4 prescoring, about to call diligence with 1960 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                    raterParticipantId  internalRaterFactor1
0    00DF531883F82B474928CB0E73C08D543F3B4944D094B5...             -0.441350
1    016A6BD710984AFF6E78F97183758AE2CAF2CDCAE10961...             -0.613578
2    0281A3E88C3C226058BEE76E1CF5061FC8A6D553ACEA0B...             -0.563508
3    03208CE07F85EC3A764559309F250D019774E8C4B357E8...              0.656463
4    05C32141E3A2301389D4F6FB0F6F0925D28B28FA739D0A...             -0.198120
..                                                 ...                   ...
152  FC2DDDCA0E5BDF6DA28E84A101DD02FF8910B7CE1E45BC...             -0.531785
153  FC6121D9B2F94211FDD9F7A2D79A670423B53A466732A7...             -0.411631
154  FCA342919301000CE0E0B21AA9890C54C752B2B36FC28B...              0.573360
155  FCF71787C19F6C45ED673372CD3469351C26003C8F44E5...              0.717957
156  FDF97D6605DA5352D673B7CB06306039BD4549FE4E7026...              0.511789

[157 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 157, vs. num we are initializing: 157
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 157
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=26.028776 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.605243 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.870975 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.649937 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.566144 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.522708 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.495635 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.477155 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.463467 | time=0.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.454181 | time=0.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.447309 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(0.1090, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.447112 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.256035 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.246216 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.245453 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=100 | loss=1.245428 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.579504 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.481139 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.479727 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=080 | loss=0.479668 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(-0.0839, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.4473, 1.2454, 0.4797
INFO:birdwatch.scorer:MFGroupScorer_4 Low Diligence MF elapsed time: 1.26 secs (0.02 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 8904 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 57 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.24 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.27 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.04 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.31 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.06 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.11 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.23 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 88.74 secs (1.48 mins)
INFO:birdwatch.constants:MFGroupScorer_4: Compute tag thresholds for percentiles elapsed time: 0.17 secs (0.00 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_3 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_3.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 113991
INFO:birdwatch.scorer:MFGroupScorer_3 Filter input elapsed time: 7.45 secs (0.12 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_3: 228686326e3dfe2c14fc570551a1344f9547e51ea0a0ce8db29ebde8dac3fe52
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 34023, Num Unique Notes Rated: 2048, Num Unique Raters: 1909
INFO:birdwatch.scorer:MFGroupScorer_3 Prepare ratings elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_3: 475a49d056bb88d5d68eb92b0ee1f86e14b1bcdb4a441907496c4650d39fce36
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_3: a98b9575925fbdbc138fad20a54069ccbb0a2d5fa3b11835db1f34e65d093d9a
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_3: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 1909, Notes: 2048
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 16.61279296875
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 17.822420115243585
INFO:birdwatch.matrix_factorization:epoch 0 7.054668426513672
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 6.549778461456299
INFO:birdwatch.matrix_factorization:epoch 20 0.2600482404232025
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.20358999073505402
INFO:birdwatch.matrix_factorization:epoch 40 0.1135980486869812
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07705695927143097
INFO:birdwatch.matrix_factorization:epoch 60 0.09370740503072739
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.059700995683670044
INFO:birdwatch.matrix_factorization:epoch 80 0.09102711081504822
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05696174129843712
INFO:birdwatch.matrix_factorization:epoch 100 0.09069512039422989
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05675027519464493
INFO:birdwatch.matrix_factorization:epoch 120 0.0906495600938797
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05664264038205147
INFO:birdwatch.matrix_factorization:Num epochs: 129
INFO:birdwatch.matrix_factorization:epoch 129 0.0906459167599678
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05664319172501564
INFO:birdwatch.matrix_factorization:Global Intercept: 0.17307166755199432
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_3 First MF/stable init elapsed time: 1.80 secs (0.03 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_3

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 45761 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 180 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.13 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.19 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.25 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.22 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.28 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.40 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 91.24 secs (1.52 mins)
INFO:birdwatch.scorer:MFGroupScorer_3 Compute scored notes elapsed time: 122.45 secs (2.04 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 113957 post-tombstones and 34 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 85301, including 85298 post-tombstones and 3 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 8280
INFO:birdwatch.scorer:MFGroupScorer_3 Compute valid ratings elapsed time: 2.13 secs (0.04 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_3 Helpfulness scores pre-harassment  elapsed time: 0.18 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 1909
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 6334
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 4930
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 1281
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 34023
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 24931
INFO:birdwatch.scorer:MFGroupScorer_3 Filtering by helpfulness score elapsed time: 0.07 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    17082
1      926
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 6923
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 10903, Num Unique Notes Rated: 731, Num Unique Raters: 667
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    10554
1      349
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.03200953865908466
INFO:birdwatch.matrix_factorization:Using pos weight: 30.24068767908309 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 667, Notes: 731
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 14.915184678522571
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 16.34632683658171
INFO:birdwatch.matrix_factorization:epoch 0 3.1331851482391357
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 1.232362985610962
INFO:birdwatch.matrix_factorization:epoch 20 0.6790701746940613
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.26648178696632385
INFO:birdwatch.matrix_factorization:epoch 40 0.39122992753982544
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.20063740015029907
INFO:birdwatch.matrix_factorization:epoch 60 0.3451996445655823
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.17899927496910095
INFO:birdwatch.matrix_factorization:epoch 80 0.33982497453689575
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.17951804399490356
INFO:birdwatch.matrix_factorization:epoch 100 0.33905279636383057
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.17898567020893097
INFO:birdwatch.matrix_factorization:epoch 120 0.3389558792114258
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.1789672076702118
INFO:birdwatch.matrix_factorization:epoch 140 0.33894309401512146
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.17903435230255127
INFO:birdwatch.matrix_factorization:Num epochs: 148
INFO:birdwatch.matrix_factorization:epoch 148 0.33894211053848267
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.17902468144893646
INFO:birdwatch.matrix_factorization:Global Intercept: -0.266248494386673
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_3 Harassment tag consensus elapsed time: 1.61 secs (0.03 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_3 Helpfulness scores post-harassment elapsed time: 0.46 secs (0.01 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 1909
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 6334
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 4930
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 1281
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 34023
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 24931
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 1281, Notes: 2046
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 12.185239491691105
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 19.462138953942233
INFO:birdwatch.matrix_factorization:epoch 0 0.38775724172592163
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3134753406047821
INFO:birdwatch.matrix_factorization:epoch 20 0.08946868777275085
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.053653378039598465
INFO:birdwatch.matrix_factorization:epoch 40 0.0863277018070221
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.053490638732910156
INFO:birdwatch.matrix_factorization:epoch 60 0.0851878821849823
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05120007321238518
INFO:birdwatch.matrix_factorization:epoch 80 0.08509930223226547
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05086046829819679
INFO:birdwatch.matrix_factorization:epoch 100 0.0850914791226387
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05068689212203026
INFO:birdwatch.matrix_factorization:Num epochs: 101
INFO:birdwatch.matrix_factorization:epoch 101 0.0850914791226387
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05068689212203026
INFO:birdwatch.matrix_factorization:Global Intercept: 0.17761580646038055
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 1.20 secs (0.02 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_3 prescoring, about to call diligence with 24931 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                     raterParticipantId  internalRaterFactor1
0     0082235CA4459F0F8C5D33A76A9E9C985165454365EA2A...             -0.597066
1     008B07A5C6396F8E4812840D0379BE7E7351683F5E6320...              0.086789
2     009040F358AE8F2BA076F70305BBFFF02248F2E9086C1F...             -0.220483
3     009EF8E67A7620A96FEEA18E8CA43EDACB1FD6E8EE3850...             -0.446463
4     010E852380E40FB1BD5DB43C2D83FFE9AAE05B330FCA51...             -0.640116
...                                                 ...                   ...
1276  FF9FE70C24E5AC0646100D783F8E4033FE39E0532B86FB...              0.028513
1277  FFA1228B74DC1BC97BBB4CC7FCF812BBA979C1D0E6FB66...              0.239789
1278  FFAF7A01888D9005A21A1C22CC3BC3B487CA7B4A7829A1...             -0.386232
1279  FFBE6497F66B97BD0FFAC62B0E5ED0A3CA89E07885039C...             -0.307208
1280  FFC0FE156D4D58A807AE58E3C67B1CAFAA4D1B09794163...             -0.538852

[1281 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 1281, vs. num we are initializing: 1281
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 1281
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=15.251669 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.134798 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.684022 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.577295 | time=0.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.534343 | time=1.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.510123 | time=1.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.494729 | time=1.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.485128 | time=1.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.478793 | time=2.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.474751 | time=2.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.471938 | time=2.5s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(-0.6351, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.471852 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.251423 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.241560 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.238795 | time=1.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=110 | loss=1.238687 | time=1.2s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.514065 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.415423 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.414152 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=075 | loss=0.414102 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(0.2425, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.4719, 1.2387, 0.4141
INFO:birdwatch.scorer:MFGroupScorer_3 Low Diligence MF elapsed time: 4.26 secs (0.07 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 45761 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 180 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.19 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.78 secs (0.03 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.29 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.28 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.30 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.44 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 92.71 secs (1.55 mins)
INFO:birdwatch.constants:MFGroupScorer_3: Compute tag thresholds for percentiles elapsed time: 0.44 secs (0.01 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_2 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_2.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 42885
INFO:birdwatch.scorer:MFGroupScorer_2 Filter input elapsed time: 6.82 secs (0.11 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_2: 6331503e965a834318c9020257dcd52d771dd42b79006909fe2d0bc59788e68a
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 9721, Num Unique Notes Rated: 973, Num Unique Raters: 588
INFO:birdwatch.scorer:MFGroupScorer_2 Prepare ratings elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_2: 9f82ef3c30f5f748b7ba7c332c68b0eabbb0df77f252720af0f86103ae9769e8
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_2: a98b9575925fbdbc138fad20a54069ccbb0a2d5fa3b11835db1f34e65d093d9a
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_2: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 588, Notes: 973
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 9.990750256937307
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 16.532312925170068
INFO:birdwatch.matrix_factorization:epoch 0 7.339871406555176
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 6.832291126251221
INFO:birdwatch.matrix_factorization:epoch 20 0.2535027861595154
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.19349800050258636
INFO:birdwatch.matrix_factorization:epoch 40 0.12156889587640762
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.08351347595453262
INFO:birdwatch.matrix_factorization:epoch 60 0.0943785160779953
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05867411568760872
INFO:birdwatch.matrix_factorization:epoch 80 0.09093496203422546
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.055984921753406525
INFO:birdwatch.matrix_factorization:epoch 100 0.09045129269361496
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05565788596868515
INFO:birdwatch.matrix_factorization:epoch 120 0.09039328992366791
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05567096918821335
INFO:birdwatch.matrix_factorization:epoch 140 0.0903855711221695
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05565659701824188
INFO:birdwatch.matrix_factorization:Num epochs: 144
INFO:birdwatch.matrix_factorization:epoch 144 0.0903853178024292
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05566127598285675
INFO:birdwatch.matrix_factorization:Global Intercept: 0.16218987107276917
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_2 First MF/stable init elapsed time: 1.30 secs (0.02 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_2

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 19967 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 53 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.18 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.10 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.25 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.50 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.22 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.34 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.32 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 89.95 secs (1.50 mins)
INFO:birdwatch.scorer:MFGroupScorer_2 Compute scored notes elapsed time: 121.32 secs (2.02 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 42863 post-tombstones and 22 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 33357, including 33357 post-tombstones and 0 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 2173
INFO:birdwatch.scorer:MFGroupScorer_2 Compute valid ratings elapsed time: 1.78 secs (0.03 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_2 Helpfulness scores pre-harassment  elapsed time: 0.14 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 588
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 2028
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 1363
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 375
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 9721
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 6742
INFO:birdwatch.scorer:MFGroupScorer_2 Filtering by helpfulness score elapsed time: 0.02 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    4183
1     262
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 2297
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 976, Num Unique Notes Rated: 121, Num Unique Raters: 98
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    948
1     28
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.028688524590163935
INFO:birdwatch.matrix_factorization:Using pos weight: 33.857142857142854 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 98, Notes: 121
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 8.066115702479339
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 9.959183673469388
INFO:birdwatch.matrix_factorization:epoch 0 2.7565648555755615
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.8603439927101135
INFO:birdwatch.matrix_factorization:epoch 20 0.6052011251449585
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.21931278705596924
INFO:birdwatch.matrix_factorization:epoch 40 0.3308408856391907
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.11807742714881897
INFO:birdwatch.matrix_factorization:epoch 60 0.2876792550086975
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.113236203789711
INFO:birdwatch.matrix_factorization:epoch 80 0.2807309031486511
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.11274757236242294
INFO:birdwatch.matrix_factorization:epoch 100 0.27520251274108887
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.10664291679859161
INFO:birdwatch.matrix_factorization:epoch 120 0.24602246284484863
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.08762259781360626
INFO:birdwatch.matrix_factorization:Num epochs: 126
INFO:birdwatch.matrix_factorization:epoch 126 0.23860864341259003
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07987058162689209
INFO:birdwatch.matrix_factorization:Global Intercept: -0.2181515395641327
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_2 Harassment tag consensus elapsed time: 0.51 secs (0.01 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_2 Helpfulness scores post-harassment elapsed time: 0.20 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 588
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 2028
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 1363
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 375
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 9721
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 6742
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 375, Notes: 970
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 6.950515463917526
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 17.978666666666665
INFO:birdwatch.matrix_factorization:epoch 0 0.40046897530555725
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3260018527507782
INFO:birdwatch.matrix_factorization:epoch 20 0.09118765592575073
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05355978012084961
INFO:birdwatch.matrix_factorization:epoch 40 0.08571460843086243
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05113007500767708
INFO:birdwatch.matrix_factorization:epoch 60 0.08422807604074478
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.048026882112026215
INFO:birdwatch.matrix_factorization:epoch 80 0.08413302153348923
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.048013489693403244
INFO:birdwatch.matrix_factorization:epoch 100 0.08410234749317169
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04785771667957306
INFO:birdwatch.matrix_factorization:Num epochs: 102
INFO:birdwatch.matrix_factorization:epoch 102 0.08410283923149109
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04792065918445587
INFO:birdwatch.matrix_factorization:Global Intercept: 0.16896888613700867
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 0.62 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_2 prescoring, about to call diligence with 6742 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                    raterParticipantId  internalRaterFactor1
0    004155EE77F1D621C93AC236A4E0DC3F3ADE8362817535...             -0.553908
1    006D40D8573E03CCCE668D8C289DEA96FB519A75356786...             -0.127671
2    00A4EDC01FFF8C52C55BA50811078061D15C23E5ECA99A...             -0.374762
3    019065DD62143A0CFEBF5C9DCFC4F67549A76C7EE02E29...             -0.346178
4    01DF80CE748D764930B05F40EA2E3CA86C220AC05F87F9...              0.169136
..                                                 ...                   ...
370  FCF5C6479C7EC58AB271F1AF8D46438C754E5E730766CE...             -0.121728
371  FD6357C7D5694C614853A40BDCAE231AD9327294BABCFC...             -0.517875
372  FD8CDB4FFEDA9C0B025FCD1E318B8CCFCA0E349E683265...             -0.436516
373  FE9616D890308B83BA931D17A92EE72CFB5F669017216D...             -0.544217
374  FEC16AB59DFD7992B5D16534CB7A1B1CC4C8C84E088ADE...              0.074621

[375 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 375, vs. num we are initializing: 375
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 375
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=18.979654 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.267118 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.734488 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.602574 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.549633 | time=0.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.520396 | time=0.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.501820 | time=1.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.486717 | time=1.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.474284 | time=1.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.466560 | time=1.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.460880 | time=1.6s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(-0.2926, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.460683 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.271250 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.262270 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.261544 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=100 | loss=1.261521 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.579861 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.489483 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.488344 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=075 | loss=0.488298 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(0.0128, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.4609, 1.2615, 0.4883
INFO:birdwatch.scorer:MFGroupScorer_2 Low Diligence MF elapsed time: 2.37 secs (0.04 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 19967 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 53 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.21 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.23 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.04 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.27 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.23 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.21 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.30 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 91.28 secs (1.52 mins)
INFO:birdwatch.constants:MFGroupScorer_2: Compute tag thresholds for percentiles elapsed time: 0.29 secs (0.00 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_1 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_1.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 171481
INFO:birdwatch.scorer:MFGroupScorer_1 Filter input elapsed time: 6.33 secs (0.11 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_1: 514cbbb55733ae23ec6fda54816d75fa9b21d10ee0a3dfbda917c30318f23614
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 56729, Num Unique Notes Rated: 2248, Num Unique Raters: 3052
INFO:birdwatch.scorer:MFGroupScorer_1 Prepare ratings elapsed time: 0.13 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_1: c3986be02fc74c0ba8c6b9ec52f34215f2b47f8a3264070d51e0924f8f3543d0
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_1: a98b9575925fbdbc138fad20a54069ccbb0a2d5fa3b11835db1f34e65d093d9a
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_1: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 3052, Notes: 2248
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 25.235320284697508
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 18.58748361730013
INFO:birdwatch.matrix_factorization:epoch 0 7.535259246826172
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 7.035916328430176
INFO:birdwatch.matrix_factorization:epoch 20 0.24976661801338196
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18853655457496643
INFO:birdwatch.matrix_factorization:epoch 40 0.09952807426452637
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0646577998995781
INFO:birdwatch.matrix_factorization:epoch 60 0.07942277938127518
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04925694689154625
INFO:birdwatch.matrix_factorization:epoch 80 0.07669013738632202
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04689227417111397
INFO:birdwatch.matrix_factorization:epoch 100 0.07631409168243408
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.046735864132642746
INFO:birdwatch.matrix_factorization:epoch 120 0.07626810669898987
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04670638218522072
INFO:birdwatch.matrix_factorization:Num epochs: 135
INFO:birdwatch.matrix_factorization:epoch 135 0.07626302540302277
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04673013091087341
INFO:birdwatch.matrix_factorization:Global Intercept: 0.14168956875801086
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_1 First MF/stable init elapsed time: 2.39 secs (0.04 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_1

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 67149 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 597 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.49 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.16 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.60 secs (0.03 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.04 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.61 secs (0.03 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.46 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.51 secs (0.03 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.13 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.69 secs (0.03 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 114.34 secs (1.91 mins)
INFO:birdwatch.scorer:MFGroupScorer_1 Compute scored notes elapsed time: 152.15 secs (2.54 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 171446 post-tombstones and 35 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 138431, including 138431 post-tombstones and 0 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 7133
INFO:birdwatch.scorer:MFGroupScorer_1 Compute valid ratings elapsed time: 2.07 secs (0.03 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_1 Helpfulness scores pre-harassment  elapsed time: 0.20 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 3052
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 6752
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 5502
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 1366
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 56729
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 29323
INFO:birdwatch.scorer:MFGroupScorer_1 Filtering by helpfulness score elapsed time: 0.11 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    16579
1     2228
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 10516
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 11022, Num Unique Notes Rated: 705, Num Unique Raters: 672
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    9753
1    1269
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.11513336962438758
INFO:birdwatch.matrix_factorization:Using pos weight: 7.685579196217494 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 672, Notes: 705
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 15.63404255319149
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 16.401785714285715
INFO:birdwatch.matrix_factorization:epoch 0 3.065234661102295
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 1.2045278549194336
INFO:birdwatch.matrix_factorization:epoch 20 0.6197426319122314
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2291819453239441
INFO:birdwatch.matrix_factorization:epoch 40 0.3839772939682007
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.19567808508872986
INFO:birdwatch.matrix_factorization:epoch 60 0.35295569896698
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18792495131492615
INFO:birdwatch.matrix_factorization:epoch 80 0.3489841818809509
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18815869092941284
INFO:birdwatch.matrix_factorization:epoch 100 0.34844446182250977
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18789835274219513
INFO:birdwatch.matrix_factorization:epoch 120 0.3483746647834778
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18781889975070953
INFO:birdwatch.matrix_factorization:epoch 140 0.3483657240867615
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.1878279745578766
INFO:birdwatch.matrix_factorization:Num epochs: 143
INFO:birdwatch.matrix_factorization:epoch 143 0.34836551547050476
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.1878231316804886
INFO:birdwatch.matrix_factorization:Global Intercept: -0.18927985429763794
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_1 Harassment tag consensus elapsed time: 1.50 secs (0.03 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_1 Helpfulness scores post-harassment elapsed time: 0.27 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 3052
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 6752
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 5502
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 1366
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 56729
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 29323
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 1366, Notes: 2228
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 13.16113105924596
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 21.46632503660322
INFO:birdwatch.matrix_factorization:epoch 0 0.43265894055366516
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.36698365211486816
INFO:birdwatch.matrix_factorization:epoch 20 0.07936793565750122
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04683771729469299
INFO:birdwatch.matrix_factorization:epoch 40 0.07487647235393524
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04619744420051575
INFO:birdwatch.matrix_factorization:epoch 60 0.07384366542100906
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04453465715050697
INFO:birdwatch.matrix_factorization:epoch 80 0.0736643597483635
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04378746077418327
INFO:birdwatch.matrix_factorization:epoch 100 0.0736546516418457
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.043801914900541306
INFO:birdwatch.matrix_factorization:Num epochs: 101
INFO:birdwatch.matrix_factorization:epoch 101 0.0736546516418457
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.043801914900541306
INFO:birdwatch.matrix_factorization:Global Intercept: 0.1414526253938675
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 1.64 secs (0.03 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_1 prescoring, about to call diligence with 29323 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                     raterParticipantId  internalRaterFactor1
0     00112506AE39C99AC786AD84B9C4CF2EC5040813AB92FF...             -0.160904
1     0023E170A507256EDF23FF2BDD8C448C483228143F0005...             -0.386047
2     003C46FD89FA2D8E73B739ADE9A567CFCD9924A74308EB...             -0.568222
3     0042E705C9CC807BECE823F245D34D18F0B2BD80D575A7...              0.636199
4     004ADBC69D4312D219477CF778E9D8BC19BF9280135D57...             -0.346392
...                                                 ...                   ...
1361  FEDD8FF0ED6BAC4996AC061841CC9B62DB246AF5C0A3BE...              0.774289
1362  FEF5C89461E9EDC9443990BF3225DBF0F5233CC2143350...             -0.490731
1363  FF501081452FE92A0E41AB20BB62156E32E07826BE7E63...             -0.360574
1364  FF606A8A07943D2836B1392C2BD9CC6331508BA0A01231...             -0.468581
1365  FF7A4377FD8A6393B76A69F95EDBD9EF7A24CCD97B8D84...             -0.434507

[1366 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 1366, vs. num we are initializing: 1366
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 1366
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=23.466072 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.633713 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.991498 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.859650 | time=1.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.817434 | time=1.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.795994 | time=1.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.784139 | time=2.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.776934 | time=2.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.771746 | time=2.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.767355 | time=3.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.764169 | time=3.6s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(0.5174, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.764078 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.512291 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.501455 | time=0.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.500608 | time=1.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=100 | loss=1.500582 | time=1.5s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.469256 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.362996 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.361511 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=080 | loss=0.361448 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(1.3229, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.7642, 1.5006, 0.3614
INFO:birdwatch.scorer:MFGroupScorer_1 Low Diligence MF elapsed time: 5.87 secs (0.10 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 67149 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 597 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.31 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.11 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.38 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.04 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.42 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.33 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.32 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.10 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.47 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 97.66 secs (1.63 mins)
INFO:birdwatch.constants:MFGroupScorer_1: Compute tag thresholds for percentiles elapsed time: 0.38 secs (0.01 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_14 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_14.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 314456
INFO:birdwatch.scorer:MFGroupScorer_14 Filter input elapsed time: 6.58 secs (0.11 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_14: 3c51175ec22dbcdcc830bf1a5f5de3159bec4b480330a98c16e9be42e553975d
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 184135, Num Unique Notes Rated: 8293, Num Unique Raters: 7166
INFO:birdwatch.scorer:MFGroupScorer_14 Prepare ratings elapsed time: 0.27 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_14: 22163bc70855e634fde7a9624dec7bc542a8563bef074e1c58394ad29d7bae17
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_14: a98b9575925fbdbc138fad20a54069ccbb0a2d5fa3b11835db1f34e65d093d9a
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_14: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 7166, Notes: 8293
INFO:birdwatch.matrix_factorization:learning rate set to :0.02
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 22.20366574219221
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 25.695646106614568
INFO:birdwatch.matrix_factorization:epoch 0 0.4977082908153534
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.4969539940357208
INFO:birdwatch.matrix_factorization:epoch 20 0.18958830833435059
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.13712716102600098
INFO:birdwatch.matrix_factorization:epoch 40 0.1387222707271576
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.09859807044267654
INFO:birdwatch.matrix_factorization:epoch 60 0.10871246457099915
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07200683653354645
INFO:birdwatch.matrix_factorization:epoch 80 0.09967868030071259
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06717623770236969
INFO:birdwatch.matrix_factorization:epoch 100 0.09693367034196854
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06644365191459656
INFO:birdwatch.matrix_factorization:epoch 120 0.09595268219709396
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06644069403409958
INFO:birdwatch.matrix_factorization:Num epochs: 136
INFO:birdwatch.matrix_factorization:epoch 136 0.09563057124614716
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06651900708675385
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 7166, Notes: 8293
INFO:birdwatch.matrix_factorization:learning rate set to :0.02
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:epoch 0 0.21148733794689178
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.49696826934814453
INFO:birdwatch.matrix_factorization:epoch 20 0.09629814326763153
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.1523735076189041
INFO:birdwatch.matrix_factorization:epoch 40 0.07523325085639954
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.1137603148818016
INFO:birdwatch.matrix_factorization:epoch 60 0.06108444184064865
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07974953949451447
INFO:birdwatch.matrix_factorization:epoch 80 0.056699156761169434
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07604493200778961
INFO:birdwatch.matrix_factorization:epoch 100 0.05523372441530228
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0762765035033226
INFO:birdwatch.matrix_factorization:epoch 120 0.05476401373744011
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07657098025083542
INFO:birdwatch.matrix_factorization:Num epochs: 127
INFO:birdwatch.matrix_factorization:epoch 127 0.05467725172638893
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07661604881286621
INFO:birdwatch.matrix_factorization:Global Intercept: 0.20000217854976654
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_14 First MF/stable init elapsed time: 12.01 secs (0.20 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_14

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 204215 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 413 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.15 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.19 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.25 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.11 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.19 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.45 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 80.78 secs (1.35 mins)
INFO:birdwatch.scorer:MFGroupScorer_14 Compute scored notes elapsed time: 109.63 secs (1.83 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 314180 post-tombstones and 276 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 255465, including 255439 post-tombstones and 26 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 12064
INFO:birdwatch.scorer:MFGroupScorer_14 Compute valid ratings elapsed time: 1.98 secs (0.03 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_14 Helpfulness scores pre-harassment  elapsed time: 0.19 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 7166
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 10434
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 6820
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 3305
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 184135
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 102973
INFO:birdwatch.scorer:MFGroupScorer_14 Filtering by helpfulness score elapsed time: 0.26 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    59720
1     4407
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 38846
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 44129, Num Unique Notes Rated: 3218, Num Unique Raters: 1964
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    41226
1     2903
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.06578440481316142
INFO:birdwatch.matrix_factorization:Using pos weight: 14.201171202204614 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 1964, Notes: 3218
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 13.713175885643256
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 22.468940936863543
INFO:birdwatch.matrix_factorization:epoch 0 3.0821547508239746
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 1.22616446018219
INFO:birdwatch.matrix_factorization:epoch 20 0.6607519388198853
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.23567473888397217
INFO:birdwatch.matrix_factorization:epoch 40 0.39015012979507446
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.20176583528518677
INFO:birdwatch.matrix_factorization:epoch 60 0.3560217618942261
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.19389602541923523
INFO:birdwatch.matrix_factorization:epoch 80 0.35133492946624756
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.19346661865711212
INFO:birdwatch.matrix_factorization:epoch 100 0.3506583571434021
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.19334207475185394
INFO:birdwatch.matrix_factorization:epoch 120 0.3505558371543884
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.19339650869369507
INFO:birdwatch.matrix_factorization:epoch 140 0.35053837299346924
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.1933712512254715
INFO:birdwatch.matrix_factorization:Num epochs: 153
INFO:birdwatch.matrix_factorization:epoch 153 0.35053592920303345
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.19336070120334625
INFO:birdwatch.matrix_factorization:Global Intercept: -0.2770853042602539
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_14 Harassment tag consensus elapsed time: 2.13 secs (0.04 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)


MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 183: helpfulnessScores = helpfulnessScores.merge(
  PandasTypeError: Output mismatch on totalHelpfulHarassmentPenalty: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_14 Helpfulness scores post-harassment elapsed time: 0.28 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 7166
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 10434
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 6775
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 3260
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 184135
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 100907
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 3260, Notes: 8246
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.02
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 12.237084647101625
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 30.953067484662576
INFO:birdwatch.matrix_factorization:epoch 0 0.13671191036701202
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.1127113401889801
INFO:birdwatch.matrix_factorization:epoch 20 0.09690795838832855
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06653041392564774
INFO:birdwatch.matrix_factorization:epoch 40 0.0932772308588028
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06367000192403793
INFO:birdwatch.matrix_factorization:epoch 60 0.0927320346236229
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06332123279571533
INFO:birdwatch.matrix_factorization:Num epochs: 76
INFO:birdwatch.matrix_factorization:epoch 76 0.0926491916179657
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0632554441690445
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 3260, Notes: 8246
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.02
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:epoch 0 0.13227345049381256
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2895028293132782
INFO:birdwatch.matrix_factorization:epoch 20 0.06256450712680817
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0810943990945816
INFO:birdwatch.matrix_factorization:epoch 40 0.05481414124369621
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07347706705331802
INFO:birdwatch.matrix_factorization:epoch 60 0.052908387035131454
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07434885203838348
INFO:birdwatch.matrix_factorization:epoch 80 0.05236583948135376
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07474631071090698
INFO:birdwatch.matrix_factorization:epoch 100 0.052147552371025085
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07504390180110931
INFO:birdwatch.matrix_factorization:Num epochs: 106
INFO:birdwatch.matrix_factorization:epoch 106 0.05211050808429718
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07510360330343246
INFO:birdwatch.matrix_factorization:Global Intercept: 0.19278715550899506
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 4.93 secs (0.08 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_14 prescoring, about to call diligence with 100907 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                     raterParticipantId  internalRaterFactor1
0     000B5C69FAB0466A4CDD351B8F2A116C6FB2033EBE430A...              0.625285
1     00108E4CC8AF3573F479BD3EC1ED4DE673BB74F78BA96F...             -0.883891
2     0026842E7BA6E0D7B865A12D877689B96DE9A7DB19E19F...              0.798600
3     003CACFF7428964A519071D84C8353F905FC9DD45DF76A...             -0.689759
4     003D2B3D72FF436059DC4E01162C7253A0635B275A35D9...              0.501069
...                                                 ...                   ...
3255  FF78F603EF4B1B58D481C10F587E3C6BBDD4AE0D00BECB...              0.446769
3256  FF7B612D6F6781CC7DFD34073CCA1958DE0357EF97C9D3...              0.730143
3257  FFB5647328B8D14158E857811DAF369FDCCD24772E2EBC...              0.744719
3258  FFEC6A5CC145DFB2F63DFB1453E10ECEE8E6C032F76FC3...             -0.896270
3259  FFF22CB48A5F4C1C0F944C552973CE17979A4B2F5C225C...             -0.839188

[3260 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 3260, vs. num we are initializing: 3260
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 3260
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=17.795786 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.444666 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.957232 | time=0.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.864020 | time=1.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.831203 | time=1.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.814529 | time=2.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.804344 | time=2.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.797222 | time=3.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.792307 | time=3.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.788672 | time=4.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.786227 | time=4.6s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(-0.0434, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.786156 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.591655 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.582263 | time=0.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.581475 | time=1.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=100 | loss=1.581451 | time=1.5s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.495022 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.401515 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.400312 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=075 | loss=0.400261 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(0.9708, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.7862, 1.5815, 0.4003
INFO:birdwatch.scorer:MFGroupScorer_14 Low Diligence MF elapsed time: 6.96 secs (0.12 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 204215 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 413 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.14 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.25 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.04 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.60 secs (0.03 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.24 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.24 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.38 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 86.07 secs (1.43 mins)
INFO:birdwatch.constants:MFGroupScorer_14: Compute tag thresholds for percentiles elapsed time: 0.64 secs (0.01 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_33 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_33.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 14795
INFO:birdwatch.scorer:MFGroupScorer_33 Filter input elapsed time: 7.22 secs (0.12 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_33: eb790d8d02e3e4fc7c7d9ac07482b2b150a4ea405a5f63d762709432f45d3687
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 4039, Num Unique Notes Rated: 207, Num Unique Raters: 264
INFO:birdwatch.scorer:MFGroupScorer_33 Prepare ratings elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_33: a7896b21d0313197bbde21ccc7c83268221805b27ce14c6be33724bdf979100b
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_33: a98b9575925fbdbc138fad20a54069ccbb0a2d5fa3b11835db1f34e65d093d9a
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_33: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 264, Notes: 207
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 19.51207729468599
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 15.299242424242424
INFO:birdwatch.matrix_factorization:epoch 0 5.7597479820251465
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 5.251858711242676
INFO:birdwatch.matrix_factorization:epoch 20 0.19172403216362
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.1278972029685974
INFO:birdwatch.matrix_factorization:epoch 40 0.07982872426509857
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03230893611907959
INFO:birdwatch.matrix_factorization:epoch 60 0.06006423756480217
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.019394658505916595
INFO:birdwatch.matrix_factorization:epoch 80 0.05130232498049736
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.01712273433804512
INFO:birdwatch.matrix_factorization:epoch 100 0.05030415579676628
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0163002610206604
INFO:birdwatch.matrix_factorization:epoch 120 0.050157301127910614
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.016404740512371063
INFO:birdwatch.matrix_factorization:epoch 140 0.05013864487409592
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.01639598421752453
INFO:birdwatch.matrix_factorization:Num epochs: 146
INFO:birdwatch.matrix_factorization:epoch 146 0.05013764649629593
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.01636931300163269
INFO:birdwatch.matrix_factorization:Global Intercept: 0.14795048534870148
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_33 First MF/stable init elapsed time: 1.11 secs (0.02 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_33

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 4226 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 63 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.14 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.10 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.23 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.08 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.08 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.21 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.20 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.41 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 92.59 secs (1.54 mins)
INFO:birdwatch.scorer:MFGroupScorer_33 Compute scored notes elapsed time: 125.56 secs (2.09 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 14795 post-tombstones and 0 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 10786, including 10786 post-tombstones and 0 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 217
INFO:birdwatch.scorer:MFGroupScorer_33 Compute valid ratings elapsed time: 2.18 secs (0.04 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_33 Helpfulness scores pre-harassment  elapsed time: 0.13 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 264
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 232
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 192
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 42
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 4039
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 717
INFO:birdwatch.scorer:MFGroupScorer_33 Filtering by helpfulness score elapsed time: 0.02 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    652
1      2
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 63
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 200, Num Unique Notes Rated: 30, Num Unique Raters: 19
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    200
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse tag positive rate is 0.0: returning None and aborting notHelpfulSpamHarassmentOrAbuse model training.
INFO:birdwatch.scorer:MFGroupScorer_33 Harassment tag consensus elapsed time: 0.03 secs (0.00 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_33 Helpfulness scores post-harassment elapsed time: 0.11 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 264
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 232
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 192
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 42
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 4039
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 717
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 42, Notes: 183
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 3.918032786885246
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 17.071428571428573
INFO:birdwatch.matrix_factorization:epoch 0 0.543944776058197
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.45667192339897156
INFO:birdwatch.matrix_factorization:epoch 20 0.05730441212654114
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.013899115845561028
INFO:birdwatch.matrix_factorization:epoch 40 0.05342967063188553
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.011802248656749725
INFO:birdwatch.matrix_factorization:epoch 60 0.05152231082320213
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.012747115455567837
INFO:birdwatch.matrix_factorization:epoch 80 0.05088213086128235
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.010834014043211937
INFO:birdwatch.matrix_factorization:Num epochs: 82
INFO:birdwatch.matrix_factorization:epoch 82 0.05088218301534653
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.010831760242581367
INFO:birdwatch.matrix_factorization:Global Intercept: 0.20564056932926178
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 0.35 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_33 prescoring, about to call diligence with 717 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                   raterParticipantId  internalRaterFactor1
0   07F9F0F26C9F82E8848562815D0359CA414AAFF175D552...             -0.612232
1   09607871CE251DA1617067D306D55E743B71C1108F5D7A...              0.367253
2   0C7E40EF08E14F494B478879BADCE4E8F2DA2C65ACF130...              0.393821
3   281A26459CA7831354ACC128311BE88C7210E6E5CB2C3E...             -0.406995
4   3253192B6C494A85E0558BD2134D79CB166B5FF012E0E4...             -0.577815
5   357DE6431AAB5F8DBB182DE8EF73ECCC4A8007B3185BA2...             -0.518043
6   43DA6E75C707DFFE55D782C7CDE344D39BB5F3771F3013...             -0.647289
7   50842D703CE58C5529C82175D47DF7ACF11664A43423FB...             -0.531719
8   54181B66F1C421355416829FA4EDD24D93B396E492339A...             -0.534643
9   5694E6530996AC1A6281083E691CCA3FC9C292C201AE96...             -0.631398
10  579406E812B1AB336C0C8AD8E4F357E3678C49E4B394ED...             -0.590831
11  60C79F791A410F772AE616A950D2520EB111ADAAF139E9...             -0.413984
12  67995D6FA66C918AD7E816F695E307D96A97F6EDB68B2D...             -0.617879
13  70752682E10040EBF50C6D1934A1ED93BEC848BCE3D105...             -0.138725
14  7248565463894E4A69132CC09943A8482C8AFD4E7EF611...             -0.355470
15  752BFBE2BD61F9096E18083EE2E8A193E9143945D4332C...              0.311956
16  781B2D137805731E39AF2FE707197725F6DEE820EA7477...             -0.650675
17  78FB6CF821108F1AD5B05CE035758C6ECF03450A1090F4...             -0.189665
18  79322F8FC9D78A663EAB65454794D08E17CF3988DF64B8...             -0.520417
19  7AEE95CB66D25841C2BAF5BFC4496CB5CB67EA6CC21212...              0.408432
20  80BE8059CF6D3B90B2A752959F6B6ACED18BB08C33D502...              0.533459
21  8172896AE09B906B0D11531B80ED2A28AD9C6FB6A0E100...             -0.479791
22  871031957E92A057D995286B6D7C4E8E007A25E8C018F4...             -0.570968
23  9294BB7CB3D5BA1D3F7C6F3545C56CECA7615CFC2A9D4D...             -0.530918
24  95AFF705DEF22889105778EA39A6F9B4E9313D5BD7D710...             -0.688770
25  9705A73677B41C2A1C55DA7BDECE501C0A3A93D8E1DE25...             -0.515355
26  9ECB1EE68B86AC4974DD3AD19CC433E89E8EE88FF62D74...              0.341670
27  A2205139F8E8A2C635D495128DD7ECAC70D0DBB4766AB6...             -0.698455
28  A3F0B84AA806E3DB8D54B026EB474D3652E4A1515FC420...             -0.583575
29  AB09CFCE51432283F95DE979E26880FD26FAA001B102DB...             -0.496792
30  B35B364064C1555A7F51E4BDE9FA8258BD7AD35397E561...             -0.608091
31  B3AAA87CF0434FC699F383C59BA77E5E8602BF5E85A868...              0.063479
32  B4919D3DC8FB1FCF6B9F0C113F59F844A289F3F14233C5...              0.522529
33  CA61CECE655294BFA083FEFE1AD8173ECD65F902EC5370...             -0.558418
34  D07A5792EBB9295F69EFB61129D4271FB4E43DF28959F1...             -0.539204
35  D8C6F6C4EF39E440B4D2A972CB81210841624CC4D04550...             -0.610494
36  DBF79DADD9FE2CB8FD3D5A3E7621E10D0646449CD3BC46...             -0.520808
37  DF1C55F430F0E859D5520FE413388B38CF64CBA62087FB...             -0.522940
38  E4D796BCD74B8095D02AFD6A58669D7FB1B272F9B934C3...             -0.579038
39  ECD0A2ABEF013BECBFAE24F481F37E7A2ECCB71AC7714A...             -0.590585
40  F7B2DC436D20887BAF3C969EF64AD33A79D09A4ED26124...             -0.605060
41  FD7C32A30F2DC53BD9498C93A0A2E9E50A74FDB43D186C...             -0.452252
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 42, vs. num we are initializing: 42
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 42
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=6.696291 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.966361 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.800907 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.709586 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=1.654588 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=1.631737 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=1.623026 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=1.619474 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=1.617880 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=1.617107 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=1.616712 | time=0.6s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(-4.3126, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=1.616703 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.136013 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.135105 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=0.133466 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=110 | loss=0.133396 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.109302 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.100948 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=055 | loss=0.100694 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(-4.7992, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 1.6167, 0.1334, 0.1007
INFO:birdwatch.scorer:MFGroupScorer_33 Low Diligence MF elapsed time: 0.96 secs (0.02 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 4226 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 63 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.25 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.16 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.15 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.15 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.40 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.28 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 94.92 secs (1.58 mins)
INFO:birdwatch.constants:MFGroupScorer_33: Compute tag thresholds for percentiles elapsed time: 0.25 secs (0.00 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFTopicScorer_Unassigned set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFTopicScorer_Unassigned.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 0
INFO:birdwatch.scorer:  Ratings after group filter: 0
INFO:birdwatch.scorer:MFTopicScorer_Unassigned Filter input elapsed time: 3.83 secs (0.06 mins)

INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFTopicScorer_UkraineConflict set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFTopicScorer_UkraineConflict.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 106029
INFO:birdwatch.scorer:  Ratings after group filter: 106029
INFO:birdwatch.scorer:MFTopicScorer_UkraineConflict Filter input elapsed time: 2.22 secs (0.04 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFTopicScorer_UkraineConflict: 112737fb49e6cbb86c03f3dcdcec1e79948127608951a35f6c345fdaa5addb6e
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 10480, Num Unique Notes Rated: 488, Num Unique Raters: 714
INFO:birdwatch.scorer:MFTopicScorer_UkraineConflict Prepare ratings elapsed time: 0.12 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFTopicScorer_UkraineConflict: 0622c6cc9c96def5da0d9ecff9220be80cb3407c66097f2c7818020fb4445a57
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFTopicScorer_UkraineConflict: e2315a96ac7cc47e5b5056688b6f0ad8bb146f4d61c03ee4214c82605ada9bc0
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFTopicScorer_UkraineConflict: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 714, Notes: 488
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 21.475409836065573
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 14.677871148459383
INFO:birdwatch.matrix_factorization:epoch 0 6.951846599578857
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 6.443840026855469
INFO:birdwatch.matrix_factorization:epoch 20 0.23378662765026093
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.15690366923809052
INFO:birdwatch.matrix_factorization:epoch 40 0.11797330528497696
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07507527619600296
INFO:birdwatch.matrix_factorization:epoch 60 0.07364830374717712
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03857782483100891
INFO:birdwatch.matrix_factorization:epoch 80 0.06733620166778564
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03335252031683922
INFO:birdwatch.matrix_factorization:epoch 100 0.06636281311511993
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.032734937965869904
INFO:birdwatch.matrix_factorization:epoch 120 0.06623274087905884
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03274518996477127
INFO:birdwatch.matrix_factorization:epoch 140 0.06621849536895752
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03270392864942551
INFO:birdwatch.matrix_factorization:Num epochs: 141
INFO:birdwatch.matrix_factorization:epoch 141 0.06621849536895752
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03270392864942551
INFO:birdwatch.matrix_factorization:Global Intercept: 0.1517382115125656
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFTopicScorer_UkraineConflict First MF/stable init elapsed time: 1.43 secs (0.02 mins)
INFO:birdwatch.mf_base_scorer:Skipping rep-filtering in prescoring for MFTopicScorer_UkraineConflict
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py:622: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  helpfulnessScores[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py:642: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  harassmentAbuseNoteParams[[c.harassmentNoteInterceptKey, c.harassmentNoteFactor1Key]] = np.nan
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py:642: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  harassmentAbuseNoteParams[[c.harassmentNoteInterceptKey, c.harassmentNoteFactor1Key]] = np.nan
INFO:birdwatch.mf_base_scorer:In MFTopicScorer_UkraineConflict prescoring, about to call diligence with 10480 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                    raterParticipantId  internalRaterFactor1
0    85B9E8186274A9ADCC3B045AF0F8E32370856F5FFCD762...              0.282404
1    CBB8CC89C65869515F3EA8446A44BF126AB96D30470FDD...             -0.810993
2    9C053B9C35CB5435320126E54A7C149DEC1AC8777447A3...             -0.426361
3    19C99014A287B37E0A1CDAFC8A35C1ED6BD276D5502AE2...             -0.655216
4    3765CA200B3D098D1F594F1DD96A1CB4D25146094EFEAD...             -0.506287
..                                                 ...                   ...
709  F2BCC6C60FDD8CAF901E652FE6D8157DD3BDAD65F623A3...             -0.725851
710  CA13806B4DBB8C01F033A0DC988A4450E9C685A8E3C5E9...              0.449243
711  CDAFD2677C1AF34248F196207D76B13D7D37890102474C...              0.341337
712  7561B82DAB6D3FBE2ECD8CF94056476CE9252C8890DB36...              0.518141
713  7D7BAA5B227CBB1058E05356F5A8CA9BD8F35691C4E0D1...              0.429968

[714 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 714, vs. num we are initializing: 714
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 714
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=19.258612 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.357107 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.784772 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.643643 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.593320 | time=0.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.570854 | time=1.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.557845 | time=1.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.549650 | time=1.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.544185 | time=1.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.540348 | time=1.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.536782 | time=2.1s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(0.2116, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.536672 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.184267 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.177262 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.176118 | time=0.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.176118 | time=0.6s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.408421 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.319073 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.318012 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=075 | loss=0.317962 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(1.5190, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.5368, 1.1761, 0.3180
INFO:birdwatch.scorer:MFTopicScorer_UkraineConflict Low Diligence MF elapsed time: 3.09 secs (0.05 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 11316 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 5 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 0.06 secs (0.00 mins)
INFO:birdwatch.constants:MFTopicScorer_UkraineConflict: Compute tag thresholds for percentiles elapsed time: 0.22 secs (0.00 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFTopicScorer_GazaConflict set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFTopicScorer_GazaConflict.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 167755
INFO:birdwatch.scorer:  Ratings after group filter: 167755
INFO:birdwatch.scorer:MFTopicScorer_GazaConflict Filter input elapsed time: 2.45 secs (0.04 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFTopicScorer_GazaConflict: ec292a55ee27bc17b54154f98a3101d175ba504d6d07cc85360e8edc530e444c
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 30471, Num Unique Notes Rated: 848, Num Unique Raters: 1788
INFO:birdwatch.scorer:MFTopicScorer_GazaConflict Prepare ratings elapsed time: 0.49 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFTopicScorer_GazaConflict: 457f53916202b5d97d82a644db63ff100a4cec039dda0a6aa063ba85fe44e7e3
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFTopicScorer_GazaConflict: 04c40bd7301e2bbda4024ecefae3b38b2c519e68bc0b976ff60ff02e4073c50f
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFTopicScorer_GazaConflict: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 1788, Notes: 848
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 35.93278301886792
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 17.04194630872483
INFO:birdwatch.matrix_factorization:epoch 0 7.721938133239746
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 7.215432167053223
INFO:birdwatch.matrix_factorization:epoch 20 0.29041290283203125
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.23669375479221344
INFO:birdwatch.matrix_factorization:epoch 40 0.09508208930492401
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05441289022564888
INFO:birdwatch.matrix_factorization:epoch 60 0.06407684087753296
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.031724706292152405
INFO:birdwatch.matrix_factorization:epoch 80 0.0601058304309845
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.028668267652392387
INFO:birdwatch.matrix_factorization:epoch 100 0.059595733880996704
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.028162753209471703
INFO:birdwatch.matrix_factorization:epoch 120 0.05952765420079231
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.02813202142715454
INFO:birdwatch.matrix_factorization:Num epochs: 139
INFO:birdwatch.matrix_factorization:epoch 139 0.0595192089676857
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.02813124470412731
INFO:birdwatch.matrix_factorization:Global Intercept: 0.13775189220905304
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFTopicScorer_GazaConflict First MF/stable init elapsed time: 2.51 secs (0.04 mins)
INFO:birdwatch.mf_base_scorer:Skipping rep-filtering in prescoring for MFTopicScorer_GazaConflict
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py:622: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  helpfulnessScores[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py:642: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  harassmentAbuseNoteParams[[c.harassmentNoteInterceptKey, c.harassmentNoteFactor1Key]] = np.nan
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py:642: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  harassmentAbuseNoteParams[[c.harassmentNoteInterceptKey, c.harassmentNoteFactor1Key]] = np.nan
INFO:birdwatch.mf_base_scorer:In MFTopicScorer_GazaConflict prescoring, about to call diligence with 30471 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                     raterParticipantId  internalRaterFactor1
0     923890CE514A77A4C14904E320E7E11D84410D4BC0D869...              0.475112
1     AB4E403C88CD249B62AD06455A87CB0102BF4110C044E7...             -0.541745
2     4E548A7A7C565880DBFF4E51CF8E094A805DF8F4C1DA52...             -0.553476
3     354892C4E64F567A94117B5E437A8322D200CAD8BBC9E0...             -0.604376
4     B2EAB465E7379177C183482D28A88FE3A6FAE0CF2468ED...              0.620025
...                                                 ...                   ...
1783  F2BCC6C60FDD8CAF901E652FE6D8157DD3BDAD65F623A3...             -0.614103
1784  CA13806B4DBB8C01F033A0DC988A4450E9C685A8E3C5E9...              0.719236
1785  7B2C1E69883DB8FA117EE795A69779D1441B5EEDBDAA28...              0.666155
1786  D929B80B5FF339ADA3FC081819C60FFEC537198A452CBF...              0.600934
1787  661124877CA60A5DFE80D04DE9F9A9563C563C84B22D55...              0.690318

[1788 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 1788, vs. num we are initializing: 1788
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 1788
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=30.444767 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=4.013017 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=3.075451 | time=0.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.897490 | time=1.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.854806 | time=2.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.839906 | time=2.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.833256 | time=3.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.829867 | time=3.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.827998 | time=3.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.826897 | time=4.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.826209 | time=4.7s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(1.1095, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.826191 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.447701 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.441108 | time=0.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.439961 | time=1.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.439961 | time=1.1s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.359534 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.263675 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.262543 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=080 | loss=0.262491 | time=0.9s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(2.9691, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.8262, 1.4400, 0.2625
INFO:birdwatch.scorer:MFTopicScorer_GazaConflict Low Diligence MF elapsed time: 6.81 secs (0.11 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 31312 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 6 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 0.22 secs (0.00 mins)
INFO:birdwatch.constants:MFTopicScorer_GazaConflict: Compute tag thresholds for percentiles elapsed time: 0.63 secs (0.01 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFTopicScorer_MessiRonaldo set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFTopicScorer_MessiRonaldo.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 344
INFO:birdwatch.scorer:  Ratings after group filter: 344
INFO:birdwatch.scorer:MFTopicScorer_MessiRonaldo Filter input elapsed time: 3.81 secs (0.06 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFTopicScorer_MessiRonaldo: b795b3b79411d97fb70021165a6d389f3cc7158bb81533a1aa324dc93988369c
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 0, Num Unique Notes Rated: 0, Num Unique Raters: 0
INFO:birdwatch.scorer:MFTopicScorer_MessiRonaldo Prepare ratings elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.scorer:EmptyRatingException raised from MFTopicScorer_MessiRonaldo.

INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFTopicScorer_Scams set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFTopicScorer_Scams.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 51740
INFO:birdwatch.scorer:  Ratings after group filter: 51740
INFO:birdwatch.scorer:MFTopicScorer_Scams Filter input elapsed time: 2.27 secs (0.04 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFTopicScorer_Scams: 8c15d1a1e237a60b728d85f6bc014f2a0da269401b73ff021351a1ea5df83789
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 141, Num Unique Notes Rated: 23, Num Unique Raters: 48
INFO:birdwatch.scorer:MFTopicScorer_Scams Prepare ratings elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFTopicScorer_Scams: c30976cb03f266afae23d56cff707bb3165554b440a878007fa7d46c5276f51e
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFTopicScorer_Scams: a6cfb963b3968018de65825db971a81d33c58721b2b0f3dd79e3263c51ff6848
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFTopicScorer_Scams: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 48, Notes: 23
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 6.130434782608695
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 2.9375
INFO:birdwatch.matrix_factorization:epoch 0 6.489548683166504
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 5.9892120361328125
INFO:birdwatch.matrix_factorization:epoch 20 0.23488262295722961
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.15365953743457794
INFO:birdwatch.matrix_factorization:epoch 40 0.08771120756864548
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03453867509961128
INFO:birdwatch.matrix_factorization:epoch 60 0.06389828771352768
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.01980353333055973
INFO:birdwatch.matrix_factorization:epoch 80 0.060486722737550735
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.01724233850836754
INFO:birdwatch.matrix_factorization:epoch 100 0.06018051132559776
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.016790572553873062
INFO:birdwatch.matrix_factorization:Num epochs: 105
INFO:birdwatch.matrix_factorization:epoch 105 0.060152918100357056
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.016618745401501656
INFO:birdwatch.matrix_factorization:Global Intercept: 0.14596329629421234
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFTopicScorer_Scams First MF/stable init elapsed time: 0.45 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:Skipping rep-filtering in prescoring for MFTopicScorer_Scams
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py:622: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  helpfulnessScores[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py:642: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  harassmentAbuseNoteParams[[c.harassmentNoteInterceptKey, c.harassmentNoteFactor1Key]] = np.nan
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py:642: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  harassmentAbuseNoteParams[[c.harassmentNoteInterceptKey, c.harassmentNoteFactor1Key]] = np.nan
INFO:birdwatch.mf_base_scorer:In MFTopicScorer_Scams prescoring, about to call diligence with 141 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                   raterParticipantId  internalRaterFactor1
0   9C053B9C35CB5435320126E54A7C149DEC1AC8777447A3...              0.171133
1   F07A8E902F7C4CE8A8C079B41AAD849492B0427812C665...              1.237127
2   F6700CE6C398D88F68989BD0B4936602C790E4F7DAA7C6...             -0.537226
3   643AEF2B7AA1A29A9580B72982EB15A9F4229C385280DF...              0.507569
4   7803CEDE19DBFD32B1E7CC94E0EB4A34DEE5EC92167DE5...              0.072493
5   7A2D56502C5AA9B330C429DA861934DE400E079C81CB02...              0.221209
6   1C244FBE6580E8E8A036FFAFEE0911B3909144E2534C8D...              0.076077
7   E848DB71A10D211C7BC9CC031153C01CD56F146C772D00...             -0.618090
8   8509AFC203677DCB57C630A013AC2B3961AE353B648115...             -0.494849
9   4850FD72F536ADCEEBFDCAB0252EAD57F0B1E07DB71EBD...              0.172023
10  B1A872E8A595B1A1219B5E56C311A9972CB4F90B3CABEB...              0.287970
11  81568B9DB97322C4679EDC2D93D1E155AF681C485ED07A...             -0.700283
12  A1746A5E2DA2C3F27F08CA303A1DC1E72F4436A75EF1A0...             -0.805609
13  20AB4543BD8205C155FAA411DB3667AE50A98C0EB7EEAD...             -0.351380
14  555337DB5227D5F5970566FB05DDD56850EBC681365767...              0.945853
15  380DE09486B4792FA3A5D934B99B8445518C2B041C0C0D...             -0.896394
16  801EF47667BB4A265482C460A08B6BB8CD8D4399730F8E...              0.906497
17  12440F70709BC2ACDAFB6BDF47C3E1EC36A05E3D2C57F3...              0.744007
18  33577E7ED6EF21F65D527FC98A57165116BF3889CE2049...             -0.509487
19  D283DC61F9E63112EA339492182CCE9EC9952F0BA71CE9...              0.059234
20  80BD8E73C1C1D785F08347705DDC82ACC6B5C461184024...              0.101689
21  00BCB97268660AF256C5DA5F3B1841A5F79F2BCF438686...             -0.037894
22  38C1AC7E553585A426992B085C9CE0F018DD10D3BEDE1F...             -0.623641
23  FDCE1FE4470B33669F34D45F9B6CB883DE6481C8083E9B...             -0.345269
24  5332702DAA8B8FB18DDF55AB80B61A5810A7C829F0AFCF...             -0.572851
25  D16D3B645FC7BD9BD888BB950B98807A8CB2FCE06E0004...             -0.661122
26  A45F28BCE289973C2E060D666F8632CB222A9B2CAF2C23...              0.525859
27  7D96B24678C0C0CA0573A9736BEFD4638D385327A09F7F...              0.185681
28  2542EBAA7A75C87A39828B0674334C1837338224D3E71D...             -0.534410
29  B2A6B8B542D6A25A4414D8DDC2C335575C481101F76664...             -0.198968
30  21A8DFD6CAD94DBC34F53DA0DB66D340D4F690D51DC38F...             -0.730631
31  B2B612CC640FFC40D58623F44809976A90FAD75BD7A9A8...             -0.486699
32  B7E8CCCDBB26F04774FA1531E53886976DF726A753F826...             -0.599604
33  D4CC30A718414CD5EBE23BF2A8DACC8CC2FA0F8207EEA8...             -0.610621
34  C323314C3595F5E8F3DF7966B440416A9932DA6AC09665...              0.463232
35  3A36E2B52990C8590FB5AA93716A4615C7E445C9DF67B4...             -0.507835
36  637FA98E1C901393E545447387E0F44B5BB5486FA5EBB8...             -0.751734
37  5D275857A775AB8F69CCF5AFE425907CA628F1A44D8C81...              1.137046
38  CEDF14DB83FE181E9604AC80B709827E0C5D80F4D48909...              0.144999
39  8A71763EF32805658EF0AD5C9092E9375D24614FCD442D...              0.057574
40  A3A09A68E255217787F54F9EB8522830798D274962B38A...             -0.636482
41  2C0B6C8622426BFE647D56D102B714C1D01C31B0F5A3FC...              0.830965
42  B6B6625BC9E5E7753A723787520D6DFB26F84176B599FC...             -0.749406
43  C0DA0E1225995F1773D4CDF8D1BD8BB52A242F9478D089...             -0.160956
44  67476E420F2954D52B3F6CDDA4517882621C1F07F46880...             -0.427572
45  54DFD39A8E8C988F943DFE08B52E25C710623DBB33A026...              0.790822
46  C9B3CC2F9B7AEBDFA50B0BDD65142010A775515C81127B...             -0.448537
47  F2BCC6C60FDD8CAF901E652FE6D8157DD3BDAD65F623A3...              0.865924
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 48, vs. num we are initializing: 48
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 48
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=22.944778 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.456595 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.868063 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.645437 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.511132 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.453141 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.417027 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.392691 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.369695 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.352720 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.341798 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(0.2514, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.341463 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.945990 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.890061 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=0.885360 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=0.885248 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=0.885248 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.592244 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.451531 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.450428 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=070 | loss=0.450352 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(-0.9891, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.3418, 0.8852, 0.4504
INFO:birdwatch.scorer:MFTopicScorer_Scams Low Diligence MF elapsed time: 0.97 secs (0.02 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 876 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 0 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 0.04 secs (0.00 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 0.20 secs (0.00 mins)
INFO:birdwatch.constants:MFTopicScorer_Scams: Compute tag thresholds for percentiles elapsed time: 0.15 secs (0.00 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFMultiGroupScorer_1 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFMultiGroupScorer_1.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 142811
INFO:birdwatch.scorer:MFMultiGroupScorer_1 Filter input elapsed time: 5.44 secs (0.09 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFMultiGroupScorer_1: 26b7cd9e1eac4f6710f46646d6c493523eedb723c18566fdd92a7c902d7b61c4
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 38360, Num Unique Notes Rated: 2978, Num Unique Raters: 2221
INFO:birdwatch.scorer:MFMultiGroupScorer_1 Prepare ratings elapsed time: 0.10 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFMultiGroupScorer_1: 83d597d1bc136a002bdfd8fb59cfdb7a35785b65b85aa8a75bca076ffdfa7e30
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFMultiGroupScorer_1: a98b9575925fbdbc138fad20a54069ccbb0a2d5fa3b11835db1f34e65d093d9a
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFMultiGroupScorer_1: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 2221, Notes: 2978
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 12.881128274009402
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 17.271499324628547
INFO:birdwatch.matrix_factorization:epoch 0 7.359224319458008
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 6.85610818862915
INFO:birdwatch.matrix_factorization:epoch 20 0.2570008337497711
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.20213906466960907
INFO:birdwatch.matrix_factorization:epoch 40 0.11277013272047043
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07624972611665726
INFO:birdwatch.matrix_factorization:epoch 60 0.09280897676944733
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05870235338807106
INFO:birdwatch.matrix_factorization:epoch 80 0.09007881581783295
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.055845946073532104
INFO:birdwatch.matrix_factorization:epoch 100 0.08972610533237457
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.055696163326501846
INFO:birdwatch.matrix_factorization:epoch 120 0.08968265354633331
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.055683836340904236
INFO:birdwatch.matrix_factorization:Num epochs: 134
INFO:birdwatch.matrix_factorization:epoch 134 0.08967763185501099
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.055718161165714264
INFO:birdwatch.matrix_factorization:Global Intercept: 0.16317035257816315
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFMultiGroupScorer_1 First MF/stable init elapsed time: 1.87 secs (0.03 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFMultiGroupScorer_1

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 53269 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 312 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.50 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.18 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.37 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.33 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.16 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.22 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.37 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 96.54 secs (1.61 mins)
INFO:birdwatch.scorer:MFMultiGroupScorer_1 Compute scored notes elapsed time: 127.80 secs (2.13 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 142782 post-tombstones and 29 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 114745, including 114745 post-tombstones and 0 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 6674
INFO:birdwatch.scorer:MFMultiGroupScorer_1 Compute valid ratings elapsed time: 2.02 secs (0.03 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFMultiGroupScorer_1 Helpfulness scores pre-harassment  elapsed time: 0.17 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 2221
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 6486
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 4817
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 1180
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 38360
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 23478
INFO:birdwatch.scorer:MFMultiGroupScorer_1 Filtering by helpfulness score elapsed time: 0.07 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    13564
1     2290
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 7624
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 5529, Num Unique Notes Rated: 674, Num Unique Raters: 402
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    4834
1     695
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.1257008500633026
INFO:birdwatch.matrix_factorization:Using pos weight: 6.955395683453237 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 402, Notes: 674
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 8.20326409495549
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 13.753731343283581
INFO:birdwatch.matrix_factorization:epoch 0 3.237178325653076
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 1.3633344173431396
INFO:birdwatch.matrix_factorization:epoch 20 0.7811161279678345
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.4205339848995209
INFO:birdwatch.matrix_factorization:epoch 40 0.46113911271095276
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2511715888977051
INFO:birdwatch.matrix_factorization:epoch 60 0.37470775842666626
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.19445699453353882
INFO:birdwatch.matrix_factorization:epoch 80 0.3610808253288269
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18991775810718536
INFO:birdwatch.matrix_factorization:epoch 100 0.3595387041568756
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.1900104433298111
INFO:birdwatch.matrix_factorization:epoch 120 0.3593132495880127
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.19026236236095428
INFO:birdwatch.matrix_factorization:Num epochs: 124
INFO:birdwatch.matrix_factorization:epoch 124 0.35930806398391724
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.19009900093078613
INFO:birdwatch.matrix_factorization:Global Intercept: -0.24987831711769104
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFMultiGroupScorer_1 Harassment tag consensus elapsed time: 1.13 secs (0.02 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFMultiGroupScorer_1 Helpfulness scores post-harassment elapsed time: 0.25 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 2221
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 6486
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 4817
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 1180
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 38360
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 23478
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 1180, Notes: 2970
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 7.905050505050505
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 19.896610169491524
INFO:birdwatch.matrix_factorization:epoch 0 0.38865721225738525
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.31673020124435425
INFO:birdwatch.matrix_factorization:epoch 20 0.08438929915428162
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04759417846798897
INFO:birdwatch.matrix_factorization:epoch 40 0.08300846815109253
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.049294255673885345
INFO:birdwatch.matrix_factorization:epoch 60 0.08149468898773193
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04641030356287956
INFO:birdwatch.matrix_factorization:epoch 80 0.08145160973072052
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04649701341986656
INFO:birdwatch.matrix_factorization:Num epochs: 99
INFO:birdwatch.matrix_factorization:epoch 99 0.08143474161624908
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.046301502734422684
INFO:birdwatch.matrix_factorization:Global Intercept: 0.1645847111940384
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 1.31 secs (0.02 mins)
INFO:birdwatch.mf_base_scorer:In MFMultiGroupScorer_1 prescoring, about to call diligence with 23478 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                     raterParticipantId  internalRaterFactor1
0     0007FA945EF35219D0388D94715189F6231A77263D83B1...              0.062371
1     000F1687C56AB92D846F2B9BFA71AE16D8A88426754E3B...              0.549540
2     00403F6A378AB662BD6A14B1F09C2D0817A843B01E0E04...              0.348527
3     00720BF51C446ED4E89C14B3C9C054F9557789AD0CB013...              0.524024
4     008D2B105D9284320C4CC52C5247EC6C4167699D26BD53...              0.254340
...                                                 ...                   ...
1175  FE283EE92CACEDDCA0FAFBCCA57D96A3053BEFBA837849...             -0.532976
1176  FE8FCC5CB441BBAC17079F1C9D89743B56A8CB444B44D8...              0.759939
1177  FEE6C03F45C7E92C66ADCF8F16F6722483E760D293C023...              0.278656
1178  FF10E6EE6DECE1153515D6D38E8C076D20AB9393292946...             -0.281375
1179  FFA7AFC202040B072B0AE92D4DF0239977FC8E55497E95...             -0.612357

[1180 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 1180, vs. num we are initializing: 1180
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 1180
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=21.591051 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.511032 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.918793 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.764746 | time=1.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.698222 | time=1.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.662991 | time=1.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.641589 | time=2.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.627742 | time=2.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.617601 | time=2.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.610401 | time=2.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.604793 | time=3.1s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(-0.0666, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.604622 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.435615 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.423949 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.423069 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=105 | loss=1.423036 | time=0.9s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.574410 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.473955 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.472695 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=075 | loss=0.472645 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(0.5341, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.6048, 1.4230, 0.4726
INFO:birdwatch.scorer:MFMultiGroupScorer_1 Low Diligence MF elapsed time: 4.36 secs (0.07 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 53269 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 312 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.18 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.20 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.22 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.16 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.29 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.30 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 93.41 secs (1.56 mins)
INFO:birdwatch.constants:MFMultiGroupScorer_1: Compute tag thresholds for percentiles elapsed time: 0.53 secs (0.01 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)

INFO:birdwatch.run_scoring:----
    Completed individual scorers. Ran in parallel: False.  Succeeded in 6742.65 seconds. 
    Individual scorers: (name, runtime): [('MFCoreWithTopicsScorer', '9.59 mins'), ('MFCoreScorer', '8.71 mins'), ('MFExpansionScorer', '9.51 mins'), ('MFExpansionPlusScorer', '9.59 mins'), ('ReputationScorer', '3.11 mins'), ('MFGroupScorer_13', '6.17 mins'), ('MFGroupScorer_12', '3.61 mins'), ('MFGroupScorer_11', '4.27 mins'), ('MFGroupScorer_10', '3.85 mins'), ('MFGroupScorer_9', '4.08 mins'), ('MFGroupScorer_8', '4.47 mins'), ('MFGroupScorer_7', '4.43 mins'), ('MFGroupScorer_6', '4.31 mins'), ('MFGroupScorer_5', '4.34 mins'), ('MFGroupScorer_4', '4.24 mins'), ('MFGroupScorer_3', '4.50 mins'), ('MFGroupScorer_2', '4.36 mins'), ('MFGroupScorer_1', '5.10 mins'), ('MFGroupScorer_14', '4.42 mins'), ('MFGroupScorer_33', '4.44 mins'), ('MFTopicScorer_Unassigned', '0.06 mins'), ('MFTopicScorer_UkraineConflict', '0.16 mins'), ('MFTopicScorer_GazaConflict', '0.27 mins'), ('MFTopicScorer_MessiRonaldo', '0.06 mins'), ('MFTopicScorer_Scams', '0.10 mins'), ('MFMultiGroupScorer_1', '4.59 mins')]
    ----
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pandas_utils.py:405: FutureWarning: The behavior of DataFrame concatenation with empty or all-NA entries is deprecated. In a future version, this will no longer exclude empty or all-NA columns when determining the result dtypes. To retain the old behavior, exclude the relevant entries before the concat operation.
  result = self._origConcat(*args, **kwargs)

CONCAT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py, in combine_prescorer_scorer_results, at line 549: prescoringNoteModelOutput = pd.concat(
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64
  PandasTypeError: DataFrame concat on noteId: output=object inputs=[dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('O'), dtype('int64'), dtype('int64'), dtype('O'), dtype('int64'), dtype('int64')] (allowed)
  PandasTypeError: DataFrame concat on internalNoteIntercept: output=float32 inputs=[dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32')] (allowed)
  PandasTypeError: DataFrame concat on internalNoteFactor1: output=float32 inputs=[dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32')] (allowed)
  PandasTypeError: DataFrame concat on lowDiligenceNoteIntercept: output=float32 inputs=[dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32')] (allowed)
  PandasTypeError: DataFrame concat on lowDiligenceNoteFactor1: output=float32 inputs=[dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32')] (allowed)
  PandasTypeError: DataFrame concat on harassmentNoteIntercept: output=float32 inputs=[dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float32'), dtype('float64'), dtype('float64'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float32')] (UNALLOWED)
  PandasTypeError: DataFrame concat on harassmentNoteFactor1: output=float32 inputs=[dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float32'), dtype('float64'), dtype('float64'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float32')] (UNALLOWED)
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pandas_utils.py:405: FutureWarning: The behavior of DataFrame concatenation with empty or all-NA entries is deprecated. In a future version, this will no longer exclude empty or all-NA columns when determining the result dtypes. To retain the old behavior, exclude the relevant entries before the concat operation.
  result = self._origConcat(*args, **kwargs)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pandas_utils.py:405: FutureWarning: The behavior of DataFrame concatenation with empty or all-NA entries is deprecated. In a future version, this will no longer exclude empty or all-NA columns when determining the result dtypes. To retain the old behavior, exclude the relevant entries before the concat operation.
  result = self._origConcat(*args, **kwargs)

CONCAT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py, in combine_prescorer_scorer_results, at line 570: raterParamsUnfilteredMultiScorers = pd.concat(
  PandasTypeError: DataFrame concat on internalRaterIntercept: output=float32 inputs=[dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32')] (allowed)
  PandasTypeError: DataFrame concat on internalRaterFactor1: output=float32 inputs=[dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32')] (allowed)
  PandasTypeError: DataFrame concat on internalFirstRoundRaterIntercept: output=float32 inputs=[dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32')] (UNALLOWED)
  PandasTypeError: DataFrame concat on internalFirstRoundRaterFactor1: output=float32 inputs=[dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32')] (UNALLOWED)
  PandasTypeError: DataFrame concat on crhCrnhRatioDifference: output=float64 inputs=[dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('O'), dtype('float64'), dtype('float64'), dtype('O'), dtype('float64'), dtype('float64')] (allowed)
  PandasTypeError: DataFrame concat on meanNoteScore: output=float64 inputs=[dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('O'), dtype('float64'), dtype('float64'), dtype('O'), dtype('float64'), dtype('float64')] (allowed)
  PandasTypeError: DataFrame concat on raterAgreeRatio: output=float64 inputs=[dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('O'), dtype('float64'), dtype('float64'), dtype('O'), dtype('float64'), dtype('float64')] (allowed)
  PandasTypeError: DataFrame concat on aboveHelpfulnessThreshold: output=object inputs=[dtype('bool'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('float64'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('O'), dtype('float64'), dtype('float64'), dtype('O'), dtype('float64'), dtype('bool')] (allowed)
  PandasTypeError: DataFrame concat on internalRaterReputation: output=float32 inputs=[dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float32'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64')] (allowed)
  PandasTypeError: DataFrame concat on lowDiligenceRaterIntercept: output=float32 inputs=[dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32')] (allowed)
  PandasTypeError: DataFrame concat on lowDiligenceRaterFactor1: output=float32 inputs=[dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32')] (allowed)
  PandasTypeError: DataFrame concat on lowDiligenceRaterReputation: output=float32 inputs=[dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32')] (allowed)
  PandasTypeError: DataFrame concat on incorrectTagRatingsMadeByRater: output=Int64 inputs=[Int64Dtype(), Int64Dtype(), Int64Dtype(), Int64Dtype(), dtype('float64'), Int64Dtype(), Int8Dtype(), Int64Dtype(), Int8Dtype(), Int8Dtype(), Int8Dtype(), Int8Dtype(), Int64Dtype(), Int64Dtype(), Int8Dtype(), Int64Dtype(), Int8Dtype(), Int8Dtype(), Int64Dtype(), Int8Dtype(), Int8Dtype(), Int8Dtype(), Int8Dtype(), Int64Dtype()] (allowed)

INFO:birdwatch.run_scoring:notes total RAM: 4050264 bytes (0.004 GB)
                                    column     dtype     RAM
0                                   noteId     int64  400000
1                  noteAuthorParticipantId    object  400000
2                          createdAtMillis     int64  400000
3                                  tweetId    object  400000
4                           classification    object  400000
5                               believable  category   50124
6                                  harmful  category   50016
7                     validationDifficulty  category   50124
8                          misleadingOther      Int8  100000
9                   misleadingFactualError      Int8  100000
10              misleadingManipulatedMedia      Int8  100000
11           misleadingOutdatedInformation      Int8  100000
12       misleadingMissingImportantContext      Int8  100000
13         misleadingUnverifiedClaimAsFact      Int8  100000
14                        misleadingSatire      Int8  100000
15                      notMisleadingOther      Int8  100000
16           notMisleadingFactuallyCorrect      Int8  100000
17  notMisleadingOutdatedButNotWhenWritten      Int8  100000
18              notMisleadingClearlySatire      Int8  100000
19            notMisleadingPersonalOpinion      Int8  100000
20                      trustworthySources      Int8  100000
21                                 summary    object  400000
22                             isMediaNote      Int8  100000
23                     isCollaborativeNote      Int8  100000
INFO:birdwatch.run_scoring:ratings total RAM: 454637044 bytes (0.455 GB)
                                  column     dtype       RAM
0                                 noteId     int64  31904336
1                     raterParticipantId    object  31904336
2                        createdAtMillis     int64  31904336
3                                version      Int8   7976084
4                                  agree      Int8   7976084
5                               disagree      Int8   7976084
6                                helpful      Int8   7976084
7                             notHelpful      Int8   7976084
8                       helpfulnessLevel  category   3988174
9                           helpfulOther      Int8   7976084
10                    helpfulInformative      Int8   7976084
11                          helpfulClear      Int8   7976084
12                     helpfulEmpathetic      Int8   7976084
13                    helpfulGoodSources      Int8   7976084
14                  helpfulUniqueContext      Int8   7976084
15                 helpfulAddressesClaim      Int8   7976084
16               helpfulImportantContext      Int8   7976084
17               helpfulUnbiasedLanguage      Int8   7976084
18                       notHelpfulOther      Int8   7976084
19                   notHelpfulIncorrect      Int8   7976084
20  notHelpfulSourcesMissingOrUnreliable      Int8   7976084
21    notHelpfulOpinionSpeculationOrBias      Int8   7976084
22            notHelpfulMissingKeyPoints      Int8   7976084
23                    notHelpfulOutdated      Int8   7976084
24            notHelpfulHardToUnderstand      Int8   7976084
25       notHelpfulArgumentativeOrBiased      Int8   7976084
26                    notHelpfulOffTopic      Int8   7976084
27       notHelpfulSpamHarassmentOrAbuse      Int8   7976084
28           notHelpfulIrrelevantSources      Int8   7976084
29          notHelpfulOpinionSpeculation      Int8   7976084
30               notHelpfulNoteNotNeeded      Int8   7976084
31                        ratedOnTweetId     int64  31904336
32                  ratingSourceBucketed  category   3988166
33                            helpfulNum   float64  31904336
34                       highVolumeRater      bool   3988042
35                       correlatedRater      bool   3988042
36                    postSelectionValue   float64  31904336
37        postSelectionValue_note_author   float64  31904336
INFO:birdwatch.run_scoring:noteStatusHistory total RAM: 326123170 bytes (0.326 GB)
                                            column     dtype       RAM
0                                           noteId     int64  20224528
1                          noteAuthorParticipantId    object  20224528
2                                  createdAtMillis   float64  20224528
3               timestampMillisOfFirstNonNMRStatus   float64  20224528
4                                firstNonNMRStatus  category   2528190
5                   timestampMillisOfCurrentStatus   float64  20224528
6                                    currentStatus  category   2528198
7              timestampMillisOfLatestNonNMRStatus   float64  20224528
8                           mostRecentNonNMRStatus  category   2528190
9                      timestampMillisOfStatusLock   float64  20224528
10                                    lockedStatus  category   2528198
11                      timestampMillisOfRetroLock   float64  20224528
12                               currentCoreStatus  category   2528278
13                          currentExpansionStatus  category   2528278
14                              currentGroupStatus  category   2528270
15                                currentDecidedBy  category   2529378
16                            currentModelingGroup   float64  20224528
17         timestampMillisOfMostRecentStatusChange   float64  20224528
18       timestampMillisOfNmrDueToMinStableCrhTime   float64  20224528
19                         currentMultiGroupStatus  category   2528270
20                       currentModelingMultiGroup   float64  20224528
21             timestampMinuteOfFinalScoringOutput   float64  20224528
22  timestampMillisOfFirstNmrDueToMinStableCrhTime   float64  20224528
23                                  classification    object  20224528
INFO:birdwatch.run_scoring:userEnrollment total RAM: 77749221 bytes (0.078 GB)
                           column     dtype       RAM
0                   participantId    object  10912168
1                 enrollmentState    object  10912168
2  successfulRatingNeededToEarnIn     int64  10912168
3      timestampOfLastStateChange     int64  10912168
4          timestampOfLastEarnOut   float64  10912168
5              modelingPopulation  category   1364045
6                   modelingGroup   float64  10912168
7          numberOfTimesEarnedOut     int64  10912168
INFO:birdwatch.run_scoring:prescoringNoteModelOutput total RAM: 118662984 bytes (0.119 GB)
                            column    dtype       RAM
0                           noteId   object  21575088
1            internalNoteIntercept  float32  10787544
2              internalNoteFactor1  float32  10787544
3                       scorerName   object  21575088
4        lowDiligenceNoteIntercept  float32  10787544
5          lowDiligenceNoteFactor1  float32  10787544
6  lowDiligenceNoteInterceptRound2  float32  10787544
7          harassmentNoteIntercept  float32  10787544
8            harassmentNoteFactor1  float32  10787544
INFO:birdwatch.run_scoring:prescoringRaterModelOutput total RAM: 93634365 bytes (0.094 GB)
                                          column    dtype      RAM
0                             raterParticipantId   object  4539848
1                         internalRaterIntercept  float32  2269924
2                           internalRaterFactor1  float32  2269924
3               internalFirstRoundRaterIntercept  float32  2269924
4                 internalFirstRoundRaterFactor1  float32  2269924
5                         crhCrnhRatioDifference  float64  4539848
6                                  meanNoteScore  float64  4539848
7                                raterAgreeRatio  float64  4539848
8                      aboveHelpfulnessThreshold   object  4539848
9                                     scorerName   object  4539848
10                       internalRaterReputation  float32  2269924
11                    lowDiligenceRaterIntercept  float32  2269924
12                      lowDiligenceRaterFactor1  float32  2269924
13                   lowDiligenceRaterReputation  float32  2269924
14              lowDiligenceRaterInterceptRound2  float32  2269924
15                incorrectTagRatingsMadeByRater    Int64  5107329
16                       totalRatingsMadeByRater  float64  4539848
17                            postSelectionValue  float64  4539848
18                  successfulRatingHelpfulCount  float64  4539848
19               successfulRatingNotHelpfulCount  float64  4539848
20                unsuccessfulRatingHelpfulCount  float64  4539848
21             unsuccessfulRatingNotHelpfulCount  float64  4539848
22                 totalHelpfulHarassmentPenalty  float64  4539848
23  raterAgreeRatioKeyWithHarassmentAbusePenalty  float64  4539848
24                              quasiCliqueValue  float64  4539848
INFO:birdwatch.constants:Logging Prescoring Results RAM usage (before conversion) elapsed time: 0.11 secs (0.00 mins)
INFO:birdwatch.run_scoring:notes total RAM: 4050264 bytes (0.004 GB)
                                    column     dtype     RAM
0                                   noteId     int64  400000
1                  noteAuthorParticipantId    object  400000
2                          createdAtMillis     int64  400000
3                                  tweetId    object  400000
4                           classification    object  400000
5                               believable  category   50124
6                                  harmful  category   50016
7                     validationDifficulty  category   50124
8                          misleadingOther      Int8  100000
9                   misleadingFactualError      Int8  100000
10              misleadingManipulatedMedia      Int8  100000
11           misleadingOutdatedInformation      Int8  100000
12       misleadingMissingImportantContext      Int8  100000
13         misleadingUnverifiedClaimAsFact      Int8  100000
14                        misleadingSatire      Int8  100000
15                      notMisleadingOther      Int8  100000
16           notMisleadingFactuallyCorrect      Int8  100000
17  notMisleadingOutdatedButNotWhenWritten      Int8  100000
18              notMisleadingClearlySatire      Int8  100000
19            notMisleadingPersonalOpinion      Int8  100000
20                      trustworthySources      Int8  100000
21                                 summary    object  400000
22                             isMediaNote      Int8  100000
23                     isCollaborativeNote      Int8  100000
INFO:birdwatch.run_scoring:ratings total RAM: 454637044 bytes (0.455 GB)
                                  column     dtype       RAM
0                                 noteId     int64  31904336
1                     raterParticipantId    object  31904336
2                        createdAtMillis     int64  31904336
3                                version      Int8   7976084
4                                  agree      Int8   7976084
5                               disagree      Int8   7976084
6                                helpful      Int8   7976084
7                             notHelpful      Int8   7976084
8                       helpfulnessLevel  category   3988174
9                           helpfulOther      Int8   7976084
10                    helpfulInformative      Int8   7976084
11                          helpfulClear      Int8   7976084
12                     helpfulEmpathetic      Int8   7976084
13                    helpfulGoodSources      Int8   7976084
14                  helpfulUniqueContext      Int8   7976084
15                 helpfulAddressesClaim      Int8   7976084
16               helpfulImportantContext      Int8   7976084
17               helpfulUnbiasedLanguage      Int8   7976084
18                       notHelpfulOther      Int8   7976084
19                   notHelpfulIncorrect      Int8   7976084
20  notHelpfulSourcesMissingOrUnreliable      Int8   7976084
21    notHelpfulOpinionSpeculationOrBias      Int8   7976084
22            notHelpfulMissingKeyPoints      Int8   7976084
23                    notHelpfulOutdated      Int8   7976084
24            notHelpfulHardToUnderstand      Int8   7976084
25       notHelpfulArgumentativeOrBiased      Int8   7976084
26                    notHelpfulOffTopic      Int8   7976084
27       notHelpfulSpamHarassmentOrAbuse      Int8   7976084
28           notHelpfulIrrelevantSources      Int8   7976084
29          notHelpfulOpinionSpeculation      Int8   7976084
30               notHelpfulNoteNotNeeded      Int8   7976084
31                        ratedOnTweetId     int64  31904336
32                  ratingSourceBucketed  category   3988166
33                            helpfulNum   float64  31904336
34                       highVolumeRater      bool   3988042
35                       correlatedRater      bool   3988042
36                    postSelectionValue   float64  31904336
37        postSelectionValue_note_author   float64  31904336
INFO:birdwatch.run_scoring:noteStatusHistory total RAM: 326123170 bytes (0.326 GB)
                                            column     dtype       RAM
0                                           noteId     int64  20224528
1                          noteAuthorParticipantId    object  20224528
2                                  createdAtMillis   float64  20224528
3               timestampMillisOfFirstNonNMRStatus   float64  20224528
4                                firstNonNMRStatus  category   2528190
5                   timestampMillisOfCurrentStatus   float64  20224528
6                                    currentStatus  category   2528198
7              timestampMillisOfLatestNonNMRStatus   float64  20224528
8                           mostRecentNonNMRStatus  category   2528190
9                      timestampMillisOfStatusLock   float64  20224528
10                                    lockedStatus  category   2528198
11                      timestampMillisOfRetroLock   float64  20224528
12                               currentCoreStatus  category   2528278
13                          currentExpansionStatus  category   2528278
14                              currentGroupStatus  category   2528270
15                                currentDecidedBy  category   2529378
16                            currentModelingGroup   float64  20224528
17         timestampMillisOfMostRecentStatusChange   float64  20224528
18       timestampMillisOfNmrDueToMinStableCrhTime   float64  20224528
19                         currentMultiGroupStatus  category   2528270
20                       currentModelingMultiGroup   float64  20224528
21             timestampMinuteOfFinalScoringOutput   float64  20224528
22  timestampMillisOfFirstNmrDueToMinStableCrhTime   float64  20224528
23                                  classification    object  20224528
INFO:birdwatch.run_scoring:userEnrollment total RAM: 77749221 bytes (0.078 GB)
                           column     dtype       RAM
0                   participantId    object  10912168
1                 enrollmentState    object  10912168
2  successfulRatingNeededToEarnIn     int64  10912168
3      timestampOfLastStateChange     int64  10912168
4          timestampOfLastEarnOut   float64  10912168
5              modelingPopulation  category   1364045
6                   modelingGroup   float64  10912168
7          numberOfTimesEarnedOut     int64  10912168
INFO:birdwatch.run_scoring:prescoringNoteModelOutput total RAM: 118662984 bytes (0.119 GB)
                            column    dtype       RAM
0                           noteId   object  21575088
1            internalNoteIntercept  float32  10787544
2              internalNoteFactor1  float32  10787544
3                       scorerName   object  21575088
4        lowDiligenceNoteIntercept  float32  10787544
5          lowDiligenceNoteFactor1  float32  10787544
6  lowDiligenceNoteInterceptRound2  float32  10787544
7          harassmentNoteIntercept  float32  10787544
8            harassmentNoteFactor1  float32  10787544
INFO:birdwatch.run_scoring:prescoringRaterModelOutput total RAM: 93634365 bytes (0.094 GB)
                                          column    dtype      RAM
0                             raterParticipantId   object  4539848
1                         internalRaterIntercept  float32  2269924
2                           internalRaterFactor1  float32  2269924
3               internalFirstRoundRaterIntercept  float32  2269924
4                 internalFirstRoundRaterFactor1  float32  2269924
5                         crhCrnhRatioDifference  float64  4539848
6                                  meanNoteScore  float64  4539848
7                                raterAgreeRatio  float64  4539848
8                      aboveHelpfulnessThreshold   object  4539848
9                                     scorerName   object  4539848
10                       internalRaterReputation  float32  2269924
11                    lowDiligenceRaterIntercept  float32  2269924
12                      lowDiligenceRaterFactor1  float32  2269924
13                   lowDiligenceRaterReputation  float32  2269924
14              lowDiligenceRaterInterceptRound2  float32  2269924
15                incorrectTagRatingsMadeByRater    Int64  5107329
16                       totalRatingsMadeByRater  float64  4539848
17                            postSelectionValue  float64  4539848
18                  successfulRatingHelpfulCount  float64  4539848
19               successfulRatingNotHelpfulCount  float64  4539848
20                unsuccessfulRatingHelpfulCount  float64  4539848
21             unsuccessfulRatingNotHelpfulCount  float64  4539848
22                 totalHelpfulHarassmentPenalty  float64  4539848
23  raterAgreeRatioKeyWithHarassmentAbusePenalty  float64  4539848
24                              quasiCliqueValue  float64  4539848
INFO:birdwatch.constants:Logging Prescoring Results RAM usage (after conversion) elapsed time: 0.17 secs (0.00 mins)
INFO:birdwatch.run_scoring:prescoringRaterModelOutput total RAM: 93648885 bytes (0.094 GB)
                                          column    dtype      RAM
0                             raterParticipantId   object  4540552
1                         internalRaterIntercept  float32  2270276
2                           internalRaterFactor1  float32  2270276
3               internalFirstRoundRaterIntercept  float32  2270276
4                 internalFirstRoundRaterFactor1  float32  2270276
5                         crhCrnhRatioDifference  float64  4540552
6                                  meanNoteScore  float64  4540552
7                                raterAgreeRatio  float64  4540552
8                      aboveHelpfulnessThreshold   object  4540552
9                                     scorerName   object  4540552
10                       internalRaterReputation  float32  2270276
11                    lowDiligenceRaterIntercept  float32  2270276
12                      lowDiligenceRaterFactor1  float32  2270276
13                   lowDiligenceRaterReputation  float32  2270276
14              lowDiligenceRaterInterceptRound2  float32  2270276
15                incorrectTagRatingsMadeByRater    Int64  5108121
16                       totalRatingsMadeByRater  float64  4540552
17                            postSelectionValue  float64  4540552
18                  successfulRatingHelpfulCount  float64  4540552
19               successfulRatingNotHelpfulCount  float64  4540552
20                unsuccessfulRatingHelpfulCount  float64  4540552
21             unsuccessfulRatingNotHelpfulCount  float64  4540552
22                 totalHelpfulHarassmentPenalty  float64  4540552
23  raterAgreeRatioKeyWithHarassmentAbusePenalty  float64  4540552
24                              quasiCliqueValue  float64  4540552
INFO:birdwatch.constants:Logging Prescoring Results RAM usage (after concatenation) elapsed time: 0.02 secs (0.00 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pflip_plus_model.py, in _get_notes, at line 242: noteStatusHistory[[c.noteIdKey, c.createdAtMillisKey]].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=Int64 vs right=int64 (UNALLOWED)
  PandasTypeError: Merge key mismatch on createdAtMillis: left=Int64 vs right=int64 (UNALLOWED)
  PandasTypeError: Output mismatch on createdAtMillis: result=Int64 expected=None (UNALLOWED)

INFO:birdwatch.pflip_plus_model:labels before ScoringDriftGuard:
LABEL
CRH     1562
FLIP     636
Name: count, dtype: int64
INFO:birdwatch.pflip_plus_model:labels after ScoringDriftGuard:
LABEL
CRH     1521
FLIP     636
Name: count, dtype: int64

INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pflip_plus_model.py, in _compute_scoring_cutoff, at line 335: .astype(pd.Int64Dtype())
  PandasTypeError: Type expectation mismatch on noteId: found=Int64 expected=int64


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pflip_plus_model.py, in _compute_scoring_cutoff, at line 342: .astype(pd.Int64Dtype()),
  PandasTypeError: Type expectation mismatch on noteId: found=Int64 expected=int64


CONCAT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pflip_plus_model.py, in _compute_scoring_cutoff, at line 337: cutoffByRatings = cutoffByRatings.merge(
  PandasTypeError: Type expectation mismatch on noteId: found=Int64 expected=int64
  PandasTypeError: Type expectation mismatch on noteId: found=Int64 expected=int64


MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pflip_plus_model.py, in _compute_scoring_cutoff, at line 337: cutoffByRatings = cutoffByRatings.merge(
  PandasTypeError: Type expectation mismatch on noteId: found=Int64 expected=int64
  PandasTypeError: Type expectation mismatch on noteId: found=Int64 expected=int64
  PandasTypeError: Type expectation mismatch on noteId: found=Int64 expected=int64


MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pflip_plus_model.py, in _compute_scoring_cutoff, at line 348: scoringCutoff = scoringCutoff.merge(cutoffByRatings[[c.noteIdKey, "ratingMin"]])
  PandasTypeError: Type expectation mismatch on noteId: found=Int64 expected=int64
  PandasTypeError: Input mismatch on noteId: left=int64 vs right=Int64 (UNALLOWED)
  PandasTypeError: Merge key mismatch on noteId: left=int64 vs right=Int64 (UNALLOWED)
  PandasTypeError: Output mismatch on noteId: result=int64 expected=None (UNALLOWED)

INFO:birdwatch.constants:Fitting pflip model elapsed time: 12.33 secs (0.21 mins)
Patching pandas
Pairs dict used 2.6843546480000002GB RAM at max
Pairs dict used 2.6843546480000002GB RAM after deleted unneeded pairs
TERM_PROGRAM: Apple_Terminal
SHELL: /bin/zsh
TERM: xterm-256color
TMPDIR: /var/folders/06/vqf6dx7s0mdbgx_rpjv0hc5m0000gn/T/
TERM_PROGRAM_VERSION: 453
TERM_SESSION_ID: F736EB59-D622-4D96-8E2F-8FE9FDD8CEF1
USER: canbo
SSH_AUTH_SOCK: /private/tmp/com.apple.launchd.p38rtIG1br/Listeners
PATH: /Users/canbo/INFO494/494-algo-representations/cn_venv/bin:/Users/canbo/.local/bin:/Library/Frameworks/Python.framework/Versions/3.14/bin:/opt/local/bin:/opt/local/sbin:/Library/Frameworks/Python.framework/Versions/3.13/bin:/usr/local/bin:/System/Cryptexes/App/usr/bin:/usr/bin:/bin:/usr/sbin:/sbin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/local/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/appleinternal/bin
LaunchInstanceID: FEDCD432-4AA4-450A-B3C3-C3F601934137
__CFBundleIdentifier: com.apple.Terminal
PWD: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src
XPC_FLAGS: 0x0
XPC_SERVICE_NAME: 0
SHLVL: 1
HOME: /Users/canbo
LOGNAME: canbo
SECURITYSESSIONID: 186a2
OLDPWD: /Users/canbo/INFO494/494-algo-representations
VIRTUAL_ENV: /Users/canbo/INFO494/494-algo-representations/cn_venv
VIRTUAL_ENV_PROMPT: (cn_venv) 
PS1: ((cn_venv) ) %n@%m %1~ %# 
LANG: en_US.UTF-8
_: /Users/canbo/INFO494/494-algo-representations/cn_venv/bin/python
__CF_USER_TEXT_ENCODING: 0x1F5:0x0:0x0
KMP_INIT_AT_FORK: FALSE
KMP_DUPLICATE_LIB_OK: True
[Pipeline] .... (step 1 of 3) Processing UnigramEncoder, total=   7.1s
[Pipeline] ............. (step 2 of 3) Processing tfidf, total=   0.1s
[Pipeline] ........ (step 3 of 3) Processing Classifier, total=   1.9s
(4181, 3)
Excluding ratings outside of group
Traceback (most recent call last):
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/main.py", line 31, in <module>
    main()
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/runner.py", line 278, in main
    return _run_scorer(args=args, dataLoader=dataLoader, extraScoringArgs=extraScoringArgs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pandas_utils.py", line 722, in _inner
    retVal = main(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/runner.py", line 231, in _run_scorer
    scoredNotes, helpfulnessScores, newStatus, auxNoteInfo = run_scoring(
                                                             ^^^^^^^^^^^^
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py", line 2089, in run_scoring
    ) = run_prescoring(
        ^^^^^^^^^^^^^^^
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py", line 1348, in run_prescoring
    pflipPlusModel.fit(notes, ratings, noteStatusHistory, prescoringRaterModelOutput)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pflip_plus_model.py", line 1566, in fit
    self._prepare_note_info(
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pflip_plus_model.py", line 1054, in _prepare_note_info
    scoringCutoff = self._compute_scoring_cutoff(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pflip_plus_model.py", line 349, in _compute_scoring_cutoff
    assert len(scoringCutoff) == beforeMerge
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AssertionError
