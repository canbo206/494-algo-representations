INFO:birdwatch.runner:scorer python version: 3.12.12 (main, Oct  9 2025, 11:07:00) [Clang 16.0.0 (clang-1600.0.26.6)]
INFO:birdwatch.runner:scorer pandas version: 2.3.3
INFO:birdwatch.runner:beginning scorer execution
INFO:birdwatch.process_data:Timestamp of latest rating in data: 2026-01-26 02:52:16.873000
INFO:birdwatch.process_data:Timestamp of latest note in data: 2026-01-19 01:00:50.225000
INFO:birdwatch.process_data:Total raters: 623657
INFO:birdwatch.process_data:Identifying high volume raters
INFO:birdwatch.process_data:Total ratings: 4007501
INFO:birdwatch.process_data:High volume threshold for 7 days: 4.740000000000009
INFO:birdwatch.process_data:High volume raters for 7 days: 1
INFO:birdwatch.process_data:High volume threshold for 28 days: 19.0
INFO:birdwatch.process_data:High volume raters for 28 days: 50
INFO:birdwatch.process_data:Total high volume raters: 51
INFO:birdwatch.process_data:Total ratings: 4007501
INFO:birdwatch.process_data:Total ratings from high volume raters: 20858

CONCAT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_status_history.py, in merge_note_info, at line 31: newNoteStatusHistory = oldNoteStatusHistory.merge(
  PandasTypeError: Type expectation mismatch on noteId: found=float64 expected=int64
  PandasTypeError: Type expectation mismatch on noteId: found=float64 expected=int64


MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_status_history.py, in merge_note_info, at line 31: newNoteStatusHistory = oldNoteStatusHistory.merge(
  PandasTypeError: Output mismatch on createdAtMillis: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on createdAtMillis_notes: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_status_history:total notes added to noteStatusHistory: 2297

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_status_history.py, in merge_note_info, at line 57: newNoteStatusHistory[[c.noteIdKey, c.createdAtMillisKey]].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=float64 vs right=int64 (allowed)
  PandasTypeError: Merge key mismatch on createdAtMillis: left=float64 vs right=int64 (allowed)


MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/process_data.py, in _filter_misleading_notes, at line 298: ratings = ratings.merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.process_data:Preprocess Data: Filter misleading notes, starting with 4007501 ratings on 44476 notes
INFO:birdwatch.process_data:  Keeping 3283088 ratings on 34889 misleading notes
INFO:birdwatch.process_data:  Keeping 0 ratings on 0 deleted notes that were previously scored (in note status history)
INFO:birdwatch.process_data:  Removing 6416 ratings on 419 older notes that aren't deleted, but are not-misleading.
INFO:birdwatch.process_data:  Removing 0 ratings on 0 notes that were deleted and not in note status history (e.g. old).
INFO:birdwatch.process_data:Num Ratings: 4001085, Num Unique Notes Rated: 44057, Num Unique Raters: 623416
INFO:birdwatch.process_data:Called filter_input_data_for_testing.
        Notes: 50000, Ratings: 4001085. Max note createdAt: 2026-01-19 01:00:50.225000; Max rating createAt: 2026-01-26 02:52:16.873000
INFO:birdwatch.process_data:After filtering notes and ratings after particular timestamp (=None). 
        Notes: 50000, Ratings: 4001085. Max note createdAt: 2026-01-19 01:00:50.225000; Max rating createAt: 2026-01-26 02:52:16.873000
INFO:birdwatch.process_data:After filtering ratings after first status (plus None hours) for notes created in last 14 days. 
        Notes: 50000, Ratings: 4001085. Max note createdAt: 2026-01-19 01:00:50.225000; Max rating createAt: 2026-01-26 02:52:16.873000
INFO:birdwatch.process_data:After filtering prescoring notes and ratings to simulate a delay of None hours: 
        Notes: 50000, Ratings: 4001085. Max note createdAt: 2026-01-19 01:00:50.225000; Max rating createAt: 2026-01-26 02:52:16.873000
INFO:birdwatch.constants:Compute pair counts dict elapsed time: 196.34 secs (3.27 mins)
INFO:birdwatch.constants:Compute PMI and minSim elapsed time: 131.76 secs (2.20 mins)
INFO:birdwatch.constants:Delete unneeded pairs from pairCountsDict elapsed time: 46.15 secs (0.77 mins)
INFO:birdwatch.constants:Aggregate into cliques by post selection similarity elapsed time: 1.90 secs (0.03 mins)
INFO:birdwatch.constants:Compute Post Selection Similarity elapsed time: 396.88 secs (6.61 mins)
--- Logging error ---
Traceback (most recent call last):
  File "/usr/local/Cellar/python@3.12/3.12.12_1/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 1160, in emit
    msg = self.format(record)
          ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.12/3.12.12_1/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.12/3.12.12_1/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 703, in format
    record.message = record.getMessage()
                     ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.12/3.12.12_1/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 392, in getMessage
    msg = msg % self.args
          ~~~~^~~~~~~~~~~
TypeError: not all arguments converted during string formatting
Call stack:
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/main.py", line 31, in <module>
    main()
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/runner.py", line 278, in main
    return _run_scorer(args=args, dataLoader=dataLoader, extraScoringArgs=extraScoringArgs)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pandas_utils.py", line 722, in _inner
    retVal = main(*args, **kwargs)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/runner.py", line 231, in _run_scorer
    scoredNotes, helpfulnessScores, newStatus, auxNoteInfo = run_scoring(
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py", line 2080, in run_scoring
    postSelectionSimilarityValues = run_rater_clustering(notes=notes, ratings=ratings)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py", line 1188, in run_rater_clustering
    quasiCliques = qcd.get_quasi_cliques(notes, ratings)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/quasi_clique_detection.py", line 256, in get_quasi_cliques
    raterPairCounts, raterPairRatings = self._get_pair_counts(ratings, notes, self._recencyCutoff)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/quasi_clique_detection.py", line 60, in _get_pair_counts
    logger.info("initial rating length:", len(ratings))
Message: 'initial rating length:'
Arguments: (4001085,)
--- Logging error ---
Traceback (most recent call last):
  File "/usr/local/Cellar/python@3.12/3.12.12_1/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 1160, in emit
    msg = self.format(record)
          ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.12/3.12.12_1/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.12/3.12.12_1/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 703, in format
    record.message = record.getMessage()
                     ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.12/3.12.12_1/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 392, in getMessage
    msg = msg % self.args
          ~~~~^~~~~~~~~~~
TypeError: not all arguments converted during string formatting
Call stack:
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/main.py", line 31, in <module>
    main()
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/runner.py", line 278, in main
    return _run_scorer(args=args, dataLoader=dataLoader, extraScoringArgs=extraScoringArgs)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pandas_utils.py", line 722, in _inner
    retVal = main(*args, **kwargs)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/runner.py", line 231, in _run_scorer
    scoredNotes, helpfulnessScores, newStatus, auxNoteInfo = run_scoring(
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py", line 2080, in run_scoring
    postSelectionSimilarityValues = run_rater_clustering(notes=notes, ratings=ratings)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py", line 1188, in run_rater_clustering
    quasiCliques = qcd.get_quasi_cliques(notes, ratings)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/quasi_clique_detection.py", line 256, in get_quasi_cliques
    raterPairCounts, raterPairRatings = self._get_pair_counts(ratings, notes, self._recencyCutoff)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/quasi_clique_detection.py", line 67, in _get_pair_counts
    logger.info("ratings after merges:", len(ratings))
Message: 'ratings after merges:'
Arguments: (4001085,)
--- Logging error ---
Traceback (most recent call last):
  File "/usr/local/Cellar/python@3.12/3.12.12_1/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 1160, in emit
    msg = self.format(record)
          ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.12/3.12.12_1/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.12/3.12.12_1/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 703, in format
    record.message = record.getMessage()
                     ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.12/3.12.12_1/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 392, in getMessage
    msg = msg % self.args
          ~~~~^~~~~~~~~~~
TypeError: not all arguments converted during string formatting
Call stack:
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/main.py", line 31, in <module>
    main()
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/runner.py", line 278, in main
    return _run_scorer(args=args, dataLoader=dataLoader, extraScoringArgs=extraScoringArgs)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pandas_utils.py", line 722, in _inner
    retVal = main(*args, **kwargs)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/runner.py", line 231, in _run_scorer
    scoredNotes, helpfulnessScores, newStatus, auxNoteInfo = run_scoring(
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py", line 2080, in run_scoring
    postSelectionSimilarityValues = run_rater_clustering(notes=notes, ratings=ratings)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py", line 1188, in run_rater_clustering
    quasiCliques = qcd.get_quasi_cliques(notes, ratings)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/quasi_clique_detection.py", line 256, in get_quasi_cliques
    raterPairCounts, raterPairRatings = self._get_pair_counts(ratings, notes, self._recencyCutoff)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/quasi_clique_detection.py", line 69, in _get_pair_counts
    logger.info("recent ratings:", len(ratings))
Message: 'recent ratings:'
Arguments: (358354,)
--- Logging error ---
Traceback (most recent call last):
  File "/usr/local/Cellar/python@3.12/3.12.12_1/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 1160, in emit
    msg = self.format(record)
          ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.12/3.12.12_1/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.12/3.12.12_1/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 703, in format
    record.message = record.getMessage()
                     ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.12/3.12.12_1/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 392, in getMessage
    msg = msg % self.args
          ~~~~^~~~~~~~~~~
TypeError: not all arguments converted during string formatting
Call stack:
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/main.py", line 31, in <module>
    main()
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/runner.py", line 278, in main
    return _run_scorer(args=args, dataLoader=dataLoader, extraScoringArgs=extraScoringArgs)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pandas_utils.py", line 722, in _inner
    retVal = main(*args, **kwargs)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/runner.py", line 231, in _run_scorer
    scoredNotes, helpfulnessScores, newStatus, auxNoteInfo = run_scoring(
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py", line 2080, in run_scoring
    postSelectionSimilarityValues = run_rater_clustering(notes=notes, ratings=ratings)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py", line 1188, in run_rater_clustering
    quasiCliques = qcd.get_quasi_cliques(notes, ratings)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/quasi_clique_detection.py", line 256, in get_quasi_cliques
    raterPairCounts, raterPairRatings = self._get_pair_counts(ratings, notes, self._recencyCutoff)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/quasi_clique_detection.py", line 71, in _get_pair_counts
    logger.info("ratings on non-deleted tweets:", len(ratings))
Message: 'ratings on non-deleted tweets:'
Arguments: (358354,)
--- Logging error ---
Traceback (most recent call last):
  File "/usr/local/Cellar/python@3.12/3.12.12_1/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 1160, in emit
    msg = self.format(record)
          ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.12/3.12.12_1/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.12/3.12.12_1/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 703, in format
    record.message = record.getMessage()
                     ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/Cellar/python@3.12/3.12.12_1/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 392, in getMessage
    msg = msg % self.args
          ~~~~^~~~~~~~~~~
TypeError: not all arguments converted during string formatting
Call stack:
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/main.py", line 31, in <module>
    main()
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/runner.py", line 278, in main
    return _run_scorer(args=args, dataLoader=dataLoader, extraScoringArgs=extraScoringArgs)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pandas_utils.py", line 722, in _inner
    retVal = main(*args, **kwargs)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/runner.py", line 231, in _run_scorer
    scoredNotes, helpfulnessScores, newStatus, auxNoteInfo = run_scoring(
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py", line 2080, in run_scoring
    postSelectionSimilarityValues = run_rater_clustering(notes=notes, ratings=ratings)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py", line 1188, in run_rater_clustering
    quasiCliques = qcd.get_quasi_cliques(notes, ratings)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/quasi_clique_detection.py", line 256, in get_quasi_cliques
    raterPairCounts, raterPairRatings = self._get_pair_counts(ratings, notes, self._recencyCutoff)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/quasi_clique_detection.py", line 73, in _get_pair_counts
    logger.info("ratings on misleading posts:", len(ratings))
Message: 'ratings on misleading posts:'
Arguments: (306449,)
INFO:birdwatch.quasi_clique_detection:Preparing pairs for 2752 tweets
INFO:birdwatch.quasi_clique_detection:0
INFO:birdwatch.quasi_clique_detection:1000
INFO:birdwatch.quasi_clique_detection:2000
INFO:birdwatch.quasi_clique_detection:ratings after filter to raters included in pair counts: 80038
INFO:birdwatch.quasi_clique_detection:orig raterPairCounts: 130185
INFO:birdwatch.quasi_clique_detection:pruned raterPairCounts: 193
INFO:birdwatch.quasi_clique_detection:Skipping clique  (raters=3, tweets=32).  Remaining ratePairCounts: 191
INFO:birdwatch.quasi_clique_detection:Adding clique  (raters=38, tweets=64).  Remaining ratePairCounts: 0
INFO:birdwatch.constants:Compute Quasi-Cliques elapsed time: 172.90 secs (2.88 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py, in run_rater_clustering, at line 1192: return postSelectionSimilarityValues.merge(quasiCliques, how="outer")
  PandasTypeError: Output mismatch on postSelectionValue: result=float64 expected=int64 (UNALLOWED)
  PandasTypeError: Output mismatch on quasiCliqueValue: result=float64 expected=int64 (UNALLOWED)

INFO:birdwatch.run_scoring:logging environment variables
INFO:birdwatch.run_scoring:notes total RAM: 4050264 bytes (0.004 GB)
                                    column     dtype     RAM
0                                   noteId     int64  400000
1                  noteAuthorParticipantId    object  400000
2                          createdAtMillis     int64  400000
3                                  tweetId    object  400000
4                           classification    object  400000
5                               believable  category   50124
6                                  harmful  category   50016
7                     validationDifficulty  category   50124
8                          misleadingOther      Int8  100000
9                   misleadingFactualError      Int8  100000
10              misleadingManipulatedMedia      Int8  100000
11           misleadingOutdatedInformation      Int8  100000
12       misleadingMissingImportantContext      Int8  100000
13         misleadingUnverifiedClaimAsFact      Int8  100000
14                        misleadingSatire      Int8  100000
15                      notMisleadingOther      Int8  100000
16           notMisleadingFactuallyCorrect      Int8  100000
17  notMisleadingOutdatedButNotWhenWritten      Int8  100000
18              notMisleadingClearlySatire      Int8  100000
19            notMisleadingPersonalOpinion      Int8  100000
20                      trustworthySources      Int8  100000
21                                 summary    object  400000
22                             isMediaNote      Int8  100000
23                     isCollaborativeNote      Int8  100000
INFO:birdwatch.run_scoring:ratings total RAM: 388105393 bytes (0.388 GB)
                                  column     dtype       RAM
0                                 noteId     int64  32008680
1                     raterParticipantId    object  32008680
2                        createdAtMillis     int64  32008680
3                                version      Int8   8002170
4                                  agree      Int8   8002170
5                               disagree      Int8   8002170
6                                helpful      Int8   8002170
7                             notHelpful      Int8   8002170
8                       helpfulnessLevel  category   4001217
9                           helpfulOther      Int8   8002170
10                    helpfulInformative      Int8   8002170
11                          helpfulClear      Int8   8002170
12                     helpfulEmpathetic      Int8   8002170
13                    helpfulGoodSources      Int8   8002170
14                  helpfulUniqueContext      Int8   8002170
15                 helpfulAddressesClaim      Int8   8002170
16               helpfulImportantContext      Int8   8002170
17               helpfulUnbiasedLanguage      Int8   8002170
18                       notHelpfulOther      Int8   8002170
19                   notHelpfulIncorrect      Int8   8002170
20  notHelpfulSourcesMissingOrUnreliable      Int8   8002170
21    notHelpfulOpinionSpeculationOrBias      Int8   8002170
22            notHelpfulMissingKeyPoints      Int8   8002170
23                    notHelpfulOutdated      Int8   8002170
24            notHelpfulHardToUnderstand      Int8   8002170
25       notHelpfulArgumentativeOrBiased      Int8   8002170
26                    notHelpfulOffTopic      Int8   8002170
27       notHelpfulSpamHarassmentOrAbuse      Int8   8002170
28           notHelpfulIrrelevantSources      Int8   8002170
29          notHelpfulOpinionSpeculation      Int8   8002170
30               notHelpfulNoteNotNeeded      Int8   8002170
31                        ratedOnTweetId     int64  32008680
32                  ratingSourceBucketed  category   4001101
33                            helpfulNum   float64  32008680
34                       highVolumeRater      bool   4001085
INFO:birdwatch.run_scoring:noteStatusHistory total RAM: 326123170 bytes (0.326 GB)
                                            column     dtype       RAM
0                                           noteId     int64  20224528
1                          noteAuthorParticipantId    object  20224528
2                                  createdAtMillis   float64  20224528
3               timestampMillisOfFirstNonNMRStatus   float64  20224528
4                                firstNonNMRStatus  category   2528190
5                   timestampMillisOfCurrentStatus   float64  20224528
6                                    currentStatus  category   2528198
7              timestampMillisOfLatestNonNMRStatus   float64  20224528
8                           mostRecentNonNMRStatus  category   2528190
9                      timestampMillisOfStatusLock   float64  20224528
10                                    lockedStatus  category   2528198
11                      timestampMillisOfRetroLock   float64  20224528
12                               currentCoreStatus  category   2528278
13                          currentExpansionStatus  category   2528278
14                              currentGroupStatus  category   2528270
15                                currentDecidedBy  category   2529378
16                            currentModelingGroup   float64  20224528
17         timestampMillisOfMostRecentStatusChange   float64  20224528
18       timestampMillisOfNmrDueToMinStableCrhTime   float64  20224528
19                         currentMultiGroupStatus  category   2528270
20                       currentModelingMultiGroup   float64  20224528
21             timestampMinuteOfFinalScoringOutput   float64  20224528
22  timestampMillisOfFirstNmrDueToMinStableCrhTime   float64  20224528
23                                  classification    object  20224528
INFO:birdwatch.run_scoring:userEnrollment total RAM: 77749221 bytes (0.078 GB)
                           column     dtype       RAM
0                   participantId    object  10912168
1                 enrollmentState    object  10912168
2  successfulRatingNeededToEarnIn     int64  10912168
3      timestampOfLastStateChange     int64  10912168
4          timestampOfLastEarnOut   float64  10912168
5              modelingPopulation  category   1364045
6                   modelingGroup   float64  10912168
7          numberOfTimesEarnedOut     int64  10912168
INFO:birdwatch.constants:Logging Prescoring Inputs Initial RAM usage elapsed time: 0.10 secs (0.00 mins)
INFO:birdwatch.constants:Get Note Topics: Prepare Post Text elapsed time: 1.67 secs (0.03 mins)
INFO:birdwatch.topic_model:  Notes unassigned due to multiple matches: 41
INFO:birdwatch.constants:Get Note Topics: Make Seed Labels elapsed time: 18.31 secs (0.31 mins)
INFO:birdwatch.topic_model:  Initial vocabulary length: 177649
INFO:birdwatch.topic_model:  Total tokens to filter: 34
INFO:birdwatch.topic_model:  Total identified stopwords: 283
INFO:birdwatch.constants:Get Note Topics: Get Stop Words elapsed time: 7.54 secs (0.13 mins)
INFO:birdwatch.constants:Get Note Topics: Train Model elapsed time: 9.24 secs (0.15 mins)
INFO:birdwatch.topic_model:Assigning notes to topics:
INFO:birdwatch.constants:Get Note Topics: Prepare Post Text elapsed time: 1.38 secs (0.02 mins)
INFO:birdwatch.topic_model:  Balanced accuracy on raw predictions: 0.4520598050268324
INFO:birdwatch.topic_model:  Post Topic assignment results: [44922  1138  1473    13  1439]
INFO:birdwatch.constants:Get Note Topics: Merge and assign predictions elapsed time: 0.11 secs (0.00 mins)
INFO:birdwatch.topic_model:  Note Topic assignment results:
noteTopic
GazaConflict       1527
Scams              1455
UkraineConflict    1186
MessiRonaldo         13
Name: count, dtype: int64
INFO:birdwatch.constants:Get Note Topics: Predict elapsed time: 7.09 secs (0.12 mins)
INFO:birdwatch.constants:Note Topic Assignment elapsed time: 45.24 secs (0.75 mins)
INFO:birdwatch.run_scoring:ratings summary before PSS: 72d916edd8480a54840614d8a27768c12eda5a92f28ed63515d656d471f2c6ec
INFO:birdwatch.run_scoring:Post Selection Similarity Prescoring: begin with 4001085 ratings.
INFO:birdwatch.post_selection_similarity:Total ratings prior to applying post selection similarity: 4001085
INFO:birdwatch.post_selection_similarity:Total unique ratings before: 4001085
INFO:birdwatch.post_selection_similarity:Summary of postSelectionSimilarityValues: 
postSelectionValue    86
quasiCliqueValue      38
dtype: int64
INFO:birdwatch.post_selection_similarity:correlatedRater set on 13204 ratings from 38 unique raters
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/post_selection_similarity.py:243: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  ratingsWithPostSelectionSimilarityValue.sort_values(
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/post_selection_similarity.py:246: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  ratingsWithPostSelectionSimilarityValue.drop_duplicates(
INFO:birdwatch.post_selection_similarity:Total ratings after to applying post selection similarity: 3988042
INFO:birdwatch.post_selection_similarity:Total unique ratings after: 3988042
INFO:birdwatch.run_scoring:Post Selection Similarity Prescoring: 3988042 ratings remaining.
INFO:birdwatch.constants:Filter ratings by Post Selection Similarity elapsed time: 16.75 secs (0.28 mins)
INFO:birdwatch.run_scoring:ratings summary after PSS: 9a7cd54d34e5498956eca9b67961c16c00bf98b08b1300f2d5694732fdac0d4a
INFO:birdwatch.run_scoring:Error converting user IDs to ints.  IDs will remain as strings. ValueError("invalid literal for int() with base 10: '65F687F3F0BE41BB456A883BA989742AB6F9566B731F7526D2F0E850C1B7F1DC'")
INFO:birdwatch.run_scoring:notes total RAM: 4050264 bytes (0.004 GB)
                                    column     dtype     RAM
0                                   noteId     int64  400000
1                  noteAuthorParticipantId    object  400000
2                          createdAtMillis     int64  400000
3                                  tweetId    object  400000
4                           classification    object  400000
5                               believable  category   50124
6                                  harmful  category   50016
7                     validationDifficulty  category   50124
8                          misleadingOther      Int8  100000
9                   misleadingFactualError      Int8  100000
10              misleadingManipulatedMedia      Int8  100000
11           misleadingOutdatedInformation      Int8  100000
12       misleadingMissingImportantContext      Int8  100000
13         misleadingUnverifiedClaimAsFact      Int8  100000
14                        misleadingSatire      Int8  100000
15                      notMisleadingOther      Int8  100000
16           notMisleadingFactuallyCorrect      Int8  100000
17  notMisleadingOutdatedButNotWhenWritten      Int8  100000
18              notMisleadingClearlySatire      Int8  100000
19            notMisleadingPersonalOpinion      Int8  100000
20                      trustworthySources      Int8  100000
21                                 summary    object  400000
22                             isMediaNote      Int8  100000
23                     isCollaborativeNote      Int8  100000
INFO:birdwatch.run_scoring:ratings total RAM: 454636936 bytes (0.455 GB)
                                  column     dtype       RAM
0                                 noteId     int64  31904336
1                     raterParticipantId    object  31904336
2                        createdAtMillis     int64  31904336
3                                version      Int8   7976084
4                                  agree      Int8   7976084
5                               disagree      Int8   7976084
6                                helpful      Int8   7976084
7                             notHelpful      Int8   7976084
8                       helpfulnessLevel  category   3988174
9                           helpfulOther      Int8   7976084
10                    helpfulInformative      Int8   7976084
11                          helpfulClear      Int8   7976084
12                     helpfulEmpathetic      Int8   7976084
13                    helpfulGoodSources      Int8   7976084
14                  helpfulUniqueContext      Int8   7976084
15                 helpfulAddressesClaim      Int8   7976084
16               helpfulImportantContext      Int8   7976084
17               helpfulUnbiasedLanguage      Int8   7976084
18                       notHelpfulOther      Int8   7976084
19                   notHelpfulIncorrect      Int8   7976084
20  notHelpfulSourcesMissingOrUnreliable      Int8   7976084
21    notHelpfulOpinionSpeculationOrBias      Int8   7976084
22            notHelpfulMissingKeyPoints      Int8   7976084
23                    notHelpfulOutdated      Int8   7976084
24            notHelpfulHardToUnderstand      Int8   7976084
25       notHelpfulArgumentativeOrBiased      Int8   7976084
26                    notHelpfulOffTopic      Int8   7976084
27       notHelpfulSpamHarassmentOrAbuse      Int8   7976084
28           notHelpfulIrrelevantSources      Int8   7976084
29          notHelpfulOpinionSpeculation      Int8   7976084
30               notHelpfulNoteNotNeeded      Int8   7976084
31                        ratedOnTweetId     int64  31904336
32                  ratingSourceBucketed  category   3988058
33                            helpfulNum   float64  31904336
34                       highVolumeRater      bool   3988042
35                       correlatedRater      bool   3988042
36                    postSelectionValue   float64  31904336
37        postSelectionValue_note_author   float64  31904336
INFO:birdwatch.run_scoring:noteStatusHistory total RAM: 326123170 bytes (0.326 GB)
                                            column     dtype       RAM
0                                           noteId     int64  20224528
1                          noteAuthorParticipantId    object  20224528
2                                  createdAtMillis   float64  20224528
3               timestampMillisOfFirstNonNMRStatus   float64  20224528
4                                firstNonNMRStatus  category   2528190
5                   timestampMillisOfCurrentStatus   float64  20224528
6                                    currentStatus  category   2528198
7              timestampMillisOfLatestNonNMRStatus   float64  20224528
8                           mostRecentNonNMRStatus  category   2528190
9                      timestampMillisOfStatusLock   float64  20224528
10                                    lockedStatus  category   2528198
11                      timestampMillisOfRetroLock   float64  20224528
12                               currentCoreStatus  category   2528278
13                          currentExpansionStatus  category   2528278
14                              currentGroupStatus  category   2528270
15                                currentDecidedBy  category   2529378
16                            currentModelingGroup   float64  20224528
17         timestampMillisOfMostRecentStatusChange   float64  20224528
18       timestampMillisOfNmrDueToMinStableCrhTime   float64  20224528
19                         currentMultiGroupStatus  category   2528270
20                       currentModelingMultiGroup   float64  20224528
21             timestampMinuteOfFinalScoringOutput   float64  20224528
22  timestampMillisOfFirstNmrDueToMinStableCrhTime   float64  20224528
23                                  classification    object  20224528
INFO:birdwatch.run_scoring:userEnrollment total RAM: 77749221 bytes (0.078 GB)
                           column     dtype       RAM
0                   participantId    object  10912168
1                 enrollmentState    object  10912168
2  successfulRatingNeededToEarnIn     int64  10912168
3      timestampOfLastStateChange     int64  10912168
4          timestampOfLastEarnOut   float64  10912168
5              modelingPopulation  category   1364045
6                   modelingGroup   float64  10912168
7          numberOfTimesEarnedOut     int64  10912168
INFO:birdwatch.constants:Logging Prescoring Inputs RAM usage before _run_scorers elapsed time: 0.06 secs (0.00 mins)

INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFCoreWithTopicsScorer set to: 12
INFO:birdwatch.scorer:Filtering ratings for MFCoreWithTopicsScorer.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 3569825
INFO:birdwatch.scorer:MFCoreWithTopicsScorer Filter input elapsed time: 6.76 secs (0.11 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFCoreWithTopicsScorer: 2225481918d5509ff2340d8582050d8073f622c076082760b97f808e90c9664a
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 2387326, Num Unique Notes Rated: 30564, Num Unique Raters: 79773
INFO:birdwatch.scorer:MFCoreWithTopicsScorer Prepare ratings elapsed time: 2.55 secs (0.04 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFCoreWithTopicsScorer: 1d09ed02a9baf049007d80fbfd84dde03498aab5614def883dc6d3100100faf5
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFCoreWithTopicsScorer: a98b9575925fbdbc138fad20a54069ccbb0a2d5fa3b11835db1f34e65d093d9a
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFCoreWithTopicsScorer: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.scorer:MFCoreWithTopicsScorer Prepare data for stable initialization elapsed time: 2.30 secs (0.04 mins)
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:asyncio:Using selector: KqueueSelector
DEBUG:git.cmd:Popen(['git', 'version'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src, stdin=None, shell=False, universal_newlines=False)
DEBUG:git.cmd:Popen(['git', 'version'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src, stdin=None, shell=False, universal_newlines=False)
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 34974, Notes: 7236
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 70.7893864013267
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 14.646079945102075
INFO:birdwatch.matrix_factorization:epoch 0 7.426004409790039
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 6.9417901039123535
INFO:birdwatch.matrix_factorization:epoch 20 0.2695973515510559
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.19923736155033112
INFO:birdwatch.matrix_factorization:epoch 40 0.10906213521957397
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07695330679416656
INFO:birdwatch.matrix_factorization:epoch 60 0.08417394012212753
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05789339169859886
INFO:birdwatch.matrix_factorization:epoch 80 0.08070449531078339
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05513697490096092
INFO:birdwatch.matrix_factorization:epoch 100 0.080245241522789
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05471232160925865
INFO:birdwatch.matrix_factorization:epoch 120 0.08018402010202408
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05465393140912056
INFO:birdwatch.matrix_factorization:epoch 140 0.08017611503601074
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.054660603404045105
INFO:birdwatch.matrix_factorization:Num epochs: 144
INFO:birdwatch.matrix_factorization:epoch 144 0.08017580956220627
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05466045066714287
INFO:birdwatch.matrix_factorization:Global Intercept: 0.13458546996116638
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFCoreWithTopicsScorer MF on stable-initialization subset elapsed time: 20.62 secs (0.34 mins)
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 79773, Notes: 30564
INFO:birdwatch.matrix_factorization:initializing notes

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py, in _initialize_parameters, at line 186: noteInit = self.noteIdMap.merge(
  PandasTypeError: Output mismatch on noteIndex_y: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:initialized global intercept
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 78.10908258081403
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 29.926491419402556
INFO:birdwatch.matrix_factorization:epoch 0 0.2576960623264313
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.22041749954223633
INFO:birdwatch.matrix_factorization:epoch 20 0.10507415980100632
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07693732529878616
INFO:birdwatch.matrix_factorization:epoch 40 0.09514439851045609
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0670657604932785
INFO:birdwatch.matrix_factorization:epoch 60 0.09391562640666962
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06619875878095627
INFO:birdwatch.matrix_factorization:epoch 80 0.0937606692314148
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06595513224601746
INFO:birdwatch.matrix_factorization:epoch 100 0.09374047815799713
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06593272089958191
INFO:birdwatch.matrix_factorization:Num epochs: 113
INFO:birdwatch.matrix_factorization:epoch 113 0.09373831748962402
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06594500690698624
INFO:birdwatch.matrix_factorization:Global Intercept: 0.15629056096076965
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFCoreWithTopicsScorer First full MF (initializated with stable-initialization) elapsed time: 64.04 secs (1.07 mins)
INFO:birdwatch.scorer:MFCoreWithTopicsScorer First MF/stable init elapsed time: 87.30 secs (1.45 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFCoreWithTopicsScorer

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 2409631 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 9446 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.42 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.13 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.34 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.04 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.26 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.19 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.13 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.36 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 93.03 secs (1.55 mins)
INFO:birdwatch.scorer:MFCoreWithTopicsScorer Compute scored notes elapsed time: 132.03 secs (2.20 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 3553009 post-tombstones and 16816 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 2812635, including 2806823 post-tombstones and 5812 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 155621
INFO:birdwatch.scorer:MFCoreWithTopicsScorer Compute valid ratings elapsed time: 7.61 secs (0.13 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFCoreWithTopicsScorer Helpfulness scores pre-harassment  elapsed time: 0.87 secs (0.01 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 79773
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 95580
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 84156
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 37793
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 2387326
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 1422583
INFO:birdwatch.scorer:MFCoreWithTopicsScorer Filtering by helpfulness score elapsed time: 4.52 secs (0.08 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    837786
1     91169
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 491496
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 840299, Num Unique Notes Rated: 21501, Num Unique Raters: 28156
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    755003
1     85296
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.10150672558220347
INFO:birdwatch.matrix_factorization:Using pos weight: 8.8515639654849 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 28156, Notes: 21501
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 39.08185665782987
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 29.84440261400767
INFO:birdwatch.matrix_factorization:epoch 0 3.2110533714294434
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 1.3253991603851318
INFO:birdwatch.matrix_factorization:epoch 20 0.6591613292694092
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.34633004665374756
INFO:birdwatch.matrix_factorization:epoch 40 0.4373529851436615
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.28381580114364624
INFO:birdwatch.matrix_factorization:epoch 60 0.40778523683547974
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.27353253960609436
INFO:birdwatch.matrix_factorization:epoch 80 0.40373557806015015
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2719612419605255
INFO:birdwatch.matrix_factorization:epoch 100 0.40319299697875977
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2718293368816376
INFO:birdwatch.matrix_factorization:epoch 120 0.4031248092651367
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.27179110050201416
INFO:birdwatch.matrix_factorization:Num epochs: 136
INFO:birdwatch.matrix_factorization:epoch 136 0.4031166732311249
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.27178555727005005
INFO:birdwatch.matrix_factorization:Global Intercept: -0.2110743671655655
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFCoreWithTopicsScorer Harassment tag consensus elapsed time: 32.78 secs (0.55 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFCoreWithTopicsScorer Helpfulness scores post-harassment elapsed time: 1.04 secs (0.02 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 79773
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 95580
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 83769
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 37406
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 2387326
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 1392035
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 37406, Notes: 30500
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 45.640491803278685
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 37.21421697053949
INFO:birdwatch.matrix_factorization:epoch 0 0.40730738639831543
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.341918408870697
INFO:birdwatch.matrix_factorization:epoch 20 0.09785958379507065
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06763526797294617
INFO:birdwatch.matrix_factorization:epoch 40 0.09265979379415512
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06558957695960999
INFO:birdwatch.matrix_factorization:epoch 60 0.09173012524843216
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06401786208152771
INFO:birdwatch.matrix_factorization:epoch 80 0.09161122888326645
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06359036266803741
INFO:birdwatch.matrix_factorization:epoch 100 0.09160012751817703
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06357583403587341
INFO:birdwatch.matrix_factorization:Num epochs: 101
INFO:birdwatch.matrix_factorization:epoch 101 0.09160012751817703
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06357583403587341
INFO:birdwatch.matrix_factorization:Global Intercept: 0.16073395311832428
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 42.91 secs (0.72 mins)
INFO:birdwatch.mf_base_scorer:In MFCoreWithTopicsScorer prescoring, about to call diligence with 1392035 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                      raterParticipantId  internalRaterFactor1
0      000045A5FA0CF004F68CBF2913506C37D540CF48522D33...             -0.583194
1      0002CA11E7127598E26C281F887129ADA2623C82BBCE8F...              0.431960
2      00055253971F408A7AB80D461A543E010EC67DFAF29C45...              0.612919
3      0007EFAB89EB0BCC18E8994B141F291F33C9CB80B9332E...             -0.111424
4      0008AA2B592A961E760CED75ED025B716C4F51956DDFD9...              0.164441
...                                                  ...                   ...
37401  FFF566C4AC6CDF855B2083DA2C7D9CF983135BCF167735...              0.626112
37402  FFF69D67772D36A4F36656044618362E9F92C97215AE48...             -0.537732
37403  FFFA49720F254411E1F79CA757C403F0A0217240BC4922...             -0.175260
37404  FFFEB058BCC25277E2662DD3E8C0506FB1B23BA4D965EA...              0.630795
37405  FFFF3B1E5FB7927B196BCC7753E5CE5B2E64AFA90099E0...             -0.211298

[37406 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 37406, vs. num we are initializing: 37406
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 37406
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=18.495272 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.676009 | time=7.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=3.219462 | time=14.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=3.151501 | time=22.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=3.132690 | time=29.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=3.124315 | time=37.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=3.119617 | time=44.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=3.116895 | time=52.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=3.115083 | time=59.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=3.113800 | time=67.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=3.112999 | time=75.3s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(0.6771, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=3.112979 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.835505 | time=7.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.826326 | time=14.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.825425 | time=22.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=100 | loss=1.825396 | time=24.4s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.368205 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.256696 | time=4.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.255337 | time=9.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=080 | loss=0.255273 | time=12.4s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(2.2319, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 3.1130, 1.8254, 0.2553
INFO:birdwatch.scorer:MFCoreWithTopicsScorer Low Diligence MF elapsed time: 114.77 secs (1.91 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 2409631 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 9446 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.11 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.20 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.04 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.23 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.10 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.14 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.24 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 80.90 secs (1.35 mins)
INFO:birdwatch.constants:MFCoreWithTopicsScorer: Compute tag thresholds for percentiles elapsed time: 6.80 secs (0.11 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 280: pd.DataFrame(columns=self.get_auxiliary_note_info_cols())
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFCoreScorer set to: 12
INFO:birdwatch.scorer:Filtering ratings for MFCoreScorer.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3662174
INFO:birdwatch.scorer:  Ratings without assigned group: 491
INFO:birdwatch.scorer:  Ratings after group filter: 3291769
INFO:birdwatch.scorer:MFCoreScorer Filter input elapsed time: 9.68 secs (0.16 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFCoreScorer: a2fbcfc41138f2e6b730b0b26cf7b1f09afac2a49c0e18c6c97c61709bca991f
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 2153132, Num Unique Notes Rated: 27775, Num Unique Raters: 73281
INFO:birdwatch.scorer:MFCoreScorer Prepare ratings elapsed time: 2.35 secs (0.04 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFCoreScorer: 890c420dafb12dc01f2db4c1994ec45acc5d31de1511d7b37060d234ad072e7d
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFCoreScorer: ad384f60b737285de5e8091e1c2f985eac3d7b58d7b77a2f1aff20f2adf11053
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFCoreScorer: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.scorer:MFCoreScorer Prepare data for stable initialization elapsed time: 2.12 secs (0.04 mins)
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 33031, Notes: 7078
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 70.6612037298672
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 15.141533710756562
INFO:birdwatch.matrix_factorization:epoch 0 7.512246131896973
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 7.026849269866943
INFO:birdwatch.matrix_factorization:epoch 20 0.2908824682235718
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.22015655040740967
INFO:birdwatch.matrix_factorization:epoch 40 0.10484963655471802
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07285383343696594
INFO:birdwatch.matrix_factorization:epoch 60 0.08352994918823242
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.057250335812568665
INFO:birdwatch.matrix_factorization:epoch 80 0.0806979313492775
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05504160374403
INFO:birdwatch.matrix_factorization:epoch 100 0.08030141890048981
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05470287799835205
INFO:birdwatch.matrix_factorization:epoch 120 0.08024920523166656
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05466125160455704
INFO:birdwatch.matrix_factorization:epoch 140 0.0802425816655159
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05466243624687195
INFO:birdwatch.matrix_factorization:Num epochs: 141
INFO:birdwatch.matrix_factorization:epoch 141 0.0802425816655159
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05466243624687195
INFO:birdwatch.matrix_factorization:Global Intercept: 0.1346540004014969
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFCoreScorer MF on stable-initialization subset elapsed time: 17.99 secs (0.30 mins)
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 73281, Notes: 27775
INFO:birdwatch.matrix_factorization:initializing notes

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py, in _initialize_parameters, at line 186: noteInit = self.noteIdMap.merge(
  PandasTypeError: Output mismatch on noteIndex_y: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:initialized global intercept
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 77.52050405040504
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 29.381858872013208
INFO:birdwatch.matrix_factorization:epoch 0 0.2568698823451996
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.21925194561481476
INFO:birdwatch.matrix_factorization:epoch 20 0.10342933237552643
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07514701783657074
INFO:birdwatch.matrix_factorization:epoch 40 0.09368083626031876
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06574956327676773
INFO:birdwatch.matrix_factorization:epoch 60 0.09242374449968338
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0648040845990181
INFO:birdwatch.matrix_factorization:epoch 80 0.09227100014686584
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06458201259374619
INFO:birdwatch.matrix_factorization:epoch 100 0.09225098788738251
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06456127762794495
INFO:birdwatch.matrix_factorization:Num epochs: 112
INFO:birdwatch.matrix_factorization:epoch 112 0.09224893897771835
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06456664204597473
INFO:birdwatch.matrix_factorization:Global Intercept: 0.15501782298088074
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFCoreScorer First full MF (initializated with stable-initialization) elapsed time: 60.12 secs (1.00 mins)
INFO:birdwatch.scorer:MFCoreScorer First MF/stable init elapsed time: 80.50 secs (1.34 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFCoreScorer

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 2173646 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 8764 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.23 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.10 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.31 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.04 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.54 secs (0.03 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.22 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.34 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.40 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 81.15 secs (1.35 mins)
INFO:birdwatch.scorer:MFCoreScorer Compute scored notes elapsed time: 118.90 secs (1.98 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 3276066 post-tombstones and 15703 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 2600499, including 2594981 post-tombstones and 5518 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 138687
INFO:birdwatch.scorer:MFCoreScorer Compute valid ratings elapsed time: 6.52 secs (0.11 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFCoreScorer Helpfulness scores pre-harassment  elapsed time: 0.77 secs (0.01 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 73281
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 85606
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 75290
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 33465
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 2153132
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 1247700
INFO:birdwatch.scorer:MFCoreScorer Filtering by helpfulness score elapsed time: 3.99 secs (0.07 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    730900
1     81386
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 433417
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 731978, Num Unique Notes Rated: 19113, Num Unique Raters: 24722
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    655977
1     76001
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.10382962329468919
INFO:birdwatch.matrix_factorization:Using pos weight: 8.631162747858582 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 24722, Notes: 19113
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 38.29738921153142
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 29.60836501901141
INFO:birdwatch.matrix_factorization:epoch 0 3.179448127746582
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 1.2940483093261719
INFO:birdwatch.matrix_factorization:epoch 20 0.6528248190879822
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3389514982700348
INFO:birdwatch.matrix_factorization:epoch 40 0.43085822463035583
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.27799153327941895
INFO:birdwatch.matrix_factorization:epoch 60 0.40105098485946655
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.26719892024993896
INFO:birdwatch.matrix_factorization:epoch 80 0.3970201015472412
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2657252550125122
INFO:birdwatch.matrix_factorization:epoch 100 0.39647191762924194
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.26557332277297974
INFO:birdwatch.matrix_factorization:epoch 120 0.3964032530784607
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.26556235551834106
INFO:birdwatch.matrix_factorization:Num epochs: 137
INFO:birdwatch.matrix_factorization:epoch 137 0.39639517664909363
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2655673623085022
INFO:birdwatch.matrix_factorization:Global Intercept: -0.20831212401390076
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFCoreScorer Harassment tag consensus elapsed time: 25.54 secs (0.43 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFCoreScorer Helpfulness scores post-harassment elapsed time: 0.93 secs (0.02 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 73281
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 85606
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 74925
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 33100
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 2153132
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 1222958
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 33100, Notes: 27676
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 44.18839427662957
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 36.94737160120846
INFO:birdwatch.matrix_factorization:epoch 0 0.4087894558906555
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3438110053539276
INFO:birdwatch.matrix_factorization:epoch 20 0.09645813703536987
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0664927065372467
INFO:birdwatch.matrix_factorization:epoch 40 0.09100739657878876
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06411206722259521
INFO:birdwatch.matrix_factorization:epoch 60 0.09006290137767792
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06259249895811081
INFO:birdwatch.matrix_factorization:epoch 80 0.0899336189031601
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06213667616248131
INFO:birdwatch.matrix_factorization:epoch 100 0.08992078900337219
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06214725598692894
INFO:birdwatch.matrix_factorization:Num epochs: 101
INFO:birdwatch.matrix_factorization:epoch 101 0.08992078900337219
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06214725598692894
INFO:birdwatch.matrix_factorization:Global Intercept: 0.15884388983249664
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 35.64 secs (0.59 mins)
INFO:birdwatch.mf_base_scorer:In MFCoreScorer prescoring, about to call diligence with 1222958 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                      raterParticipantId  internalRaterFactor1
0      000045A5FA0CF004F68CBF2913506C37D540CF48522D33...             -0.567630
1      0002CA11E7127598E26C281F887129ADA2623C82BBCE8F...              0.417102
2      00055253971F408A7AB80D461A543E010EC67DFAF29C45...              0.606705
3      0007EFAB89EB0BCC18E8994B141F291F33C9CB80B9332E...             -0.111350
4      0008AA2B592A961E760CED75ED025B716C4F51956DDFD9...              0.157624
...                                                  ...                   ...
33095  FFF22CB48A5F4C1C0F944C552973CE17979A4B2F5C225C...              0.515434
33096  FFF4C20F77FE6BBB23129254835E9257FC9F76BB7BF098...             -0.387801
33097  FFF566C4AC6CDF855B2083DA2C7D9CF983135BCF167735...              0.678595
33098  FFF69D67772D36A4F36656044618362E9F92C97215AE48...             -0.517205
33099  FFFF3B1E5FB7927B196BCC7753E5CE5B2E64AFA90099E0...             -0.260983

[33100 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 33100, vs. num we are initializing: 33100
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 33100
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=18.475792 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.668308 | time=6.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=3.209128 | time=13.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=3.138724 | time=19.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=3.117860 | time=26.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=3.108418 | time=32.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=3.102977 | time=39.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=3.099778 | time=45.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=3.097635 | time=52.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=3.096036 | time=59.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=3.095096 | time=66.1s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(0.6437, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=3.095073 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.815031 | time=6.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.805449 | time=12.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.804529 | time=19.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=100 | loss=1.804493 | time=21.4s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.367981 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.257204 | time=4.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.255842 | time=7.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=080 | loss=0.255778 | time=10.5s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(2.1758, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 3.0951, 1.8045, 0.2558
INFO:birdwatch.scorer:MFCoreScorer Low Diligence MF elapsed time: 100.13 secs (1.67 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 2173646 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 8764 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.09 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.10 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.22 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.04 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.27 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.20 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.17 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.31 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 86.18 secs (1.44 mins)
INFO:birdwatch.constants:MFCoreScorer: Compute tag thresholds for percentiles elapsed time: 6.02 secs (0.10 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFExpansionScorer set to: 12
INFO:birdwatch.scorer:Filtering ratings for MFExpansionScorer.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 3979420
INFO:birdwatch.scorer:MFExpansionScorer Filter input elapsed time: 6.59 secs (0.11 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFExpansionScorer: 68c66d6d968a99904637f35488aa65b8cf53da7169e413e4609fab1b9f5c0cb6
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 2568687, Num Unique Notes Rated: 32491, Num Unique Raters: 87649
INFO:birdwatch.scorer:MFExpansionScorer Prepare ratings elapsed time: 2.90 secs (0.05 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFExpansionScorer: d6a9575cf58ce0ec4570d5d6aaf9d6e69f6692472359e994309ae195efcd9006
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFExpansionScorer: a98b9575925fbdbc138fad20a54069ccbb0a2d5fa3b11835db1f34e65d093d9a
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFExpansionScorer: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.scorer:MFExpansionScorer Prepare data for stable initialization elapsed time: 2.32 secs (0.04 mins)
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 34449, Notes: 6329
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 65.86490756833624
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 12.100757641731255
INFO:birdwatch.matrix_factorization:epoch 0 7.412086486816406
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 6.92913293838501
INFO:birdwatch.matrix_factorization:epoch 20 0.2673580050468445
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.21390333771705627
INFO:birdwatch.matrix_factorization:epoch 40 0.10575569421052933
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07516976445913315
INFO:birdwatch.matrix_factorization:epoch 60 0.08363299071788788
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05757945403456688
INFO:birdwatch.matrix_factorization:epoch 80 0.08059990406036377
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.055005431175231934
INFO:birdwatch.matrix_factorization:epoch 100 0.08020740747451782
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05473397672176361
INFO:birdwatch.matrix_factorization:epoch 120 0.08015605807304382
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05468348041176796
INFO:birdwatch.matrix_factorization:epoch 140 0.08014946430921555
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.054671794176101685
INFO:birdwatch.matrix_factorization:Num epochs: 141
INFO:birdwatch.matrix_factorization:epoch 141 0.08014946430921555
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.054671794176101685
INFO:birdwatch.matrix_factorization:Global Intercept: 0.13243736326694489
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFExpansionScorer MF on stable-initialization subset elapsed time: 14.41 secs (0.24 mins)
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 87649, Notes: 32491
INFO:birdwatch.matrix_factorization:initializing notes

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py, in _initialize_parameters, at line 186: noteInit = self.noteIdMap.merge(
  PandasTypeError: Output mismatch on noteIndex_y: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:initialized global intercept
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 79.05841617678742
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 29.30651804356011
INFO:birdwatch.matrix_factorization:epoch 0 0.2548961341381073
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.21886005997657776
INFO:birdwatch.matrix_factorization:epoch 20 0.10591504722833633
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0777781754732132
INFO:birdwatch.matrix_factorization:epoch 40 0.09570422768592834
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06730761379003525
INFO:birdwatch.matrix_factorization:epoch 60 0.09446217119693756
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06659417599439621
INFO:birdwatch.matrix_factorization:epoch 80 0.09430292248725891
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06638509780168533
INFO:birdwatch.matrix_factorization:epoch 100 0.0942816436290741
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06635743379592896
INFO:birdwatch.matrix_factorization:Num epochs: 113
INFO:birdwatch.matrix_factorization:epoch 113 0.09427943825721741
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06636485457420349
INFO:birdwatch.matrix_factorization:Global Intercept: 0.15715965628623962
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFExpansionScorer First full MF (initializated with stable-initialization) elapsed time: 63.36 secs (1.06 mins)
INFO:birdwatch.scorer:MFExpansionScorer First MF/stable init elapsed time: 80.36 secs (1.34 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFExpansionScorer

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 2590566 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 10452 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.19 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.11 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.25 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.04 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.28 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.22 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.33 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.42 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 86.37 secs (1.44 mins)
INFO:birdwatch.scorer:MFExpansionScorer Compute scored notes elapsed time: 125.25 secs (2.09 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 3961906 post-tombstones and 17514 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 3138203, including 3132226 post-tombstones and 5977 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 174187
INFO:birdwatch.scorer:MFExpansionScorer Compute valid ratings elapsed time: 7.71 secs (0.13 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFExpansionScorer Helpfulness scores pre-harassment  elapsed time: 0.93 secs (0.02 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 87649
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 109741
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 97286
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 41528
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 2568687
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 1525682
INFO:birdwatch.scorer:MFExpansionScorer Filtering by helpfulness score elapsed time: 4.81 secs (0.08 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    903934
1     98340
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 521192
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 904692, Num Unique Notes Rated: 22932, Num Unique Raters: 30791
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    812840
1     91852
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.10152847598961856
INFO:birdwatch.matrix_factorization:Using pos weight: 8.849453468623437 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 30791, Notes: 22932
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 39.451072736787026
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 29.381702445519796
INFO:birdwatch.matrix_factorization:epoch 0 3.2228732109069824
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 1.3371429443359375
INFO:birdwatch.matrix_factorization:epoch 20 0.66138756275177
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3480983078479767
INFO:birdwatch.matrix_factorization:epoch 40 0.44039827585220337
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2864857316017151
INFO:birdwatch.matrix_factorization:epoch 60 0.41068947315216064
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.27590662240982056
INFO:birdwatch.matrix_factorization:epoch 80 0.40666651725769043
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2743440270423889
INFO:birdwatch.matrix_factorization:epoch 100 0.4061133861541748
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.27418676018714905
INFO:birdwatch.matrix_factorization:epoch 120 0.40604230761528015
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2741396427154541
INFO:birdwatch.matrix_factorization:Num epochs: 132
INFO:birdwatch.matrix_factorization:epoch 132 0.4060364365577698
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.27414241433143616
INFO:birdwatch.matrix_factorization:Global Intercept: -0.21107600629329681
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFExpansionScorer Harassment tag consensus elapsed time: 30.33 secs (0.51 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFExpansionScorer Helpfulness scores post-harassment elapsed time: 1.24 secs (0.02 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 87649
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 109741
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 96860
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 41102
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 2568687
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 1492959
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 41102, Notes: 32413
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 46.06050041649955
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 36.32326894068415
INFO:birdwatch.matrix_factorization:epoch 0 0.4059346616268158
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3402516543865204
INFO:birdwatch.matrix_factorization:epoch 20 0.09807910025119781
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06765244156122208
INFO:birdwatch.matrix_factorization:epoch 40 0.09315074980258942
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06589946150779724
INFO:birdwatch.matrix_factorization:epoch 60 0.09224888682365417
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06434981524944305
INFO:birdwatch.matrix_factorization:epoch 80 0.09213559329509735
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06393416225910187
INFO:birdwatch.matrix_factorization:epoch 100 0.09212543070316315
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0639088973402977
INFO:birdwatch.matrix_factorization:Num epochs: 101
INFO:birdwatch.matrix_factorization:epoch 101 0.09212543070316315
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0639088973402977
INFO:birdwatch.matrix_factorization:Global Intercept: 0.1621266007423401
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 41.55 secs (0.69 mins)
INFO:birdwatch.mf_base_scorer:In MFExpansionScorer prescoring, about to call diligence with 1492959 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                      raterParticipantId  internalRaterFactor1
0      000045A5FA0CF004F68CBF2913506C37D540CF48522D33...             -0.585140
1      0002CA11E7127598E26C281F887129ADA2623C82BBCE8F...              0.418088
2      00037E5A04D7781E19E5AAF559E14512FF17E7F76C30AF...             -0.400670
3      00055253971F408A7AB80D461A543E010EC67DFAF29C45...              0.610852
4      0007EFAB89EB0BCC18E8994B141F291F33C9CB80B9332E...             -0.132920
...                                                  ...                   ...
41097  FFF7EDDCE3F147B1B3350D639AA98CAA36412F88FA9084...              0.439837
41098  FFFA49720F254411E1F79CA757C403F0A0217240BC4922...             -0.176162
41099  FFFE3234F03ED7E6F39F6799E38C7C146F849346F295D9...             -0.555250
41100  FFFEB058BCC25277E2662DD3E8C0506FB1B23BA4D965EA...              0.624085
41101  FFFF3B1E5FB7927B196BCC7753E5CE5B2E64AFA90099E0...             -0.210386

[41102 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 41102, vs. num we are initializing: 41102
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 41102
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=18.296358 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.663623 | time=7.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=3.213373 | time=16.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=3.147672 | time=23.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=3.129843 | time=31.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=3.122008 | time=39.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=3.117752 | time=48.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=3.115215 | time=56.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=3.113587 | time=64.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=3.112499 | time=72.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=3.111758 | time=80.9s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(0.6761, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=3.111740 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.833326 | time=8.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.824338 | time=17.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.823418 | time=28.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=100 | loss=1.823389 | time=31.3s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.369815 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.257061 | time=6.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.255694 | time=11.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=080 | loss=0.255630 | time=15.4s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(2.2482, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 3.1118, 1.8234, 0.2556
INFO:birdwatch.scorer:MFExpansionScorer Low Diligence MF elapsed time: 130.15 secs (2.17 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 2590566 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 10452 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.24 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.11 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.26 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.04 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.48 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.20 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.24 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.35 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 84.32 secs (1.41 mins)
INFO:birdwatch.constants:MFExpansionScorer: Compute tag thresholds for percentiles elapsed time: 7.44 secs (0.12 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFExpansionPlusScorer set to: 12
INFO:birdwatch.scorer:Filtering ratings for MFExpansionPlusScorer.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 3988042
INFO:birdwatch.scorer:MFExpansionPlusScorer Filter input elapsed time: 6.15 secs (0.10 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFExpansionPlusScorer: 608faef1700c88e9481d1a67c004cd1862b618a8a597c5b8f6a57ce19027a9c0
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 2570017, Num Unique Notes Rated: 32497, Num Unique Raters: 87730
INFO:birdwatch.scorer:MFExpansionPlusScorer Prepare ratings elapsed time: 3.07 secs (0.05 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFExpansionPlusScorer: 6f6712e1dba215318d2e473399c6e2441baf59d384e73c5921d70b8262ae7107
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFExpansionPlusScorer: a98b9575925fbdbc138fad20a54069ccbb0a2d5fa3b11835db1f34e65d093d9a
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFExpansionPlusScorer: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.scorer:MFExpansionPlusScorer Prepare data for stable initialization elapsed time: 2.33 secs (0.04 mins)
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 34447, Notes: 6326
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 65.84065760354095
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 12.091270647661625
INFO:birdwatch.matrix_factorization:epoch 0 7.384893894195557
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 6.9022216796875
INFO:birdwatch.matrix_factorization:epoch 20 0.270539253950119
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.20508603751659393
INFO:birdwatch.matrix_factorization:epoch 40 0.10745707899332047
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07528224587440491
INFO:birdwatch.matrix_factorization:epoch 60 0.08378903567790985
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05753856152296066
INFO:birdwatch.matrix_factorization:epoch 80 0.08060535788536072
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05495910346508026
INFO:birdwatch.matrix_factorization:epoch 100 0.08020196855068207
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05473898723721504
INFO:birdwatch.matrix_factorization:epoch 120 0.08014828711748123
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05467720329761505
INFO:birdwatch.matrix_factorization:epoch 140 0.08014130592346191
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05466701090335846
INFO:birdwatch.matrix_factorization:Num epochs: 142
INFO:birdwatch.matrix_factorization:epoch 142 0.08014121651649475
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05466269701719284
INFO:birdwatch.matrix_factorization:Global Intercept: 0.1324162632226944
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFExpansionPlusScorer MF on stable-initialization subset elapsed time: 14.53 secs (0.24 mins)
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 87730, Notes: 32497
INFO:birdwatch.matrix_factorization:initializing notes

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py, in _initialize_parameters, at line 186: noteInit = self.noteIdMap.merge(
  PandasTypeError: Output mismatch on noteIndex_y: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:initialized global intercept
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 79.0847462842724
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 29.294619856377523
INFO:birdwatch.matrix_factorization:epoch 0 0.2547913193702698
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.21876351535320282
INFO:birdwatch.matrix_factorization:epoch 20 0.10591132938861847
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07777758687734604
INFO:birdwatch.matrix_factorization:epoch 40 0.09571052342653275
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06731309741735458
INFO:birdwatch.matrix_factorization:epoch 60 0.09446749091148376
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06659863889217377
INFO:birdwatch.matrix_factorization:epoch 80 0.09430815279483795
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06638949364423752
INFO:birdwatch.matrix_factorization:epoch 100 0.09428688883781433
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06636204570531845
INFO:birdwatch.matrix_factorization:Num epochs: 114
INFO:birdwatch.matrix_factorization:epoch 114 0.09428457170724869
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06637285649776459
INFO:birdwatch.matrix_factorization:Global Intercept: 0.15712252259254456
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFExpansionPlusScorer First full MF (initializated with stable-initialization) elapsed time: 64.26 secs (1.07 mins)
INFO:birdwatch.scorer:MFExpansionPlusScorer First MF/stable init elapsed time: 81.38 secs (1.36 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFExpansionPlusScorer

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 2591889 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 10466 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.40 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.13 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.47 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.04 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.30 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.33 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.17 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.29 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 81.18 secs (1.35 mins)
INFO:birdwatch.scorer:MFExpansionPlusScorer Compute scored notes elapsed time: 119.49 secs (1.99 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 3970525 post-tombstones and 17517 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 3144126, including 3138149 post-tombstones and 5977 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 174145
INFO:birdwatch.scorer:MFExpansionPlusScorer Compute valid ratings elapsed time: 7.69 secs (0.13 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFExpansionPlusScorer Helpfulness scores pre-harassment  elapsed time: 0.90 secs (0.02 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 87730
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 109921
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 97446
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 41542
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 2570017
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 1525854
INFO:birdwatch.scorer:MFExpansionPlusScorer Filtering by helpfulness score elapsed time: 4.50 secs (0.07 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    904046
1     98361
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 521231
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 904700, Num Unique Notes Rated: 22928, Num Unique Raters: 30790
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    812834
1     91866
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.10154305294572787
INFO:birdwatch.matrix_factorization:Using pos weight: 8.848039535845688 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 30790, Notes: 22928
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 39.458304256803906
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 29.382916531341344
INFO:birdwatch.matrix_factorization:epoch 0 3.222942352294922
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 1.337204098701477
INFO:birdwatch.matrix_factorization:epoch 20 0.6614296436309814
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3481769263744354
INFO:birdwatch.matrix_factorization:epoch 40 0.44040441513061523
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.28650304675102234
INFO:birdwatch.matrix_factorization:epoch 60 0.4107084274291992
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.27592596411705017
INFO:birdwatch.matrix_factorization:epoch 80 0.4066820740699768
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2743643522262573
INFO:birdwatch.matrix_factorization:epoch 100 0.40613096952438354
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2742035984992981
INFO:birdwatch.matrix_factorization:epoch 120 0.4060590863227844
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.27415913343429565
INFO:birdwatch.matrix_factorization:Num epochs: 136
INFO:birdwatch.matrix_factorization:epoch 136 0.4060513973236084
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.27415937185287476
INFO:birdwatch.matrix_factorization:Global Intercept: -0.21102601289749146
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFExpansionPlusScorer Harassment tag consensus elapsed time: 31.47 secs (0.52 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFExpansionPlusScorer Helpfulness scores post-harassment elapsed time: 1.10 secs (0.02 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 87730
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 109921
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 97021
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 41117
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 2570017
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 1493189
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 41117, Notes: 32419
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 46.059070298281874
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 36.315611547535084
INFO:birdwatch.matrix_factorization:epoch 0 0.4058769941329956
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.34020140767097473
INFO:birdwatch.matrix_factorization:epoch 20 0.0980844646692276
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06765874475240707
INFO:birdwatch.matrix_factorization:epoch 40 0.0931534692645073
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06590418517589569
INFO:birdwatch.matrix_factorization:epoch 60 0.0922502726316452
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06435157358646393
INFO:birdwatch.matrix_factorization:epoch 80 0.09213672578334808
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06393633037805557
INFO:birdwatch.matrix_factorization:epoch 100 0.09212647378444672
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0639113336801529
INFO:birdwatch.matrix_factorization:Num epochs: 101
INFO:birdwatch.matrix_factorization:epoch 101 0.09212647378444672
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0639113336801529
INFO:birdwatch.matrix_factorization:Global Intercept: 0.16212934255599976
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 41.74 secs (0.70 mins)
INFO:birdwatch.mf_base_scorer:In MFExpansionPlusScorer prescoring, about to call diligence with 1493189 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                      raterParticipantId  internalRaterFactor1
0      000045A5FA0CF004F68CBF2913506C37D540CF48522D33...             -0.585086
1      0002CA11E7127598E26C281F887129ADA2623C82BBCE8F...              0.417874
2      00037E5A04D7781E19E5AAF559E14512FF17E7F76C30AF...             -0.400743
3      00055253971F408A7AB80D461A543E010EC67DFAF29C45...              0.610596
4      0007EFAB89EB0BCC18E8994B141F291F33C9CB80B9332E...             -0.133827
...                                                  ...                   ...
41112  FFF7EDDCE3F147B1B3350D639AA98CAA36412F88FA9084...              0.439917
41113  FFFA49720F254411E1F79CA757C403F0A0217240BC4922...             -0.176435
41114  FFFE3234F03ED7E6F39F6799E38C7C146F849346F295D9...             -0.555638
41115  FFFEB058BCC25277E2662DD3E8C0506FB1B23BA4D965EA...              0.623825
41116  FFFF3B1E5FB7927B196BCC7753E5CE5B2E64AFA90099E0...             -0.209239

[41117 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 41117, vs. num we are initializing: 41117
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 41117
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=18.484056 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.690695 | time=8.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=3.222018 | time=16.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=3.151879 | time=25.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=3.132414 | time=35.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=3.123662 | time=44.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=3.118857 | time=53.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=3.115963 | time=63.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=3.114184 | time=72.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=3.113007 | time=82.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=3.112215 | time=90.6s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(0.6813, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=3.112194 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.833806 | time=8.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.824720 | time=15.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.823799 | time=23.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=100 | loss=1.823764 | time=26.5s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.370204 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.257176 | time=5.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.255802 | time=10.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=080 | loss=0.255737 | time=13.6s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(2.2481, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 3.1122, 1.8238, 0.2557
INFO:birdwatch.scorer:MFExpansionPlusScorer Low Diligence MF elapsed time: 133.50 secs (2.23 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 2591889 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 10466 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.10 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.22 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.23 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.14 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.12 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.30 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 82.51 secs (1.38 mins)
INFO:birdwatch.constants:MFExpansionPlusScorer: Compute tag thresholds for percentiles elapsed time: 7.23 secs (0.12 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for ReputationScorer set to: 12
INFO:birdwatch.scorer:Filtering ratings for ReputationScorer.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 3569825
INFO:birdwatch.scorer:ReputationScorer Filter input elapsed time: 7.42 secs (0.12 mins)
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 2387326, Num Unique Notes Rated: 30564, Num Unique Raters: 79773
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 34974, Notes: 7236
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 70.7893864013267
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 14.646079945102075
INFO:birdwatch.matrix_factorization:epoch 0 7.47501802444458
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 6.990758419036865
INFO:birdwatch.matrix_factorization:epoch 20 0.2792172133922577
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.22105200588703156
INFO:birdwatch.matrix_factorization:epoch 40 0.11338776350021362
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07877928018569946
INFO:birdwatch.matrix_factorization:epoch 60 0.08471237868070602
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.058137159794569016
INFO:birdwatch.matrix_factorization:epoch 80 0.08077508211135864
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.055192794650793076
INFO:birdwatch.matrix_factorization:epoch 100 0.08025483787059784
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05471041426062584
INFO:birdwatch.matrix_factorization:epoch 120 0.08018510788679123
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05465756729245186
INFO:birdwatch.matrix_factorization:epoch 140 0.08017627149820328
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.054663412272930145
INFO:birdwatch.matrix_factorization:Num epochs: 143
INFO:birdwatch.matrix_factorization:epoch 143 0.08017604053020477
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.054658953100442886
INFO:birdwatch.matrix_factorization:Global Intercept: 0.1346663385629654
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
                   noteId  internalNoteFactor1
0     1377281345605472256            -0.562232
1     1379042834678870019             0.412343
2     1411136229035417602             0.375075
3     1417506709489266699             0.399769
4     1423432584806256647             0.273127
...                   ...                  ...
7231  1798345473138544767            -0.092639
7232  1969698945199755326             0.234766
7233  1859577066997387538            -0.150349
7234  1829342583304425781             0.162476
7235  2000203513532432641             0.059746

[7236 rows x 2 columns],
 raterInitState: 
                                      raterParticipantId  internalRaterFactor1
0      65F687F3F0BE41BB456A883BA989742AB6F9566B731F75...              0.808688
1      D6602F91F0E36E0C5230FB766CF1529E6FB5FC677DCB17...              0.746541
2      5926E5D40EA0EE16FE23941EADF05B78DEFDFD84D1DBEB...              0.549738
3      04243FCEE3704BBA1846E5009F2BA03EE36A98C381FDA4...             -0.550523
4      0BD47C7568154F38C2A90F1A2A9A7573F52415E24DBE18...             -0.569307
...                                                  ...                   ...
34969  D929B80B5FF339ADA3FC081819C60FFEC537198A452CBF...             -0.627211
34970  7D7BAA5B227CBB1058E05356F5A8CA9BD8F35691C4E0D1...             -0.422172
34971  0EFB6486B1D3907CB10E4D8A6B90203203502612790465...             -0.535260
34972  C268312EBE067A1C280DEB03FBC6A727879EFD4F97AEDE...             -0.423123
34973  661124877CA60A5DFE80D04DE9F9A9563C563C84B22D55...             -0.530879

[34974 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 79773, vs. num we are initializing: 34974
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 44799
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 34974
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Initializing internalNoteFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 30564, vs. num we are initializing: 7236
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalNoteFactor1s: 29406
INFO:birdwatch.reputation_matrix_factorization:  initialized internalNoteFactor1s: 1158
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.301992 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.023773 | time=12.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.019764 | time=24.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=0.019560 | time=36.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=0.019544 | time=48.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=0.019541 | time=61.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=170 | loss=0.019541 | time=69.3s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(0.4036, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.116229 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.071817 | time=11.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.069982 | time=23.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=0.069878 | time=36.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=0.069871 | time=49.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=0.069870 | time=61.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=160 | loss=0.069870 | time=65.4s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.006048 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.005630 | time=7.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.005514 | time=13.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=0.005507 | time=20.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=110 | loss=0.005506 | time=25.5s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(0.5948, requires_grad=True)
INFO:birdwatch.helpfulness_model:Helpfulness reputation loss: 0.0195, 0.0699, 0.0055

CONCAT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/reputation_scorer.py, in _prescore_notes_and_users, at line 147: noteStats = noteStats.merge(noteStatusHistory[[c.noteIdKey]].drop_duplicates(), how="outer")
  PandasTypeError: Type expectation mismatch on noteId: found=float64 expected=int64
  PandasTypeError: Type expectation mismatch on noteId: found=float64 expected=int64

INFO:birdwatch.reputation_scorer:Reputation prescoring: returning these columns:
          noteStats: Index(['noteId', 'internalNoteIntercept', 'internalNoteFactor1',
       'lowDiligenceNoteInterceptRound2'],
      dtype='object')
          raterStats: Index(['raterParticipantId', 'internalRaterReputation',
       'internalRaterIntercept', 'internalRaterFactor1',
       'lowDiligenceRaterInterceptRound2'],
      dtype='object')
          

INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_13 set to: 8
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_13.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 1632387
INFO:birdwatch.scorer:MFGroupScorer_13 Filter input elapsed time: 4.43 secs (0.07 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_13: 8590ad518d30011e5c9e2c1864ed165783fc480031268e45a6af994c42c9f150
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 1190040, Num Unique Notes Rated: 18279, Num Unique Raters: 35248
INFO:birdwatch.scorer:MFGroupScorer_13 Prepare ratings elapsed time: 1.12 secs (0.02 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_13: 2d485429ac6bd5ac86a83949ba4cc0e8de812f92482c4ce8e2519dc7cf74151f
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_13: a98b9575925fbdbc138fad20a54069ccbb0a2d5fa3b11835db1f34e65d093d9a
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_13: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 35248, Notes: 18279
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 65.10421795503036
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 33.76191556967771
INFO:birdwatch.matrix_factorization:epoch 0 7.459750175476074
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 6.980473041534424
INFO:birdwatch.matrix_factorization:epoch 20 0.23779404163360596
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.17035508155822754
INFO:birdwatch.matrix_factorization:epoch 40 0.11117921769618988
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.08255136013031006
INFO:birdwatch.matrix_factorization:epoch 60 0.09176009893417358
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06577890366315842
INFO:birdwatch.matrix_factorization:epoch 80 0.08933625370264053
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06345323473215103
INFO:birdwatch.matrix_factorization:epoch 100 0.08896598219871521
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06286203861236572
INFO:birdwatch.matrix_factorization:Num epochs: 104
INFO:birdwatch.matrix_factorization:epoch 104 0.08895662426948547
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06302852928638458
INFO:birdwatch.matrix_factorization:Global Intercept: 0.14152564108371735
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_13 First MF/stable init elapsed time: 26.22 secs (0.44 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_13

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 1211005 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 2282 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.09 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.10 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.21 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.25 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.17 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.11 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.27 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 79.47 secs (1.32 mins)
INFO:birdwatch.scorer:MFGroupScorer_13 Compute scored notes elapsed time: 109.05 secs (1.82 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 1616669 post-tombstones and 15718 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 1312448, including 1306649 post-tombstones and 5799 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 50619
INFO:birdwatch.scorer:MFGroupScorer_13 Compute valid ratings elapsed time: 3.63 secs (0.06 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_13 Helpfulness scores pre-harassment  elapsed time: 0.34 secs (0.01 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 35248
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 35264
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 29318
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 15511
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 1190040
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 699410
INFO:birdwatch.scorer:MFGroupScorer_13 Filtering by helpfulness score elapsed time: 1.91 secs (0.03 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    344810
1     59587
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 292947
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 359755, Num Unique Notes Rated: 12010, Num Unique Raters: 10996
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    304155
1     55600
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.1545496240497005
INFO:birdwatch.matrix_factorization:Using pos weight: 5.470413669064748 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 10996, Notes: 12010
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 29.954621149042463
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 32.71689705347399
INFO:birdwatch.matrix_factorization:epoch 0 3.0674843788146973
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 1.1891981363296509
INFO:birdwatch.matrix_factorization:epoch 20 0.6201614141464233
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3322833478450775
INFO:birdwatch.matrix_factorization:epoch 40 0.4191039800643921
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.27092912793159485
INFO:birdwatch.matrix_factorization:epoch 60 0.3913850784301758
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2612825036048889
INFO:birdwatch.matrix_factorization:epoch 80 0.3876509666442871
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.26041755080223083
INFO:birdwatch.matrix_factorization:epoch 100 0.3871650993824005
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.26025867462158203
INFO:birdwatch.matrix_factorization:epoch 120 0.38710087537765503
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.260217547416687
INFO:birdwatch.matrix_factorization:Num epochs: 125
INFO:birdwatch.matrix_factorization:epoch 125 0.38709986209869385
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.26021629571914673
INFO:birdwatch.matrix_factorization:Global Intercept: -0.2074204981327057
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_13 Harassment tag consensus elapsed time: 10.68 secs (0.18 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_13 Helpfulness scores post-harassment elapsed time: 0.49 secs (0.01 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 35248
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 35264
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 29315
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 15508
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 1190040
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 699133
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 15508, Notes: 18268
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 38.27091088241734
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 45.08208666494713
INFO:birdwatch.matrix_factorization:epoch 0 0.4064909815788269
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.34577417373657227
INFO:birdwatch.matrix_factorization:epoch 20 0.09560593962669373
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0675978884100914
INFO:birdwatch.matrix_factorization:epoch 40 0.08812635391950607
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06310965865850449
INFO:birdwatch.matrix_factorization:epoch 60 0.08691128343343735
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06129845976829529
INFO:birdwatch.matrix_factorization:epoch 80 0.0867573618888855
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06064329296350479
INFO:birdwatch.matrix_factorization:epoch 100 0.08673075586557388
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.060766562819480896
INFO:birdwatch.matrix_factorization:Num epochs: 103
INFO:birdwatch.matrix_factorization:epoch 103 0.08672890067100525
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06074816361069679
INFO:birdwatch.matrix_factorization:Global Intercept: 0.14218184351921082
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 18.84 secs (0.31 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_13 prescoring, about to call diligence with 699133 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                      raterParticipantId  internalRaterFactor1
0      000045A5FA0CF004F68CBF2913506C37D540CF48522D33...             -0.520505
1      0002CA11E7127598E26C281F887129ADA2623C82BBCE8F...              0.504207
2      000A152E7173AF94A55928A9BC0D120701A1828BB59A29...             -0.277186
3      001226CEFA7FAA022C825459EF0731988DB66BA000D0C3...              0.569611
4      001A1BA9FBE62859A450D0A6BAE39DFB47CE649A9E154F...              0.554457
...                                                  ...                   ...
15503  FFE869D51FD64C9E02044A8625A73BFAA6BF5C28643BDC...             -0.387120
15504  FFEE86876559D283E86FFD2DCE8ED8D612D9E8D7E92E83...             -0.417966
15505  FFF0E85D4BAF243215A303AAF08A06FCF54B3E4DA68D13...              0.714090
15506  FFF566C4AC6CDF855B2083DA2C7D9CF983135BCF167735...              0.647475
15507  FFF69D67772D36A4F36656044618362E9F92C97215AE48...             -0.467167

[15508 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 15508, vs. num we are initializing: 15508
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 15508
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=22.159445 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.963159 | time=3.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=3.415017 | time=7.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=3.338709 | time=10.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=3.318870 | time=15.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=3.310475 | time=20.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=3.306034 | time=24.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=3.303383 | time=28.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=3.301693 | time=32.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=3.300581 | time=36.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=3.299853 | time=40.1s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(0.9793, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=3.299834 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=2.016729 | time=3.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.007095 | time=7.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.006227 | time=10.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=100 | loss=2.006199 | time=11.8s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.353669 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.250294 | time=2.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.249030 | time=4.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=080 | loss=0.248972 | time=5.5s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(2.3825, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 3.2999, 2.0062, 0.2490
INFO:birdwatch.scorer:MFGroupScorer_13 Low Diligence MF elapsed time: 58.58 secs (0.98 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 1211005 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 2282 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.17 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.20 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.04 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.29 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.22 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.20 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.30 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 79.47 secs (1.32 mins)
INFO:birdwatch.constants:MFGroupScorer_13: Compute tag thresholds for percentiles elapsed time: 2.86 secs (0.05 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_12 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_12.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 16394
INFO:birdwatch.scorer:MFGroupScorer_12 Filter input elapsed time: 5.54 secs (0.09 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_12: 50375f737684e02ad29f6804d5cfdce1bfa1749a2a1f1110052d5cb7e298ffca
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 704, Num Unique Notes Rated: 71, Num Unique Raters: 109
INFO:birdwatch.scorer:MFGroupScorer_12 Prepare ratings elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_12: b3d3a8a30c6d55b6ea7f2462fd524b92583017393068d9e7c2ba903fbc54271c
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_12: a98b9575925fbdbc138fad20a54069ccbb0a2d5fa3b11835db1f34e65d093d9a
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_12: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 109, Notes: 71
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 9.915492957746478
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 6.458715596330276
INFO:birdwatch.matrix_factorization:epoch 0 6.407577991485596
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 5.904400825500488
INFO:birdwatch.matrix_factorization:epoch 20 0.2248169183731079
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.15191179513931274
INFO:birdwatch.matrix_factorization:epoch 40 0.09339018166065216
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04736693203449249
INFO:birdwatch.matrix_factorization:epoch 60 0.06284230202436447
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.026149362325668335
INFO:birdwatch.matrix_factorization:epoch 80 0.057197246700525284
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.021654639393091202
INFO:birdwatch.matrix_factorization:epoch 100 0.0566646046936512
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.02079663798213005
INFO:birdwatch.matrix_factorization:epoch 120 0.05657384544610977
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.021003033965826035
INFO:birdwatch.matrix_factorization:Num epochs: 126
INFO:birdwatch.matrix_factorization:epoch 126 0.05656944587826729
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.020975295454263687
INFO:birdwatch.matrix_factorization:Global Intercept: 0.15406212210655212
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_12 First MF/stable init elapsed time: 0.52 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_12

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 3334 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 26 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.17 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.17 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.17 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.10 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.07 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.18 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 80.01 secs (1.33 mins)
INFO:birdwatch.scorer:MFGroupScorer_12 Compute scored notes elapsed time: 102.86 secs (1.71 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 16391 post-tombstones and 3 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 13328, including 13328 post-tombstones and 0 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 16
INFO:birdwatch.scorer:MFGroupScorer_12 Compute valid ratings elapsed time: 1.29 secs (0.02 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_12 Helpfulness scores pre-harassment  elapsed time: 0.11 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 109
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 56
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 15
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 7
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 704
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 55
INFO:birdwatch.scorer:MFGroupScorer_12 Filtering by helpfulness score elapsed time: 0.02 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    33
1     2
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 20
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 0, Num Unique Notes Rated: 0, Num Unique Raters: 0
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown Series([], dtype: int64)
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:No valid data for notHelpfulSpamHarassmentOrAbuse, returning None and aborting notHelpfulSpamHarassmentOrAbuse model training.
INFO:birdwatch.scorer:MFGroupScorer_12 Harassment tag consensus elapsed time: 0.02 secs (0.00 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_12 Helpfulness scores post-harassment elapsed time: 0.12 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 109
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 56
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 15
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 7
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 704
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 55
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 7, Notes: 38
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 1.4473684210526316
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 7.857142857142857
INFO:birdwatch.matrix_factorization:epoch 0 0.41017648577690125
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3369871973991394
INFO:birdwatch.matrix_factorization:epoch 20 0.04548179358243942
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.012210129760205746
INFO:birdwatch.matrix_factorization:epoch 40 0.03671212121844292
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.005080005619674921
INFO:birdwatch.matrix_factorization:epoch 60 0.034532248973846436
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0018604397773742676
INFO:birdwatch.matrix_factorization:epoch 80 0.034307874739170074
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0017485455609858036
INFO:birdwatch.matrix_factorization:epoch 100 0.03428036347031593
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.001772609306499362
INFO:birdwatch.matrix_factorization:Num epochs: 101
INFO:birdwatch.matrix_factorization:epoch 101 0.03428036347031593
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.001772609306499362
INFO:birdwatch.matrix_factorization:Global Intercept: 0.128597229719162
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 0.34 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_12 prescoring, about to call diligence with 55 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                  raterParticipantId  internalRaterFactor1
0  1E88DDB7C7065B2F4FCA4D453A3B3E28E1792E6DA91504...              0.540532
1  386451F0F4893DEDF6DFD6A72B26EF67F1478C0FA00E09...             -0.670397
2  6B532B7B3E20DDA50B054D0AA0880CA5CA2F64D8457475...              0.508345
3  800A625468F03893CA64F6967F8E9751D9D7E2567E913C...              0.666215
4  87B5855E0CE84DCAA594734F032600DB1068C63D3427F5...             -0.590245
5  A8AE29FDE715D7346DEC1D86ACE01EDE999AA2998D3491...             -0.002397
6  BFDD604937541F1AC934DEFC095562E8975AA8E71D5B1C...             -0.767994
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 7, vs. num we are initializing: 7
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 7
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=12.414192 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=2.280038 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.078766 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.029553 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.014109 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.002791 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=1.993389 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=1.985488 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=1.978830 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=1.973188 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=1.968349 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(-0.2303, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=1.968199 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.415308 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.330738 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=0.327133 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=115 | loss=0.326963 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.292062 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.227709 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.227055 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=075 | loss=0.226984 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(-3.6086, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 1.9683, 0.3270, 0.2270
INFO:birdwatch.scorer:MFGroupScorer_12 Low Diligence MF elapsed time: 0.85 secs (0.01 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 3334 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 26 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.22 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.19 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.14 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.12 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.13 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.26 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 83.30 secs (1.39 mins)
INFO:birdwatch.constants:MFGroupScorer_12: Compute tag thresholds for percentiles elapsed time: 0.18 secs (0.00 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_11 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_11.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 46957
INFO:birdwatch.scorer:MFGroupScorer_11 Filter input elapsed time: 6.37 secs (0.11 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_11: 206e35389df7cbca14c387fe614ca0d97d617a18b65d6a1537daaeca6a6981ac
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 13185, Num Unique Notes Rated: 1377, Num Unique Raters: 724
INFO:birdwatch.scorer:MFGroupScorer_11 Prepare ratings elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_11: 2d0eefdc38b0649622ea950efcd43099e12457993d8b01240dad0a29263258c0
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_11: a98b9575925fbdbc138fad20a54069ccbb0a2d5fa3b11835db1f34e65d093d9a
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_11: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 724, Notes: 1377
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 9.57516339869281
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 18.21132596685083
INFO:birdwatch.matrix_factorization:epoch 0 7.583672046661377
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 7.076788902282715
INFO:birdwatch.matrix_factorization:epoch 20 0.24080310761928558
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.19277752935886383
INFO:birdwatch.matrix_factorization:epoch 40 0.10594980418682098
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06598325073719025
INFO:birdwatch.matrix_factorization:epoch 60 0.08601808547973633
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.050869397819042206
INFO:birdwatch.matrix_factorization:epoch 80 0.08331628143787384
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04913274943828583
INFO:birdwatch.matrix_factorization:epoch 100 0.08295029401779175
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04880121722817421
INFO:birdwatch.matrix_factorization:epoch 120 0.08290509134531021
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04870719462633133
INFO:birdwatch.matrix_factorization:Num epochs: 140
INFO:birdwatch.matrix_factorization:epoch 140 0.08289919793605804
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.048692744225263596
INFO:birdwatch.matrix_factorization:Global Intercept: 0.15600520372390747
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_11 First MF/stable init elapsed time: 1.23 secs (0.02 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_11

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 25533 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 44 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.12 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.10 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.29 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.04 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.52 secs (0.03 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.11 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.23 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.69 secs (0.03 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 90.17 secs (1.50 mins)
INFO:birdwatch.scorer:MFGroupScorer_11 Compute scored notes elapsed time: 117.98 secs (1.97 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 46915 post-tombstones and 42 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 37824, including 37824 post-tombstones and 0 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 1433
INFO:birdwatch.scorer:MFGroupScorer_11 Compute valid ratings elapsed time: 1.64 secs (0.03 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_11 Helpfulness scores pre-harassment  elapsed time: 0.14 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 724
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 1658
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 909
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 378
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 13185
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 8529
INFO:birdwatch.scorer:MFGroupScorer_11 Filtering by helpfulness score elapsed time: 0.03 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    4683
1     507
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 3339
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 941, Num Unique Notes Rated: 138, Num Unique Raters: 94
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    885
1     56
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.05951115834218916
INFO:birdwatch.matrix_factorization:Using pos weight: 15.803571428571429 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 94, Notes: 138
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 6.818840579710145
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 10.01063829787234
INFO:birdwatch.matrix_factorization:epoch 0 3.058159351348877
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 1.191838264465332
INFO:birdwatch.matrix_factorization:epoch 20 0.6921662092208862
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.29705333709716797
INFO:birdwatch.matrix_factorization:epoch 40 0.4585998058319092
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2512953281402588
INFO:birdwatch.matrix_factorization:epoch 60 0.40845561027526855
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2175627201795578
INFO:birdwatch.matrix_factorization:epoch 80 0.39352428913116455
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2111976593732834
INFO:birdwatch.matrix_factorization:epoch 100 0.38155466318130493
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.20267292857170105
INFO:birdwatch.matrix_factorization:Num epochs: 103
INFO:birdwatch.matrix_factorization:epoch 103 0.38147488236427307
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.20391333103179932
INFO:birdwatch.matrix_factorization:Global Intercept: -0.33493515849113464
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_11 Harassment tag consensus elapsed time: 0.45 secs (0.01 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_11 Helpfulness scores post-harassment elapsed time: 0.19 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 724
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 1658
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 909
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 378
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 13185
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 8529
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 378, Notes: 1373
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 6.211944646758922
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 22.563492063492063
INFO:birdwatch.matrix_factorization:epoch 0 0.39851415157318115
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3261566162109375
INFO:birdwatch.matrix_factorization:epoch 20 0.08152569830417633
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04458196461200714
INFO:birdwatch.matrix_factorization:epoch 40 0.07873199135065079
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04529142379760742
INFO:birdwatch.matrix_factorization:epoch 60 0.0773719847202301
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.042679548263549805
INFO:birdwatch.matrix_factorization:epoch 80 0.07732334733009338
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04271566495299339
INFO:birdwatch.matrix_factorization:epoch 100 0.07729862630367279
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04252748563885689
INFO:birdwatch.matrix_factorization:Num epochs: 103
INFO:birdwatch.matrix_factorization:epoch 103 0.07730032503604889
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04264599457383156
INFO:birdwatch.matrix_factorization:Global Intercept: 0.15833252668380737
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 0.61 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_11 prescoring, about to call diligence with 8529 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                    raterParticipantId  internalRaterFactor1
0    00055253971F408A7AB80D461A543E010EC67DFAF29C45...              0.629375
1    0096E887BAB766D447D935A6FAA4B583C57CDDD7437330...              0.264069
2    02392701E4091AE843AD4485F95727D5E936281FC0F00C...             -0.265802
3    02552C5986DDF49CF618D738BD5FDDE46F07D965B780C5...             -0.510081
4    029E49778E6642A935E0CAE3E5896E4BD8B1112E89127B...             -0.433192
..                                                 ...                   ...
373  FE59A526EF3F5201453FE484E163928828B605DA4CD3BA...              0.815784
374  FE85094603CE54C94C5BFB73B4C36B92C775BE56DB7A10...              0.183995
375  FEB153643EB9E05DDEA406950F906E2CF9B0228BD82FF9...              0.526048
376  FED35B57756A294F0573827EAB412B5595E3D301D9F0A0...              0.862812
377  FFFA49720F254411E1F79CA757C403F0A0217240BC4922...             -0.197703

[378 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 378, vs. num we are initializing: 378
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 378
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=20.071039 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.322984 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.752724 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.596092 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.530370 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.494604 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.471211 | time=0.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.454988 | time=0.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.441310 | time=1.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.431281 | time=1.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.424902 | time=1.3s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(-0.6121, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.424729 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.193824 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.186928 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.186003 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=100 | loss=1.185976 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.506197 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.440122 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.439237 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=075 | loss=0.439202 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(-0.5900, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.4249, 1.1860, 0.4392
INFO:birdwatch.scorer:MFGroupScorer_11 Low Diligence MF elapsed time: 2.09 secs (0.03 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 25533 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 44 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.11 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.17 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.04 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.32 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.25 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.14 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.25 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 82.40 secs (1.37 mins)
INFO:birdwatch.constants:MFGroupScorer_11: Compute tag thresholds for percentiles elapsed time: 0.19 secs (0.00 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_10 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_10.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 26153
INFO:birdwatch.scorer:MFGroupScorer_10 Filter input elapsed time: 5.97 secs (0.10 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_10: 435ef71f01a7873a405e0dded5015b5b3d475220b0c6062663565fed8640d39b
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 3561, Num Unique Notes Rated: 406, Num Unique Raters: 291
INFO:birdwatch.scorer:MFGroupScorer_10 Prepare ratings elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_10: b8ba09c608a3d438abcc451c72c9c37966ad88d5ec07bba2355a19c069710be0
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_10: a98b9575925fbdbc138fad20a54069ccbb0a2d5fa3b11835db1f34e65d093d9a
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_10: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 291, Notes: 406
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 8.770935960591133
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 12.237113402061855
INFO:birdwatch.matrix_factorization:epoch 0 7.337538719177246
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 6.829094886779785
INFO:birdwatch.matrix_factorization:epoch 20 0.2554004490375519
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.19394129514694214
INFO:birdwatch.matrix_factorization:epoch 40 0.11202462017536163
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07509069889783859
INFO:birdwatch.matrix_factorization:epoch 60 0.07828196883201599
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.043219611048698425
INFO:birdwatch.matrix_factorization:epoch 80 0.07404235005378723
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03901292756199837
INFO:birdwatch.matrix_factorization:epoch 100 0.07347702234983444
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03878815099596977
INFO:birdwatch.matrix_factorization:epoch 120 0.07339875400066376
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03876470774412155
INFO:birdwatch.matrix_factorization:epoch 140 0.07338577508926392
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.038804955780506134
INFO:birdwatch.matrix_factorization:epoch 160 0.07337921857833862
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.038831911981105804
INFO:birdwatch.matrix_factorization:epoch 180 0.07337109744548798
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.038859687745571136
INFO:birdwatch.matrix_factorization:Num epochs: 197
INFO:birdwatch.matrix_factorization:epoch 197 0.07336001843214035
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.038846224546432495
INFO:birdwatch.matrix_factorization:Global Intercept: 0.15349477529525757
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_10 First MF/stable init elapsed time: 0.83 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_10

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 10902 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 21 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.11 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.10 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.20 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.21 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.11 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.14 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.37 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 83.19 secs (1.39 mins)
INFO:birdwatch.scorer:MFGroupScorer_10 Compute scored notes elapsed time: 106.81 secs (1.78 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 26146 post-tombstones and 7 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 21512, including 21512 post-tombstones and 0 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 562
INFO:birdwatch.scorer:MFGroupScorer_10 Compute valid ratings elapsed time: 1.67 secs (0.03 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_10 Helpfulness scores pre-harassment  elapsed time: 0.13 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 291
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 667
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 392
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 151
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 3561
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 2255
INFO:birdwatch.scorer:MFGroupScorer_10 Filtering by helpfulness score elapsed time: 0.03 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    1230
1     176
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 849
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 153, Num Unique Notes Rated: 20, Num Unique Raters: 22
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    153
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse tag positive rate is 0.0: returning None and aborting notHelpfulSpamHarassmentOrAbuse model training.
INFO:birdwatch.scorer:MFGroupScorer_10 Harassment tag consensus elapsed time: 0.06 secs (0.00 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_10 Helpfulness scores post-harassment elapsed time: 0.11 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 291
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 667
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 392
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 151
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 3561
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 2255
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 151, Notes: 406
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 5.554187192118227
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 14.933774834437086
INFO:birdwatch.matrix_factorization:epoch 0 0.3953080475330353
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3251565396785736
INFO:birdwatch.matrix_factorization:epoch 20 0.07227770984172821
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03623835742473602
INFO:birdwatch.matrix_factorization:epoch 40 0.0686911791563034
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.035062026232481
INFO:birdwatch.matrix_factorization:epoch 60 0.06721468269824982
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0323711559176445
INFO:birdwatch.matrix_factorization:epoch 80 0.06713235378265381
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.032429855316877365
INFO:birdwatch.matrix_factorization:epoch 100 0.06710804998874664
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.032206203788518906
INFO:birdwatch.matrix_factorization:Num epochs: 103
INFO:birdwatch.matrix_factorization:epoch 103 0.06710929423570633
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03231241554021835
INFO:birdwatch.matrix_factorization:Global Intercept: 0.15206433832645416
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 0.43 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_10 prescoring, about to call diligence with 2255 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                    raterParticipantId  internalRaterFactor1
0    01552D5C26FC92544FC04FC6295300EB0F18231076FCA5...             -0.673831
1    01E57AF02AE507E09A96747887664ED43F14374567C26F...             -0.358199
2    053B64CC0B096D79A09BC665C84EF0B9F14996FC81BEA9...             -0.721378
3    094A2218E592741C7A9B2F8DBA17B9A03279194479EB02...              0.864550
4    0A65EA1338C709F851D6459ABFBA1141EE2B4DB496D3D7...             -0.642638
..                                                 ...                   ...
146  FA0CDC5CD8DD6F5056FCCD4E0848810C5888D71D5B4B37...              0.674492
147  FB72F3D4CBE1FE6DB8AFA4FC948EEE28E98019FF31A9FE...             -0.044792
148  FB77683424FDABC100967536C499B6FB56BAEB24A4DAE4...             -0.325922
149  FC9E0A8DBF9173C60DC171330FFA45B2562254A3AFAED4...             -0.538561
150  FF3967F3562EA361C231F53000A40BC23DA93C318A3101...             -0.377369

[151 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 151, vs. num we are initializing: 151
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 151
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=20.745371 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.362481 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.785201 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.641792 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.578600 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.537971 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.512784 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.496683 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.485422 | time=0.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.477399 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.471576 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(0.1573, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.471426 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.351989 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.334220 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.333235 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=105 | loss=1.333199 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.641352 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.540979 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.539743 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=080 | loss=0.539689 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(0.0352, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.4716, 1.3332, 0.5397
INFO:birdwatch.scorer:MFGroupScorer_10 Low Diligence MF elapsed time: 1.17 secs (0.02 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 10902 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 21 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.11 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.33 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.20 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.04 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.13 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.24 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 85.27 secs (1.42 mins)
INFO:birdwatch.constants:MFGroupScorer_10: Compute tag thresholds for percentiles elapsed time: 0.13 secs (0.00 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_9 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_9.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 134738
INFO:birdwatch.scorer:MFGroupScorer_9 Filter input elapsed time: 5.86 secs (0.10 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_9: 7603afe18415075459d559d1c0af85aef68e3b0405b4d418bbf7203fafc2a2e8
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 49348, Num Unique Notes Rated: 2327, Num Unique Raters: 2718
INFO:birdwatch.scorer:MFGroupScorer_9 Prepare ratings elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_9: 727300b3844d0154c00003fe036798d61374ce483af40a3975bb09a848e6bcfd
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_9: a98b9575925fbdbc138fad20a54069ccbb0a2d5fa3b11835db1f34e65d093d9a
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_9: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 2718, Notes: 2327
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 21.206703910614525
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 18.15599705665931
INFO:birdwatch.matrix_factorization:epoch 0 7.257350921630859
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 6.754096031188965
INFO:birdwatch.matrix_factorization:epoch 20 0.29522913694381714
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2300456315279007
INFO:birdwatch.matrix_factorization:epoch 40 0.10254873335361481
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06549261510372162
INFO:birdwatch.matrix_factorization:epoch 60 0.08096606284379959
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04746793583035469
INFO:birdwatch.matrix_factorization:epoch 80 0.0780828595161438
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04486164450645447
INFO:birdwatch.matrix_factorization:epoch 100 0.07769706845283508
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04455127194523811
INFO:birdwatch.matrix_factorization:epoch 120 0.0776452124118805
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04454464465379715
INFO:birdwatch.matrix_factorization:Num epochs: 139
INFO:birdwatch.matrix_factorization:epoch 139 0.07763901352882385
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04454437270760536
INFO:birdwatch.matrix_factorization:Global Intercept: 0.16313883662223816
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_9 First MF/stable init elapsed time: 2.01 secs (0.03 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_9

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 61213 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 260 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.10 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.15 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.23 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.15 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.19 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.31 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 80.58 secs (1.34 mins)
INFO:birdwatch.scorer:MFGroupScorer_9 Compute scored notes elapsed time: 104.92 secs (1.75 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 134712 post-tombstones and 26 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 108607, including 108607 post-tombstones and 0 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 5348
INFO:birdwatch.scorer:MFGroupScorer_9 Compute valid ratings elapsed time: 1.52 secs (0.03 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_9 Helpfulness scores pre-harassment  elapsed time: 0.13 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 2718
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 5090
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 3891
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 1317
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 49348
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 27986
INFO:birdwatch.scorer:MFGroupScorer_9 Filtering by helpfulness score elapsed time: 0.07 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    17746
1     1849
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 8391
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 12031, Num Unique Notes Rated: 799, Num Unique Raters: 703
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    10962
1     1069
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.08885379436455823
INFO:birdwatch.matrix_factorization:Using pos weight: 10.25444340505145 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 703, Notes: 799
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 15.057571964956196
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 17.11379800853485
INFO:birdwatch.matrix_factorization:epoch 0 3.296243190765381
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 1.4351361989974976
INFO:birdwatch.matrix_factorization:epoch 20 0.656080961227417
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.22509481012821198
INFO:birdwatch.matrix_factorization:epoch 40 0.3811073899269104
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.19544081389904022
INFO:birdwatch.matrix_factorization:epoch 60 0.34867268800735474
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18120872974395752
INFO:birdwatch.matrix_factorization:epoch 80 0.34426775574684143
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18141773343086243
INFO:birdwatch.matrix_factorization:epoch 100 0.3436657190322876
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18115364015102386
INFO:birdwatch.matrix_factorization:epoch 120 0.343588262796402
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18103399872779846
INFO:birdwatch.matrix_factorization:epoch 140 0.34357863664627075
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18107114732265472
INFO:birdwatch.matrix_factorization:Num epochs: 143
INFO:birdwatch.matrix_factorization:epoch 143 0.34357842803001404
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18106400966644287
INFO:birdwatch.matrix_factorization:Global Intercept: -0.23170582950115204
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_9 Harassment tag consensus elapsed time: 1.17 secs (0.02 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_9 Helpfulness scores post-harassment elapsed time: 0.22 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 2718
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 5090
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 3891
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 1317
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 49348
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 27986
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 1317, Notes: 2324
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 12.042168674698795
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 21.249810174639332
INFO:birdwatch.matrix_factorization:epoch 0 0.4067046642303467
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3337513208389282
INFO:birdwatch.matrix_factorization:epoch 20 0.07790641486644745
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04134564846754074
INFO:birdwatch.matrix_factorization:epoch 40 0.07500667870044708
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0423242524266243
INFO:birdwatch.matrix_factorization:epoch 60 0.07422591745853424
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04082011803984642
INFO:birdwatch.matrix_factorization:epoch 80 0.07408370077610016
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.040159061551094055
INFO:birdwatch.matrix_factorization:epoch 100 0.07407921552658081
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04011719301342964
INFO:birdwatch.matrix_factorization:Num epochs: 101
INFO:birdwatch.matrix_factorization:epoch 101 0.07407921552658081
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04011719301342964
INFO:birdwatch.matrix_factorization:Global Intercept: 0.16518765687942505
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 1.10 secs (0.02 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_9 prescoring, about to call diligence with 27986 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                     raterParticipantId  internalRaterFactor1
0     0010071192160B757808FAA013F537FC46BDAB3245A1D1...             -0.172016
1     003342625F00A9CCC1E87CC2EBDB61AE4042297B2E2EAE...              0.144765
2     007724A5673C2AC83FEB05670C44E28CEDF043BFB3FB29...             -0.359283
3     008A699E5E1D0F4C106E5A2D39AA9E7D7048FA367C4222...             -0.264228
4     00B1CD9CEEE1AA0E9434B3FC1E07C7CA329FE3EBE9AB45...             -0.523702
...                                                 ...                   ...
1312  FF1FBCB5BE47B326E922C801FE922884F6F57A031CC291...              0.520358
1313  FF3E0F86DEE8F26B4206335671C8D1B19BB5DE4C094662...             -0.513714
1314  FF862F35A3E9BE11D12C20D4B75BF6290C5566CBAC90B2...             -0.008313
1315  FF970D7E05D06EACFC74A3D512FE5E5EA4C7461B3AE0E3...              0.343682
1316  FFA32B052EE21AD7FCCDA98BD213D106DAB4DA6A168DB7...             -0.619816

[1317 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 1317, vs. num we are initializing: 1317
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 1317
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=19.721113 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.406596 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.805854 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.681423 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.643161 | time=0.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.625612 | time=1.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.616234 | time=1.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.610159 | time=1.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.605835 | time=1.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.602812 | time=2.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.600758 | time=2.3s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(0.1207, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.600701 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.373126 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.364834 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.364001 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=100 | loss=1.363976 | time=0.8s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.478433 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.394557 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.393483 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=075 | loss=0.393439 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(0.9050, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.6008, 1.3640, 0.3934
INFO:birdwatch.scorer:MFGroupScorer_9 Low Diligence MF elapsed time: 3.58 secs (0.06 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 61213 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 260 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.09 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.18 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.24 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.21 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.21 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.35 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 81.12 secs (1.35 mins)
INFO:birdwatch.constants:MFGroupScorer_9: Compute tag thresholds for percentiles elapsed time: 0.27 secs (0.00 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_8 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_8.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 21657
INFO:birdwatch.scorer:MFGroupScorer_8 Filter input elapsed time: 5.51 secs (0.09 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_8: e01e335b9122917c0e18fef7a0626e8b9ec86d67a15f36dd4a9bd4c89435573c
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 2275, Num Unique Notes Rated: 306, Num Unique Raters: 218
INFO:birdwatch.scorer:MFGroupScorer_8 Prepare ratings elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_8: 8a0eb1e5569f5ffef21102dd11ef38c32081b083187fa97e3097dd907e6038ad
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_8: a98b9575925fbdbc138fad20a54069ccbb0a2d5fa3b11835db1f34e65d093d9a
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_8: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 218, Notes: 306
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 7.434640522875817
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 10.435779816513762
INFO:birdwatch.matrix_factorization:epoch 0 7.391633987426758
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 6.88375997543335
INFO:birdwatch.matrix_factorization:epoch 20 0.24475803971290588
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18468020856380463
INFO:birdwatch.matrix_factorization:epoch 40 0.10652787983417511
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06656045466661453
INFO:birdwatch.matrix_factorization:epoch 60 0.08029758930206299
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04352414235472679
INFO:birdwatch.matrix_factorization:epoch 80 0.0754726380109787
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.040087658911943436
INFO:birdwatch.matrix_factorization:epoch 100 0.0728285163640976
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.037972111254930496
INFO:birdwatch.matrix_factorization:Num epochs: 105
INFO:birdwatch.matrix_factorization:epoch 105 0.07189203053712845
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.036988623440265656
INFO:birdwatch.matrix_factorization:Global Intercept: 0.14721046388149261
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_8 First MF/stable init elapsed time: 0.51 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_8

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 9600 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 18 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.11 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.18 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.18 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.13 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.10 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.25 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 78.53 secs (1.31 mins)
INFO:birdwatch.scorer:MFGroupScorer_8 Compute scored notes elapsed time: 101.37 secs (1.69 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 21640 post-tombstones and 17 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 17549, including 17549 post-tombstones and 0 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 379
INFO:birdwatch.scorer:MFGroupScorer_8 Compute valid ratings elapsed time: 1.37 secs (0.02 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_8 Helpfulness scores pre-harassment  elapsed time: 0.11 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 218
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 497
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 269
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 102
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 2275
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 1241
INFO:birdwatch.scorer:MFGroupScorer_8 Filtering by helpfulness score elapsed time: 0.01 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    624
1    103
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 514
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 0, Num Unique Notes Rated: 0, Num Unique Raters: 0
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown Series([], dtype: int64)
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:No valid data for notHelpfulSpamHarassmentOrAbuse, returning None and aborting notHelpfulSpamHarassmentOrAbuse model training.
INFO:birdwatch.scorer:MFGroupScorer_8 Harassment tag consensus elapsed time: 0.02 secs (0.00 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_8 Helpfulness scores post-harassment elapsed time: 0.11 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 218
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 497
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 269
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 102
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 2275
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 1241
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 102, Notes: 301
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 4.122923588039867
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 12.166666666666666
INFO:birdwatch.matrix_factorization:epoch 0 0.3737185597419739
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3028968572616577
INFO:birdwatch.matrix_factorization:epoch 20 0.061153165996074677
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.025441458448767662
INFO:birdwatch.matrix_factorization:epoch 40 0.05743463709950447
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.024322986602783203
INFO:birdwatch.matrix_factorization:epoch 60 0.0556265264749527
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.02107221819460392
INFO:birdwatch.matrix_factorization:epoch 80 0.05545968562364578
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.021325653418898582
INFO:birdwatch.matrix_factorization:epoch 100 0.05541730299592018
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.021178510040044785
INFO:birdwatch.matrix_factorization:Num epochs: 101
INFO:birdwatch.matrix_factorization:epoch 101 0.05541730299592018
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.021178510040044785
INFO:birdwatch.matrix_factorization:Global Intercept: 0.14076881110668182
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 0.39 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_8 prescoring, about to call diligence with 1241 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                    raterParticipantId  internalRaterFactor1
0    008D34E0D18308D492967DAF146DEC13A3555643414B07...              0.489527
1    02DB36F53766B5A72170C2E64EA5ADF5049A1BDB38A2C9...             -0.227885
2    034D043921F0321563A40F6C033A627423DB4AEBAB8B8E...              0.509190
3    0DF4A5CA74D8CF3D1AE263EA0C8AD4319B733C31A5A97C...              0.570846
4    10FB4DB26055F348FD00DDC89812D4F257D7CC0BF0FF81...             -0.109679
..                                                 ...                   ...
97   EF24800AB22EE50CAE354BCC08B3F99891DD872DCE8BD2...             -0.209846
98   F3DE9F4343D8DD44E618EBAF1478BBAE161EB9D3B20C74...             -0.389044
99   F7C724A477F5CDDC480F4D76FBDB060676BA4096576300...             -0.355448
100  F7D3C87A4E3919A63566FB781FA8AE20872E4665C2CB95...              0.591441
101  FE48D2947F539E4B125452622985E955B43B4F23D9404E...             -0.501934

[102 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 102, vs. num we are initializing: 102
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 102
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=17.328356 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=2.924295 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.509334 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.380619 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.321780 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.284183 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.257557 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.238968 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.226375 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.216373 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.209572 | time=0.6s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(-0.7106, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.209393 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.041793 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.035889 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.035067 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=100 | loss=1.035041 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.613592 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.540497 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.539589 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=070 | loss=0.539554 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(-0.7849, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.2096, 1.0350, 0.5396
INFO:birdwatch.scorer:MFGroupScorer_8 Low Diligence MF elapsed time: 0.92 secs (0.02 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 9600 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 18 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.14 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.15 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.10 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.09 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.12 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.19 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 79.52 secs (1.33 mins)
INFO:birdwatch.constants:MFGroupScorer_8: Compute tag thresholds for percentiles elapsed time: 0.13 secs (0.00 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_7 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_7.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 49986
INFO:birdwatch.scorer:MFGroupScorer_7 Filter input elapsed time: 5.71 secs (0.10 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_7: f510407878034c700fb38d4c5f16bf0ceaecf4a78de981a4dc5c8b7a53ed1975
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 9268, Num Unique Notes Rated: 853, Num Unique Raters: 660
INFO:birdwatch.scorer:MFGroupScorer_7 Prepare ratings elapsed time: 0.04 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_7: dad49217b26c532795cafdb08ada29dec8350f4e82b6da3d292f7327920f8481
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_7: a98b9575925fbdbc138fad20a54069ccbb0a2d5fa3b11835db1f34e65d093d9a
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_7: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 660, Notes: 853
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 10.865181711606096
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 14.042424242424243
INFO:birdwatch.matrix_factorization:epoch 0 7.5927839279174805
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 7.084713459014893
INFO:birdwatch.matrix_factorization:epoch 20 0.2430640161037445
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18302100896835327
INFO:birdwatch.matrix_factorization:epoch 40 0.1090422198176384
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06991847604513168
INFO:birdwatch.matrix_factorization:epoch 60 0.0898093655705452
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.054280031472444534
INFO:birdwatch.matrix_factorization:epoch 80 0.08716879040002823
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.051713742315769196
INFO:birdwatch.matrix_factorization:epoch 100 0.08682097494602203
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.051513586193323135
INFO:birdwatch.matrix_factorization:epoch 120 0.08677361905574799
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05150945857167244
INFO:birdwatch.matrix_factorization:Num epochs: 123
INFO:birdwatch.matrix_factorization:epoch 123 0.08677224814891815
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0515802837908268
INFO:birdwatch.matrix_factorization:Global Intercept: 0.1645866483449936
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_7 First MF/stable init elapsed time: 0.88 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_7

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 17636 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 89 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.09 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.10 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.17 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.21 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.06 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.08 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.25 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 79.48 secs (1.32 mins)
INFO:birdwatch.scorer:MFGroupScorer_7 Compute scored notes elapsed time: 103.46 secs (1.72 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 49974 post-tombstones and 12 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 39302, including 39302 post-tombstones and 0 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 1620
INFO:birdwatch.scorer:MFGroupScorer_7 Compute valid ratings elapsed time: 1.52 secs (0.03 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_7 Helpfulness scores pre-harassment  elapsed time: 0.13 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 660
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 1756
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 1156
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 309
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 9268
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 5067
INFO:birdwatch.scorer:MFGroupScorer_7 Filtering by helpfulness score elapsed time: 0.02 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    2959
1     403
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 1705
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 402, Num Unique Notes Rated: 57, Num Unique Raters: 61
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    377
1     25
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.06218905472636816
INFO:birdwatch.matrix_factorization:Using pos weight: 15.08 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 61, Notes: 57
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 7.052631578947368
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 6.590163934426229
INFO:birdwatch.matrix_factorization:epoch 0 3.4938511848449707
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 1.6125730276107788
INFO:birdwatch.matrix_factorization:epoch 20 0.6353008151054382
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.21703122556209564
INFO:birdwatch.matrix_factorization:epoch 40 0.3762659728527069
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.17139233648777008
INFO:birdwatch.matrix_factorization:epoch 60 0.3383619785308838
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.171731099486351
INFO:birdwatch.matrix_factorization:epoch 80 0.3333514928817749
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.16033455729484558
INFO:birdwatch.matrix_factorization:epoch 100 0.33272475004196167
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.16112032532691956
INFO:birdwatch.matrix_factorization:Num epochs: 103
INFO:birdwatch.matrix_factorization:epoch 103 0.3327203392982483
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.16167403757572174
INFO:birdwatch.matrix_factorization:Global Intercept: -0.33285799622535706
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_7 Harassment tag consensus elapsed time: 0.61 secs (0.01 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_7 Helpfulness scores post-harassment elapsed time: 0.20 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 660
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 1756
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 1156
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 309
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 9268
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 5067
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 309, Notes: 848
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 5.975235849056604
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 16.398058252427184
INFO:birdwatch.matrix_factorization:epoch 0 0.37941843271255493
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.30656108260154724
INFO:birdwatch.matrix_factorization:epoch 20 0.08094310760498047
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.042862895876169205
INFO:birdwatch.matrix_factorization:epoch 40 0.07878807187080383
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.043866973370313644
INFO:birdwatch.matrix_factorization:epoch 60 0.0770370364189148
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04042906314134598
INFO:birdwatch.matrix_factorization:epoch 80 0.07696083188056946
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04077206924557686
INFO:birdwatch.matrix_factorization:epoch 100 0.07692396640777588
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04049023240804672
INFO:birdwatch.matrix_factorization:Num epochs: 102
INFO:birdwatch.matrix_factorization:epoch 102 0.07692493498325348
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0405658595263958
INFO:birdwatch.matrix_factorization:Global Intercept: 0.16499924659729004
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 0.48 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_7 prescoring, about to call diligence with 5067 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                    raterParticipantId  internalRaterFactor1
0    0007FA945EF35219D0388D94715189F6231A77263D83B1...              0.428860
1    000F1687C56AB92D846F2B9BFA71AE16D8A88426754E3B...              0.469994
2    008D2B105D9284320C4CC52C5247EC6C4167699D26BD53...              0.462134
3    00D9B842B8F532C5E4159DCB7443408832331D526F5B0A...              0.688854
4    00E801A1AE7306E83F42DE6B2C1D7D5E4AF667A29E3AFC...             -0.452994
..                                                 ...                   ...
304  FA42C855566088D2CF0A3FD5A1F156A681DD0E8E058A69...             -0.404858
305  FA77FDC6DBA0EDBE1244CD3E9BB0E11E10DD92FC9361CF...              0.118507
306  FB7453028620D33F1C4E68A8437CE132ED11A967C2733D...             -0.607608
307  FE4973B3DA280A019D30F8EBAFFC19D8B7C1E5B89AF997...              0.120553
308  FF77FD3571A6B1C5746E07AC7CD9D569F05CABA3183635...             -0.517580

[309 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 309, vs. num we are initializing: 309
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 309
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=22.241684 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.425397 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.855253 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.678874 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.589273 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.542411 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.513845 | time=0.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.494939 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.483057 | time=0.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.475212 | time=0.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.469727 | time=1.1s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(-0.1857, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.469572 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.271209 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.262845 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.262070 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=100 | loss=1.262047 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.572997 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.491855 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.490820 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=075 | loss=0.490777 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(-0.2088, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.4697, 1.2620, 0.4908
INFO:birdwatch.scorer:MFGroupScorer_7 Low Diligence MF elapsed time: 1.62 secs (0.03 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 17636 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 89 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.28 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.19 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.04 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.18 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.11 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.16 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.26 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 83.75 secs (1.40 mins)
INFO:birdwatch.constants:MFGroupScorer_7: Compute tag thresholds for percentiles elapsed time: 0.22 secs (0.00 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_6 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_6.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 139548
INFO:birdwatch.scorer:MFGroupScorer_6 Filter input elapsed time: 6.44 secs (0.11 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_6: 6c0ddb8b1625f20183a4b1bd869c69b9dfede08cb0c17bb75f6959cc9e2ca986
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 61687, Num Unique Notes Rated: 3844, Num Unique Raters: 2890
INFO:birdwatch.scorer:MFGroupScorer_6 Prepare ratings elapsed time: 0.12 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_6: 788238e12ef578e83a2c879dd2238e2d4d4c149cc9fac6146c453f86a2fa8129
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_6: a98b9575925fbdbc138fad20a54069ccbb0a2d5fa3b11835db1f34e65d093d9a
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_6: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 2890, Notes: 3844
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 16.04760665972945
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 21.34498269896194
INFO:birdwatch.matrix_factorization:epoch 0 7.3360981941223145
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 6.834492206573486
INFO:birdwatch.matrix_factorization:epoch 20 0.2754742503166199
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.21582581102848053
INFO:birdwatch.matrix_factorization:epoch 40 0.11447551101446152
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07892943173646927
INFO:birdwatch.matrix_factorization:epoch 60 0.0933942124247551
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05970095098018646
INFO:birdwatch.matrix_factorization:epoch 80 0.0906580239534378
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.056518636643886566
INFO:birdwatch.matrix_factorization:epoch 100 0.09030787646770477
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05651630088686943
INFO:birdwatch.matrix_factorization:epoch 120 0.09026148915290833
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05640088766813278
INFO:birdwatch.matrix_factorization:Num epochs: 126
INFO:birdwatch.matrix_factorization:epoch 126 0.09025915712118149
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.056360021233558655
INFO:birdwatch.matrix_factorization:Global Intercept: 0.1662932187318802
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_6 First MF/stable init elapsed time: 1.94 secs (0.03 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_6

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 77962 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 268 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.05 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 2.10 secs (0.03 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.42 secs (0.01 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 2.83 secs (0.05 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.17 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.68 secs (0.03 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.44 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.04 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.34 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.46 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 84.59 secs (1.41 mins)
INFO:birdwatch.scorer:MFGroupScorer_6 Compute scored notes elapsed time: 2979.41 secs (49.66 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 139464 post-tombstones and 84 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 114255, including 114250 post-tombstones and 5 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 8137
INFO:birdwatch.scorer:MFGroupScorer_6 Compute valid ratings elapsed time: 1.80 secs (0.03 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_6 Helpfulness scores pre-harassment  elapsed time: 0.16 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 2890
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 6465
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 4621
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 1761
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 61687
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 42364
INFO:birdwatch.scorer:MFGroupScorer_6 Filtering by helpfulness score elapsed time: 0.11 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    26038
1     2031
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 14295
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 16766, Num Unique Notes Rated: 1412, Num Unique Raters: 942
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    15718
1     1048
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.06250745556483359
INFO:birdwatch.matrix_factorization:Using pos weight: 14.998091603053435 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 942, Notes: 1412
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 11.873937677053824
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 17.798301486199577
INFO:birdwatch.matrix_factorization:epoch 0 3.324955463409424
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 1.4488683938980103
INFO:birdwatch.matrix_factorization:epoch 20 0.6593860387802124
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2630392909049988
INFO:birdwatch.matrix_factorization:epoch 40 0.40941542387008667
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.21177645027637482
INFO:birdwatch.matrix_factorization:epoch 60 0.375163197517395
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.20268034934997559
INFO:birdwatch.matrix_factorization:epoch 80 0.36994072794914246
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.20012983679771423
INFO:birdwatch.matrix_factorization:epoch 100 0.3692966401576996
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.19993361830711365
INFO:birdwatch.matrix_factorization:epoch 120 0.3692133128643036
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.19983787834644318
INFO:birdwatch.matrix_factorization:Num epochs: 140
INFO:birdwatch.matrix_factorization:epoch 140 0.36920300126075745
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.19984212517738342
INFO:birdwatch.matrix_factorization:Global Intercept: -0.2909986972808838
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_6 Harassment tag consensus elapsed time: 1.36 secs (0.02 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_6 Helpfulness scores post-harassment elapsed time: 0.23 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 2890
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 6465
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 4595
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 1735
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 61687
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 40489
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 1735, Notes: 3836
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 10.555005213764337
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 23.336599423631124
INFO:birdwatch.matrix_factorization:epoch 0 0.3963112235069275
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3229105472564697
INFO:birdwatch.matrix_factorization:epoch 20 0.08857707679271698
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.051730677485466
INFO:birdwatch.matrix_factorization:epoch 40 0.0862293615937233
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05298599228262901
INFO:birdwatch.matrix_factorization:epoch 60 0.0852128267288208
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0510372631251812
INFO:birdwatch.matrix_factorization:epoch 80 0.08512318134307861
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.050663698464632034
INFO:birdwatch.matrix_factorization:epoch 100 0.0851195678114891
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05055708438158035
INFO:birdwatch.matrix_factorization:Num epochs: 101
INFO:birdwatch.matrix_factorization:epoch 101 0.0851195678114891
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05055708438158035
INFO:birdwatch.matrix_factorization:Global Intercept: 0.16938357055187225
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 1.30 secs (0.02 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_6 prescoring, about to call diligence with 40489 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                     raterParticipantId  internalRaterFactor1
0     00537B460182CCA4864ED4D53F50B3C90AAC12C10D2393...              0.608517
1     007A172A5561E8B7763F51D195A87DF3FE042D50A20328...              0.463779
2     00819BDCAA385D10049D512029D3F839808A094BFB9F6F...              0.712055
3     009C38FB2D3F4140022CC566C236B8E161E362406F7D10...              0.101132
4     009F30BCF8C336CA8D2770C5264293797F55F2C83A5FA3...             -0.494038
...                                                 ...                   ...
1730  FF8482988E355445D426EB9CA10449FFA8BF5D7B898DFB...              0.676425
1731  FF8B8E0DB0E0B736C013D10B7E0BE5503AA4EC11AC0C50...              0.622850
1732  FFAA882D56280425C2A13877395F17D5BF7A25C6FD1BC7...              0.676361
1733  FFB5F72892AFEECA1370E0D784FAB97CB07AC2D3DAAC31...              0.699783
1734  FFFC8248F057883916F06F78A0DB7878BFB2C6162434E2...              0.584032

[1735 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 1735, vs. num we are initializing: 1735
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 1735
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=17.169920 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.371245 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.839188 | time=0.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.714552 | time=0.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.669723 | time=1.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.648504 | time=1.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.635485 | time=1.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.626966 | time=2.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.621075 | time=2.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.617049 | time=2.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.614241 | time=2.7s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(-0.3708, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.614167 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.432215 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.422891 | time=0.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.422052 | time=0.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=100 | loss=1.422027 | time=1.0s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.536042 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.447215 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.446045 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=075 | loss=0.445999 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(0.3910, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.6142, 1.4220, 0.4460
INFO:birdwatch.scorer:MFGroupScorer_6 Low Diligence MF elapsed time: 4.22 secs (0.07 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 77962 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 268 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.11 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.20 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.22 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.17 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.16 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.29 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 81.03 secs (1.35 mins)
INFO:birdwatch.constants:MFGroupScorer_6: Compute tag thresholds for percentiles elapsed time: 0.32 secs (0.01 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_5 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_5.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 14172
INFO:birdwatch.scorer:MFGroupScorer_5 Filter input elapsed time: 5.92 secs (0.10 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_5: 74f5d3a0e6f003a2616624c2ef5687de81069bafc3ce003fd4d4ab655f979ed3
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 726, Num Unique Notes Rated: 83, Num Unique Raters: 92
INFO:birdwatch.scorer:MFGroupScorer_5 Prepare ratings elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_5: 070078da5b37a726746ee8b9c61377095b539512528102c284a231563271b400
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_5: a98b9575925fbdbc138fad20a54069ccbb0a2d5fa3b11835db1f34e65d093d9a
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_5: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 92, Notes: 83
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 8.74698795180723
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 7.891304347826087
INFO:birdwatch.matrix_factorization:epoch 0 7.6172614097595215
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 7.107903480529785
INFO:birdwatch.matrix_factorization:epoch 20 0.22280433773994446
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.1537475287914276
INFO:birdwatch.matrix_factorization:epoch 40 0.08354062587022781
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03719964623451233
INFO:birdwatch.matrix_factorization:epoch 60 0.05943828076124191
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.020360363647341728
INFO:birdwatch.matrix_factorization:epoch 80 0.05659443140029907
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.01813891902565956
INFO:birdwatch.matrix_factorization:epoch 100 0.05619843304157257
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.01780814491212368
INFO:birdwatch.matrix_factorization:Num epochs: 104
INFO:birdwatch.matrix_factorization:epoch 104 0.05618555098772049
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.017721399664878845
INFO:birdwatch.matrix_factorization:Global Intercept: 0.16581584513187408
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_5 First MF/stable init elapsed time: 0.43 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_5

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 3432 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 15 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.11 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.15 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.13 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.12 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.07 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.19 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 79.87 secs (1.33 mins)
INFO:birdwatch.scorer:MFGroupScorer_5 Compute scored notes elapsed time: 102.70 secs (1.71 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 14169 post-tombstones and 3 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 11419, including 11419 post-tombstones and 0 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 141
INFO:birdwatch.scorer:MFGroupScorer_5 Compute valid ratings elapsed time: 1.34 secs (0.02 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_5 Helpfulness scores pre-harassment  elapsed time: 0.11 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 92
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 175
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 124
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 23
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 726
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 208
INFO:birdwatch.scorer:MFGroupScorer_5 Filtering by helpfulness score elapsed time: 0.02 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    140
1     13
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 55
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 0, Num Unique Notes Rated: 0, Num Unique Raters: 0
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown Series([], dtype: int64)
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:No valid data for notHelpfulSpamHarassmentOrAbuse, returning None and aborting notHelpfulSpamHarassmentOrAbuse model training.
INFO:birdwatch.scorer:MFGroupScorer_5 Harassment tag consensus elapsed time: 0.02 secs (0.00 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_5 Helpfulness scores post-harassment elapsed time: 0.11 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 92
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 175
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 124
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 23
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 726
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 208
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 23, Notes: 72
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 2.888888888888889
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 9.043478260869565
INFO:birdwatch.matrix_factorization:epoch 0 0.39588242769241333
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.31362786889076233
INFO:birdwatch.matrix_factorization:epoch 20 0.051555804908275604
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0118789067491889
INFO:birdwatch.matrix_factorization:epoch 40 0.04683039337396622
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.011557378806173801
INFO:birdwatch.matrix_factorization:epoch 60 0.04501268267631531
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.00762864900752902
INFO:birdwatch.matrix_factorization:epoch 80 0.044913824647665024
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.008054744452238083
INFO:birdwatch.matrix_factorization:epoch 100 0.04487277567386627
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.007875669747591019
INFO:birdwatch.matrix_factorization:Num epochs: 102
INFO:birdwatch.matrix_factorization:epoch 102 0.04487479478120804
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.00792951975017786
INFO:birdwatch.matrix_factorization:Global Intercept: 0.16386453807353973
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 0.39 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_5 prescoring, about to call diligence with 208 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                   raterParticipantId  internalRaterFactor1
0   06714FBDCE5A7A6E45B5F0815901C281FEB961390712A2...             -0.543999
1   0EF7481E7E847819CBDE13CC2C3933C118215DC5819A97...             -0.509289
2   1729D50F11A2405B98258D5389E18F5FBD9B2979176588...             -0.643976
3   19C25936718B5013BB2228AD4F1EBDB1726A731C986162...              0.532475
4   2769B56422E5E4AE5C6F0E8014FF9D544F92B4C2FBD037...             -0.627973
5   2FED843BA72F095F4DA1FAEDE071B3CF6271F47EC29027...             -0.455502
6   45A5BAC69E307E940554DBD6BABD16899132DDC2583FFB...              0.673671
7   47FCCEA02838D26E00DB65A821CE70778CEE9CB161A216...              0.357544
8   49787BB4031B62F92FCF98FF57091428B7E7D299BAD934...              0.685785
9   4AEEFB2D8959A36D46A96F9DF98532388344AA2CF91C9F...             -0.693505
10  4ED158FE69FADBE2A473E1512B3FFBCA8728AF23D4CA06...             -0.550210
11  5020509DFCFB744DB84715469B4ABF87DA9E2ED072B813...              0.531095
12  5F6311257FE14462CCB51A18801817AC5D38CC69DEDCEC...             -0.583072
13  6444EE19DE9290141D7B08D6EA3F2AAEF3FF64215D8CB6...             -0.699161
14  7B01CC0F9341F73DA9AEFED9639A869A050AA6967D41AA...             -0.616822
15  9585BE0BD81A263EA7243D1F9C8248391DBE34013D8E3A...             -0.294067
16  96ABC65F2ABC51F218CC4450FBC4F49D1C19E4C251F8AB...              0.278340
17  9B97B1FBACB2209C6D0BCA75B1CA282A3B3DA7C07CBD85...             -0.699157
18  9DC67B26EA92E056FA5411048F563168FEC64EC67EB9DA...              0.588367
19  A836C6F56F7D37BEA213868DFD41FCFCE7C2E2184593EE...              0.529947
20  B92CC2CC56D23D3FA02C0A4642F5ECC5C586C602407679...             -0.641583
21  B92D1E0BD707B660351C99D48A4F187349C939CCFDF481...             -0.599597
22  D02578E31DDC80C9FEA63EDEC5842FEC6A5FCBAEEAF58F...              0.424151
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 23, vs. num we are initializing: 23
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 23
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=15.904942 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=2.565471 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.146115 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.035359 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=1.984949 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=1.954786 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=1.934105 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=1.919035 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=1.907703 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=1.899126 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=1.892672 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(-1.2317, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=1.892488 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.446362 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.440432 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=0.439030 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=100 | loss=0.438992 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.320059 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.285857 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.285218 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=070 | loss=0.285196 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(-3.2428, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 1.8927, 0.4390, 0.2852
INFO:birdwatch.scorer:MFGroupScorer_5 Low Diligence MF elapsed time: 0.77 secs (0.01 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 3432 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 15 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.16 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.18 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.04 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.13 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.08 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.13 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.14 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 78.42 secs (1.31 mins)
INFO:birdwatch.constants:MFGroupScorer_5: Compute tag thresholds for percentiles elapsed time: 0.12 secs (0.00 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_4 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_4.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 33598
INFO:birdwatch.scorer:MFGroupScorer_4 Filter input elapsed time: 4.98 secs (0.08 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_4: 000de088e6e757994a81ab0d8f8a8eefd4759f2b9ae311fdd34a12c69e01680f
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 4120, Num Unique Notes Rated: 371, Num Unique Raters: 361
INFO:birdwatch.scorer:MFGroupScorer_4 Prepare ratings elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_4: f6025cecbf88cbf0aa9531507e8f786616f9c50596430ef3202d43bd209d2b2d
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_4: a98b9575925fbdbc138fad20a54069ccbb0a2d5fa3b11835db1f34e65d093d9a
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_4: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 361, Notes: 371
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 11.10512129380054
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 11.412742382271468
INFO:birdwatch.matrix_factorization:epoch 0 7.5696234703063965
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 7.061809062957764
INFO:birdwatch.matrix_factorization:epoch 20 0.2530864477157593
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.19668443500995636
INFO:birdwatch.matrix_factorization:epoch 40 0.09542848914861679
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0578298456966877
INFO:birdwatch.matrix_factorization:epoch 60 0.07658909261226654
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.041724223643541336
INFO:birdwatch.matrix_factorization:epoch 80 0.07394526153802872
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04016101360321045
INFO:birdwatch.matrix_factorization:epoch 100 0.07359194755554199
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03975611925125122
INFO:birdwatch.matrix_factorization:epoch 120 0.07354623079299927
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03974252939224243
INFO:birdwatch.matrix_factorization:Num epochs: 121
INFO:birdwatch.matrix_factorization:epoch 121 0.07354623079299927
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03974252939224243
INFO:birdwatch.matrix_factorization:Global Intercept: 0.1452866941690445
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_4 First MF/stable init elapsed time: 0.63 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_4

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 8904 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 57 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.10 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.19 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.21 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.03 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.06 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.25 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 79.32 secs (1.32 mins)
INFO:birdwatch.scorer:MFGroupScorer_4 Compute scored notes elapsed time: 102.25 secs (1.70 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 33595 post-tombstones and 3 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 27619, including 27619 post-tombstones and 0 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 858
INFO:birdwatch.scorer:MFGroupScorer_4 Compute valid ratings elapsed time: 1.31 secs (0.02 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_4 Helpfulness scores pre-harassment  elapsed time: 0.11 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 361
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 967
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 701
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 157
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 4120
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 1960
INFO:birdwatch.scorer:MFGroupScorer_4 Filtering by helpfulness score elapsed time: 0.01 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    1045
1     179
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 736
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 5, Num Unique Notes Rated: 1, Num Unique Raters: 5
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    5
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse tag positive rate is 0.0: returning None and aborting notHelpfulSpamHarassmentOrAbuse model training.
INFO:birdwatch.scorer:MFGroupScorer_4 Harassment tag consensus elapsed time: 0.02 secs (0.00 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_4 Helpfulness scores post-harassment elapsed time: 0.11 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 361
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 967
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 701
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 157
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 4120
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 1960
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 157, Notes: 366
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 5.355191256830601
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 12.48407643312102
INFO:birdwatch.matrix_factorization:epoch 0 0.39927947521209717
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.32793548703193665
INFO:birdwatch.matrix_factorization:epoch 20 0.06984633207321167
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03243127092719078
INFO:birdwatch.matrix_factorization:epoch 40 0.06714223325252533
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03249504044651985
INFO:birdwatch.matrix_factorization:epoch 60 0.0655125230550766
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.029411954805254936
INFO:birdwatch.matrix_factorization:epoch 80 0.065454863011837
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.029516929760575294
INFO:birdwatch.matrix_factorization:Num epochs: 99
INFO:birdwatch.matrix_factorization:epoch 99 0.06543296575546265
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.02933732233941555
INFO:birdwatch.matrix_factorization:Global Intercept: 0.1518016904592514
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 0.42 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_4 prescoring, about to call diligence with 1960 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                    raterParticipantId  internalRaterFactor1
0    00DF531883F82B474928CB0E73C08D543F3B4944D094B5...             -0.441503
1    016A6BD710984AFF6E78F97183758AE2CAF2CDCAE10961...             -0.614252
2    0281A3E88C3C226058BEE76E1CF5061FC8A6D553ACEA0B...             -0.562803
3    03208CE07F85EC3A764559309F250D019774E8C4B357E8...              0.657495
4    05C32141E3A2301389D4F6FB0F6F0925D28B28FA739D0A...             -0.199272
..                                                 ...                   ...
152  FC2DDDCA0E5BDF6DA28E84A101DD02FF8910B7CE1E45BC...             -0.530507
153  FC6121D9B2F94211FDD9F7A2D79A670423B53A466732A7...             -0.412314
154  FCA342919301000CE0E0B21AA9890C54C752B2B36FC28B...              0.573039
155  FCF71787C19F6C45ED673372CD3469351C26003C8F44E5...              0.718500
156  FDF97D6605DA5352D673B7CB06306039BD4549FE4E7026...              0.512481

[157 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 157, vs. num we are initializing: 157
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 157
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=22.131044 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.470765 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.796253 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.634385 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.564442 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.521433 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.493157 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.469460 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.447421 | time=0.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.430887 | time=0.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.422468 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(0.0364, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.422259 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.249671 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.240011 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.239346 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=100 | loss=1.239325 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.590837 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.487521 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.486080 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=080 | loss=0.486020 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(0.0415, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.4225, 1.2393, 0.4860
INFO:birdwatch.scorer:MFGroupScorer_4 Low Diligence MF elapsed time: 1.08 secs (0.02 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 8904 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 57 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.06 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.15 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.14 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.08 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.08 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.24 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 78.12 secs (1.30 mins)
INFO:birdwatch.constants:MFGroupScorer_4: Compute tag thresholds for percentiles elapsed time: 0.15 secs (0.00 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_3 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_3.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 113991
INFO:birdwatch.scorer:MFGroupScorer_3 Filter input elapsed time: 5.59 secs (0.09 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_3: 228686326e3dfe2c14fc570551a1344f9547e51ea0a0ce8db29ebde8dac3fe52
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 34023, Num Unique Notes Rated: 2048, Num Unique Raters: 1909
INFO:birdwatch.scorer:MFGroupScorer_3 Prepare ratings elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_3: 475a49d056bb88d5d68eb92b0ee1f86e14b1bcdb4a441907496c4650d39fce36
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_3: a98b9575925fbdbc138fad20a54069ccbb0a2d5fa3b11835db1f34e65d093d9a
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_3: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 1909, Notes: 2048
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 16.61279296875
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 17.822420115243585
INFO:birdwatch.matrix_factorization:epoch 0 7.006125450134277
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 6.501842498779297
INFO:birdwatch.matrix_factorization:epoch 20 0.23908403515815735
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.1863172948360443
INFO:birdwatch.matrix_factorization:epoch 40 0.13083869218826294
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.09412109851837158
INFO:birdwatch.matrix_factorization:epoch 60 0.10795652866363525
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07414773851633072
INFO:birdwatch.matrix_factorization:epoch 80 0.09894528239965439
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06518054753541946
INFO:birdwatch.matrix_factorization:epoch 100 0.09164640307426453
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.057174064218997955
INFO:birdwatch.matrix_factorization:epoch 120 0.09079340845346451
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05674804747104645
INFO:birdwatch.matrix_factorization:epoch 140 0.0906614437699318
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05663806200027466
INFO:birdwatch.matrix_factorization:epoch 160 0.09064525365829468
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05661296844482422
INFO:birdwatch.matrix_factorization:Num epochs: 171
INFO:birdwatch.matrix_factorization:epoch 171 0.09064367413520813
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.056617189198732376
INFO:birdwatch.matrix_factorization:Global Intercept: 0.17320342361927032
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_3 First MF/stable init elapsed time: 2.71 secs (0.05 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_3

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 45761 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 180 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.24 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.10 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.29 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.34 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.20 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.25 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.33 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 79.19 secs (1.32 mins)
INFO:birdwatch.scorer:MFGroupScorer_3 Compute scored notes elapsed time: 104.97 secs (1.75 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 113957 post-tombstones and 34 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 85301, including 85298 post-tombstones and 3 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 8274
INFO:birdwatch.scorer:MFGroupScorer_3 Compute valid ratings elapsed time: 1.48 secs (0.02 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_3 Helpfulness scores pre-harassment  elapsed time: 0.14 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 1909
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 6332
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 4930
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 1279
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 34023
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 24858
INFO:birdwatch.scorer:MFGroupScorer_3 Filtering by helpfulness score elapsed time: 0.07 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    17065
1      925
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 6868
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 10882, Num Unique Notes Rated: 729, Num Unique Raters: 666
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    10534
1      348
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.03197941554861239
INFO:birdwatch.matrix_factorization:Using pos weight: 30.270114942528735 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 666, Notes: 729
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 14.927297668038408
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 16.33933933933934
INFO:birdwatch.matrix_factorization:epoch 0 3.134751796722412
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 1.2341862916946411
INFO:birdwatch.matrix_factorization:epoch 20 0.6814315319061279
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2681715488433838
INFO:birdwatch.matrix_factorization:epoch 40 0.39071089029312134
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.20110182464122772
INFO:birdwatch.matrix_factorization:epoch 60 0.347095251083374
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18144254386425018
INFO:birdwatch.matrix_factorization:epoch 80 0.3415789306163788
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18100391328334808
INFO:birdwatch.matrix_factorization:epoch 100 0.34036576747894287
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18040332198143005
INFO:birdwatch.matrix_factorization:Num epochs: 111
INFO:birdwatch.matrix_factorization:epoch 111 0.3402339220046997
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18101957440376282
INFO:birdwatch.matrix_factorization:Global Intercept: -0.26569321751594543
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_3 Harassment tag consensus elapsed time: 0.86 secs (0.01 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_3 Helpfulness scores post-harassment elapsed time: 0.22 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 1909
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 6332
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 4930
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 1279
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 34023
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 24858
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 1279, Notes: 2046
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 12.149560117302054
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 19.43549648162627
INFO:birdwatch.matrix_factorization:epoch 0 0.3878743052482605
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3135416805744171
INFO:birdwatch.matrix_factorization:epoch 20 0.08917553722858429
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05330623313784599
INFO:birdwatch.matrix_factorization:epoch 40 0.08610077202320099
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0532606765627861
INFO:birdwatch.matrix_factorization:epoch 60 0.08496919274330139
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.050975456833839417
INFO:birdwatch.matrix_factorization:epoch 80 0.08487972617149353
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05062641575932503
INFO:birdwatch.matrix_factorization:epoch 100 0.0848727747797966
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05046258494257927
INFO:birdwatch.matrix_factorization:Num epochs: 101
INFO:birdwatch.matrix_factorization:epoch 101 0.0848727747797966
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05046258494257927
INFO:birdwatch.matrix_factorization:Global Intercept: 0.1778133511543274
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 0.96 secs (0.02 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_3 prescoring, about to call diligence with 24858 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                     raterParticipantId  internalRaterFactor1
0     0082235CA4459F0F8C5D33A76A9E9C985165454365EA2A...             -0.597534
1     008B07A5C6396F8E4812840D0379BE7E7351683F5E6320...              0.086486
2     009040F358AE8F2BA076F70305BBFFF02248F2E9086C1F...             -0.229927
3     009EF8E67A7620A96FEEA18E8CA43EDACB1FD6E8EE3850...             -0.445069
4     010E852380E40FB1BD5DB43C2D83FFE9AAE05B330FCA51...             -0.638839
...                                                 ...                   ...
1274  FF9FE70C24E5AC0646100D783F8E4033FE39E0532B86FB...              0.027106
1275  FFA1228B74DC1BC97BBB4CC7FCF812BBA979C1D0E6FB66...              0.238790
1276  FFAF7A01888D9005A21A1C22CC3BC3B487CA7B4A7829A1...             -0.396498
1277  FFBE6497F66B97BD0FFAC62B0E5ED0A3CA89E07885039C...             -0.306968
1278  FFC0FE156D4D58A807AE58E3C67B1CAFAA4D1B09794163...             -0.551250

[1279 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 1279, vs. num we are initializing: 1279
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 1279
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=16.335716 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.181560 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.702518 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.584044 | time=0.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.539376 | time=0.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.516413 | time=1.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.502568 | time=1.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.494062 | time=1.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.487733 | time=1.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.482643 | time=1.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.479301 | time=2.1s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(-0.5410, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.479212 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.261398 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.250313 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.249362 | time=0.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=100 | loss=1.249337 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.513690 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.412848 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.411541 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=075 | loss=0.411490 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(0.2970, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.4793, 1.2493, 0.4115
INFO:birdwatch.scorer:MFGroupScorer_3 Low Diligence MF elapsed time: 3.23 secs (0.05 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 45761 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 180 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.28 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.10 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.37 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.04 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.33 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.22 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.22 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.33 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 78.24 secs (1.30 mins)
INFO:birdwatch.constants:MFGroupScorer_3: Compute tag thresholds for percentiles elapsed time: 0.24 secs (0.00 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_2 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_2.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 42885
INFO:birdwatch.scorer:MFGroupScorer_2 Filter input elapsed time: 5.43 secs (0.09 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_2: 6331503e965a834318c9020257dcd52d771dd42b79006909fe2d0bc59788e68a
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 9721, Num Unique Notes Rated: 973, Num Unique Raters: 588
INFO:birdwatch.scorer:MFGroupScorer_2 Prepare ratings elapsed time: 0.04 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_2: 9f82ef3c30f5f748b7ba7c332c68b0eabbb0df77f252720af0f86103ae9769e8
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_2: a98b9575925fbdbc138fad20a54069ccbb0a2d5fa3b11835db1f34e65d093d9a
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_2: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 588, Notes: 973
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 9.990750256937307
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 16.532312925170068
INFO:birdwatch.matrix_factorization:epoch 0 7.1635026931762695
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 6.655839443206787
INFO:birdwatch.matrix_factorization:epoch 20 0.2790426015853882
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2219211608171463
INFO:birdwatch.matrix_factorization:epoch 40 0.13682782649993896
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.09753832966089249
INFO:birdwatch.matrix_factorization:epoch 60 0.10735774040222168
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07222074270248413
INFO:birdwatch.matrix_factorization:epoch 80 0.09957701712846756
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06518155336380005
INFO:birdwatch.matrix_factorization:epoch 100 0.09688703715801239
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06287270039319992
INFO:birdwatch.matrix_factorization:epoch 120 0.09567199647426605
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.061722032725811005
INFO:birdwatch.matrix_factorization:epoch 140 0.09430132806301117
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06023962050676346
INFO:birdwatch.matrix_factorization:epoch 160 0.09131090342998505
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05641734227538109
INFO:birdwatch.matrix_factorization:epoch 180 0.09049256145954132
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05574258416891098
INFO:birdwatch.matrix_factorization:epoch 200 0.0903996154665947
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05567915737628937
INFO:birdwatch.matrix_factorization:epoch 220 0.09038939327001572
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.055677685886621475
INFO:birdwatch.matrix_factorization:Num epochs: 225
INFO:birdwatch.matrix_factorization:epoch 225 0.09038875997066498
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05568106472492218
INFO:birdwatch.matrix_factorization:Global Intercept: 0.16232086718082428
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_2 First MF/stable init elapsed time: 1.57 secs (0.03 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_2

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 19967 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 53 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.13 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.10 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.16 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.21 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.08 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.09 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.24 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 80.10 secs (1.33 mins)
INFO:birdwatch.scorer:MFGroupScorer_2 Compute scored notes elapsed time: 104.77 secs (1.75 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 42863 post-tombstones and 22 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 33357, including 33357 post-tombstones and 0 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 2173
INFO:birdwatch.scorer:MFGroupScorer_2 Compute valid ratings elapsed time: 1.57 secs (0.03 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_2 Helpfulness scores pre-harassment  elapsed time: 0.12 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 588
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 2028
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 1363
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 375
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 9721
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 6742
INFO:birdwatch.scorer:MFGroupScorer_2 Filtering by helpfulness score elapsed time: 0.02 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    4183
1     262
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 2297
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 976, Num Unique Notes Rated: 121, Num Unique Raters: 98
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    948
1     28
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.028688524590163935
INFO:birdwatch.matrix_factorization:Using pos weight: 33.857142857142854 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 98, Notes: 121
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 8.066115702479339
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 9.959183673469388
INFO:birdwatch.matrix_factorization:epoch 0 2.7515244483947754
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.855675995349884
INFO:birdwatch.matrix_factorization:epoch 20 0.6040847301483154
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.21887066960334778
INFO:birdwatch.matrix_factorization:epoch 40 0.330849826335907
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.11743317544460297
INFO:birdwatch.matrix_factorization:epoch 60 0.2875751852989197
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.11355174332857132
INFO:birdwatch.matrix_factorization:epoch 80 0.2807256579399109
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.11276853084564209
INFO:birdwatch.matrix_factorization:epoch 100 0.2751404047012329
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.1065668985247612
INFO:birdwatch.matrix_factorization:epoch 120 0.24583466351032257
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.08746801316738129
INFO:birdwatch.matrix_factorization:Num epochs: 126
INFO:birdwatch.matrix_factorization:epoch 126 0.2386283278465271
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07983162254095078
INFO:birdwatch.matrix_factorization:Global Intercept: -0.21817201375961304
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_2 Harassment tag consensus elapsed time: 0.47 secs (0.01 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_2 Helpfulness scores post-harassment elapsed time: 0.20 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 588
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 2028
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 1363
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 375
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 9721
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 6742
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 375, Notes: 970
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 6.950515463917526
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 17.978666666666665
INFO:birdwatch.matrix_factorization:epoch 0 0.4005793035030365
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3261229991912842
INFO:birdwatch.matrix_factorization:epoch 20 0.09123125672340393
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05355967953801155
INFO:birdwatch.matrix_factorization:epoch 40 0.08571465313434601
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05114439129829407
INFO:birdwatch.matrix_factorization:epoch 60 0.08422933518886566
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04805136099457741
INFO:birdwatch.matrix_factorization:epoch 80 0.08413322269916534
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04801991209387779
INFO:birdwatch.matrix_factorization:epoch 100 0.08410237729549408
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.047858987003564835
INFO:birdwatch.matrix_factorization:Num epochs: 102
INFO:birdwatch.matrix_factorization:epoch 102 0.08410288393497467
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.047923143953084946
INFO:birdwatch.matrix_factorization:Global Intercept: 0.16897648572921753
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 0.59 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_2 prescoring, about to call diligence with 6742 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                    raterParticipantId  internalRaterFactor1
0    004155EE77F1D621C93AC236A4E0DC3F3ADE8362817535...             -0.553859
1    006D40D8573E03CCCE668D8C289DEA96FB519A75356786...             -0.127166
2    00A4EDC01FFF8C52C55BA50811078061D15C23E5ECA99A...             -0.375943
3    019065DD62143A0CFEBF5C9DCFC4F67549A76C7EE02E29...             -0.346297
4    01DF80CE748D764930B05F40EA2E3CA86C220AC05F87F9...              0.169004
..                                                 ...                   ...
370  FCF5C6479C7EC58AB271F1AF8D46438C754E5E730766CE...             -0.123093
371  FD6357C7D5694C614853A40BDCAE231AD9327294BABCFC...             -0.518610
372  FD8CDB4FFEDA9C0B025FCD1E318B8CCFCA0E349E683265...             -0.436692
373  FE9616D890308B83BA931D17A92EE72CFB5F669017216D...             -0.541630
374  FEC16AB59DFD7992B5D16534CB7A1B1CC4C8C84E088ADE...              0.073438

[375 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 375, vs. num we are initializing: 375
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 375
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=16.561850 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.147888 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.734781 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.618617 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.563558 | time=0.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.526579 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.497415 | time=0.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.480940 | time=1.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.470727 | time=1.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.463667 | time=1.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.458791 | time=1.4s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(-0.3815, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.458668 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.297482 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.289427 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.288743 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=100 | loss=1.288721 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.587032 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.502554 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.501354 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=075 | loss=0.501311 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(-0.0916, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.4588, 1.2887, 0.5013
INFO:birdwatch.scorer:MFGroupScorer_2 Low Diligence MF elapsed time: 2.04 secs (0.03 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 19967 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 53 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.08 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.17 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.17 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.09 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.12 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.22 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 81.30 secs (1.36 mins)
INFO:birdwatch.constants:MFGroupScorer_2: Compute tag thresholds for percentiles elapsed time: 0.14 secs (0.00 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_1 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_1.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 171481
INFO:birdwatch.scorer:MFGroupScorer_1 Filter input elapsed time: 4.95 secs (0.08 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_1: 514cbbb55733ae23ec6fda54816d75fa9b21d10ee0a3dfbda917c30318f23614
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 56729, Num Unique Notes Rated: 2248, Num Unique Raters: 3052
INFO:birdwatch.scorer:MFGroupScorer_1 Prepare ratings elapsed time: 0.12 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_1: c3986be02fc74c0ba8c6b9ec52f34215f2b47f8a3264070d51e0924f8f3543d0
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_1: a98b9575925fbdbc138fad20a54069ccbb0a2d5fa3b11835db1f34e65d093d9a
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_1: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 3052, Notes: 2248
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 25.235320284697508
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 18.58748361730013
INFO:birdwatch.matrix_factorization:epoch 0 7.516616344451904
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 7.016791820526123
INFO:birdwatch.matrix_factorization:epoch 20 0.27306440472602844
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.22277966141700745
INFO:birdwatch.matrix_factorization:epoch 40 0.10377250611782074
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06834845244884491
INFO:birdwatch.matrix_factorization:epoch 60 0.07983194291591644
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.049947988241910934
INFO:birdwatch.matrix_factorization:epoch 80 0.07672561705112457
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.047087978571653366
INFO:birdwatch.matrix_factorization:epoch 100 0.07632111012935638
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.046765998005867004
INFO:birdwatch.matrix_factorization:epoch 120 0.0762692242860794
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04672768712043762
INFO:birdwatch.matrix_factorization:Num epochs: 140
INFO:birdwatch.matrix_factorization:epoch 140 0.07626241445541382
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.046708278357982635
INFO:birdwatch.matrix_factorization:Global Intercept: 0.1417572796344757
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_1 First MF/stable init elapsed time: 2.08 secs (0.03 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_1

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 67149 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 597 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.09 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.18 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.13 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.10 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.14 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.25 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 80.27 secs (1.34 mins)
INFO:birdwatch.scorer:MFGroupScorer_1 Compute scored notes elapsed time: 105.43 secs (1.76 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 171446 post-tombstones and 35 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 138431, including 138431 post-tombstones and 0 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 6958
INFO:birdwatch.scorer:MFGroupScorer_1 Compute valid ratings elapsed time: 1.58 secs (0.03 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_1 Helpfulness scores pre-harassment  elapsed time: 0.13 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 3052
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 6641
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 5412
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 1345
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 56729
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 29035
INFO:birdwatch.scorer:MFGroupScorer_1 Filtering by helpfulness score elapsed time: 0.09 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    16396
1     2217
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 10422
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 10932, Num Unique Notes Rated: 704, Num Unique Raters: 665
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    9665
1    1267
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.11589828027808269
INFO:birdwatch.matrix_factorization:Using pos weight: 7.628255722178374 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 665, Notes: 704
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 15.528409090909092
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 16.439097744360904
INFO:birdwatch.matrix_factorization:epoch 0 3.074197292327881
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 1.2135530710220337
INFO:birdwatch.matrix_factorization:epoch 20 0.6199406385421753
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.230500727891922
INFO:birdwatch.matrix_factorization:epoch 40 0.38506948947906494
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.19729715585708618
INFO:birdwatch.matrix_factorization:epoch 60 0.35411536693573
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18918131291866302
INFO:birdwatch.matrix_factorization:epoch 80 0.35010597109794617
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18941828608512878
INFO:birdwatch.matrix_factorization:epoch 100 0.3495701253414154
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18914468586444855
INFO:birdwatch.matrix_factorization:epoch 120 0.34949976205825806
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18905287981033325
INFO:birdwatch.matrix_factorization:epoch 140 0.34949082136154175
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.189055934548378
INFO:birdwatch.matrix_factorization:Num epochs: 144
INFO:birdwatch.matrix_factorization:epoch 144 0.34949052333831787
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18905869126319885
INFO:birdwatch.matrix_factorization:Global Intercept: -0.18928930163383484
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_1 Harassment tag consensus elapsed time: 1.06 secs (0.02 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_1 Helpfulness scores post-harassment elapsed time: 0.23 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 3052
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 6641
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 5412
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 1345
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 56729
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 29035
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 1345, Notes: 2228
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 13.031867145421902
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 21.587360594795538
INFO:birdwatch.matrix_factorization:epoch 0 0.43222251534461975
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.366517037153244
INFO:birdwatch.matrix_factorization:epoch 20 0.07936833798885345
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04677162319421768
INFO:birdwatch.matrix_factorization:epoch 40 0.0748608410358429
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.046143125742673874
INFO:birdwatch.matrix_factorization:epoch 60 0.07385727763175964
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04451223462820053
INFO:birdwatch.matrix_factorization:epoch 80 0.07368408143520355
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04378305375576019
INFO:birdwatch.matrix_factorization:epoch 100 0.07367399334907532
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04379690811038017
INFO:birdwatch.matrix_factorization:Num epochs: 101
INFO:birdwatch.matrix_factorization:epoch 101 0.07367399334907532
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04379690811038017
INFO:birdwatch.matrix_factorization:Global Intercept: 0.14139698445796967
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 1.13 secs (0.02 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_1 prescoring, about to call diligence with 29035 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                     raterParticipantId  internalRaterFactor1
0     00112506AE39C99AC786AD84B9C4CF2EC5040813AB92FF...             -0.144493
1     0023E170A507256EDF23FF2BDD8C448C483228143F0005...             -0.390126
2     0042E705C9CC807BECE823F245D34D18F0B2BD80D575A7...              0.633794
3     004ADBC69D4312D219477CF778E9D8BC19BF9280135D57...             -0.341714
4     00533D1DF2498B0ADD194F7895B09F8B36B885DF9C79BD...             -0.572275
...                                                 ...                   ...
1340  FEDD8FF0ED6BAC4996AC061841CC9B62DB246AF5C0A3BE...              0.767588
1341  FEF5C89461E9EDC9443990BF3225DBF0F5233CC2143350...             -0.490710
1342  FF501081452FE92A0E41AB20BB62156E32E07826BE7E63...             -0.362828
1343  FF606A8A07943D2836B1392C2BD9CC6331508BA0A01231...             -0.470738
1344  FF7A4377FD8A6393B76A69F95EDBD9EF7A24CCD97B8D84...             -0.438298

[1345 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 1345, vs. num we are initializing: 1345
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 1345
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=23.145287 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.611399 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.980355 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.850797 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.808570 | time=1.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.788480 | time=1.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.776315 | time=1.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.768639 | time=1.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.763635 | time=1.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.759613 | time=2.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.756350 | time=2.3s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(0.4653, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.756258 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.510257 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.499084 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.498290 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=100 | loss=1.498267 | time=0.8s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.475079 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.367722 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.366221 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=075 | loss=0.366161 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(1.2779, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.7563, 1.4983, 0.3662
INFO:birdwatch.scorer:MFGroupScorer_1 Low Diligence MF elapsed time: 3.64 secs (0.06 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 67149 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 597 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.12 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.13 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.16 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.11 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.12 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.24 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 80.51 secs (1.34 mins)
INFO:birdwatch.constants:MFGroupScorer_1: Compute tag thresholds for percentiles elapsed time: 0.34 secs (0.01 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_14 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_14.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 314456
INFO:birdwatch.scorer:MFGroupScorer_14 Filter input elapsed time: 5.72 secs (0.10 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_14: 3c51175ec22dbcdcc830bf1a5f5de3159bec4b480330a98c16e9be42e553975d
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 184135, Num Unique Notes Rated: 8293, Num Unique Raters: 7166
INFO:birdwatch.scorer:MFGroupScorer_14 Prepare ratings elapsed time: 0.21 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_14: 22163bc70855e634fde7a9624dec7bc542a8563bef074e1c58394ad29d7bae17
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_14: a98b9575925fbdbc138fad20a54069ccbb0a2d5fa3b11835db1f34e65d093d9a
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_14: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 7166, Notes: 8293
INFO:birdwatch.matrix_factorization:learning rate set to :0.02
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 22.20366574219221
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 25.695646106614568
INFO:birdwatch.matrix_factorization:epoch 0 0.49771878123283386
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.49696311354637146
INFO:birdwatch.matrix_factorization:epoch 20 0.1892249882221222
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.13633477687835693
INFO:birdwatch.matrix_factorization:epoch 40 0.1327665150165558
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0925850123167038
INFO:birdwatch.matrix_factorization:epoch 60 0.10520931333303452
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06932534277439117
INFO:birdwatch.matrix_factorization:epoch 80 0.09818603843450546
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06634906679391861
INFO:birdwatch.matrix_factorization:epoch 100 0.09624634683132172
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06628413498401642
INFO:birdwatch.matrix_factorization:epoch 120 0.09564118832349777
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06642690300941467
INFO:birdwatch.matrix_factorization:Num epochs: 130
INFO:birdwatch.matrix_factorization:epoch 130 0.0954962968826294
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06647937744855881
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 7166, Notes: 8293
INFO:birdwatch.matrix_factorization:learning rate set to :0.02
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:epoch 0 0.211313396692276
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.4969753921031952
INFO:birdwatch.matrix_factorization:epoch 20 0.09493603557348251
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.14738154411315918
INFO:birdwatch.matrix_factorization:epoch 40 0.07084602862596512
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.10211008042097092
INFO:birdwatch.matrix_factorization:epoch 60 0.05948130041360855
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07736251503229141
INFO:birdwatch.matrix_factorization:epoch 80 0.05604182183742523
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07594520598649979
INFO:birdwatch.matrix_factorization:epoch 100 0.054984964430332184
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07638967037200928
INFO:birdwatch.matrix_factorization:epoch 120 0.05462035536766052
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0766172930598259
INFO:birdwatch.matrix_factorization:Num epochs: 133
INFO:birdwatch.matrix_factorization:epoch 133 0.05451377108693123
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07671676576137543
INFO:birdwatch.matrix_factorization:Global Intercept: 0.1991450935602188
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_14 First MF/stable init elapsed time: 11.14 secs (0.19 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_14

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 204215 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 413 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.25 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.10 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.20 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.04 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.27 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.04 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.10 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.32 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 79.94 secs (1.33 mins)
INFO:birdwatch.scorer:MFGroupScorer_14 Compute scored notes elapsed time: 107.44 secs (1.79 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 314180 post-tombstones and 276 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 255465, including 255439 post-tombstones and 26 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 11514
INFO:birdwatch.scorer:MFGroupScorer_14 Compute valid ratings elapsed time: 1.73 secs (0.03 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_14 Helpfulness scores pre-harassment  elapsed time: 0.17 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 7166
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 10063
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 6574
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 3193
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 184135
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 100761
INFO:birdwatch.scorer:MFGroupScorer_14 Filtering by helpfulness score elapsed time: 0.26 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    58253
1     4032
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 38476
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 42777, Num Unique Notes Rated: 3159, Num Unique Raters: 1905
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    40154
1     2623
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.06131799798957384
INFO:birdwatch.matrix_factorization:Using pos weight: 15.308425467022493 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 1905, Notes: 3159
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 13.54131054131054
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 22.45511811023622
INFO:birdwatch.matrix_factorization:epoch 0 3.092211961746216
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 1.2368907928466797
INFO:birdwatch.matrix_factorization:epoch 20 0.6648001074790955
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.23689478635787964
INFO:birdwatch.matrix_factorization:epoch 40 0.38988035917282104
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2011788785457611
INFO:birdwatch.matrix_factorization:epoch 60 0.35591793060302734
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.19324764609336853
INFO:birdwatch.matrix_factorization:epoch 80 0.35119134187698364
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.19245147705078125
INFO:birdwatch.matrix_factorization:epoch 100 0.350519061088562
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.19242504239082336
INFO:birdwatch.matrix_factorization:epoch 120 0.3504164218902588
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.19240683317184448
INFO:birdwatch.matrix_factorization:epoch 140 0.3503972589969635
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.1924048662185669
INFO:birdwatch.matrix_factorization:Num epochs: 156
INFO:birdwatch.matrix_factorization:epoch 156 0.35039374232292175
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.1923958957195282
INFO:birdwatch.matrix_factorization:Global Intercept: -0.2809737026691437
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_14 Harassment tag consensus elapsed time: 2.03 secs (0.03 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)


MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 183: helpfulnessScores = helpfulnessScores.merge(
  PandasTypeError: Output mismatch on totalHelpfulHarassmentPenalty: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_14 Helpfulness scores post-harassment elapsed time: 0.27 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 7166
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 10063
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 6525
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 3144
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 184135
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 98473
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 3144, Notes: 8246
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.02
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 11.94191122968712
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 31.320928753180663
INFO:birdwatch.matrix_factorization:epoch 0 0.1369929015636444
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.11285897344350815
INFO:birdwatch.matrix_factorization:epoch 20 0.09698331356048584
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06650153547525406
INFO:birdwatch.matrix_factorization:epoch 40 0.0931861400604248
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06359786540269852
INFO:birdwatch.matrix_factorization:epoch 60 0.09262511134147644
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06319204717874527
INFO:birdwatch.matrix_factorization:epoch 80 0.09252414107322693
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06305688619613647
INFO:birdwatch.matrix_factorization:epoch 100 0.09247875213623047
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06300541758537292
INFO:birdwatch.matrix_factorization:Num epochs: 103
INFO:birdwatch.matrix_factorization:epoch 103 0.09247393161058426
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.06300080567598343
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 3144, Notes: 8246
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.02
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:epoch 0 0.13211141526699066
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.2890893518924713
INFO:birdwatch.matrix_factorization:epoch 20 0.062476854771375656
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.081296905875206
INFO:birdwatch.matrix_factorization:epoch 40 0.054757259786129
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07349293678998947
INFO:birdwatch.matrix_factorization:epoch 60 0.052898433059453964
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07427871972322464
INFO:birdwatch.matrix_factorization:epoch 80 0.05234576016664505
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07469122111797333
INFO:birdwatch.matrix_factorization:epoch 100 0.05211374908685684
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07502398639917374
INFO:birdwatch.matrix_factorization:Num epochs: 102
INFO:birdwatch.matrix_factorization:epoch 102 0.05211501568555832
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.07503798604011536
INFO:birdwatch.matrix_factorization:Global Intercept: 0.19262602925300598
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 4.74 secs (0.08 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_14 prescoring, about to call diligence with 98473 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                     raterParticipantId  internalRaterFactor1
0     000B5C69FAB0466A4CDD351B8F2A116C6FB2033EBE430A...             -0.522827
1     00108E4CC8AF3573F479BD3EC1ED4DE673BB74F78BA96F...              0.876338
2     0026842E7BA6E0D7B865A12D877689B96DE9A7DB19E19F...             -0.791999
3     003D2B3D72FF436059DC4E01162C7253A0635B275A35D9...             -0.437563
4     003F780D3B6933BBF7368DCA9D59AECBC659C0556B6AD7...              0.472232
...                                                 ...                   ...
3139  FF54873952D71F23E3167EB13300DF5C43B0ABA1821BE5...              0.596774
3140  FF78F603EF4B1B58D481C10F587E3C6BBDD4AE0D00BECB...             -0.453648
3141  FFB5647328B8D14158E857811DAF369FDCCD24772E2EBC...             -0.736220
3142  FFEC6A5CC145DFB2F63DFB1453E10ECEE8E6C032F76FC3...              0.880886
3143  FFF22CB48A5F4C1C0F944C552973CE17979A4B2F5C225C...              0.848012

[3144 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 3144, vs. num we are initializing: 3144
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 3144
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=17.709255 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.444944 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.963942 | time=1.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.867497 | time=1.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.832062 | time=1.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.813740 | time=2.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.802120 | time=2.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.793786 | time=3.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.788240 | time=3.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.784145 | time=4.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.781124 | time=4.5s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(-0.0615, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.781047 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.586348 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.576624 | time=0.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.575808 | time=1.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=100 | loss=1.575783 | time=1.4s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.496010 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.404580 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.403401 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=075 | loss=0.403353 | time=0.6s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(0.9006, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.7811, 1.5758, 0.4034
INFO:birdwatch.scorer:MFGroupScorer_14 Low Diligence MF elapsed time: 6.64 secs (0.11 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 204215 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 413 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.26 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.27 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.04 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.38 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.18 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.14 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.38 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 102.64 secs (1.71 mins)
INFO:birdwatch.constants:MFGroupScorer_14: Compute tag thresholds for percentiles elapsed time: 0.94 secs (0.02 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFGroupScorer_33 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFGroupScorer_33.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 14795
INFO:birdwatch.scorer:MFGroupScorer_33 Filter input elapsed time: 6.72 secs (0.11 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFGroupScorer_33: eb790d8d02e3e4fc7c7d9ac07482b2b150a4ea405a5f63d762709432f45d3687
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 4039, Num Unique Notes Rated: 207, Num Unique Raters: 264
INFO:birdwatch.scorer:MFGroupScorer_33 Prepare ratings elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFGroupScorer_33: a7896b21d0313197bbde21ccc7c83268221805b27ce14c6be33724bdf979100b
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFGroupScorer_33: a98b9575925fbdbc138fad20a54069ccbb0a2d5fa3b11835db1f34e65d093d9a
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFGroupScorer_33: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 264, Notes: 207
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 19.51207729468599
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 15.299242424242424
INFO:birdwatch.matrix_factorization:epoch 0 6.345095634460449
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 5.8367509841918945
INFO:birdwatch.matrix_factorization:epoch 20 0.18924546241760254
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.11617562919855118
INFO:birdwatch.matrix_factorization:epoch 40 0.08007349073886871
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03466664254665375
INFO:birdwatch.matrix_factorization:epoch 60 0.05827527493238449
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.018871663138270378
INFO:birdwatch.matrix_factorization:epoch 80 0.05080743134021759
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.016612866893410683
INFO:birdwatch.matrix_factorization:epoch 100 0.050224222242832184
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.01649661734700203
INFO:birdwatch.matrix_factorization:epoch 120 0.05014732480049133
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.016372090205550194
INFO:birdwatch.matrix_factorization:epoch 140 0.050137367099523544
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.01638200134038925
INFO:birdwatch.matrix_factorization:Num epochs: 142
INFO:birdwatch.matrix_factorization:epoch 142 0.050137318670749664
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.016375333070755005
INFO:birdwatch.matrix_factorization:Global Intercept: 0.14808472990989685
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFGroupScorer_33 First MF/stable init elapsed time: 0.73 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFGroupScorer_33

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 4226 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 63 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.20 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.10 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.22 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.10 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.10 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.15 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.20 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 84.36 secs (1.41 mins)
INFO:birdwatch.scorer:MFGroupScorer_33 Compute scored notes elapsed time: 108.29 secs (1.80 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 14795 post-tombstones and 0 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 10786, including 10786 post-tombstones and 0 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 217
INFO:birdwatch.scorer:MFGroupScorer_33 Compute valid ratings elapsed time: 1.45 secs (0.02 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFGroupScorer_33 Helpfulness scores pre-harassment  elapsed time: 0.11 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 264
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 232
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 192
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 42
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 4039
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 717
INFO:birdwatch.scorer:MFGroupScorer_33 Filtering by helpfulness score elapsed time: 0.02 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    652
1      2
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 63
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 200, Num Unique Notes Rated: 30, Num Unique Raters: 19
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    200
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse tag positive rate is 0.0: returning None and aborting notHelpfulSpamHarassmentOrAbuse model training.
INFO:birdwatch.scorer:MFGroupScorer_33 Harassment tag consensus elapsed time: 0.03 secs (0.00 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFGroupScorer_33 Helpfulness scores post-harassment elapsed time: 0.11 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 264
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 232
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 192
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 42
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 4039
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 717
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 42, Notes: 183
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 3.918032786885246
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 17.071428571428573
INFO:birdwatch.matrix_factorization:epoch 0 0.543311357498169
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.4560661017894745
INFO:birdwatch.matrix_factorization:epoch 20 0.05731336772441864
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.013954331167042255
INFO:birdwatch.matrix_factorization:epoch 40 0.05334554240107536
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.011739811860024929
INFO:birdwatch.matrix_factorization:epoch 60 0.051518358290195465
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.012715238146483898
INFO:birdwatch.matrix_factorization:epoch 80 0.050881482660770416
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.010837851092219353
INFO:birdwatch.matrix_factorization:epoch 100 0.0507858470082283
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.011374174617230892
INFO:birdwatch.matrix_factorization:Num epochs: 103
INFO:birdwatch.matrix_factorization:epoch 103 0.05078641325235367
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.011139152571558952
INFO:birdwatch.matrix_factorization:Global Intercept: 0.1986960619688034
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 0.38 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:In MFGroupScorer_33 prescoring, about to call diligence with 717 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                   raterParticipantId  internalRaterFactor1
0   07F9F0F26C9F82E8848562815D0359CA414AAFF175D552...             -0.628332
1   09607871CE251DA1617067D306D55E743B71C1108F5D7A...              0.382444
2   0C7E40EF08E14F494B478879BADCE4E8F2DA2C65ACF130...              0.366605
3   281A26459CA7831354ACC128311BE88C7210E6E5CB2C3E...             -0.429771
4   3253192B6C494A85E0558BD2134D79CB166B5FF012E0E4...             -0.593695
5   357DE6431AAB5F8DBB182DE8EF73ECCC4A8007B3185BA2...             -0.530921
6   43DA6E75C707DFFE55D782C7CDE344D39BB5F3771F3013...             -0.647117
7   50842D703CE58C5529C82175D47DF7ACF11664A43423FB...             -0.549039
8   54181B66F1C421355416829FA4EDD24D93B396E492339A...             -0.550676
9   5694E6530996AC1A6281083E691CCA3FC9C292C201AE96...             -0.617966
10  579406E812B1AB336C0C8AD8E4F357E3678C49E4B394ED...             -0.603829
11  60C79F791A410F772AE616A950D2520EB111ADAAF139E9...             -0.459820
12  67995D6FA66C918AD7E816F695E307D96A97F6EDB68B2D...             -0.647045
13  70752682E10040EBF50C6D1934A1ED93BEC848BCE3D105...             -0.173628
14  7248565463894E4A69132CC09943A8482C8AFD4E7EF611...             -0.372169
15  752BFBE2BD61F9096E18083EE2E8A193E9143945D4332C...              0.278458
16  781B2D137805731E39AF2FE707197725F6DEE820EA7477...             -0.653028
17  78FB6CF821108F1AD5B05CE035758C6ECF03450A1090F4...             -0.221988
18  79322F8FC9D78A663EAB65454794D08E17CF3988DF64B8...             -0.540764
19  7AEE95CB66D25841C2BAF5BFC4496CB5CB67EA6CC21212...              0.404789
20  80BE8059CF6D3B90B2A752959F6B6ACED18BB08C33D502...              0.504620
21  8172896AE09B906B0D11531B80ED2A28AD9C6FB6A0E100...             -0.507673
22  871031957E92A057D995286B6D7C4E8E007A25E8C018F4...             -0.587262
23  9294BB7CB3D5BA1D3F7C6F3545C56CECA7615CFC2A9D4D...             -0.547096
24  95AFF705DEF22889105778EA39A6F9B4E9313D5BD7D710...             -0.710594
25  9705A73677B41C2A1C55DA7BDECE501C0A3A93D8E1DE25...             -0.536177
26  9ECB1EE68B86AC4974DD3AD19CC433E89E8EE88FF62D74...              0.330827
27  A2205139F8E8A2C635D495128DD7ECAC70D0DBB4766AB6...             -0.704381
28  A3F0B84AA806E3DB8D54B026EB474D3652E4A1515FC420...             -0.608495
29  AB09CFCE51432283F95DE979E26880FD26FAA001B102DB...             -0.528699
30  B35B364064C1555A7F51E4BDE9FA8258BD7AD35397E561...             -0.618676
31  B3AAA87CF0434FC699F383C59BA77E5E8602BF5E85A868...              0.022871
32  B4919D3DC8FB1FCF6B9F0C113F59F844A289F3F14233C5...              0.511340
33  CA61CECE655294BFA083FEFE1AD8173ECD65F902EC5370...             -0.571954
34  D07A5792EBB9295F69EFB61129D4271FB4E43DF28959F1...             -0.554112
35  D8C6F6C4EF39E440B4D2A972CB81210841624CC4D04550...             -0.618768
36  DBF79DADD9FE2CB8FD3D5A3E7621E10D0646449CD3BC46...             -0.542541
37  DF1C55F430F0E859D5520FE413388B38CF64CBA62087FB...             -0.606288
38  E4D796BCD74B8095D02AFD6A58669D7FB1B272F9B934C3...             -0.593436
39  ECD0A2ABEF013BECBFAE24F481F37E7A2ECCB71AC7714A...             -0.597099
40  F7B2DC436D20887BAF3C969EF64AD33A79D09A4ED26124...             -0.598376
41  FD7C32A30F2DC53BD9498C93A0A2E9E50A74FDB43D186C...             -0.467031
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 42, vs. num we are initializing: 42
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 42
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=4.683811 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.910302 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.764102 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.677601 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=1.645421 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=1.636797 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=1.632744 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=1.629786 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=1.627886 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=1.626780 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=1.626160 | time=0.6s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(-4.5353, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=1.626145 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.155052 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.153305 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=0.151702 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=110 | loss=0.151634 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.119586 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.104883 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=055 | loss=0.104542 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(-4.8533, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 1.6262, 0.1516, 0.1045
INFO:birdwatch.scorer:MFGroupScorer_33 Low Diligence MF elapsed time: 0.98 secs (0.02 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 4226 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 63 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.26 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.32 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.03 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.28 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.13 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.13 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.21 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 81.14 secs (1.35 mins)
INFO:birdwatch.constants:MFGroupScorer_33: Compute tag thresholds for percentiles elapsed time: 0.16 secs (0.00 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFTopicScorer_Unassigned set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFTopicScorer_Unassigned.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 0
INFO:birdwatch.scorer:  Ratings after group filter: 0
INFO:birdwatch.scorer:MFTopicScorer_Unassigned Filter input elapsed time: 3.36 secs (0.06 mins)

INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFTopicScorer_UkraineConflict set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFTopicScorer_UkraineConflict.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 106029
INFO:birdwatch.scorer:  Ratings after group filter: 106029
INFO:birdwatch.scorer:MFTopicScorer_UkraineConflict Filter input elapsed time: 1.96 secs (0.03 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFTopicScorer_UkraineConflict: 112737fb49e6cbb86c03f3dcdcec1e79948127608951a35f6c345fdaa5addb6e
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 10480, Num Unique Notes Rated: 488, Num Unique Raters: 714
INFO:birdwatch.scorer:MFTopicScorer_UkraineConflict Prepare ratings elapsed time: 0.11 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFTopicScorer_UkraineConflict: 0622c6cc9c96def5da0d9ecff9220be80cb3407c66097f2c7818020fb4445a57
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFTopicScorer_UkraineConflict: e2315a96ac7cc47e5b5056688b6f0ad8bb146f4d61c03ee4214c82605ada9bc0
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFTopicScorer_UkraineConflict: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 714, Notes: 488
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 21.475409836065573
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 14.677871148459383
INFO:birdwatch.matrix_factorization:epoch 0 6.825825214385986
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 6.318262577056885
INFO:birdwatch.matrix_factorization:epoch 20 0.22610363364219666
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.17176437377929688
INFO:birdwatch.matrix_factorization:epoch 40 0.09262663125991821
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05202431231737137
INFO:birdwatch.matrix_factorization:epoch 60 0.06966009736061096
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.035207368433475494
INFO:birdwatch.matrix_factorization:epoch 80 0.06669332087039948
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.03308332711458206
INFO:birdwatch.matrix_factorization:epoch 100 0.06630095839500427
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0327666774392128
INFO:birdwatch.matrix_factorization:epoch 120 0.06624557077884674
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.032733235508203506
INFO:birdwatch.matrix_factorization:epoch 140 0.06623870879411697
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.032746266573667526
INFO:birdwatch.matrix_factorization:Num epochs: 141
INFO:birdwatch.matrix_factorization:epoch 141 0.06623870879411697
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.032746266573667526
INFO:birdwatch.matrix_factorization:Global Intercept: 0.15189489722251892
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFTopicScorer_UkraineConflict First MF/stable init elapsed time: 1.07 secs (0.02 mins)
INFO:birdwatch.mf_base_scorer:Skipping rep-filtering in prescoring for MFTopicScorer_UkraineConflict
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py:622: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  helpfulnessScores[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py:642: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  harassmentAbuseNoteParams[[c.harassmentNoteInterceptKey, c.harassmentNoteFactor1Key]] = np.nan
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py:642: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  harassmentAbuseNoteParams[[c.harassmentNoteInterceptKey, c.harassmentNoteFactor1Key]] = np.nan
INFO:birdwatch.mf_base_scorer:In MFTopicScorer_UkraineConflict prescoring, about to call diligence with 10480 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                    raterParticipantId  internalRaterFactor1
0    85B9E8186274A9ADCC3B045AF0F8E32370856F5FFCD762...              0.270827
1    CBB8CC89C65869515F3EA8446A44BF126AB96D30470FDD...             -0.808314
2    9C053B9C35CB5435320126E54A7C149DEC1AC8777447A3...             -0.420018
3    19C99014A287B37E0A1CDAFC8A35C1ED6BD276D5502AE2...             -0.712672
4    3765CA200B3D098D1F594F1DD96A1CB4D25146094EFEAD...             -0.498329
..                                                 ...                   ...
709  F2BCC6C60FDD8CAF901E652FE6D8157DD3BDAD65F623A3...             -0.724009
710  CA13806B4DBB8C01F033A0DC988A4450E9C685A8E3C5E9...              0.452467
711  CDAFD2677C1AF34248F196207D76B13D7D37890102474C...              0.345514
712  7561B82DAB6D3FBE2ECD8CF94056476CE9252C8890DB36...              0.518278
713  7D7BAA5B227CBB1058E05356F5A8CA9BD8F35691C4E0D1...              0.430479

[714 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 714, vs. num we are initializing: 714
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 714
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=19.458275 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.267864 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.763680 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.644717 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.597921 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.572781 | time=0.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.558652 | time=1.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.549754 | time=1.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.543472 | time=1.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.538765 | time=1.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.534919 | time=1.7s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(0.2211, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.534824 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.184467 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.177445 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.176341 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.176341 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.410181 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.319269 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.318159 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=075 | loss=0.318104 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(1.5213, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.5349, 1.1763, 0.3181
INFO:birdwatch.scorer:MFTopicScorer_UkraineConflict Low Diligence MF elapsed time: 2.50 secs (0.04 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 11316 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 5 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 0.06 secs (0.00 mins)
INFO:birdwatch.constants:MFTopicScorer_UkraineConflict: Compute tag thresholds for percentiles elapsed time: 0.22 secs (0.00 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFTopicScorer_GazaConflict set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFTopicScorer_GazaConflict.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 167755
INFO:birdwatch.scorer:  Ratings after group filter: 167755
INFO:birdwatch.scorer:MFTopicScorer_GazaConflict Filter input elapsed time: 2.13 secs (0.04 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFTopicScorer_GazaConflict: ec292a55ee27bc17b54154f98a3101d175ba504d6d07cc85360e8edc530e444c
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 30471, Num Unique Notes Rated: 848, Num Unique Raters: 1788
INFO:birdwatch.scorer:MFTopicScorer_GazaConflict Prepare ratings elapsed time: 0.15 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFTopicScorer_GazaConflict: 457f53916202b5d97d82a644db63ff100a4cec039dda0a6aa063ba85fe44e7e3
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFTopicScorer_GazaConflict: 04c40bd7301e2bbda4024ecefae3b38b2c519e68bc0b976ff60ff02e4073c50f
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFTopicScorer_GazaConflict: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 1788, Notes: 848
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 35.93278301886792
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 17.04194630872483
INFO:birdwatch.matrix_factorization:epoch 0 7.731199741363525
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 7.224636077880859
INFO:birdwatch.matrix_factorization:epoch 20 0.20314916968345642
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.13660040497779846
INFO:birdwatch.matrix_factorization:epoch 40 0.08293865621089935
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0448756217956543
INFO:birdwatch.matrix_factorization:epoch 60 0.06272557377815247
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.030293915420770645
INFO:birdwatch.matrix_factorization:epoch 80 0.05993954837322235
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.028482483699917793
INFO:birdwatch.matrix_factorization:epoch 100 0.05957027152180672
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.02814413234591484
INFO:birdwatch.matrix_factorization:epoch 120 0.05952385440468788
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.028135906904935837
INFO:birdwatch.matrix_factorization:Num epochs: 137
INFO:birdwatch.matrix_factorization:epoch 137 0.05951886251568794
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.028137318789958954
INFO:birdwatch.matrix_factorization:Global Intercept: 0.13771699368953705
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFTopicScorer_GazaConflict First MF/stable init elapsed time: 1.81 secs (0.03 mins)
INFO:birdwatch.mf_base_scorer:Skipping rep-filtering in prescoring for MFTopicScorer_GazaConflict
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py:622: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  helpfulnessScores[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py:642: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  harassmentAbuseNoteParams[[c.harassmentNoteInterceptKey, c.harassmentNoteFactor1Key]] = np.nan
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py:642: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  harassmentAbuseNoteParams[[c.harassmentNoteInterceptKey, c.harassmentNoteFactor1Key]] = np.nan
INFO:birdwatch.mf_base_scorer:In MFTopicScorer_GazaConflict prescoring, about to call diligence with 30471 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                     raterParticipantId  internalRaterFactor1
0     923890CE514A77A4C14904E320E7E11D84410D4BC0D869...              0.480814
1     AB4E403C88CD249B62AD06455A87CB0102BF4110C044E7...             -0.539922
2     4E548A7A7C565880DBFF4E51CF8E094A805DF8F4C1DA52...             -0.556478
3     354892C4E64F567A94117B5E437A8322D200CAD8BBC9E0...             -0.601951
4     B2EAB465E7379177C183482D28A88FE3A6FAE0CF2468ED...              0.620380
...                                                 ...                   ...
1783  F2BCC6C60FDD8CAF901E652FE6D8157DD3BDAD65F623A3...             -0.613955
1784  CA13806B4DBB8C01F033A0DC988A4450E9C685A8E3C5E9...              0.719041
1785  7B2C1E69883DB8FA117EE795A69779D1441B5EEDBDAA28...              0.663050
1786  D929B80B5FF339ADA3FC081819C60FFEC537198A452CBF...              0.599555
1787  661124877CA60A5DFE80D04DE9F9A9563C563C84B22D55...              0.690503

[1788 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 1788, vs. num we are initializing: 1788
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 1788
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=32.553398 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=4.160805 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=3.101182 | time=0.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.902818 | time=1.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.855462 | time=1.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.839644 | time=1.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.832881 | time=2.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.829480 | time=2.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.827576 | time=2.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.826422 | time=3.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.825680 | time=3.6s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(1.1518, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.825660 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.448005 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.441256 | time=0.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.440148 | time=0.9s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.440148 | time=0.9s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.360021 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.263942 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.262791 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=080 | loss=0.262739 | time=0.6s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(2.9526, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.8257, 1.4401, 0.2627
INFO:birdwatch.scorer:MFTopicScorer_GazaConflict Low Diligence MF elapsed time: 5.19 secs (0.09 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 31312 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 6 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 0.07 secs (0.00 mins)
INFO:birdwatch.constants:MFTopicScorer_GazaConflict: Compute tag thresholds for percentiles elapsed time: 0.30 secs (0.00 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFTopicScorer_MessiRonaldo set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFTopicScorer_MessiRonaldo.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 344
INFO:birdwatch.scorer:  Ratings after group filter: 344
INFO:birdwatch.scorer:MFTopicScorer_MessiRonaldo Filter input elapsed time: 2.05 secs (0.03 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFTopicScorer_MessiRonaldo: b795b3b79411d97fb70021165a6d389f3cc7158bb81533a1aa324dc93988369c
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 0, Num Unique Notes Rated: 0, Num Unique Raters: 0
INFO:birdwatch.scorer:MFTopicScorer_MessiRonaldo Prepare ratings elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.scorer:EmptyRatingException raised from MFTopicScorer_MessiRonaldo.

INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFTopicScorer_Scams set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFTopicScorer_Scams.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 51740
INFO:birdwatch.scorer:  Ratings after group filter: 51740
INFO:birdwatch.scorer:MFTopicScorer_Scams Filter input elapsed time: 1.97 secs (0.03 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFTopicScorer_Scams: 8c15d1a1e237a60b728d85f6bc014f2a0da269401b73ff021351a1ea5df83789
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 141, Num Unique Notes Rated: 23, Num Unique Raters: 48
INFO:birdwatch.scorer:MFTopicScorer_Scams Prepare ratings elapsed time: 0.07 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFTopicScorer_Scams: c30976cb03f266afae23d56cff707bb3165554b440a878007fa7d46c5276f51e
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFTopicScorer_Scams: a6cfb963b3968018de65825db971a81d33c58721b2b0f3dd79e3263c51ff6848
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFTopicScorer_Scams: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 48, Notes: 23
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 6.130434782608695
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 2.9375
INFO:birdwatch.matrix_factorization:epoch 0 8.116061210632324
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 7.606916427612305
INFO:birdwatch.matrix_factorization:epoch 20 0.27477365732192993
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.19885024428367615
INFO:birdwatch.matrix_factorization:epoch 40 0.10045593976974487
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.047438349574804306
INFO:birdwatch.matrix_factorization:epoch 60 0.07079078257083893
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.02574673295021057
INFO:birdwatch.matrix_factorization:epoch 80 0.06707583367824554
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.022225210443139076
INFO:birdwatch.matrix_factorization:epoch 100 0.06656523793935776
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.021991929039359093
INFO:birdwatch.matrix_factorization:Num epochs: 107
INFO:birdwatch.matrix_factorization:epoch 107 0.06652345508337021
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.021992336958646774
INFO:birdwatch.matrix_factorization:Global Intercept: 0.15052495896816254
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFTopicScorer_Scams First MF/stable init elapsed time: 0.38 secs (0.01 mins)
INFO:birdwatch.mf_base_scorer:Skipping rep-filtering in prescoring for MFTopicScorer_Scams
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py:622: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  helpfulnessScores[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py:642: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  harassmentAbuseNoteParams[[c.harassmentNoteInterceptKey, c.harassmentNoteFactor1Key]] = np.nan
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py:642: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  harassmentAbuseNoteParams[[c.harassmentNoteInterceptKey, c.harassmentNoteFactor1Key]] = np.nan
INFO:birdwatch.mf_base_scorer:In MFTopicScorer_Scams prescoring, about to call diligence with 141 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                   raterParticipantId  internalRaterFactor1
0   9C053B9C35CB5435320126E54A7C149DEC1AC8777447A3...             -0.068423
1   F07A8E902F7C4CE8A8C079B41AAD849492B0427812C665...             -1.149943
2   F6700CE6C398D88F68989BD0B4936602C790E4F7DAA7C6...              0.774808
3   643AEF2B7AA1A29A9580B72982EB15A9F4229C385280DF...             -0.478207
4   7803CEDE19DBFD32B1E7CC94E0EB4A34DEE5EC92167DE5...              0.050748
5   7A2D56502C5AA9B330C429DA861934DE400E079C81CB02...             -0.377252
6   1C244FBE6580E8E8A036FFAFEE0911B3909144E2534C8D...             -0.037866
7   E848DB71A10D211C7BC9CC031153C01CD56F146C772D00...              0.761874
8   8509AFC203677DCB57C630A013AC2B3961AE353B648115...             -0.427892
9   4850FD72F536ADCEEBFDCAB0252EAD57F0B1E07DB71EBD...              0.092086
10  B1A872E8A595B1A1219B5E56C311A9972CB4F90B3CABEB...             -0.210748
11  81568B9DB97322C4679EDC2D93D1E155AF681C485ED07A...              0.760425
12  A1746A5E2DA2C3F27F08CA303A1DC1E72F4436A75EF1A0...              0.787690
13  20AB4543BD8205C155FAA411DB3667AE50A98C0EB7EEAD...              0.315074
14  555337DB5227D5F5970566FB05DDD56850EBC681365767...             -0.908783
15  380DE09486B4792FA3A5D934B99B8445518C2B041C0C0D...             -0.443474
16  801EF47667BB4A265482C460A08B6BB8CD8D4399730F8E...             -0.885925
17  12440F70709BC2ACDAFB6BDF47C3E1EC36A05E3D2C57F3...             -0.569618
18  33577E7ED6EF21F65D527FC98A57165116BF3889CE2049...              0.586126
19  D283DC61F9E63112EA339492182CCE9EC9952F0BA71CE9...             -0.066163
20  80BD8E73C1C1D785F08347705DDC82ACC6B5C461184024...              0.025658
21  00BCB97268660AF256C5DA5F3B1841A5F79F2BCF438686...             -0.031742
22  38C1AC7E553585A426992B085C9CE0F018DD10D3BEDE1F...             -0.143586
23  FDCE1FE4470B33669F34D45F9B6CB883DE6481C8083E9B...              0.347657
24  5332702DAA8B8FB18DDF55AB80B61A5810A7C829F0AFCF...              0.766287
25  D16D3B645FC7BD9BD888BB950B98807A8CB2FCE06E0004...              0.638598
26  A45F28BCE289973C2E060D666F8632CB222A9B2CAF2C23...             -0.506990
27  7D96B24678C0C0CA0573A9736BEFD4638D385327A09F7F...             -0.135201
28  2542EBAA7A75C87A39828B0674334C1837338224D3E71D...              0.570243
29  B2A6B8B542D6A25A4414D8DDC2C335575C481101F76664...              0.100891
30  21A8DFD6CAD94DBC34F53DA0DB66D340D4F690D51DC38F...             -0.305311
31  B2B612CC640FFC40D58623F44809976A90FAD75BD7A9A8...             -0.393666
32  B7E8CCCDBB26F04774FA1531E53886976DF726A753F826...              0.621488
33  D4CC30A718414CD5EBE23BF2A8DACC8CC2FA0F8207EEA8...             -0.245094
34  C323314C3595F5E8F3DF7966B440416A9932DA6AC09665...             -0.775359
35  3A36E2B52990C8590FB5AA93716A4615C7E445C9DF67B4...              0.565554
36  637FA98E1C901393E545447387E0F44B5BB5486FA5EBB8...              0.729615
37  5D275857A775AB8F69CCF5AFE425907CA628F1A44D8C81...             -0.984675
38  CEDF14DB83FE181E9604AC80B709827E0C5D80F4D48909...             -0.421304
39  8A71763EF32805658EF0AD5C9092E9375D24614FCD442D...             -0.022482
40  A3A09A68E255217787F54F9EB8522830798D274962B38A...              0.714918
41  2C0B6C8622426BFE647D56D102B714C1D01C31B0F5A3FC...             -0.711399
42  B6B6625BC9E5E7753A723787520D6DFB26F84176B599FC...              0.844550
43  C0DA0E1225995F1773D4CDF8D1BD8BB52A242F9478D089...              0.218140
44  67476E420F2954D52B3F6CDDA4517882621C1F07F46880...              0.508888
45  54DFD39A8E8C988F943DFE08B52E25C710623DBB33A026...              0.530619
46  C9B3CC2F9B7AEBDFA50B0BDD65142010A775515C81127B...             -0.421553
47  F2BCC6C60FDD8CAF901E652FE6D8157DD3BDAD65F623A3...             -0.805893
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 48, vs. num we are initializing: 48
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 48
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=30.147041 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.517985 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.926953 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.682637 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.538376 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.479501 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.451271 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.434953 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.424247 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.416690 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.411068 | time=0.5s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(0.2599, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.410905 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.038319 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.029157 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=070 | loss=1.028490 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.588238 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.490827 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.490118 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=070 | loss=0.490099 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(-0.0678, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.4111, 1.0285, 0.4901
INFO:birdwatch.scorer:MFTopicScorer_Scams Low Diligence MF elapsed time: 0.73 secs (0.01 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 876 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 0 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.00 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 0.07 secs (0.00 mins)
INFO:birdwatch.constants:MFTopicScorer_Scams: Compute tag thresholds for percentiles elapsed time: 0.13 secs (0.00 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/scorer.py, in prescore, at line 273: pd.DataFrame(columns=self.get_internal_scored_notes_cols()),
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

INFO:birdwatch.scorer:prescore: Torch intra-op parallelism for MFMultiGroupScorer_1 set to: 4
INFO:birdwatch.scorer:Filtering ratings for MFMultiGroupScorer_1.  Original rating length: 3988042
INFO:birdwatch.scorer:  Ratings after topic filter: 3988042
INFO:birdwatch.scorer:  Ratings without assigned group: 568
INFO:birdwatch.scorer:  Ratings after group filter: 142811
INFO:birdwatch.scorer:MFMultiGroupScorer_1 Filter input elapsed time: 4.37 secs (0.07 mins)
INFO:birdwatch.mf_base_scorer:ratings summary MFMultiGroupScorer_1: 26b7cd9e1eac4f6710f46646d6c493523eedb723c18566fdd92a7c902d7b61c4
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 38360, Num Unique Notes Rated: 2978, Num Unique Raters: 2221
INFO:birdwatch.scorer:MFMultiGroupScorer_1 Prepare ratings elapsed time: 0.10 secs (0.00 mins)
INFO:birdwatch.mf_base_scorer:ratingsForTraining summary MFMultiGroupScorer_1: 83d597d1bc136a002bdfd8fb59cfdb7a35785b65b85aa8a75bca076ffdfa7e30
INFO:birdwatch.mf_base_scorer:noteStatusHistory summary MFMultiGroupScorer_1: a98b9575925fbdbc138fad20a54069ccbb0a2d5fa3b11835db1f34e65d093d9a
INFO:birdwatch.mf_base_scorer:userEnrollmentRaw summary MFMultiGroupScorer_1: 11b66278c16270cd373fc0bc02f0d09d798dd25ea46c24816b6f381f6f97f287
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 2221, Notes: 2978
INFO:birdwatch.matrix_factorization:learning rate set to :1.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 12.881128274009402
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 17.271499324628547
INFO:birdwatch.matrix_factorization:epoch 0 7.4038543701171875
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 6.900479793548584
INFO:birdwatch.matrix_factorization:epoch 20 0.2518106698989868
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.19826850295066833
INFO:birdwatch.matrix_factorization:epoch 40 0.1132735162973404
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.0765770673751831
INFO:birdwatch.matrix_factorization:epoch 60 0.09286147356033325
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05888134613633156
INFO:birdwatch.matrix_factorization:epoch 80 0.09009667485952377
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.055875733494758606
INFO:birdwatch.matrix_factorization:epoch 100 0.08972873538732529
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05568794906139374
INFO:birdwatch.matrix_factorization:epoch 120 0.08968288451433182
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05567825585603714
INFO:birdwatch.matrix_factorization:Num epochs: 121
INFO:birdwatch.matrix_factorization:epoch 121 0.08968288451433182
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.05567825585603714
INFO:birdwatch.matrix_factorization:Global Intercept: 0.16336463391780853
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFMultiGroupScorer_1 First MF/stable init elapsed time: 1.40 secs (0.02 mins)
INFO:birdwatch.mf_base_scorer:Performing rep-filtering for MFMultiGroupScorer_1

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 53269 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 312 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.10 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.18 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.04 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.20 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.17 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.16 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.08 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.33 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 84.41 secs (1.41 mins)
INFO:birdwatch.scorer:MFMultiGroupScorer_1 Compute scored notes elapsed time: 111.28 secs (1.85 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in get_ratings_before_note_status_and_public_tsv, at line 96: ].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=int64 vs right=float64 (allowed)

INFO:birdwatch.note_ratings:Total ratings: 142782 post-tombstones and 29 pre-tombstones
INFO:birdwatch.note_ratings:Total ratings created before statuses: 114745, including 114745 post-tombstones and 0 pre-tombstones.
INFO:birdwatch.note_ratings:Total valid ratings: 6705
INFO:birdwatch.scorer:MFMultiGroupScorer_1 Compute valid ratings elapsed time: 1.64 secs (0.03 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scorer:MFMultiGroupScorer_1 Helpfulness scores pre-harassment  elapsed time: 0.15 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 2221
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 6502
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 4822
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 1181
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 38360
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 23475
INFO:birdwatch.scorer:MFMultiGroupScorer_1 Filtering by helpfulness score elapsed time: 0.06 secs (0.00 mins)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyNoteParams[
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/tag_consensus.py:41: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  emptyRaterParams[
INFO:birdwatch.tag_consensus:-------------------Training for tag notHelpfulSpamHarassmentOrAbuse-------------------
INFO:birdwatch.tag_consensus:Pre-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    13536
1     2290
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 7649
INFO:birdwatch.process_data:After applying min 10 ratings per rater and min 5 raters per note: 
Num Ratings: 5481, Num Unique Notes Rated: 665, Num Unique Raters: 402
INFO:birdwatch.tag_consensus:Post-filtering tag label breakdown notHelpfulSpamHarassmentOrAbuseLabel
0    4798
1     683
dtype: int64
INFO:birdwatch.tag_consensus:Number of rows with no tag label 0
INFO:birdwatch.tag_consensus:notHelpfulSpamHarassmentOrAbuse Positive Rate: 0.12461229702609013
INFO:birdwatch.matrix_factorization:Using pos weight: 7.02489019033675 with BCEWithLogitsLoss
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 402, Notes: 665
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :2.0
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 8.242105263157894
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 13.634328358208956
INFO:birdwatch.matrix_factorization:epoch 0 3.221207618713379
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 1.3468173742294312
INFO:birdwatch.matrix_factorization:epoch 20 0.7727243900299072
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.41296082735061646
INFO:birdwatch.matrix_factorization:epoch 40 0.46919095516204834
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.26067572832107544
INFO:birdwatch.matrix_factorization:epoch 60 0.3750486671924591
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.19258850812911987
INFO:birdwatch.matrix_factorization:epoch 80 0.360358864068985
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18884791433811188
INFO:birdwatch.matrix_factorization:epoch 100 0.35859304666519165
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18883655965328217
INFO:birdwatch.matrix_factorization:epoch 120 0.3583723306655884
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.18904192745685577
INFO:birdwatch.matrix_factorization:Num epochs: 131
INFO:birdwatch.matrix_factorization:epoch 131 0.35835427045822144
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.1889362931251526
INFO:birdwatch.matrix_factorization:Global Intercept: -0.2510128915309906
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.scorer:MFMultiGroupScorer_1 Harassment tag consensus elapsed time: 0.72 secs (0.01 mins)

JOIN WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py, in compute_general_helpfulness_scores, at line 117: authorCounts.join(
  PandasTypeError: Output mismatch on index: result=object expected=<class 'numpy.int64'> (allowed)
  PandasTypeError: Output mismatch on crhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on crnhBool: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on noteCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingAgreesWithNoteStatus: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on successfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingNotHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on unsuccessfulRatingHelpfulCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on ratingCount: result=float64 expected=int64 (allowed)

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/helpfulness_scores.py:189: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  helpfulnessScores[c.totalHelpfulHarassmentRatingsPenaltyKey].fillna(0, inplace=True)
INFO:birdwatch.scorer:MFMultiGroupScorer_1 Helpfulness scores post-harassment elapsed time: 0.22 secs (0.00 mins)
INFO:birdwatch.helpfulness_scores:Unique Raters: 2221
INFO:birdwatch.helpfulness_scores:People (Authors or Raters) With Helpfulness Scores: 6502
INFO:birdwatch.helpfulness_scores:Raters Included Based on Helpfulness Scores: 4822
INFO:birdwatch.helpfulness_scores:Included Raters who have rated at least 1 note in the final dataset: 1181
INFO:birdwatch.helpfulness_scores:Number of Ratings Used For 1st Training: 38360
INFO:birdwatch.helpfulness_scores:Number of Ratings for Final Training: 23475
INFO:birdwatch.matrix_factorization:Reinitializing wandb run with enabled state: False
INFO:birdwatch.wandb_utils:Reinitializing W&B run
INFO:birdwatch.wandb_utils:W&B is disabled
DEBUG:git.util:sys.platform='darwin', git_executable='git'
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/Users/canbo/INFO494/494-algo-representations/communitynotes, stdin=None, shell=False, universal_newlines=False)
INFO:birdwatch.matrix_factorization:------------------
INFO:birdwatch.matrix_factorization:Users: 1181, Notes: 2970
INFO:birdwatch.matrix_factorization:initializing notes
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:193: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.internalNoteInterceptKey].fillna(0.0, inplace=True)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/matrix_factorization/matrix_factorization.py:199: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  noteInit[c.note_factor_key(i)].fillna(0.0, inplace=True)
INFO:birdwatch.matrix_factorization:initializing users
INFO:birdwatch.matrix_factorization:learning rate set to :0.2
INFO:birdwatch.matrix_factorization:cpu
INFO:birdwatch.matrix_factorization:Ratings per note in dataset: 7.904040404040404
INFO:birdwatch.matrix_factorization:Ratings per user in dataset: 19.87722269263336
INFO:birdwatch.matrix_factorization:epoch 0 0.3896160423755646
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.3176228702068329
INFO:birdwatch.matrix_factorization:epoch 20 0.08434994518756866
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.047544997185468674
INFO:birdwatch.matrix_factorization:epoch 40 0.08292919397354126
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.049194782972335815
INFO:birdwatch.matrix_factorization:epoch 60 0.08143080770969391
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.046346716582775116
INFO:birdwatch.matrix_factorization:epoch 80 0.08138710260391235
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04642060771584511
INFO:birdwatch.matrix_factorization:epoch 100 0.08137226104736328
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.046208083629608154
INFO:birdwatch.matrix_factorization:Num epochs: 103
INFO:birdwatch.matrix_factorization:epoch 103 0.08137151598930359
INFO:birdwatch.matrix_factorization:TRAIN FIT LOSS: 0.04634971544146538
INFO:birdwatch.matrix_factorization:Global Intercept: 0.16407327353954315
INFO:birdwatch.wandb_utils:Finishing W&B run
INFO:birdwatch.constants:Final round MF elapsed time: 1.04 secs (0.02 mins)
INFO:birdwatch.mf_base_scorer:In MFMultiGroupScorer_1 prescoring, about to call diligence with 23475 final round ratings.
INFO:birdwatch.reputation_matrix_factorization:Setup model: noteInitState: 
None,
 raterInitState: 
                                     raterParticipantId  internalRaterFactor1
0     0007FA945EF35219D0388D94715189F6231A77263D83B1...              0.075372
1     000F1687C56AB92D846F2B9BFA71AE16D8A88426754E3B...              0.535497
2     00403F6A378AB662BD6A14B1F09C2D0817A843B01E0E04...              0.346542
3     00720BF51C446ED4E89C14B3C9C054F9557789AD0CB013...              0.511982
4     008D2B105D9284320C4CC52C5247EC6C4167699D26BD53...              0.255721
...                                                 ...                   ...
1176  FE283EE92CACEDDCA0FAFBCCA57D96A3053BEFBA837849...             -0.532126
1177  FE8FCC5CB441BBAC17079F1C9D89743B56A8CB444B44D8...              0.750011
1178  FEE6C03F45C7E92C66ADCF8F16F6722483E760D293C023...              0.277851
1179  FF10E6EE6DECE1153515D6D38E8C076D20AB9393292946...             -0.282311
1180  FFA7AFC202040B072B0AE92D4DF0239977FC8E55497E95...             -0.611752

[1181 rows x 2 columns]
INFO:birdwatch.reputation_matrix_factorization:Initializing internalRaterFactor1:
INFO:birdwatch.reputation_matrix_factorization:  num in dataset: 1181, vs. num we are initializing: 1181
INFO:birdwatch.reputation_matrix_factorization:  uninitialized internalRaterFactor1s: 0
INFO:birdwatch.reputation_matrix_factorization:  initialized internalRaterFactor1s: 1181
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterIntercept
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalRaterReputation
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteFactor1
INFO:birdwatch.reputation_matrix_factorization:Not initializing internalNoteIntercept
INFO:birdwatch.reputation_matrix_factorization:Reputation Matrix Factorization: rater reputation frozen
INFO:birdwatch.reputation_matrix_factorization:Round 1:
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=22.590376 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=3.525326 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=2.924373 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=2.762020 | time=0.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=120 | loss=2.694588 | time=0.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=150 | loss=2.656657 | time=1.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=180 | loss=2.634453 | time=1.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=210 | loss=2.619977 | time=1.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=240 | loss=2.610286 | time=1.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=270 | loss=2.603491 | time=1.8s
INFO:birdwatch.reputation_matrix_factorization:epoch=300 | loss=2.598110 | time=2.0s
INFO:birdwatch.reputation_matrix_factorization:After round 1, global bias: Parameter containing:
tensor(-0.0714, requires_grad=True)
INFO:birdwatch.reputation_matrix_factorization:
Round 2: learn rater rep (and everything else), freeze note intercept
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=2.597948 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=1.423365 | time=0.2s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=1.414215 | time=0.4s
INFO:birdwatch.reputation_matrix_factorization:epoch=090 | loss=1.413424 | time=0.6s
INFO:birdwatch.reputation_matrix_factorization:epoch=100 | loss=1.413399 | time=0.7s
INFO:birdwatch.reputation_matrix_factorization:
Round 3: fit intercepts and global intercept with everything else frozen
INFO:birdwatch.reputation_matrix_factorization:epoch=000 | loss=0.574525 | time=0.0s
INFO:birdwatch.reputation_matrix_factorization:epoch=030 | loss=0.475233 | time=0.1s
INFO:birdwatch.reputation_matrix_factorization:epoch=060 | loss=0.474015 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:epoch=080 | loss=0.473960 | time=0.3s
INFO:birdwatch.reputation_matrix_factorization:After round 3, global bias: Parameter containing:
tensor(0.5119, requires_grad=True)
INFO:birdwatch.diligence_model:Low diligence training loss: 2.5981, 1.4134, 0.4740
INFO:birdwatch.scorer:MFMultiGroupScorer_1 Low Diligence MF elapsed time: 3.09 secs (0.05 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_note_stats, at line 353: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on numRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numPopulationSampledRatings: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on numRatingsLast28: result=float64 expected=int64 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 53269 ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 675: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on minSignCount: result=float64 expected=int32 (allowed)
  PandasTypeError: Output mismatch on netMinHelpful: result=float64 expected=int32 (allowed)

INFO:birdwatch.note_ratings:dropped 0 out of 312 population sampled ratings due to NaN factor.

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/note_ratings.py, in compute_scored_notes, at line 709: noteStats = noteStats.merge(
  PandasTypeError: Output mismatch on negFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)
  PandasTypeError: Output mismatch on posFactor_populationSampledRatingCount: result=float64 expected=int64 (allowed)

INFO:birdwatch.scoring_rules:Applying scoring rule: InitialNMR (v1.0)
INFO:birdwatch.constants:Calling score_notes: InitialNMR (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: InitialNMR (v1.0) elapsed time: 1.27 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRH (v1.0) elapsed time: 1.35 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: GeneralCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: GeneralCRNH (v1.0) elapsed time: 0.05 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: GeneralCRNH (v1.0) elapsed time: 1.34 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: UcbCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: UcbCRNH (v1.0) elapsed time: 0.01 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: UcbCRNH (v1.0) elapsed time: 1.47 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: RatioCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: RatioCRNH (v1.0) elapsed time: 0.02 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: RatioCRNH (v1.0) elapsed time: 1.26 secs (0.02 mins)
INFO:birdwatch.scoring_rules:Applying scoring rule: NmCRNH (v1.0)
INFO:birdwatch.constants:Calling score_notes: NmCRNH (v1.0) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.constants:Applying scoring rule: NmCRNH (v1.0) elapsed time: 1.44 secs (0.02 mins)
INFO:birdwatch.constants:Condense noteRules after applying all scoring rules elapsed time: 80.10 secs (1.34 mins)
INFO:birdwatch.constants:MFMultiGroupScorer_1: Compute tag thresholds for percentiles elapsed time: 0.29 secs (0.00 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/mf_base_scorer.py, in _prescore_notes_and_users, at line 1029: .merge(
  PandasTypeError: Output mismatch on totalRatingsMadeByRater: result=float64 expected=int64 (allowed)

INFO:birdwatch.run_scoring:----
    Completed individual scorers. Ran in parallel: False.  Succeeded in 6351.65 seconds. 
    Individual scorers: (name, runtime): [('MFCoreWithTopicsScorer', '9.66 mins'), ('MFCoreScorer', '8.86 mins'), ('MFExpansionScorer', '9.80 mins'), ('MFExpansionPlusScorer', '9.66 mins'), ('ReputationScorer', '3.27 mins'), ('MFGroupScorer_13', '6.00 mins'), ('MFGroupScorer_12', '3.73 mins'), ('MFGroupScorer_11', '4.04 mins'), ('MFGroupScorer_10', '3.85 mins'), ('MFGroupScorer_9', '3.85 mins'), ('MFGroupScorer_8', '3.61 mins'), ('MFGroupScorer_7', '3.80 mins'), ('MFGroupScorer_6', '4.22 mins'), ('MFGroupScorer_5', '3.61 mins'), ('MFGroupScorer_4', '3.59 mins'), ('MFGroupScorer_3', '3.82 mins'), ('MFGroupScorer_2', '3.75 mins'), ('MFGroupScorer_1', '3.84 mins'), ('MFGroupScorer_14', '4.63 mins'), ('MFGroupScorer_33', '3.84 mins'), ('MFTopicScorer_Unassigned', '0.06 mins'), ('MFTopicScorer_UkraineConflict', '0.14 mins'), ('MFTopicScorer_GazaConflict', '0.20 mins'), ('MFTopicScorer_MessiRonaldo', '0.03 mins'), ('MFTopicScorer_Scams', '0.08 mins'), ('MFMultiGroupScorer_1', '3.90 mins')]
    ----
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pandas_utils.py:405: FutureWarning: The behavior of DataFrame concatenation with empty or all-NA entries is deprecated. In a future version, this will no longer exclude empty or all-NA columns when determining the result dtypes. To retain the old behavior, exclude the relevant entries before the concat operation.
  result = self._origConcat(*args, **kwargs)

CONCAT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py, in combine_prescorer_scorer_results, at line 549: prescoringNoteModelOutput = pd.concat(
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64
  PandasTypeError: DataFrame concat on noteId: output=object inputs=[dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('int64'), dtype('O'), dtype('int64'), dtype('int64'), dtype('O'), dtype('int64'), dtype('int64')] (allowed)
  PandasTypeError: DataFrame concat on internalNoteIntercept: output=float32 inputs=[dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32')] (allowed)
  PandasTypeError: DataFrame concat on internalNoteFactor1: output=float32 inputs=[dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32')] (allowed)
  PandasTypeError: DataFrame concat on lowDiligenceNoteIntercept: output=float32 inputs=[dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32')] (allowed)
  PandasTypeError: DataFrame concat on lowDiligenceNoteFactor1: output=float32 inputs=[dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32')] (allowed)
  PandasTypeError: DataFrame concat on harassmentNoteIntercept: output=float32 inputs=[dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float32'), dtype('float64'), dtype('float64'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float32')] (UNALLOWED)
  PandasTypeError: DataFrame concat on harassmentNoteFactor1: output=float32 inputs=[dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float32'), dtype('float64'), dtype('float64'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float32')] (UNALLOWED)
  PandasTypeError: Type expectation mismatch on noteId: found=object expected=int64

/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pandas_utils.py:405: FutureWarning: The behavior of DataFrame concatenation with empty or all-NA entries is deprecated. In a future version, this will no longer exclude empty or all-NA columns when determining the result dtypes. To retain the old behavior, exclude the relevant entries before the concat operation.
  result = self._origConcat(*args, **kwargs)
/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pandas_utils.py:405: FutureWarning: The behavior of DataFrame concatenation with empty or all-NA entries is deprecated. In a future version, this will no longer exclude empty or all-NA columns when determining the result dtypes. To retain the old behavior, exclude the relevant entries before the concat operation.
  result = self._origConcat(*args, **kwargs)

CONCAT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py, in combine_prescorer_scorer_results, at line 570: raterParamsUnfilteredMultiScorers = pd.concat(
  PandasTypeError: DataFrame concat on internalRaterIntercept: output=float32 inputs=[dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32')] (allowed)
  PandasTypeError: DataFrame concat on internalRaterFactor1: output=float32 inputs=[dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32')] (allowed)
  PandasTypeError: DataFrame concat on internalFirstRoundRaterIntercept: output=float32 inputs=[dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32')] (UNALLOWED)
  PandasTypeError: DataFrame concat on internalFirstRoundRaterFactor1: output=float32 inputs=[dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32')] (UNALLOWED)
  PandasTypeError: DataFrame concat on crhCrnhRatioDifference: output=float64 inputs=[dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('O'), dtype('float64'), dtype('float64'), dtype('O'), dtype('float64'), dtype('float64')] (allowed)
  PandasTypeError: DataFrame concat on meanNoteScore: output=float64 inputs=[dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('O'), dtype('float64'), dtype('float64'), dtype('O'), dtype('float64'), dtype('float64')] (allowed)
  PandasTypeError: DataFrame concat on raterAgreeRatio: output=float64 inputs=[dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('O'), dtype('float64'), dtype('float64'), dtype('O'), dtype('float64'), dtype('float64')] (allowed)
  PandasTypeError: DataFrame concat on aboveHelpfulnessThreshold: output=object inputs=[dtype('bool'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('float64'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('bool'), dtype('O'), dtype('float64'), dtype('float64'), dtype('O'), dtype('float64'), dtype('bool')] (allowed)
  PandasTypeError: DataFrame concat on internalRaterReputation: output=float32 inputs=[dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float32'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64'), dtype('float64')] (allowed)
  PandasTypeError: DataFrame concat on lowDiligenceRaterIntercept: output=float32 inputs=[dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32')] (allowed)
  PandasTypeError: DataFrame concat on lowDiligenceRaterFactor1: output=float32 inputs=[dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32')] (allowed)
  PandasTypeError: DataFrame concat on lowDiligenceRaterReputation: output=float32 inputs=[dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float64'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32'), dtype('O'), dtype('float32'), dtype('float32')] (allowed)
  PandasTypeError: DataFrame concat on incorrectTagRatingsMadeByRater: output=Int64 inputs=[Int64Dtype(), Int64Dtype(), Int64Dtype(), Int64Dtype(), dtype('float64'), Int64Dtype(), Int8Dtype(), Int64Dtype(), Int8Dtype(), Int8Dtype(), Int8Dtype(), Int8Dtype(), Int64Dtype(), Int64Dtype(), Int8Dtype(), Int64Dtype(), Int8Dtype(), Int8Dtype(), Int64Dtype(), Int8Dtype(), Int8Dtype(), Int8Dtype(), Int8Dtype(), Int64Dtype()] (allowed)

INFO:birdwatch.run_scoring:notes total RAM: 4050264 bytes (0.004 GB)
                                    column     dtype     RAM
0                                   noteId     int64  400000
1                  noteAuthorParticipantId    object  400000
2                          createdAtMillis     int64  400000
3                                  tweetId    object  400000
4                           classification    object  400000
5                               believable  category   50124
6                                  harmful  category   50016
7                     validationDifficulty  category   50124
8                          misleadingOther      Int8  100000
9                   misleadingFactualError      Int8  100000
10              misleadingManipulatedMedia      Int8  100000
11           misleadingOutdatedInformation      Int8  100000
12       misleadingMissingImportantContext      Int8  100000
13         misleadingUnverifiedClaimAsFact      Int8  100000
14                        misleadingSatire      Int8  100000
15                      notMisleadingOther      Int8  100000
16           notMisleadingFactuallyCorrect      Int8  100000
17  notMisleadingOutdatedButNotWhenWritten      Int8  100000
18              notMisleadingClearlySatire      Int8  100000
19            notMisleadingPersonalOpinion      Int8  100000
20                      trustworthySources      Int8  100000
21                                 summary    object  400000
22                             isMediaNote      Int8  100000
23                     isCollaborativeNote      Int8  100000
INFO:birdwatch.run_scoring:ratings total RAM: 454637044 bytes (0.455 GB)
                                  column     dtype       RAM
0                                 noteId     int64  31904336
1                     raterParticipantId    object  31904336
2                        createdAtMillis     int64  31904336
3                                version      Int8   7976084
4                                  agree      Int8   7976084
5                               disagree      Int8   7976084
6                                helpful      Int8   7976084
7                             notHelpful      Int8   7976084
8                       helpfulnessLevel  category   3988174
9                           helpfulOther      Int8   7976084
10                    helpfulInformative      Int8   7976084
11                          helpfulClear      Int8   7976084
12                     helpfulEmpathetic      Int8   7976084
13                    helpfulGoodSources      Int8   7976084
14                  helpfulUniqueContext      Int8   7976084
15                 helpfulAddressesClaim      Int8   7976084
16               helpfulImportantContext      Int8   7976084
17               helpfulUnbiasedLanguage      Int8   7976084
18                       notHelpfulOther      Int8   7976084
19                   notHelpfulIncorrect      Int8   7976084
20  notHelpfulSourcesMissingOrUnreliable      Int8   7976084
21    notHelpfulOpinionSpeculationOrBias      Int8   7976084
22            notHelpfulMissingKeyPoints      Int8   7976084
23                    notHelpfulOutdated      Int8   7976084
24            notHelpfulHardToUnderstand      Int8   7976084
25       notHelpfulArgumentativeOrBiased      Int8   7976084
26                    notHelpfulOffTopic      Int8   7976084
27       notHelpfulSpamHarassmentOrAbuse      Int8   7976084
28           notHelpfulIrrelevantSources      Int8   7976084
29          notHelpfulOpinionSpeculation      Int8   7976084
30               notHelpfulNoteNotNeeded      Int8   7976084
31                        ratedOnTweetId     int64  31904336
32                  ratingSourceBucketed  category   3988166
33                            helpfulNum   float64  31904336
34                       highVolumeRater      bool   3988042
35                       correlatedRater      bool   3988042
36                    postSelectionValue   float64  31904336
37        postSelectionValue_note_author   float64  31904336
INFO:birdwatch.run_scoring:noteStatusHistory total RAM: 326123170 bytes (0.326 GB)
                                            column     dtype       RAM
0                                           noteId     int64  20224528
1                          noteAuthorParticipantId    object  20224528
2                                  createdAtMillis   float64  20224528
3               timestampMillisOfFirstNonNMRStatus   float64  20224528
4                                firstNonNMRStatus  category   2528190
5                   timestampMillisOfCurrentStatus   float64  20224528
6                                    currentStatus  category   2528198
7              timestampMillisOfLatestNonNMRStatus   float64  20224528
8                           mostRecentNonNMRStatus  category   2528190
9                      timestampMillisOfStatusLock   float64  20224528
10                                    lockedStatus  category   2528198
11                      timestampMillisOfRetroLock   float64  20224528
12                               currentCoreStatus  category   2528278
13                          currentExpansionStatus  category   2528278
14                              currentGroupStatus  category   2528270
15                                currentDecidedBy  category   2529378
16                            currentModelingGroup   float64  20224528
17         timestampMillisOfMostRecentStatusChange   float64  20224528
18       timestampMillisOfNmrDueToMinStableCrhTime   float64  20224528
19                         currentMultiGroupStatus  category   2528270
20                       currentModelingMultiGroup   float64  20224528
21             timestampMinuteOfFinalScoringOutput   float64  20224528
22  timestampMillisOfFirstNmrDueToMinStableCrhTime   float64  20224528
23                                  classification    object  20224528
INFO:birdwatch.run_scoring:userEnrollment total RAM: 77749221 bytes (0.078 GB)
                           column     dtype       RAM
0                   participantId    object  10912168
1                 enrollmentState    object  10912168
2  successfulRatingNeededToEarnIn     int64  10912168
3      timestampOfLastStateChange     int64  10912168
4          timestampOfLastEarnOut   float64  10912168
5              modelingPopulation  category   1364045
6                   modelingGroup   float64  10912168
7          numberOfTimesEarnedOut     int64  10912168
INFO:birdwatch.run_scoring:prescoringNoteModelOutput total RAM: 118663952 bytes (0.119 GB)
                            column    dtype       RAM
0                           noteId   object  21575264
1            internalNoteIntercept  float32  10787632
2              internalNoteFactor1  float32  10787632
3                       scorerName   object  21575264
4        lowDiligenceNoteIntercept  float32  10787632
5          lowDiligenceNoteFactor1  float32  10787632
6  lowDiligenceNoteInterceptRound2  float32  10787632
7          harassmentNoteIntercept  float32  10787632
8            harassmentNoteFactor1  float32  10787632
INFO:birdwatch.run_scoring:prescoringRaterModelOutput total RAM: 93648060 bytes (0.094 GB)
                                          column    dtype      RAM
0                             raterParticipantId   object  4540512
1                         internalRaterIntercept  float32  2270256
2                           internalRaterFactor1  float32  2270256
3               internalFirstRoundRaterIntercept  float32  2270256
4                 internalFirstRoundRaterFactor1  float32  2270256
5                         crhCrnhRatioDifference  float64  4540512
6                                  meanNoteScore  float64  4540512
7                                raterAgreeRatio  float64  4540512
8                      aboveHelpfulnessThreshold   object  4540512
9                                     scorerName   object  4540512
10                       internalRaterReputation  float32  2270256
11                    lowDiligenceRaterIntercept  float32  2270256
12                      lowDiligenceRaterFactor1  float32  2270256
13                   lowDiligenceRaterReputation  float32  2270256
14              lowDiligenceRaterInterceptRound2  float32  2270256
15                incorrectTagRatingsMadeByRater    Int64  5108076
16                       totalRatingsMadeByRater  float64  4540512
17                            postSelectionValue  float64  4540512
18                  successfulRatingHelpfulCount  float64  4540512
19               successfulRatingNotHelpfulCount  float64  4540512
20                unsuccessfulRatingHelpfulCount  float64  4540512
21             unsuccessfulRatingNotHelpfulCount  float64  4540512
22                 totalHelpfulHarassmentPenalty  float64  4540512
23  raterAgreeRatioKeyWithHarassmentAbusePenalty  float64  4540512
24                              quasiCliqueValue  float64  4540512
INFO:birdwatch.constants:Logging Prescoring Results RAM usage (before conversion) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.run_scoring:notes total RAM: 4050264 bytes (0.004 GB)
                                    column     dtype     RAM
0                                   noteId     int64  400000
1                  noteAuthorParticipantId    object  400000
2                          createdAtMillis     int64  400000
3                                  tweetId    object  400000
4                           classification    object  400000
5                               believable  category   50124
6                                  harmful  category   50016
7                     validationDifficulty  category   50124
8                          misleadingOther      Int8  100000
9                   misleadingFactualError      Int8  100000
10              misleadingManipulatedMedia      Int8  100000
11           misleadingOutdatedInformation      Int8  100000
12       misleadingMissingImportantContext      Int8  100000
13         misleadingUnverifiedClaimAsFact      Int8  100000
14                        misleadingSatire      Int8  100000
15                      notMisleadingOther      Int8  100000
16           notMisleadingFactuallyCorrect      Int8  100000
17  notMisleadingOutdatedButNotWhenWritten      Int8  100000
18              notMisleadingClearlySatire      Int8  100000
19            notMisleadingPersonalOpinion      Int8  100000
20                      trustworthySources      Int8  100000
21                                 summary    object  400000
22                             isMediaNote      Int8  100000
23                     isCollaborativeNote      Int8  100000
INFO:birdwatch.run_scoring:ratings total RAM: 454637044 bytes (0.455 GB)
                                  column     dtype       RAM
0                                 noteId     int64  31904336
1                     raterParticipantId    object  31904336
2                        createdAtMillis     int64  31904336
3                                version      Int8   7976084
4                                  agree      Int8   7976084
5                               disagree      Int8   7976084
6                                helpful      Int8   7976084
7                             notHelpful      Int8   7976084
8                       helpfulnessLevel  category   3988174
9                           helpfulOther      Int8   7976084
10                    helpfulInformative      Int8   7976084
11                          helpfulClear      Int8   7976084
12                     helpfulEmpathetic      Int8   7976084
13                    helpfulGoodSources      Int8   7976084
14                  helpfulUniqueContext      Int8   7976084
15                 helpfulAddressesClaim      Int8   7976084
16               helpfulImportantContext      Int8   7976084
17               helpfulUnbiasedLanguage      Int8   7976084
18                       notHelpfulOther      Int8   7976084
19                   notHelpfulIncorrect      Int8   7976084
20  notHelpfulSourcesMissingOrUnreliable      Int8   7976084
21    notHelpfulOpinionSpeculationOrBias      Int8   7976084
22            notHelpfulMissingKeyPoints      Int8   7976084
23                    notHelpfulOutdated      Int8   7976084
24            notHelpfulHardToUnderstand      Int8   7976084
25       notHelpfulArgumentativeOrBiased      Int8   7976084
26                    notHelpfulOffTopic      Int8   7976084
27       notHelpfulSpamHarassmentOrAbuse      Int8   7976084
28           notHelpfulIrrelevantSources      Int8   7976084
29          notHelpfulOpinionSpeculation      Int8   7976084
30               notHelpfulNoteNotNeeded      Int8   7976084
31                        ratedOnTweetId     int64  31904336
32                  ratingSourceBucketed  category   3988166
33                            helpfulNum   float64  31904336
34                       highVolumeRater      bool   3988042
35                       correlatedRater      bool   3988042
36                    postSelectionValue   float64  31904336
37        postSelectionValue_note_author   float64  31904336
INFO:birdwatch.run_scoring:noteStatusHistory total RAM: 326123170 bytes (0.326 GB)
                                            column     dtype       RAM
0                                           noteId     int64  20224528
1                          noteAuthorParticipantId    object  20224528
2                                  createdAtMillis   float64  20224528
3               timestampMillisOfFirstNonNMRStatus   float64  20224528
4                                firstNonNMRStatus  category   2528190
5                   timestampMillisOfCurrentStatus   float64  20224528
6                                    currentStatus  category   2528198
7              timestampMillisOfLatestNonNMRStatus   float64  20224528
8                           mostRecentNonNMRStatus  category   2528190
9                      timestampMillisOfStatusLock   float64  20224528
10                                    lockedStatus  category   2528198
11                      timestampMillisOfRetroLock   float64  20224528
12                               currentCoreStatus  category   2528278
13                          currentExpansionStatus  category   2528278
14                              currentGroupStatus  category   2528270
15                                currentDecidedBy  category   2529378
16                            currentModelingGroup   float64  20224528
17         timestampMillisOfMostRecentStatusChange   float64  20224528
18       timestampMillisOfNmrDueToMinStableCrhTime   float64  20224528
19                         currentMultiGroupStatus  category   2528270
20                       currentModelingMultiGroup   float64  20224528
21             timestampMinuteOfFinalScoringOutput   float64  20224528
22  timestampMillisOfFirstNmrDueToMinStableCrhTime   float64  20224528
23                                  classification    object  20224528
INFO:birdwatch.run_scoring:userEnrollment total RAM: 77749221 bytes (0.078 GB)
                           column     dtype       RAM
0                   participantId    object  10912168
1                 enrollmentState    object  10912168
2  successfulRatingNeededToEarnIn     int64  10912168
3      timestampOfLastStateChange     int64  10912168
4          timestampOfLastEarnOut   float64  10912168
5              modelingPopulation  category   1364045
6                   modelingGroup   float64  10912168
7          numberOfTimesEarnedOut     int64  10912168
INFO:birdwatch.run_scoring:prescoringNoteModelOutput total RAM: 118663952 bytes (0.119 GB)
                            column    dtype       RAM
0                           noteId   object  21575264
1            internalNoteIntercept  float32  10787632
2              internalNoteFactor1  float32  10787632
3                       scorerName   object  21575264
4        lowDiligenceNoteIntercept  float32  10787632
5          lowDiligenceNoteFactor1  float32  10787632
6  lowDiligenceNoteInterceptRound2  float32  10787632
7          harassmentNoteIntercept  float32  10787632
8            harassmentNoteFactor1  float32  10787632
INFO:birdwatch.run_scoring:prescoringRaterModelOutput total RAM: 93648060 bytes (0.094 GB)
                                          column    dtype      RAM
0                             raterParticipantId   object  4540512
1                         internalRaterIntercept  float32  2270256
2                           internalRaterFactor1  float32  2270256
3               internalFirstRoundRaterIntercept  float32  2270256
4                 internalFirstRoundRaterFactor1  float32  2270256
5                         crhCrnhRatioDifference  float64  4540512
6                                  meanNoteScore  float64  4540512
7                                raterAgreeRatio  float64  4540512
8                      aboveHelpfulnessThreshold   object  4540512
9                                     scorerName   object  4540512
10                       internalRaterReputation  float32  2270256
11                    lowDiligenceRaterIntercept  float32  2270256
12                      lowDiligenceRaterFactor1  float32  2270256
13                   lowDiligenceRaterReputation  float32  2270256
14              lowDiligenceRaterInterceptRound2  float32  2270256
15                incorrectTagRatingsMadeByRater    Int64  5108076
16                       totalRatingsMadeByRater  float64  4540512
17                            postSelectionValue  float64  4540512
18                  successfulRatingHelpfulCount  float64  4540512
19               successfulRatingNotHelpfulCount  float64  4540512
20                unsuccessfulRatingHelpfulCount  float64  4540512
21             unsuccessfulRatingNotHelpfulCount  float64  4540512
22                 totalHelpfulHarassmentPenalty  float64  4540512
23  raterAgreeRatioKeyWithHarassmentAbusePenalty  float64  4540512
24                              quasiCliqueValue  float64  4540512
INFO:birdwatch.constants:Logging Prescoring Results RAM usage (after conversion) elapsed time: 0.09 secs (0.00 mins)
INFO:birdwatch.run_scoring:prescoringRaterModelOutput total RAM: 93662580 bytes (0.094 GB)
                                          column    dtype      RAM
0                             raterParticipantId   object  4541216
1                         internalRaterIntercept  float32  2270608
2                           internalRaterFactor1  float32  2270608
3               internalFirstRoundRaterIntercept  float32  2270608
4                 internalFirstRoundRaterFactor1  float32  2270608
5                         crhCrnhRatioDifference  float64  4541216
6                                  meanNoteScore  float64  4541216
7                                raterAgreeRatio  float64  4541216
8                      aboveHelpfulnessThreshold   object  4541216
9                                     scorerName   object  4541216
10                       internalRaterReputation  float32  2270608
11                    lowDiligenceRaterIntercept  float32  2270608
12                      lowDiligenceRaterFactor1  float32  2270608
13                   lowDiligenceRaterReputation  float32  2270608
14              lowDiligenceRaterInterceptRound2  float32  2270608
15                incorrectTagRatingsMadeByRater    Int64  5108868
16                       totalRatingsMadeByRater  float64  4541216
17                            postSelectionValue  float64  4541216
18                  successfulRatingHelpfulCount  float64  4541216
19               successfulRatingNotHelpfulCount  float64  4541216
20                unsuccessfulRatingHelpfulCount  float64  4541216
21             unsuccessfulRatingNotHelpfulCount  float64  4541216
22                 totalHelpfulHarassmentPenalty  float64  4541216
23  raterAgreeRatioKeyWithHarassmentAbusePenalty  float64  4541216
24                              quasiCliqueValue  float64  4541216
INFO:birdwatch.constants:Logging Prescoring Results RAM usage (after concatenation) elapsed time: 0.01 secs (0.00 mins)

MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pflip_plus_model.py, in _get_notes, at line 242: noteStatusHistory[[c.noteIdKey, c.createdAtMillisKey]].merge(
  PandasTypeError: Input mismatch on createdAtMillis: left=Int64 vs right=int64 (UNALLOWED)
  PandasTypeError: Merge key mismatch on createdAtMillis: left=Int64 vs right=int64 (UNALLOWED)
  PandasTypeError: Output mismatch on createdAtMillis: result=Int64 expected=None (UNALLOWED)

INFO:birdwatch.pflip_plus_model:labels before ScoringDriftGuard:
LABEL
CRH     1562
FLIP     636
Name: count, dtype: int64
INFO:birdwatch.pflip_plus_model:labels after ScoringDriftGuard:
LABEL
CRH     1521
FLIP     636
Name: count, dtype: int64

INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pflip_plus_model.py, in _compute_scoring_cutoff, at line 335: .astype(pd.Int64Dtype())
  PandasTypeError: Type expectation mismatch on noteId: found=Int64 expected=int64


INIT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pflip_plus_model.py, in _compute_scoring_cutoff, at line 342: .astype(pd.Int64Dtype()),
  PandasTypeError: Type expectation mismatch on noteId: found=Int64 expected=int64


CONCAT WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pflip_plus_model.py, in _compute_scoring_cutoff, at line 337: cutoffByRatings = cutoffByRatings.merge(
  PandasTypeError: Type expectation mismatch on noteId: found=Int64 expected=int64
  PandasTypeError: Type expectation mismatch on noteId: found=Int64 expected=int64


MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pflip_plus_model.py, in _compute_scoring_cutoff, at line 337: cutoffByRatings = cutoffByRatings.merge(
  PandasTypeError: Type expectation mismatch on noteId: found=Int64 expected=int64
  PandasTypeError: Type expectation mismatch on noteId: found=Int64 expected=int64
  PandasTypeError: Type expectation mismatch on noteId: found=Int64 expected=int64


MERGE WARNING(S) AT: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pflip_plus_model.py, in _compute_scoring_cutoff, at line 348: scoringCutoff = scoringCutoff.merge(cutoffByRatings[[c.noteIdKey, "ratingMin"]])
  PandasTypeError: Type expectation mismatch on noteId: found=Int64 expected=int64
  PandasTypeError: Input mismatch on noteId: left=int64 vs right=Int64 (UNALLOWED)
  PandasTypeError: Merge key mismatch on noteId: left=int64 vs right=Int64 (UNALLOWED)
  PandasTypeError: Output mismatch on noteId: result=int64 expected=None (UNALLOWED)

INFO:birdwatch.constants:Fitting pflip model elapsed time: 11.45 secs (0.19 mins)
Patching pandas
Pairs dict used 2.6843546480000002GB RAM at max
Pairs dict used 2.6843546480000002GB RAM after deleted unneeded pairs
TERM_PROGRAM: Apple_Terminal
SHELL: /bin/zsh
TERM: xterm-256color
TMPDIR: /var/folders/06/vqf6dx7s0mdbgx_rpjv0hc5m0000gn/T/
TERM_PROGRAM_VERSION: 453
TERM_SESSION_ID: F736EB59-D622-4D96-8E2F-8FE9FDD8CEF1
USER: canbo
SSH_AUTH_SOCK: /private/tmp/com.apple.launchd.p38rtIG1br/Listeners
PATH: /Users/canbo/INFO494/494-algo-representations/cn_venv/bin:/Users/canbo/.local/bin:/Library/Frameworks/Python.framework/Versions/3.14/bin:/opt/local/bin:/opt/local/sbin:/Library/Frameworks/Python.framework/Versions/3.13/bin:/usr/local/bin:/System/Cryptexes/App/usr/bin:/usr/bin:/bin:/usr/sbin:/sbin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/local/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/appleinternal/bin
LaunchInstanceID: FEDCD432-4AA4-450A-B3C3-C3F601934137
__CFBundleIdentifier: com.apple.Terminal
PWD: /Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src
XPC_FLAGS: 0x0
XPC_SERVICE_NAME: 0
SHLVL: 1
HOME: /Users/canbo
LOGNAME: canbo
SECURITYSESSIONID: 186a2
OLDPWD: /Users/canbo/INFO494/494-algo-representations
VIRTUAL_ENV: /Users/canbo/INFO494/494-algo-representations/cn_venv
VIRTUAL_ENV_PROMPT: (cn_venv) 
PS1: ((cn_venv) ) %n@%m %1~ %# 
LANG: en_US.UTF-8
_: /Users/canbo/INFO494/494-algo-representations/cn_venv/bin/python3.12
__CF_USER_TEXT_ENCODING: 0x1F5:0x0:0x0
KMP_INIT_AT_FORK: FALSE
KMP_DUPLICATE_LIB_OK: True
[Pipeline] .... (step 1 of 3) Processing UnigramEncoder, total=   7.3s
[Pipeline] ............. (step 2 of 3) Processing tfidf, total=   0.1s
[Pipeline] ........ (step 3 of 3) Processing Classifier, total=   1.8s
(4181, 3)
Excluding ratings outside of group
Traceback (most recent call last):
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/main.py", line 31, in <module>
    main()
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/runner.py", line 278, in main
    return _run_scorer(args=args, dataLoader=dataLoader, extraScoringArgs=extraScoringArgs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pandas_utils.py", line 722, in _inner
    retVal = main(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/runner.py", line 231, in _run_scorer
    scoredNotes, helpfulnessScores, newStatus, auxNoteInfo = run_scoring(
                                                             ^^^^^^^^^^^^
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py", line 2089, in run_scoring
    ) = run_prescoring(
        ^^^^^^^^^^^^^^^
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/run_scoring.py", line 1348, in run_prescoring
    pflipPlusModel.fit(notes, ratings, noteStatusHistory, prescoringRaterModelOutput)
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pflip_plus_model.py", line 1566, in fit
    self._prepare_note_info(
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pflip_plus_model.py", line 1054, in _prepare_note_info
    scoringCutoff = self._compute_scoring_cutoff(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/canbo/INFO494/494-algo-representations/communitynotes/scoring/src/scoring/pflip_plus_model.py", line 349, in _compute_scoring_cutoff
    assert len(scoringCutoff) == beforeMerge
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AssertionError
